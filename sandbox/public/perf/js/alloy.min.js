/**
 * Copyright 2019 Adobe. All rights reserved.
 * This file is licensed to you under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License. You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS
 * OF ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 */

"use strict";document.documentMode&&document.documentMode<11?console.warn("The Adobe Experience Cloud Web SDK does not support IE 10 and below."):function(){var e=function(e,n){return-1!==e.indexOf(n)},n=["Chrome","Edge","EdgeChromium","IE","Unknown"],t=function(t){return e(n,t)},r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function a(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var u=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var n={},t=0;t<10;t++)n["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(n).map((function(e){return n[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,n){for(var t,u,c=a(e),s=1;s<arguments.length;s++){for(var f in t=Object(arguments[s]))o.call(t,f)&&(c[f]=t[f]);if(r){u=r(t);for(var d=0;d<u.length;d++)i.call(t,u[d])&&(c[u[d]]=t[u[d]])}}return c},c=function(e){return JSON.parse(JSON.stringify(e))},s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function f(e,n){return e(n={exports:{}},n.exports),n.exports}var d=f((function(e,n){var t;t=function(){function e(){for(var e=0,n={};e<arguments.length;e++){var t=arguments[e];for(var r in t)n[r]=t[r]}return n}return function n(t){function r(n,o,i){var a;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(i=e({path:"/"},r.defaults,i)).expires){var u=new Date;u.setMilliseconds(u.getMilliseconds()+864e5*i.expires),i.expires=u}i.expires=i.expires?i.expires.toUTCString():"";try{a=JSON.stringify(o),/^[\{\[]/.test(a)&&(o=a)}catch(e){}o=t.write?t.write(o,n):encodeURIComponent(String(o)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=(n=(n=encodeURIComponent(String(n))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var c="";for(var s in i)i[s]&&(c+="; "+s,!0!==i[s]&&(c+="="+i[s]));return document.cookie=n+"="+o+c}n||(a={});for(var f=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,l=0;l<f.length;l++){var g=f[l].split("="),p=g.slice(1).join("=");'"'===p.charAt(0)&&(p=p.slice(1,-1));try{var m=g[0].replace(d,decodeURIComponent);if(p=t.read?t.read(p,m):t(p,m)||p.replace(d,decodeURIComponent),this.json)try{p=JSON.parse(p)}catch(e){}if(n===m){a=p;break}n||(a[m]=p)}catch(e){}}return a}}return r.set=r,r.get=function(e){return r.call(r,e)},r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(n,t){r(n,"",e(t,{expires:-1}))},r.withConverter=n,r}((function(){}))},e.exports=t()})),l={get:d.get,set:d.set,remove:d.remove},g=function(e){return null==e};function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function v(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function y(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?v(t,!0).forEach((function(n){m(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(t).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function h(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function w(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var t=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(t.push(a.value),!n||t.length!==n);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function b(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var E=function(e){return!g(e)&&!Array.isArray(e)&&"object"===p(e)},C=function e(n,t){Object.keys(t).forEach((function(r){E(n[r])&&E(t[r])?e(n[r],t[r]):n[r]=t[r]}))},I=function(e){if(g(e))throw new TypeError('deepAssign "target" cannot be null or undefined');for(var n=Object(e),t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return r.forEach((function(e){return C(n,Object(e))})),n},O=function(e,n){return function(t){var r=n.split(".").reduce((function(e,n){return e[n]=e[n]||{},e[n]}),e);I(r,t)}},k=function(){var e=[];return{add:function(n){e.push(n)},call:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return Promise.all(e.map((function(e){return e.apply(void 0,t)})))}}},R=function(e,n){for(var t=0;t<e.length;t+=1){var r=e[t];if(n(r,t,e))return r}},S=function(e,n){return e.appendChild(n)},x=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document,i=o.createElement(e);return Object.keys(n).forEach((function(e){i.setAttribute(e,n[e])})),Object.keys(t).forEach((function(e){i[e]=t[e]})),r.forEach((function(e){return S(i,e)})),i},P="src",T=function(e){var n=e.src,t=e.currentDocument,r=void 0===t?document:t;return new Promise((function(e,t){x("IMG",{src:n},{onload:e,onerror:t,onabort:t},[],r)}))},j=function(e){return"function"==typeof e},q=function(e){return Array.isArray(e)&&e.length>0},D=function(e){return Array.isArray(e)?e:null==e?[]:[].slice.call(e)},M=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return D(n.querySelectorAll(e))},N={childList:!0,subtree:!0},A=function(e){return new Error("Could not find: "+e)},_=function(e){return new Promise(e)},F=function(e){return j(e.MutationObserver)},U=function(e,n,t,r,o){return _((function(i,a){var u=new e.MutationObserver((function(){var e=o(t);q(e)&&(u.disconnect(),i(e))}));setTimeout((function(){u.disconnect(),a(A(t))}),r),u.observe(n,N)}))},B=function(e){return"visible"===e.visibilityState},L=function(e,n,t,r){return _((function(o,i){!function t(){var i=r(n);q(i)?o(i):e.requestAnimationFrame(t)}(),setTimeout((function(){i(A(n))}),t)}))},V=function(e,n,t){return _((function(r,o){!function n(){var o=t(e);q(o)?r(o):setTimeout(n,100)}(),setTimeout((function(){o(A(e))}),n)}))},H=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document,i=n(e);return q(i)?Promise.resolve(i):F(r)?U(r,o,e,t,n):B(o)?L(r,e,t,n):V(e,t,n)},J=function(e){var n=e.parentNode;return n?n.removeChild(e):null},z=T,Q={name:"Adobe Alloy",style:"display: none; width: 0; height: 0;"},W=function(e){var n,t=e.hideReferrer,r=e.url;return t?(n={src:r}.src,H("BODY").then((function(e){var n=w(e,1)[0],t=x("IFRAME",Q);return S(n,t)})).then((function(e){var t=e.contentWindow.document;return T({src:n,currentDocument:t}).then((function(){J(e)}))}))):z({src:r})},X=function(e,n){return Array.prototype.concat.apply([],e.map(n))},G="com.adobe.alloy.getTld",$=function(e,n){for(var t,r,o="",i=e.location.hostname.toLowerCase().split("."),a=1;a<i.length&&!n.get(G);)o=(t=i,r=a+=1,t.slice(-r)).join("."),n.set(G,G,{domain:o});return n.remove(G,{domain:o}),o},Y=function(e){return e.replace("@","_")},K=function(e,n){return"kndctr_"+Y(e)+"_"+n},Z=function(n,t){return n.filter((function(n){return e(t,n)}))},ee=function(e){return E(e)&&0===Object.keys(e).length},ne=function(e){return"number"==typeof e&&!isNaN(e)},te=function(e){return"string"==typeof e},re=function(e){return te(e)&&e.length>0},oe=function(){},ie=function(e,n,t){var r=String(e),o=String(t);if(r.length>=n||0===o.length)return r;for(var i=n-r.length;i>o.length;)o+=o;return o.slice(0,i)+r};function ae(e,n){return Object.prototype.hasOwnProperty.call(e,n)}for(var ue=function(e,n,t,r){n=n||"&",t=t||"=";var o={};if("string"!=typeof e||0===e.length)return o;var i=/\+/g;e=e.split(n);var a=1e3;r&&"number"==typeof r.maxKeys&&(a=r.maxKeys);var u=e.length;a>0&&u>a&&(u=a);for(var c=0;c<u;++c){var s,f,d,l,g=e[c].replace(i,"%20"),p=g.indexOf(t);p>=0?(s=g.substr(0,p),f=g.substr(p+1)):(s=g,f=""),d=decodeURIComponent(s),l=decodeURIComponent(f),ae(o,d)?Array.isArray(o[d])?o[d].push(l):o[d]=[o[d],l]:o[d]=l}return o},ce=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},se=function(e,n,t,r){return n=n||"&",t=t||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(r){var o=encodeURIComponent(ce(r))+t;return Array.isArray(e[r])?e[r].map((function(e){return o+encodeURIComponent(ce(e))})).join(n):o+encodeURIComponent(ce(e[r]))})).join(n):r?encodeURIComponent(ce(r))+t+encodeURIComponent(ce(e)):""},fe=f((function(e,n){n.decode=n.parse=ue,n.encode=n.stringify=se})),de=(fe.decode,fe.parse,fe.encode,fe.stringify,function(e){return"string"==typeof e&&(e=e.trim().replace(/^[?#&]/,"")),fe.parse(e)}),le=function(e){return e instanceof Error?e:new Error(e)},ge=function(e,n){var t=le(n);return t.message=e+"\nCaused by: "+t.message,t},pe=function(e,n,t){return{getItem:function(r){try{return e[n].getItem(t+r)}catch(e){return null}},setItem:function(r,o){try{return e[n].setItem(t+r,o),!0}catch(e){return!1}}}},me=function(e){var n=e.getFullYear(),t=ie(e.getMonth()+1,2,"0"),r=ie(e.getDate(),2,"0"),o=ie(e.getHours(),2,"0"),i=ie(e.getMinutes(),2,"0"),a=ie(e.getSeconds(),2,"0"),u=ie(e.getMilliseconds(),3,"0"),c=e.getTimezoneOffset();return n+"-"+t+"-"+r+"T"+o+":"+i+":"+a+"."+u+(c>0?"-":"+")+ie(Math.floor(Math.abs(c)/60),2,"0")+":"+ie(Math.abs(c)%60,2,"0")},ve=f((function(e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var t=new Uint8Array(16);e.exports=function(){return n(t),t}}else{var r=new Array(16);e.exports=function(){for(var e,n=0;n<16;n++)0==(3&n)&&(e=4294967296*Math.random()),r[n]=e>>>((3&n)<<3)&255;return r}}})),ye=[],he=0;he<256;++he)ye[he]=(he+256).toString(16).substr(1);var we=function(e,n){var t=n||0,r=ye;return[r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]]].join("")};var be=function(e,n,t){var r=n&&t||0;"string"==typeof e&&(n="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||ve)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,n)for(var i=0;i<16;++i)n[r+i]=o[i];return n||we(o)},Ee=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=function(t,r){return n(e(t,r),r)};return u(r,e,t),r},Ce=function(e,n,t){return Ee(e,(function(e,t){return null==e?e:n(e,t)}),t)},Ie=function(e,n,t,r){if(!e)throw new Error("'"+t+"': Expected "+r+", but got "+JSON.stringify(n)+".")},Oe=function(e,n){return Ie(function(e){return"boolean"==typeof e}(e),e,n,"true or false"),e},ke=function(e,n){return Ie(j(e),e,n,"a function"),e},Re=function(e,n){return function(t,r){return Ie(t>=n,t,r,e+" greater than or equal to "+n),t}},Se=function(e){return function(n,t){return E(n)?Ie(!ee(n),n,t,e):Ie(n.length>0,n,t,e),n}},xe=/^[a-z0-9.-]{1,}$/i,Pe=function(e,n){return Ie(xe.test(e),e,n,"a valid domain"),e},Te=function(e,n){return Ie(function(e){var n=parseInt(e,10);return ne(n)&&e===n}(e),e,n,"an integer"),e},je=function(e,n){return Ie(ne(e),e,n,"a number"),e},qe=function(e,n){return Ie(function(e){try{return null!==new RegExp(e)}catch(e){return!1}}(e),e,n,"a regular expression"),e},De=function(e,n){if(null==e)throw new Error("'"+n+"' is a required option");return e},Me=function(e,n){return Ie(te(e),e,n,"a string"),e},Ne=function(e){return e};Ne.default=function(e){return Ee(this,function(e){return function(n){return null==n?e:n}}(e))},Ne.required=function(){return Ee(this,De)};var Ae=function(){return Ce(this,Pe)},_e=function(e){return Ce(this,Re("an integer",e))},Fe=function(e){return Ce(this,Re("a number",e))},Ue=function(){return Ce(this,Te,{minimum:_e})},Be=function(){return Ce(this,Se("a non-empty string"))},Le=function(){return Ce(this,Se("a non-empty array"))},Ve=function(){return Ce(this,Se("a non-empty object"))},He=function(){return Ce(this,qe)},Je=function(){return Ce(this,function(){var e=[];return function(n,t){return Ie(-1===e.indexOf(n),n,t,"a unique value across instances"),e.push(n),n}}())},ze=function(e,n){return Ee(this,function(e,n){return function(t,r){var o=R(e,(function(e){try{return e(t,r),!0}catch(e){return!1}}));return Ie(o,t,r,n),t}}(e,n))}.bind(Ne),Qe=function(){return Ce(this,Ne)}.bind(Ne),We=function(e){return Ce(this,function(e){return function(n,t){Ie(Array.isArray(n),n,t,"an array");var r=[],o=n.map((function(n,o){try{return e(n,t+"["+o+"]")}catch(e){return void r.push(e.message)}}));if(r.length)throw new Error(r.join("\n"));return o}}(e),{nonEmpty:Le})}.bind(Ne),Xe=function(){return Ce(this,Oe)}.bind(Ne),Ge=function(){return Ce(this,ke)}.bind(Ne),$e=function(e){return Ce(this,function(e){return function(n,t){return Ie(n===e,n,t,""+e),n}}(e))}.bind(Ne),Ye=(function(){return Ce(this,je,{minimum:Fe,integer:Ue,unique:Je})}.bind(Ne),function(e){return Ce(this,(n=e,function(e,t){Ie(E(e),e,t,"an object");var r=[],o={};if(Object.keys(e).forEach((function(i){var a=e[i],u=t?t+"."+i:i;try{var c=n(a,u);void 0!==c&&(o[i]=c)}catch(e){r.push(e.message)}})),r.length)throw new Error(r.join("\n"));return o}),{nonEmpty:Ve});var n}.bind(Ne)),Ke=function(e){return Ce(this,function(e){return function(n,t){Ie(E(n),n,t,"an object");var r=[],o={};if(Object.keys(e).forEach((function(i){var a=n[i],u=e[i],c=t?t+"."+i:i;try{var s=u(a,c);void 0!==s&&(o[i]=s)}catch(e){r.push(e.message)}})),Object.keys(n).forEach((function(e){Object.prototype.hasOwnProperty.call(o,e)||(o[e]=n[e])})),r.length)throw new Error(r.join("\n"));return o}}(e),{noUnknownFields:function(){return Ce(this,function(e){return function(n,t){var r=[];if(Object.keys(n).forEach((function(n){if(!e[n]){var o=t?t+"."+n:n;r.push("'"+o+"': Unknown field.")}})),r.length)throw new Error(r.join("\n"));return n}}(e))},nonEmpty:Ve})}.bind(Ne),Ze=function(){return Ce(this,Me,{regexp:He,domain:Ae,nonEmpty:Be,unique:Je})}.bind(Ne),en=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return ze(n.map($e),"one of these values: ["+JSON.stringify(n)+"]")},nn=Ye(We(Ke({authenticatedState:en("ambiguous","authenticated","loggedOut"),id:Ze(),namespace:Ke({code:Ze()}).noUnknownFields(),primary:Xe(),xid:Ze()})).required()),tn=function(e){return Object.keys(e).map((function(n){return e[n]}))},rn=function(e){var n,t=e.console,r=e.locationSearch,o=e.createLogger,i=e.instanceName,a=e.createNamespacedStorage,u=e.getMonitors,c=de(r),s=a("instance."+i+"."),f=s.session.getItem("debug"),d="true"===f,l=null===f,g=function(){return d},p=function(e,n){var t=n.fromConfig;t&&!l||(d=e),t||(s.session.setItem("debug",e.toString()),l=!1)};return void 0!==c.alloy_debug&&p((n=c.alloy_debug,te(n)&&"true"===n.toLowerCase()),{fromConfig:!1}),{setDebugEnabled:p,logger:o({getDebugEnabled:g,context:{instanceName:i},getMonitors:u,console:t}),createComponentLogger:function(e){return o({getDebugEnabled:g,context:{instanceName:i,componentName:e},getMonitors:u,console:t})}}},on=["onComponentsRegistered","onBeforeEvent","onBeforeDataCollectionRequest","onBeforeRequest","onResponse","onRequestFailure","onClick"],an=function(e){return on.reduce((function(n,t){var r;return n[t]=(r=function(e,n){return function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return Promise.all(e.getLifecycleCallbacks(n).map((function(e){return new Promise((function(n){n(e.apply(void 0,r))}))})))}}(e,t),function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return Promise.resolve().then((function(){return r.apply(void 0,n)}))}),n}),{})},un=function(e,n){return function(){var t;try{t=e.apply(void 0,arguments)}catch(e){throw ge(n,e)}return t instanceof Promise&&(t=t.catch((function(e){throw ge(n,e)}))),t}},cn=function(){var e={},n={};return{register:function(t,r){var o=r.commands,i=r.lifecycle;!function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Z(Object.keys(e),Object.keys(t));if(r.length)throw new Error("[ComponentRegistry] Could not register "+n+" because it has existing command(s): "+r.join(","));Object.keys(t).forEach((function(r){var o=t[r];o.commandName=r,o.run=un(o.run,"["+n+"] An error occurred while executing the "+r+" command."),e[r]=o}))}(t,o),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(t).forEach((function(r){n[r]=n[r]||[],n[r].push(un(t[r],"["+e+"] An error occurred while executing the "+r+" lifecycle hook."))}))}(t,i)},getCommand:function(n){return e[n]},getCommandNames:function(){return Object.keys(e)},getLifecycleCallbacks:function(e){return n[e]||[]}}},sn=function(){var e=new Error("The user declined consent.");return e.code="declinedConsent",e},fn=function(){var e=[],n=function(){return Promise.resolve()},t=function(){return Promise.reject(sn())},r=function(){var n=function(){var e={};return e.promise=new Promise((function(n,t){e.resolve=n,e.reject=t})),e}();return e.push(n),n.promise};return{in:function(){!function(){for(;e.length;)e.shift().resolve()}(),this.awaitConsent=n},out:function(){!function(){for(;e.length;)e.shift().reject(sn())}(),this.awaitConsent=t},pending:function(){this.awaitConsent=r},awaitConsent:r}},dn=function(){var e,n,t={},r=!1,o=oe,i={setUserXdm:function(n){e=n},setUserData:function(e){n=e},mergeXdm:O(t,"xdm"),mergeMeta:O(t,"meta"),mergeQuery:O(t,"query"),documentMayUnload:function(){r=!0},getDocumentMayUnload:function(){return r},isEmpty:function(){return ee(t)&&(!e||ee(e))&&(!n||ee(n))},setLastChanceCallback:function(e){o=e},toJSON:function(){e&&i.mergeXdm(e),n&&(t.data=n);var r=c(Object(t.xdm)),a=c(Object(t.data));try{o({xdm:r,data:a}),!t.xdm&&ee(r)||(t.xdm=r),!t.data&&ee(a)||(t.data=a)}catch(e){}return t}};return i},ln=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.handle,t=void 0===n?[]:n,r=e.errors,o=void 0===r?[]:r,i=e.warnings,a=void 0===i?[]:i;return{getPayloadsByType:function(e){return X(t.filter((function(n){return n.type===e})),(function(e){return e.payload}))},getErrors:function(){return o},getWarnings:function(){return a},toJSON:function(){return e}}},gn={CONFIGURE:"configure",SET_DEBUG:"setDebug"},pn=function(e){var n=e.command,t=e.options,r=n.commandName,o=n.documentationUri,i=void 0===o?"https://adobe.ly/2UH0qO7":o,a=n.optionsValidator,u=t;if(a)try{u=a(t)}catch(e){throw new Error("Invalid "+r+" command options:\n\t - "+e+" For command documentation see: "+i)}return u},mn=function(e){var n=e.eventManager,t=e.logger;return{commands:{sendEvent:{documentationUri:"https://adobe.ly/2r0uUjh",optionsValidator:function(e){return function(e){var n=e.options,t=e.logger,r=Ke({type:Ze(),xdm:Ke({eventType:Ze(),identityMap:nn}),data:Ke({}),renderDecisions:Xe(),decisionScopes:We(Ze()),datasetId:Ze()}).required()(n),o=r.type,i=r.xdm;return!i||i.eventType||o||t.warn("No type or xdm.eventType specified."),r}({options:e,logger:t})},run:function(e){var t=e.xdm,r=e.data,o=e.documentUnloading,i=void 0!==o&&o,a=e.type,u=e.mergeId,c=e.renderDecisions,s=void 0!==c&&c,f=e.decisionScopes,d=void 0===f?[]:f,l=e.datasetId,g=n.createEvent();return i&&g.documentMayUnload(),g.setUserXdm(t),g.setUserData(r),a&&g.mergeXdm({eventType:a}),u&&g.mergeXdm({eventMergeId:u}),l&&g.mergeMeta({collect:{datasetId:l}}),n.sendEvent(g,{renderDecisions:s,decisionScopes:d})}}}}};mn.namespace="DataCollector",mn.configValidators={};var vn=function(e){var n=e.config,t=e.eventManager,r=e.lifecycle,o=e.handleError;if(n.clickCollectionEnabled){var i=function(e){var n=e.eventManager,t=e.lifecycle,r=e.handleError;return function(e){var o=e.target,i=n.createEvent();return t.onClick({event:i,clickedElement:o}).then((function(){return i.isEmpty()?Promise.resolve():n.sendEvent(i)})).then(oe).catch((function(e){r(e,"click collection")}))}}({eventManager:t,lifecycle:r,handleError:o});document.addEventListener("click",i,!0)}},yn={clickCollectionEnabled:Xe().default(!0),downloadLinkQualifier:Ze().regexp().default("\\.(exe|zip|wav|mp3|mov|mpg|avi|wmv|pdf|doc|docx|xls|xlsx|ppt|pptx)$")},hn=function(e,n){var t=e.location,r=n.href?n.href:"",o=n.protocol,i=n.host;if(!function(e){return e&&/^[a-z0-9]+:\/\//i.test(e)}(r)){o||(o=t.protocol?t.protocol:""),o=o?o+"//":"",i||(i=t.host?t.host:"");var a="";if("/"!==r.substring(0,1)){var u=t.pathname.lastIndexOf("/");u=u<0?0:u,a=t.pathname.substring(0,u)}r=""+o+i+a+"/"+r}return r},wn=function(e,n,t,r){var o="other";return!function(e,n,t){var r=new RegExp(e);return!!t.download||r.test(n.toLowerCase())}(n.downloadLinkQualifier,t,r)?function(e,n){var t=e.location.hostname.toLowerCase();return!(n.toLowerCase().indexOf(t)>=0)}(e,t)&&(o="exit"):o="download",o},bn=function(e){var n=e.config,t=e.eventManager,r=e.handleError,o=function(e,n){return function(t,r){var o,i,a,u,c=r,s=!1;do{(a=hn(e,c))||(c=c.parentNode)}while(!a&&c);!a||(!(u=c).href||"A"!==u.tagName&&"AREA"!==u.tagName||u.onclick&&u.protocol&&!(u.protocol.toLowerCase().indexOf("javascript")<0))||(s=!0,i=wn(e,n,a,c),o="Link Click"),s&&(t.documentMayUnload(),t.mergeXdm({eventType:"web.webinteraction.linkClicks",web:{webInteraction:{name:o,type:i,URL:a,linkClicks:{value:1}}}}))}}(window,n);return{lifecycle:{onComponentsRegistered:function(e){var o=e.lifecycle;vn({config:n,eventManager:t,lifecycle:o,handleError:r})},onClick:function(e){var n=e.event,t=e.clickedElement;o(n,t)}}}};bn.namespace="ActivityCollector",bn.configValidators=yn;var En,Cn,In,On=function(e,n){return"ID sync "+(n?"succeeded":"failed")+": "+e.spec.url},kn={thirdPartyCookiesEnabled:Xe().default(!0),idMigrationEnabled:Xe().default(!0)},Rn=function(e){return Ke({namespaces:We($e("ECID")).nonEmpty()}).noUnknownFields()(e),{namespaces:["ECID"]}},Sn=$(window,l),xn=function(e){var n=e.config,t=e.getEcidFromVisitor,r=n.idMigrationEnabled,o="AMCV_"+n.orgId;return{getEcid:function(){if(r){var e=function(){var e=null,n=l.get("s_ecid")||l.get(o);if(n){var t=n.match(/(^|\|)MCMID\|(\d+)($|\|)/);t&&(e=t[2])}return e}();return e?Promise.resolve(e):t()}return Promise.resolve()},setEcid:function(e){r&&!l.get(o)&&l.set(o,"MCMID|"+e,{domain:Sn,expires:390})}}},Pn=function(e){var n=e.logger;return new Promise((function(e,t){if(E(window.adobe)&&E(window.adobe.optIn)){var r=window.adobe.optIn;n.log("Delaying request while waiting for legacy opt-in to let Visitor retrieve ECID from server."),r.fetchPermissions((function(){r.isApproved([r.Categories.ECID])&&(n.log("Received legacy opt-in approval to let Visitor retrieve ECID from server."),e()),t(new Error("Legacy opt-in was declined."))}),!0)}else e()}))},Tn=function(e){var n=e.logger,t=e.orgId,r=e.awaitVisitorOptIn,o=function(e){var n=e.Visitor;return j(n)&&j(n.getInstance)&&n}(window);return function(){return o?r({logger:n}).then((function(){return n.log("Delaying request while using Visitor to retrieve ECID from server."),new Promise((function(e){o.getInstance(t,{}).getMarketingCloudVisitorID((function(t){n.log("Resuming previously delayed request that was waiting for ECID from Visitor."),e(t)}),!0)}))})):Promise.resolve()}},jn=function(e){e.mergeQuery({identity:{fetch:["ECID"]}})},qn=(En=function(e){var n,t;return(m(n={},"Edge",/Edge\/([0-9\._]+)/),m(n,"EdgeChromium",/Edg\/([0-9\.]+)/),m(n,"Chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/),m(n,"Firefox",/Firefox\/([0-9\.]+)(?:\s|$)/),m(n,"IE",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/),m(n,"Safari",/Version\/([0-9\._]+).*Safari/),t=n,function(e){for(var n=Object.keys(t),r=0;r<n.length;r+=1){var o=n[r];if(t[o].test(e))return o}return"Unknown"})(e.navigator.userAgent)},In=new Map,function(){var e=Cn?Cn.apply(void 0,arguments):arguments.length<=0?void 0:arguments[0];if(In.has(e))return In.get(e);var n=En.apply(void 0,arguments);return In.set(e,n),n}),Dn=function(e,n){e.addIdentity("ECID",{id:n})},Mn=function(e){var n=e.getPayloadsByType("identity:result"),t=R(n,(function(e){return e.namespace&&"ECID"===e.namespace.code}));return t?t.id:void 0},Nn=function(e){var n={},t=!1,r={mergeConfigOverrides:O(n,"meta.configOverrides"),mergeState:O(n,"meta.state"),mergeQuery:O(n,"query"),useIdThirdPartyDomain:function(){t=!0},getUseIdThirdPartyDomain:function(){return t},addIdentity:function(){},toJSON:function(){return n}},o=e(n);return u({},r,o)},An=function(e){return function(n,t){e.xdm=e.xdm||{},e.xdm.identityMap=e.xdm.identityMap||{},e.xdm.identityMap[n]=e.xdm.identityMap[n]||[],e.xdm.identityMap[n].push(t)}},_n=function(e){return Nn((function(n){return n.query=n.query||{},n.query.identity={fetch:e},{addIdentity:An(n)}}))},Fn=function(e){var n=e.config,r=e.logger,o=e.consent,i=e.sendEdgeNetworkRequest,a=n.orgId,u=n.thirdPartyCookiesEnabled,c=Tn({logger:r,orgId:a,awaitVisitorOptIn:Pn}),s=xn({config:n,getEcidFromVisitor:c}),f=function(e){var n=e.orgId,t=K(n,"identity");return function(){return Boolean(l.get(t))}}({orgId:a}),d=function(e){var n=e.sendEdgeNetworkRequest,t=e.createIdentityPayload;return function(e){return n({payload:t(e),action:"identity/acquire"})}}({sendEdgeNetworkRequest:i,createIdentityPayload:_n}),g=function(e){var n=e.thirdPartyCookiesEnabled,t=e.areThirdPartyCookiesSupportedByDefault;return function(e){n&&t(qn(window))&&e.useIdThirdPartyDomain()}}({thirdPartyCookiesEnabled:u,areThirdPartyCookiesSupportedByDefault:t}),p=function(e){var n=e.getLegacyEcid,t=e.addEcidToPayload;return function(e){return n().then((function(n){n&&t(e,n)}))}}({getLegacyEcid:s.getEcid,addEcidToPayload:Dn}),m=function(e){var n=e.orgId,t=e.doesIdentityCookieExist;return function(e){var r=e.onResponse,o=e.onRequestFailure;return new Promise((function(e,i){r((function(){if(!t()){var r=new Error("An identity was not set properly. Please verify that the org ID "+n+" configured in Alloy matches the org ID specified in the edge configuration.");throw i(r),r}e()})),o((function(){t()?e():i(new Error("No identity was set on response."))}))}))}}({orgId:a,doesIdentityCookieExist:f}),v=function(e){var n,t=e.doesIdentityCookieExist,r=e.setDomainForInitialIdentityPayload,o=e.addLegacyEcidToPayload,i=e.awaitIdentityCookie,a=e.logger,u=function(e){return r(e),o(e)};return function(e){var r=e.payload,o=e.onResponse,c=e.onRequestFailure;if(t())return Promise.resolve();if(n){a.log("Delaying request while retrieving ECID from server.");var s=n;return n=s.catch((function(){return i({onResponse:o,onRequestFailure:c})})),s.then((function(){a.log("Resuming previously delayed request.")})).catch((function(){return u(r)}))}return n=i({onResponse:o,onRequestFailure:c}),u(r)}}({doesIdentityCookieExist:f,setDomainForInitialIdentityPayload:g,addLegacyEcidToPayload:p,awaitIdentityCookie:m,logger:r}),y=function(e){var n=e.processIdSyncs;return function(e){return n(e.getPayloadsByType("identity:exchange"))}}({processIdSyncs:function(e){var n=e.fireReferrerHideableImage,t=e.logger;return function(e){var r=e.filter((function(e){return"url"===e.type}));return r.length?Promise.all(r.map((function(e){return n(e.spec).then((function(){t.log(On(e,!0))})).catch((function(){t.error(On(e,!1))}))}))).then(oe):Promise.resolve()}}({fireReferrerHideableImage:W,logger:r})});return function(e){var n,t=e.addEcidQueryToPayload,r=e.ensureSingleIdentity,o=e.setLegacyEcid,i=e.handleResponseForIdSyncs,a=e.getEcidFromResponse,u=e.getIdentity,c=e.consent;return{lifecycle:{onBeforeRequest:function(e){var n=e.payload,o=e.onResponse,i=e.onRequestFailure;return t(n),r({payload:n,onResponse:o,onRequestFailure:i})},onResponse:function(e){var t=e.response;return n||(n=a(t))&&o(n),i(t)}},commands:{getIdentity:{optionsValidator:Rn,run:function(e){return c.awaitConsent().then((function(){return n?void 0:u(e.namespaces)})).then((function(){return{identity:{ECID:n}}}))}}}}}({ensureSingleIdentity:v,addEcidQueryToPayload:jn,setLegacyEcid:s.setEcid,handleResponseForIdSyncs:y,getEcidFromResponse:Mn,getIdentity:d,consent:o})};Fn.namespace="Identity",Fn.configValidators=kn;var Un=function(e,n){return"URL destination "+(n?"succeeded":"failed")+": "+e.spec.url},Bn=function(e){var n=e.fireReferrerHideableImage,t=e.logger;return function(e){return function(e){e.filter((function(e){return"cookie"===e.type})).forEach((function(e){var n=e.spec,t=n.name,r=n.value,o=n.domain,i=n.ttlDays;l.set(t,r||"",{domain:o||"",expires:i||10})}))}(e),function(e,n,t){var r=t.filter((function(e){return"url"===e.type}));return Promise.all(r.map((function(t){return e(t.spec).then((function(){n.log(Un(t,!0))})).catch((function(){n.error(Un(t,!1))}))}))).then(oe)}(n,t,e)}},Ln=function(e){var n=e.logger,t=Bn({fireReferrerHideableImage:W,logger:n}),r=function(e){var n=e.response;if(n){var r=n.getPayloadsByType("activation:push");return t(r)}};return{lifecycle:{onResponse:r,onRequestFailure:r},commands:{}}};Ln.namespace="Audiences",Ln.configValidators={};var Vn=function(e){return x("DIV",{},{innerHTML:e})},Hn=f((function(e,n){var t;t=s,e.exports=function(e){if(e.CSS&&e.CSS.escape)return e.CSS.escape;var n=function(e){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var n,t=String(e),r=t.length,o=-1,i="",a=t.charCodeAt(0);++o<r;)0!=(n=t.charCodeAt(o))?i+=n>=1&&n<=31||127==n||0==o&&n>=48&&n<=57||1==o&&n>=48&&n<=57&&45==a?"\\"+n.toString(16)+" ":0==o&&1==r&&45==n||!(n>=128||45==n||95==n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122)?"\\"+t.charAt(o):t.charAt(o):i+="�";return i};return e.CSS||(e.CSS={}),e.CSS.escape=n,n}(t)})),Jn=/:eq\((\d+)\)/g,zn=function(e){return-1===e.indexOf(":eq(")},Qn=/(#|\.)(-?\w+)/g,Wn=/^\s*>?\s*/,Xn=function(e,n,t){return""+n+Hn(t)},Gn=function(e){for(var n=[],t=function(e){return e.split(Jn).filter(re)}(function(e){return e.replace(Qn,Xn)}(e.trim())),r=t.length,o=0;o<r;){var i=t[o].replace(Wn,"").trim(),a=t[o+1];a?n.push({sel:i,eq:Number(a)}):n.push({sel:i}),o+=2}return n},$n=function(e){var n=document;if(zn(e))return M(e,n);for(var t=Gn(e),r=t.length,o=[],i=n,a=0;a<r;){var u=t[a],c=u.sel,s=u.eq,f=M(c,i),d=f.length;if(0===d)break;if(null!=s&&s>d-1)break;if(a<r-1)if(null==s)i=w(f,1)[0];else i=f[s];a===r-1&&(o=null==s?f:[f[s]]),a+=1}return o},Yn=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return n.getElementById(e)},Kn=function(e,n,t){e.setAttribute(n,t)},Zn=function(e,n){return e.getAttribute(n)},et=function(e){return e.parentNode},nt=function(e,n){if(e){var t=et(e);t&&t.insertBefore(n,function(e){return e.nextElementSibling}(e))}},tt=function(e,n){if(e){var t=et(e);t&&t.insertBefore(n,e)}},rt=function(e){var n=e.childNodes;return n?D(n):[]},ot=function(e){return e.firstElementChild},it={},at=function(e){var n=it[e];n&&(J(n),delete it[e])},ut=function(e){if(e&&!Yn("alloy-prehiding")){var n=x("STYLE",{id:"alloy-prehiding"},{textContent:e});S(document.head,n)}},ct=function(){var e=Yn("alloy-prehiding");e&&J(e)},st=function(e,n){e.textContent=n},ft=function(e){return x("IMG",{src:e})},dt=function(e){M("IMG",e).forEach((function(e){var n=Zn(e,P);n&&ft(n)}))};var lt=setTimeout;function gt(e){return Boolean(e&&void 0!==e.length)}function pt(){}function mt(e){if(!(this instanceof mt))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],Et(e,this)}function vt(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,mt._immediateFn((function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var r;try{r=t(e._value)}catch(e){return void ht(n.promise,e)}yt(n.promise,r)}else(1===e._state?yt:ht)(n.promise,e._value)}))):e._deferreds.push(n)}function yt(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if(n instanceof mt)return e._state=3,e._value=n,void wt(e);if("function"==typeof t)return void Et(function(e,n){return function(){e.apply(n,arguments)}}(t,n),e)}e._state=1,e._value=n,wt(e)}catch(n){ht(e,n)}}function ht(e,n){e._state=2,e._value=n,wt(e)}function wt(e){2===e._state&&0===e._deferreds.length&&mt._immediateFn((function(){e._handled||mt._unhandledRejectionFn(e._value)}));for(var n=0,t=e._deferreds.length;n<t;n++)vt(e,e._deferreds[n]);e._deferreds=null}function bt(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}function Et(e,n){var t=!1;try{e((function(e){t||(t=!0,yt(n,e))}),(function(e){t||(t=!0,ht(n,e))}))}catch(e){if(t)return;t=!0,ht(n,e)}}mt.prototype.catch=function(e){return this.then(null,e)},mt.prototype.then=function(e,n){var t=new this.constructor(pt);return vt(this,new bt(e,n,t)),t},mt.prototype.finally=function(e){var n=this.constructor;return this.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){return n.reject(t)}))}))},mt.all=function(e){return new mt((function(n,t){if(!gt(e))return t(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(e);if(0===r.length)return n([]);var o=r.length;function i(e,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,(function(n){i(e,n)}),t)}r[e]=a,0==--o&&n(r)}catch(e){t(e)}}for(var a=0;a<r.length;a++)i(a,r[a])}))},mt.resolve=function(e){return e&&"object"==typeof e&&e.constructor===mt?e:new mt((function(n){n(e)}))},mt.reject=function(e){return new mt((function(n,t){t(e)}))},mt.race=function(e){return new mt((function(n,t){if(!gt(e))return t(new TypeError("Promise.race accepts an array"));for(var r=0,o=e.length;r<o;r++)mt.resolve(e[r]).then(n,t)}))},mt._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){lt(e,0)},mt._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var Ct="undefined"!=typeof window&&window.Promise||void 0!==s&&s.Promise||mt.default||mt,It=function(e){var n=document.createElement("script");n.src=e,n.async=!0;var t=function(e,n){return new Ct((function(t,r){n.onload=function(){t(n)},n.onerror=function(){r(new Error("Failed to load script "+e))}}))}(e,n);return document.getElementsByTagName("head")[0].appendChild(n),t},Ot=function(e,n){return e.tagName===n},kt=function(e){return Ot(e,"SCRIPT")&&!Zn(e,P)},Rt=function(e){return Ot(e,"SCRIPT")&&Zn(e,P)},St=function(e){for(var n=M("SCRIPT",e),t=[],r=n.length,o=0;o<r;o+=1){var i=n[o];if(kt(i)){var a=i.textContent;a&&t.push(x("SCRIPT",{},{textContent:a}))}}return t},xt=function(e){for(var n=M("SCRIPT",e),t=[],r=n.length,o=0;o<r;o+=1){var i=n[o];if(Rt(i)){var a=Zn(i,P);a&&t.push(a)}}return t},Pt=function(e,n,t){n.forEach((function(n){return t(e,n)}))},Tt=function(e){return Promise.all(e.map(It))},jt=function(e,n){var t=Vn(n),r=rt(t),o=St(t),i=xt(t);return dt(t),r.forEach((function(n){S(e,n)})),Pt(e,o,S),Tt(i)},qt=function(e,n){!function(e){rt(e).forEach(J)}(e),jt(e,n)},Dt=function(e,n){var t=Vn(n),r=rt(t),o=St(t),i=xt(t),a=r.length-1;for(dt(t);a>=0;){var u=r[a],c=ot(e);c?tt(c,u):S(e,u),a-=1}return Pt(e,o,S),Tt(i)},Mt=function(e,n){var t=Vn(n),r=rt(t),o=St(t),i=xt(t);return dt(t),r.forEach((function(n){tt(e,n)})),Pt(e,o,tt),Tt(i)},Nt=function(e,n){Mt(e,n),J(e)},At=function(e,n){var t=Vn(n),r=rt(t),o=St(t),i=xt(t);return dt(t),r.forEach((function(n){nt(e,n)})),Pt(e,o,nt),Tt(i)},_t=function(e,n){var t=n.priority,r=h(n,["priority"]);Object.keys(r).forEach((function(n){!function(e,n,t,r){var o;o=r?n+":"+t+" !"+r+";":n+":"+t+";",e.style.cssText+=";"+o}(e,n,r[n],t)}))},Ft=function(e,n){Object.keys(n).forEach((function(t){Kn(e,t,n[t])}))},Ut=function(e,n){"IMG"===e.tagName&&(ft(n),function(e,n){e.removeAttribute(n)}(e,P),Kn(e,P,n))},Bt=function(e,n){var t=n.from,r=n.to,o=function(e){var n=e.children;return n?D(n):[]}(e),i=o[t],a=o[r];i&&a&&(t<r?nt(a,i):tt(a,i))},Lt=function(e){return function(n){var t=n.selector,r=n.prehidingSelector,o=n.content,i=n.meta;return function(e){if(!it[e]){var n=x("STYLE",{},{textContent:e+" { visibility: hidden }"});S(document.head,n),it[e]=n}}(r),H(t,$n).then((function(n){return function(e,n,t){var r=e.map((function(e){return t(e,n)}));return Promise.all(r)}(n,o,e)})).then((function(){return at(r),{meta:i}}),(function(e){return at(r),{meta:i,error:e}}))}},Vt=function(e){return{setHtml:Lt(qt),customCode:Lt(Dt),setText:Lt(st),setAttribute:Lt(Ft),setImageSource:Lt(Ut),setStyle:Lt(_t),move:Lt(_t),resize:Lt(_t),rearrange:Lt(Bt),remove:Lt(J),insertAfter:Lt(At),insertBefore:Lt(Mt),replaceHtml:Lt(Nt),prependHtml:Lt(Dt),appendHtml:Lt(jt),click:function(n){return function(e,n){return n({selector:e.selector,meta:e.meta}),Promise.resolve()}(n,e)}}},Ht=function(e,n,t){if(e.enabled){var r=JSON.stringify(n),o=t.message,i=t.stack,a="Failed to execute action "+r+". "+o+" "+(i?"\n "+i:"");e.error(a)}},Jt=function(e,n,t){var r=e.map((function(e){var r=e.type;return function(e,n,t,r){var o=n[t];if(!o){var i=new Error('DOM action "'+t+'" not found');throw Ht(e,r[0],i),i}return o.apply(void 0,b(r))}(t,n,r,[e]).then((function(n){return function(e,n){if(e.enabled){var t=JSON.stringify(n);e.log("Action "+t+" executed.")}}(t,e),n})).catch((function(n){throw Ht(t,e,n),n}))}));return Promise.all(r)},zt="https://ns.adobe.com/personalization/dom-action",Qt=function(e){return e.schema===zt},Wt=function(e,n){return{id:e.id,scope:e.scope,items:n}},Xt=function(e){return function(e,n){var t=[],r=[];return e.forEach((function(e){var o=e.items,i=w(function(e,n){var t=[],r=[];return e.forEach((function(e){n(e)?t.push(e):r.push(e)})),[t,r]}(void 0===o?[]:o,n),2),a=i[0],u=i[1];q(a)&&t.push(Wt(e,a)),q(u)&&r.push(Wt(e,u))})),[t,r]}(e,Qt)},Gt=function(e){return e},$t=function(e){var n=e.modules,t=e.logger,r=e.executeActions,o=e.collect;return function(e){var i=e.map((function(e){var o=function(e){var n={id:e.id,scope:e.scope};return e.items.map((function(e){return u({},e.data,{meta:n})}))}(e);return r(o,n,t)}));return Promise.all(i).then((function(e){return function(e,n,t){var r=X(t,Gt),o=[],i=new Set;r.forEach((function(e){if(e)if(e.error)n.warn(e);else{var t=e.meta;i.has(t.id)||(i.add(t.id),o.push(t))}})),q(o)&&e({decisions:o})}(o,t,e)})).catch((function(e){t.error(e)}))}},Yt=function(e,n){if(zn(e))return function(e,n){return n.matches?n.matches(e):n.msMatchesSelector(e)}(e,n);for(var t=$n(e),r=!1,o=0;o<t.length;o+=1)if(t[o]===n){r=!0;break}return r},Kt=function(e,n){for(var t=document.documentElement,r=n.selector,o=n.meta,i=e;i&&i!==t;){if(Yt(r,i))return o;i=i.parentNode}return null},Zt=function(e,n){if(0===n.length)return[];for(var t=[],r=0;r<n.length;r+=1){var o=Kt(e,n[r]);o&&t.push(o)}return t},er=function(e){return q(e)},nr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return-1!==e.location.href.indexOf("mboxEdit")},tr=function(n,t){var r=b(t);return n&&!e(r,"__view__")&&r.push("__view__"),r},rr=tn(Object.freeze({__proto__:null,DOM_ACTION:zt,HTML_CONTENT_ITEM:"https://ns.adobe.com/personalization/html-content-item",JSON_CONTENT_ITEM:"https://ns.adobe.com/personalization/json-content-item",REDIRECT_ITEM:"https://ns.adobe.com/personalization/redirect-item"})),or=function(e,n){e.mergeMeta({personalization:y({},n)})},ir=function(e,n){e.mergeQuery({personalization:y({},n)})},ar=function(e){return{schemas:rr,decisionScopes:e}},ur=function(e){var n=e.config,t=e.logger,r=e.eventManager,o=function(e){var n=e.eventManager,t=e.mergeMeta;return function(e){var r=n.createEvent();return r.mergeXdm({eventType:"display"}),t(r,e),n.sendEvent(r)}}({eventManager:r,mergeMeta:or}),i=[],a=Vt((function(e){return i.push(e)})),u=$t({modules:a,logger:t,executeActions:Jt,collect:o});return function(e){var n=e.config,t=e.logger,r=e.onResponseHandler,o=e.onClickHandler,i=e.hideContainers,a=e.showContainers,u=e.hasScopes,c=e.isAuthoringModeEnabled,s=e.getDecisionScopes,f=e.mergeQuery,d=e.createQueryDetails,l=n.prehidingStyle;return{lifecycle:{onBeforeEvent:function(e){var n=e.event,o=e.renderDecisions,g=e.decisionScopes,p=void 0===g?[]:g,m=e.onResponse,v=void 0===m?oe:m,y=e.onRequestFailure,h=void 0===y?oe:y;if(c())return t.warn("Rendering is disabled, authoring mode."),void f(n,{enabled:!1});var w=s(o,p);u(w)?(o&&i(l),f(n,d(w)),v((function(e){var n=e.response;return r({renderDecisions:o,response:n})})),h((function(){a()}))):a()},onClick:function(e){var n=e.event,t=e.clickedElement;o({event:n,clickedElement:t})}}}}({config:n,logger:t,eventManager:r,onResponseHandler:function(e){var n=e.extractDecisions,t=e.executeDecisions,r=e.showContainers;return function(e){var o=e.renderDecisions,i=e.response.getPayloadsByType("personalization:decisions");if(!q(i))return r(),{decisions:[]};var a=w(n(i),2),u=a[0],c=a[1];return o?(t(u),r(),{decisions:c}):{decisions:i}}}({extractDecisions:Xt,executeDecisions:u,showContainers:ct}),onClickHandler:function(e){var n=e.mergeMeta,t=e.collectClicks,r=e.clickStorage;return function(e){var o=e.event,i=e.clickedElement,a=t(i,r);q(a)&&(o.mergeXdm({eventType:"click"}),n(o,{decisions:a}))}}({mergeMeta:or,collectClicks:Zt,clickStorage:i}),hideContainers:ut,showContainers:ct,hasScopes:er,isAuthoringModeEnabled:nr,getDecisionScopes:tr,mergeMeta:or,mergeQuery:ir,createQueryDetails:ar})};ur.namespace="Personalization",ur.configValidators={prehidingStyle:Ze().nonEmpty()};var cr,sr,fr=function(e){return function(n){var t={webPageDetails:{URL:e.location.href||e.location},webReferrer:{URL:e.top.document.referrer}};I(n,{web:t})}}(window),dr=function(e){return function(n){var t=e.screen,r=t.width,o={screenHeight:t.height,screenWidth:r},i=function(e){var n=e.screen.orientation;if(null==n||null==n.type)return null;var t=n.type.split("-");return 0===t.length?null:"portrait"!==t[0]&&"landscape"!==t[0]?null:t[0]}(e)||function(e){return e.matchMedia("(orientation: portrait)").matches?"portrait":e.matchMedia("(orientation: landscape)").matches?"landscape":null}(e);i&&(o.screenOrientation=i),I(n,{device:o})}}(window),lr=function(e){return function(n){var t=e.innerWidth,r=e.innerHeight;I(n,{environment:{type:"browser",browserDetails:{viewportWidth:t,viewportHeight:r}}})}}(window),gr=(cr=function(){return new Date},function(e){var n=cr(),t={localTime:me(n),localTimezoneOffset:n.getTimezoneOffset()};I(e,{placeContext:t})}),pr=function(e){return function(n){var t=e().toISOString();I(n,{timestamp:t})}}((function(){return new Date})),mr=(sr="2.1.0",function(e){I(e,{implementationDetails:{name:"https://ns.adobe.com/experience/alloy",version:sr,environment:"browser"}})}),vr={web:fr,device:dr,environment:lr,placeContext:gr},yr=[pr,mr],hr=function(e){return function(e,n,t,r){var o=e.context,i=X(o,(function(e,r){return t[e]?[t[e]]:(n.warn("Invalid context["+r+"]: '"+e+"' is not available."),[])})).concat(r);return{namespace:"Context",lifecycle:{onBeforeEvent:function(e){var n=e.event,t={};i.forEach((function(e){return e(t)})),n.mergeXdm(t)}}}}(e.config,e.logger,vr,yr)};hr.namespace="Context",hr.configValidators={context:We(Ze()).default(Object.keys(vr))};var wr=function(){return Nn((function(e){return{addIdentity:function(n,t){e.identityMap=e.identityMap||{},e.identityMap[n]=e.identityMap[n]||[],e.identityMap[n].push(t)},setConsent:function(n){e.consent=n}}}))},br=function(e){return e.split(";").reduce((function(e,n){var t=w(n.split("="),2),r=t[0],o=t[1];return e[r]=o,e}),{})},Er=Ke({consent:We(Qe()).required().nonEmpty(),identityMap:nn}).noUnknownFields().required(),Cr=function(e){var n,t,r=e.config,o=e.consent,i=e.sendEdgeNetworkRequest,a=r.orgId,c=r.defaultConsent;return function(e){var n=e.readStoredConsent,t=e.taskQueue,r=e.defaultConsent,o=e.consent,i=e.sendSetConsentRequest,a=e.validateSetConsentOptions,c=u(m({},"general",r),n());o.setConsent(c);var s=function(){if(0===t.length){var e=n();e&&o.setConsent(e)}};return{commands:{setConsent:{optionsValidator:a,run:function(e){var n=e.consent,r=e.identityMap;return o.suspend(),t.addTask((function(){return i({consentOptions:n,identityMap:r})})).catch((function(e){throw s(),e})).then(s)}}},lifecycle:{onResponse:s,onRequestFailure:s}}}({readStoredConsent:function(e){var n=e.parseConsentCookie,t=e.orgId,r=e.cookieJar,o=K(t,"consent");return function(){var e=r.get(o);return e?n(e):void 0}}({parseConsentCookie:br,orgId:a,cookieJar:l}),taskQueue:(n=0,t=Promise.resolve(),{addTask:function(e){n+=1;var r=function(){return e().finally((function(){n-=1}))};return t=t.then(r,r)},get length(){return n}}),defaultConsent:c,consent:o,sendSetConsentRequest:function(e){var n=e.createConsentRequestPayload,t=e.sendEdgeNetworkRequest;return function(e){var r=e.consentOptions,o=e.identityMap,i=n();return i.setConsent(r),E(o)&&Object.keys(o).forEach((function(e){o[e].forEach((function(n){i.addIdentity(e,n)}))})),t({payload:i,action:"privacy/set-consent"}).then((function(){}))}}({createConsentRequestPayload:wr,sendEdgeNetworkRequest:i}),validateSetConsentOptions:Er})};Cr.namespace="Privacy";var Ir=function(){return{eventMergeId:be()}},Or=function(e){e.config;return{commands:{createEventMergeId:{run:Ir}}}};Or.namespace="EventMerge",Or.configValidators={};var kr=function(){return{commands:{getLibraryInfo:{run:function(){return{libraryInfo:{version:"2.1.0"}}}}}}};kr.namespace="LibraryInfo";var Rr,Sr=[mn,bn,Fn,Ln,ur,hr,Cr,Or,kr],xr=function(e){var n=e.options,t=e.componentCreators,r=e.coreConfigValidators,o=e.createConfig,i=e.logger,a=e.setDebugEnabled,c=o(function(e,n){try{return Ke(e).noUnknownFields().required()(n)}catch(e){throw new Error("Resolve these configuration problems:\n\t - "+e.message.split("\n").join("\n\t - ")+"\nFor configuration documentation see: https://adobe.ly/2M4ErNE")}}(function(e,n){var t={};return u(t,e),n.forEach((function(e){var n=e.configValidators;u(t,n)})),t}(r,t),n));return a(c.debugEnabled,{fromConfig:!0}),i.logOnInstanceConfigured({config:c}),c},Pr=function(e){return u(Object.create(null),e)},Tr=function(e){var n=e.errorPrefix,t=e.logger;return function(e,r){if("declinedConsent"===e.code)return t.warn("The "+r+" could not fully complete because the user declined consent."),{};var o=le(e);throw o.message=n+" "+o.message,o}},jr=function(e,n){var t,r=j(e.fetch)?function(e){return function(n,t){return e(n,{method:"POST",cache:"no-cache",credentials:"include",headers:{"Content-Type":"text/plain; charset=UTF-8"},referrer:"client",body:t}).then((function(e){return e.text().then((function(n){return{status:e.status,body:n}}))}))}}(e.fetch):(t=e.XMLHttpRequest,function(e,n){return new Promise((function(r,o){var i=new t;i.onreadystatechange=function(){4===i.readyState&&(0===i.status?o(new Error("Request aborted.")):r({status:i.status,body:i.responseText}))},i.onloadstart=function(){i.responseType="text"},i.open("POST",e,!0),i.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),i.withCredentials=!0,i.onerror=o,i.onabort=o,i.send(n)}))}),o=e.navigator&&j(e.navigator.sendBeacon)?function(e,n,t){return function(r,o){var i=new Blob([o],{type:"text/plain; charset=UTF-8"});return e.sendBeacon(r,i)?Promise.resolve({status:204,body:""}):(t.log("The `beacon` call has failed; falling back to `fetch`"),n(r,o))}}(e.navigator,r,n):r;return function(e,n,t){return(t?o:r)(e,n)}},qr=function(e){var n=e.getDebugEnabled,t=e.console,r=e.getMonitors,o=e.context,i="["+o.instanceName+"]";o.componentName&&(i+=" ["+o.componentName+"]");var a=function(e,n){var t=r();if(t.length>0){var i=u({},o,n);t.forEach((function(n){n[e]&&n[e](i)}))}},c=function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];a("onBeforeLog",{level:e,arguments:o}),n()&&t[e].apply(t,[i].concat(o))};return{get enabled(){return r().length>0||n()},logOnInstanceCreated:function(e){a("onInstanceCreated",e),c("info","Instance initialized.")},logOnInstanceConfigured:function(e){a("onInstanceConfigured",e),c("info","Instance configured. Computed configuration:",e.config)},logOnBeforeCommand:function(e){a("onBeforeCommand",e),c("info","Executing "+e.commandName+" command. Options:",e.options)},logOnBeforeNetworkRequest:function(e){a("onBeforeNetworkRequest",e),c("info","Request "+e.requestId+": Sending request.",e.payload)},logOnNetworkResponse:function(e){a("onNetworkResponse",e);var n=e.parsedBody||e.body?"response body:":"no response body.";c("info","Request "+e.requestId+": Received response with status code "+e.status+" and "+n,e.parsedBody||e.body)},logOnNetworkError:function(e){a("onNetworkError",e),c("error","Request "+e.requestId+": Network request failed.",e.error)},log:c.bind(null,"log"),info:c.bind(null,"info"),warn:c.bind(null,"warn"),error:c.bind(null,"error")}},Dr=function(e){var n=e.cookieJar,t=e.orgId,r=e.apexDomain;return{cookiesToPayload:function(e,o){var i,a=(i=r,o.substr(-i.length)===i),u={domain:r,cookiesEnabled:!0};if(!a){var c=n.get(),s=Object.keys(c).filter((function(e){return function(e,n){return 0===n.indexOf("kndctr_"+Y(e)+"_")}(t,e)})).map((function(e){return{key:e,value:c[e]}}));s.length&&(u.entries=s)}e.mergeState(u)},responseToCookies:function(e){e.getPayloadsByType("state:store").forEach((function(e){var t,o,i,a={domain:r};void 0!==e.maxAge&&(a.expires=(t=1e3,o=864e5,i=e.maxAge,t*i/o)),n.set(e.key,e.value,a)}))}}},Mr=function(){return Nn((function(e){return{addIdentity:An(e),addEvent:function(n){e.events=e.events||[],e.events.push(n.toJSON())}}}))},Nr=function(e){var n=e.statusCode,t=e.body,r=e.parsedBody;if(!r&&204!==n||r&&!Array.isArray(r.handle))throw new Error("Unexpected server response with status code "+n+" and "+(t?"response body: "+t:"no response body."))},Ar=function(e){return 429===e||e>=500&&e<600},_r=window.__alloyNS,Fr=(Rr=window,function(e){var n="com.adobe.alloy."+e;return{session:pe(Rr,"sessionStorage",n),persistent:pe(Rr,"localStorage",n)}}),Ur=window.console,Br=function(){return window.__alloyMonitors||[]},Lr={debugEnabled:Xe().default(!1),defaultConsent:en("in","pending").default("in"),edgeConfigId:Ze().unique().required(),edgeDomain:Ze().domain().default("edge.adobedc.net"),edgeBasePath:Ze().nonEmpty().default("ee"),orgId:Ze().unique().required(),onBeforeEventSend:Ge().default(oe)},Vr=$(window,l);_r&&_r.forEach((function(e){var n=rn({console:Ur,locationSearch:window.location.search,createLogger:qr,instanceName:e,createNamespacedStorage:Fr,getMonitors:Br}),t=n.setDebugEnabled,r=n.logger,o=n.createComponentLogger,i=cn(),a=an(i),c=jr(window,r),s=Tr({errorPrefix:"["+e+"]",logger:r}),f=function(e){return function(n){var t=n[0],r=n[1],o=n[2],i=o[0],a=o[1];e(i,a).then(t,r)}}(function(e){var n,t=e.logger,r=e.configureCommand,o=e.setDebugCommand,i=e.handleError,a=e.validateCommandOptions,u=function(e,i){var u;if(e===gn.CONFIGURE){if(n)throw new Error("The library has already been configured and may only be configured once.");u=function(){return n=r(i)}}else{if(!n)throw new Error("The library must be configured first. Please do so by executing the configure command.");u=e===gn.SET_DEBUG?function(){return o(i)}:function(){return n.then((function(n){var t=n.getCommand(e);if(!t||!j(t.run)){var r=tn(gn).concat(n.getCommandNames()).join(", ");throw new Error("The "+e+" command does not exist. List of available commands: "+r+".")}var o=a({command:t,options:i});return t.run(o)}),(function(){return t.warn("An error during configuration is preventing the "+e+" command from executing."),new Promise((function(){}))}))}}return u};return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(r){var o=u(e,n);t.logOnBeforeCommand({commandName:e,options:n}),r(o())})).then((function(e){return E(e)?e:{}})).catch((function(n){return i(n,e+" command")}))}}({logger:r,configureCommand:function(n){var s=xr({options:n,componentCreators:Sr,coreConfigValidators:Lr,createConfig:Pr,logger:r,setDebugEnabled:t}),f=Dr({cookieJar:l,orgId:s.orgId,apexDomain:Vr}),d=function(e){var n=e.logger,t=e.networkStrategy,r=e.isRetryableHttpStatusCode;return function(e){var o=e.payload,i=e.url,a=e.requestId,u=JSON.stringify(o);n.enabled&&n.logOnBeforeNetworkRequest({url:i,requestId:a,payload:JSON.parse(u)});return function e(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t(i,u).then((function(t){if(r(t.status)&&o<3)return e(o+1);var c;try{c=JSON.parse(t.body)}catch(e){}return n.logOnNetworkResponse(y({requestId:a,url:i,payload:JSON.parse(u)},t,{parsedBody:c,retriesAttempted:o})),{statusCode:t.status,body:t.body,parsedBody:c}}))}().catch((function(e){throw n.logOnNetworkError({requestId:a,url:i,payload:JSON.parse(u),error:e}),ge("Network request failed.",e)}))}}({logger:r,networkStrategy:c,isRetryableHttpStatusCode:Ar}),g=function(e){var n=e.logger;return function(e){var t=e.getWarnings(),r=e.getErrors();if(t.forEach((function(e){n.warn("Warning received from server: [Code "+e.code+"] "+e.message)})),r.length){var o=r.reduce((function(e,n){return e+"\n• [Code "+n.code+"] "+n.message}),"The server responded with the following errors:");throw new Error(o)}}}({logger:r}),p=function(e){var n=e.config,t=e.lifecycle,r=e.cookieTransfer,o=e.sendNetworkRequest,i=e.createResponse,a=e.processWarningsAndErrors,c=e.validateNetworkResponseIsWellFormed,s=n.edgeDomain,f=n.edgeBasePath,d=n.edgeConfigId;return function(e){var n=e.payload,l=e.action,g=e.runOnResponseCallbacks,p=void 0===g?oe:g,m=e.runOnRequestFailureCallbacks,v=void 0===m?oe:m,y=k();y.add(t.onResponse),y.add(p);var h=k();return h.add(t.onRequestFailure),h.add(v),t.onBeforeRequest({payload:n,onResponse:y.add,onRequestFailure:h.add}).then((function(){var e=n.getUseIdThirdPartyDomain()?"adobedc.demdex.net":s,t=be(),i="https://"+e+"/"+f+"/v1/"+l+"?configId="+d+"&requestId="+t;return r.cookiesToPayload(n,e),o({payload:n,url:i,requestId:t})})).then((function(e){return c(e),e})).catch((function(e){var n=function(){throw e};return h.call({error:e}).then(n,n)})).then((function(e){var n=e.parsedBody,t=e.statusCode,o=i(n);if(r.responseToCookies(o),t>=400){var c=function(){return a(o)};return h.call({response:o}).then(c,c)}return y.call({response:o}).then((function(e){a(o);var n=e.shift()||[],t=e.shift()||[],r=e;return u.apply(void 0,[{}].concat(b(n),b(t),b(r)))}))}))}}({config:s,lifecycle:a,cookieTransfer:f,sendNetworkRequest:d,createResponse:ln,processWarningsAndErrors:g,validateNetworkResponseIsWellFormed:Nr}),m=function(e){var n=e.generalConsentState,t=e.logger;return{setConsent:function(e){switch(e.general){case"in":n.in();break;case"out":t.warn("Some commands may fail. The user declined consent."),n.out();break;case"pending":t.warn("Some commands may be delayed until the user consents."),n.pending();break;default:t.warn("Unknown consent value: "+e.general)}},suspend:function(){n.pending()},awaitConsent:function(){return n.awaitConsent()}}}({generalConsentState:fn(),logger:r}),v=function(e){var n=e.config,t=e.logger,r=e.lifecycle,o=e.consent,i=e.createEvent,a=e.createDataCollectionRequestPayload,u=e.sendEdgeNetworkRequest,c=n.onBeforeEventSend,s=function(){try{c.apply(void 0,arguments)}catch(e){throw t.error(e),e}};return{createEvent:i,sendEvent:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.setLastChanceCallback(s);var t=n.renderDecisions,i=void 0!==t&&t,c=n.decisionScopes,f=a(),d=k(),l=k();return r.onBeforeEvent({event:e,renderDecisions:i,decisionScopes:c,payload:f,onResponse:d.add,onRequestFailure:l.add}).then((function(){return f.addEvent(e),o.awaitConsent()})).then((function(){return r.onBeforeDataCollectionRequest({payload:f,onResponse:d.add,onRequestFailure:l.add})})).then((function(){var n=e.getDocumentMayUnload();return u({payload:f,action:n?"collect":"interact",runOnResponseCallbacks:d.call,runOnRequestFailureCallbacks:l.call})}))}}}({config:s,logger:r,lifecycle:a,consent:m,createEvent:dn,createDataCollectionRequestPayload:Mr,sendEdgeNetworkRequest:p});return function(e){var n=e.componentCreators,t=e.lifecycle,r=e.componentRegistry,o=e.getImmediatelyAvailableTools;return n.forEach((function(e){var n,t=e.namespace,i=o(t);try{n=e(i)}catch(e){throw ge("["+t+"] An error occurred during component creation.",e)}r.register(t,n)})),t.onComponentsRegistered({lifecycle:t}).then((function(){return r}))}({componentCreators:Sr,lifecycle:a,componentRegistry:i,getImmediatelyAvailableTools:function(n){var t=o(n);return{config:s,consent:m,eventManager:v,logger:t,lifecycle:a,sendEdgeNetworkRequest:p,handleError:Tr({errorPrefix:"["+e+"] ["+n+"]",logger:t})}}})},setDebugCommand:function(e){t(e.enabled,{fromConfig:!1})},handleError:s,validateCommandOptions:pn})),d=window[e].q;d.push=f,r.logOnInstanceCreated({instance:f}),d.forEach(f)}))}();
