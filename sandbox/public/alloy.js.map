{"version":3,"file":"alloy.js","sources":["../../src/core/createInstanceFunction.js","../../src/utils/isNil.js","../../src/utils/isObject.js","../../src/utils/assignConcatArrayValues.js","../../src/utils/bytes.js","../../node_modules/js-cookie/dist/js.cookie.mjs","../../src/utils/cookieJar.js","../../src/utils/deepAssign.js","../../src/utils/createMerger.js","../../src/utils/createCallbackAggregator.js","../../src/utils/createLoggingCookieJar.js","../../src/utils/createTaskQueue.js","../../src/utils/defer.js","../../src/utils/deduplicateArray.js","../../src/utils/dom/appendNode.js","../../src/utils/dom/createNode.js","../../src/constants/tagName.js","../../src/utils/fireImage.js","../../src/utils/isFunction.js","../../src/utils/isNonEmptyArray.js","../../src/utils/toArray.js","../../src/utils/dom/querySelectorAll.js","../../src/constants/shadowSeparator.js","../../src/utils/dom/selectNodesWithShadow.js","../../src/utils/dom/isShadowSelector.js","../../src/utils/dom/selectNodes.js","../../src/utils/dom/awaitSelector.js","../../src/utils/dom/loadScript.js","../../src/utils/dom/matchesSelector.js","../../src/utils/dom/removeNode.js","../../src/utils/injectFireReferrerHideableImage.js","../../src/utils/isEmptyObject.js","../../src/utils/filterObject.js","../../src/utils/fnv1a32Hex.js","../../src/constants/namespace.js","../../src/utils/getLastArrayItems.js","../../src/utils/getApexDomain.js","../../src/constants/cookieNamePrefix.js","../../src/utils/sanitizeOrgIdForCookieName.js","../../src/utils/getNamespacedCookieName.js","../../src/utils/groupBy.js","../../src/constants/browser.js","../../src/utils/lazy.js","../../src/utils/injectAreThirdPartyCookiesSupportedByDefault.js","../../src/constants/cookieNameKey.js","../../src/utils/injectDoesIdentityCookieExist.js","../../src/utils/injectGetBrowser.js","../../src/utils/injectStorage.js","../../src/utils/intersection.js","../../src/utils/isBoolean.js","../../src/utils/isNumber.js","../../src/utils/isInteger.js","../../src/utils/isNamespacedCookieName.js","../../src/utils/isString.js","../../src/utils/isNonEmptyString.js","../../src/utils/noop.js","../../src/utils/parseUrl.js","../../src/utils/prepareConfigOverridesForEdge.js","../../node_modules/@adobe/reactor-query-string/index.js","../../src/utils/sortObjectKeysRecursively.js","../../src/utils/toError.js","../../src/utils/updateErrorMessage.js","../../src/utils/stackError.js","../../src/utils/stringToBoolean.js","../../src/utils/toInteger.js","../../src/utils/toISOStringLocal.js","../../node_modules/uuid/dist/esm-browser/stringify.js","../../node_modules/uuid/dist/esm-browser/rng.js","../../node_modules/uuid/dist/esm-browser/native.js","../../node_modules/uuid/dist/esm-browser/v4.js","../../src/utils/validation/utils.js","../../src/utils/validation/booleanValidator.js","../../src/utils/validation/callbackValidator.js","../../src/utils/validation/createAnyOfValidator.js","../../src/utils/validation/createArrayOfValidator.js","../../src/utils/validation/createDefaultValidator.js","../../src/utils/validation/createDeprecatedValidator.js","../../src/utils/validation/createLiteralValidator.js","../../src/utils/validation/createMapOfValuesValidator.js","../../src/utils/validation/createMinimumValidator.js","../../src/utils/validation/createMaximumValidator.js","../../src/utils/validation/createNoUnknownFieldsValidator.js","../../src/utils/validation/createNonEmptyValidator.js","../../src/utils/validation/createObjectOfValidator.js","../../src/utils/validation/createRenamedValidator.js","../../src/utils/validation/createUniqueValidator.js","../../src/utils/isUnique.js","../../src/utils/validation/createUniqueItemsValidator.js","../../src/utils/validation/domainValidator.js","../../src/utils/validation/integerValidator.js","../../src/utils/validation/numberValidator.js","../../src/utils/isValidRegExp.js","../../src/utils/validation/regexpValidator.js","../../src/utils/validation/requiredValidator.js","../../src/utils/validation/stringValidator.js","../../src/utils/validation/matchesRegexpValidator.js","../../src/utils/validation/index.js","../../src/constants/identityMapAuthenticatedState.js","../../src/utils/validateIdentityMap.js","../../src/utils/validateConfigOverride.js","../../src/constants/debugQueryParam.js","../../src/core/createLogController.js","../../src/core/createLifecycle.js","../../src/core/createComponentRegistry.js","../../src/core/network/injectSendNetworkRequest.js","../../src/core/edgeNetwork/injectExtractEdgeInfo.js","../../src/utils/createDecodeKndctrCookie.js","../../src/core/identity/createIdentity.js","../../src/constants/consentStatus.js","../../src/constants/consentPurpose.js","../../src/core/consent/createConsentStateMachine.js","../../src/core/consent/createConsent.js","../../src/core/createEvent.js","../../src/constants/httpHeaderNames.js","../../src/core/injectCreateResponse.js","../../src/constants/coreCommands.js","../../src/core/injectExecuteCommand.js","../../src/core/validateCommandOptions.js","../../src/core/buildAndValidateConfig.js","../../src/core/initializeComponents.js","../../src/core/config/createConfig.js","../../src/constants/domain.js","../../src/constants/edgeBasePath.js","../../src/core/config/createCoreConfigs.js","../../src/core/injectHandleError.js","../../src/core/network/requestMethods/injectSendFetchRequest.js","../../src/core/network/requestMethods/injectSendBeaconRequest.js","../../src/core/createLogger.js","../../src/constants/pageWideScope.js","../../src/utils/request/createAddIdentity.js","../../src/utils/request/createRequest.js","../../src/utils/request/createDataCollectionRequest.js","../../src/utils/request/createRequestPayload.js","../../src/utils/request/createHasIdentity.js","../../src/utils/request/createDataCollectionRequestPayload.js","../../src/utils/request/createRequestParams.js","../../src/utils/request/createGetAssuranceValidationTokenParams.js","../../src/core/createEventManager.js","../../src/core/createCookieTransfer.js","../../src/constants/legacyCookies.js","../../src/core/injectShouldTransferCookie.js","../../src/constants/apiVersion.js","../../src/utils/networkErrors.js","../../src/core/edgeNetwork/mergeLifecycleResponses.js","../../src/core/edgeNetwork/handleRequestFailure.js","../../src/core/edgeNetwork/injectSendEdgeNetworkRequest.js","../../src/constants/httpStatusCode.js","../../src/core/edgeNetwork/injectProcessWarningsAndErrors.js","../../src/core/edgeNetwork/injectGetLocationHint.js","../../src/core/network/isRequestRetryable.js","../../src/core/network/getRequestRetryDelay.js","../../src/core/edgeNetwork/injectApplyResponse.js","../../src/core/getMonitors.js","../../src/components/Context/injectWeb.js","../../src/components/Context/injectDevice.js","../../src/components/Context/injectEnvironment.js","../../src/components/Context/injectPlaceContext.js","../../src/components/Context/injectTimestamp.js","../../src/constants/libraryName.js","../../src/constants/libraryVersion.js","../../src/components/Context/implementationDetails.js","../../src/components/Context/createComponent.js","../../src/constants/highEntropyUserAgentClientHints.js","../../src/components/Context/injectHighEntropyUserAgentHints.js","../../src/components/Context/index.js","../../src/components/DataCollector/validateUserEventOptions.js","../../src/components/DataCollector/validateApplyResponse.js","../../src/components/DataCollector/index.js","../../src/components/Identity/injectProcessIdSyncs.js","../../src/components/Identity/configValidators.js","../../src/components/Identity/appendIdentityToUrl/appendIdentityToUrlOptionsValidator.js","../../src/constants/ecidNamespace.js","../../src/components/Identity/createComponent.js","../../src/components/Identity/createLegacyIdentity.js","../../src/components/Identity/visitorService/awaitVisitorOptIn.js","../../src/components/Identity/visitorService/getVisitor.js","../../src/components/Identity/visitorService/injectGetEcidFromVisitor.js","../../src/components/Identity/injectHandleResponseForIdSyncs.js","../../src/components/Identity/injectEnsureSingleIdentity.js","../../src/constants/coreNamespace.js","../../src/components/Identity/injectAddEcidQueryToPayload.js","../../src/components/Identity/injectSetDomainForInitialIdentityPayload.js","../../src/components/Identity/injectAddLegacyEcidToPayload.js","../../src/constants/queryStringIdentityParam.js","../../src/utils/decodeUriComponentSafely.js","../../src/components/Identity/injectAddQueryStringIdentityToPayload.js","../../src/components/Identity/addEcidToPayload.js","../../src/components/Identity/injectAwaitIdentityCookie.js","../../src/components/Identity/getNamespacesFromResponse.js","../../src/components/Identity/getIdentity/createGetIdentity.js","../../src/components/Identity/getIdentity/createIdentityRequest.js","../../src/components/Identity/getIdentity/createIdentityRequestPayload.js","../../src/components/Identity/appendIdentityToUrl/injectAppendIdentityToUrl.js","../../src/components/Identity/getIdentity/createGetIdentityOptionsValidator.js","../../src/components/Identity/index.js","../../src/components/LibraryInfo/index.js","../../src/core/requiredComponentCreators.js","../../src/core/index.js","../../src/components/ActivityCollector/attachClickActivityCollector.js","../../src/components/ActivityCollector/configValidators.js","../../src/components/ActivityCollector/utils/activityMapExtensionEnabled.js","../../src/components/ActivityCollector/utils/dom/extractDomain.js","../../src/components/ActivityCollector/utils/isDifferentDomains.js","../../src/components/ActivityCollector/createInjectClickedElementProperties.js","../../src/components/ActivityCollector/createClickedElementProperties.js","../../src/components/ActivityCollector/createRecallAndInjectClickedElementProperties.js","../../src/components/ActivityCollector/createGetClickedElementProperties.js","../../src/constants/sessionDataKeys.js","../../src/components/ActivityCollector/createClickActivityStorage.js","../../src/components/ActivityCollector/createStorePageViewProperties.js","../../src/components/ActivityCollector/validateClickCollectionConfig.js","../../src/components/ActivityCollector/utils/truncateWhiteSpace.js","../../src/components/ActivityCollector/utils/dom/isSupportedTextNode.js","../../src/components/ActivityCollector/getLinkName.js","../../src/components/ActivityCollector/getLinkRegion.js","../../src/components/ActivityCollector/utils/dom/getAbsoluteUrlFromAnchorElement.js","../../src/components/ActivityCollector/utils/dom/isSupportedAnchorElement.js","../../src/components/ActivityCollector/utils/dom/elementHasClickHandler.js","../../src/components/ActivityCollector/utils/dom/isInputSubmitElement.js","../../src/components/ActivityCollector/utils/dom/isButtonSubmitElement.js","../../src/components/ActivityCollector/utils/dom/findClickableElement.js","../../src/components/ActivityCollector/utils/trimQueryFromUrl.js","../../src/components/ActivityCollector/utils/dom/isDownloadLink.js","../../src/components/ActivityCollector/utils/dom/isExitLink.js","../../src/components/ActivityCollector/utils/determineLinkType.js","../../src/components/ActivityCollector/utils/hasPageName.js","../../src/components/ActivityCollector/utils/createTransientStorage.js","../../src/components/ActivityCollector/index.js","../../src/components/Audiences/injectProcessDestinations.js","../../src/components/Audiences/injectProcessResponse.js","../../src/components/Audiences/index.js","../../src/components/Consent/createComponent.js","../../src/components/Consent/computeConsentHash.js","../../src/components/Consent/createConsentHashStore.js","../../src/components/Consent/createConsentRequestPayload.js","../../src/components/Consent/createConsentRequest.js","../../src/components/Consent/createStoredConsent.js","../../src/components/Consent/injectSendSetConsentRequest.js","../../src/components/Consent/parseConsentCookie.js","../../src/components/Consent/validateSetConsentOptions.js","../../src/components/Consent/configValidators.js","../../src/components/Consent/index.js","../../src/components/EventMerge/createEventMergeId.js","../../src/components/EventMerge/createComponent.js","../../src/components/EventMerge/index.js","../../src/components/StreamingMedia/constants/eventTypes.js","../../src/components/StreamingMedia/createMediaRequest.js","../../src/components/StreamingMedia/createMediaEventManager.js","../../src/components/StreamingMedia/constants/playbackState.js","../../src/components/StreamingMedia/createMediaSessionCacheManager.js","../../src/components/StreamingMedia/createTrackMediaEvent.js","../../src/components/StreamingMedia/createTrackMediaSession.js","../../src/utils/isBlankString.js","../../src/components/StreamingMedia/createMediaResponseHandler.js","../../src/components/MediaAnalyticsBridge/constants/constants.js","../../src/components/MediaAnalyticsBridge/createMediaAnalyticsBridgeComponent.js","../../src/components/MediaAnalyticsBridge/createMediaHelper.js","../../src/components/MediaAnalyticsBridge/constants/mediaKeysToXdmConverter.js","../../src/components/MediaAnalyticsBridge/createGetInstance.js","../../src/components/MediaAnalyticsBridge/index.js","../../src/components/Personalization/constants/surface.js","../../src/components/Personalization/utils/surfaceUtils.js","../../src/constants/schema.js","../../src/components/Personalization/createPersonalizationDetails.js","../../src/components/Personalization/constants/loggerMessage.js","../../src/constants/eventType.js","../../src/constants/propositionEventType.js","../../src/components/Personalization/validateApplyPropositionsOptions.js","../../src/components/Personalization/createComponent.js","../../src/components/Personalization/dom-actions/dom/createFragment.js","../../src/components/Personalization/dom-actions/dom/helperForEq.js","../../src/components/Personalization/dom-actions/dom/selectNodesWithEq.js","../../src/components/Personalization/dom-actions/dom/getElementById.js","../../src/components/Personalization/dom-actions/dom/setAttribute.js","../../src/components/Personalization/dom-actions/dom/getAttribute.js","../../src/components/Personalization/dom-actions/dom/removeAttribute.js","../../src/components/Personalization/dom-actions/dom/setStyle.js","../../src/components/Personalization/dom-actions/dom/getParent.js","../../src/components/Personalization/dom-actions/dom/getNextSibling.js","../../src/components/Personalization/dom-actions/dom/insertAfter.js","../../src/components/Personalization/dom-actions/dom/insertBefore.js","../../src/components/Personalization/dom-actions/dom/getChildren.js","../../src/components/Personalization/dom-actions/dom/getChildNodes.js","../../src/components/Personalization/dom-actions/dom/getFirstChild.js","../../src/components/Personalization/dom-actions/dom/getNonce.js","../../src/constants/elementAttribute.js","../../src/components/Personalization/dom-actions/images.js","../../src/components/Personalization/dom-actions/addNonceToInlineStyleElements.js","../../src/components/Personalization/dom-actions/scripts.js","../../src/components/Personalization/dom-actions/appendHtml.js","../../src/components/Personalization/dom-actions/setHtml.js","../../src/components/Personalization/dom-actions/prependHtml.js","../../src/components/Personalization/flicker/index.js","../../src/components/Personalization/dom-actions/setText.js","../../src/components/Personalization/dom-actions/insertHtmlBefore.js","../../src/components/Personalization/dom-actions/replaceHtml.js","../../src/components/Personalization/dom-actions/insertHtmlAfter.js","../../src/components/Personalization/dom-actions/setStyles.js","../../src/components/Personalization/dom-actions/setAttributes.js","../../src/components/Personalization/dom-actions/swapImage.js","../../src/components/Personalization/dom-actions/rearrangeChildren.js","../../src/components/Personalization/dom-actions/action.js","../../src/components/Personalization/dom-actions/dom/util.js","../../src/components/Personalization/dom-actions/move.js","../../src/components/Personalization/dom-actions/collectInteractions.js","../../src/components/Personalization/dom-actions/resize.js","../../src/components/Personalization/dom-actions/initDomActionsModules.js","../../src/utils/createCollect.js","../../src/components/Personalization/createFetchDataHandler.js","../../src/components/Personalization/dom-actions/dom/matchesSelectorWithEq.js","../../src/components/Personalization/constants/scopeType.js","../../src/components/Personalization/utils/metaUtils.js","../../src/components/Personalization/dom-actions/clicks/collectClicks.js","../../src/components/Personalization/utils/isAuthoringModeEnabled.js","../../src/utils/event.js","../../src/components/Personalization/createOnClickHandler.js","../../src/components/Personalization/createViewCacheManager.js","../../src/components/Personalization/createViewChangeHandler.js","../../src/components/Personalization/createClickStorage.js","../../src/components/Personalization/createInteractionStorage.js","../../src/components/Personalization/createApplyPropositions.js","../../src/components/Personalization/createGetPageLocation.js","../../src/components/Personalization/createSetTargetMigration.js","../../src/components/Personalization/dom-actions/remapCustomCodeOffers.js","../../src/components/Personalization/dom-actions/remapHeadOffers.js","../../src/components/Personalization/dom-actions/createPreprocess.js","../../src/components/Personalization/handlers/injectCreateProposition.js","../../src/components/Personalization/utils/createAsyncArray.js","../../src/components/Personalization/handlers/processDefaultContent.js","../../src/constants/propositionInteractionType.js","../../src/components/Personalization/handlers/createDecorateProposition.js","../../src/components/Personalization/handlers/createRenderStatusHandler.js","../../src/components/Personalization/handlers/createProcessDomAction.js","../../src/components/Personalization/handlers/createProcessHtmlContent.js","../../src/components/Personalization/handlers/createProcessRedirect.js","../../src/components/Personalization/handlers/createProcessPropositions.js","../../src/components/Personalization/createOnDecisionHandler.js","../../src/constants/contentType.js","../../src/components/Personalization/handlers/createProcessInAppMessage.js","../../src/components/Personalization/in-app-message-actions/utils.js","../../src/components/Personalization/dom-actions/createRedirect.js","../../src/components/Personalization/in-app-message-actions/actions/displayIframeContent.js","../../src/components/Personalization/in-app-message-actions/initInAppMessageActionsModules.js","../../src/components/Personalization/createNotificationHandler.js","../../src/components/Personalization/createHandleConsentFlicker.js","../../src/components/Personalization/dom-actions/clicks/collectInteractions.js","../../src/constants/decisionProvider.js","../../src/components/Personalization/index.js","../../src/utils/flattenObject.js","../../src/components/RulesEngine/createOnResponseHandler.js","../../node_modules/@adobe/aep-rules-engine/dist/es/index.js","../../src/components/RulesEngine/utils/generateEventHash.js","../../src/components/RulesEngine/utils/getExpirationDate.js","../../src/components/RulesEngine/constants/index.js","../../src/components/RulesEngine/utils/createEventPruner.js","../../src/components/RulesEngine/utils/hasExperienceData.js","../../src/components/RulesEngine/utils/getPropositionData.js","../../src/components/RulesEngine/utils/storage.js","../../src/utils/flattenArray.js","../../src/components/RulesEngine/consequenceAdapters/inAppMessageConsequenceAdapter.js","../../src/components/RulesEngine/consequenceAdapters/schemaTypeConsequenceAdapter.js","../../src/components/RulesEngine/createConsequenceAdapter.js","../../src/components/RulesEngine/createEvaluableRulesetPayload.js","../../src/components/RulesEngine/createDecisionProvider.js","../../src/components/RulesEngine/utils/extractPayloadsFromEventHistoryOperations.js","../../src/components/RulesEngine/createApplyResponse.js","../../src/components/RulesEngine/createEventRegistry.js","../../src/components/RulesEngine/createContextProvider.js","../../src/utils/createSubscription.js","../../src/components/RulesEngine/createSubscribeRulesetItems.js","../../src/components/RulesEngine/createEvaluateRulesetsCommand.js","../../src/components/RulesEngine/index.js","../../src/components/StreamingMedia/configValidators.js","../../src/components/StreamingMedia/validateMediaSessionOptions.js","../../src/components/StreamingMedia/validateMediaEventOptions.js","../../src/components/StreamingMedia/createStreamingMediaComponent.js","../../src/components/StreamingMedia/index.js","../../src/components/Advertising/constants/index.js","../../src/components/Advertising/handlers/clickThroughHandler.js","../../src/components/Advertising/identities/collectSurferId.js","../../src/components/Advertising/identities/collectRampId.js","../../src/components/Advertising/identities/collectID5Id.js","../../src/components/Advertising/utils/helpers.js","../../src/components/Advertising/identities/collectAllIdentities.js","../../src/components/Advertising/handlers/viewThroughHandler.js","../../src/components/Advertising/handlers/sendAdConversion.js","../../src/components/Advertising/handlers/onBeforeSendEventHandler.js","../../src/components/Advertising/createComponent.js","../../src/components/Advertising/configValidators.js","../../src/components/Advertising/handlers/createAdConversionHandler.js","../../src/components/Advertising/utils/advertisingCookieManager.js","../../src/components/Advertising/index.js","../../src/components/PushNotifications/helpers/getPushSubscriptionDetails.js","../../src/components/PushNotifications/request/createSendPushSubscriptionRequest.js","../../src/components/PushNotifications/request/createSendPushSubscriptionPayload.js","../../src/components/PushNotifications/request/makeSendPushSubscriptionRequest.js","../../src/components/PushNotifications/index.js","../../src/core/componentCreators.js","../../src/standalone.js"],"sourcesContent":["/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (executeCommand) => {\n  return ([resolve, reject, [commandName, options]]) => {\n    executeCommand(commandName, options).then(resolve, reject);\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns true when the value is null.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) => value == null;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isNil from \"./isNil.js\";\n\n/**\n * Returns whether the value is an object.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) =>\n  !isNil(value) && !Array.isArray(value) && typeof value === \"object\";\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport isObject from \"./isObject.js\";\n\nexport default (...values) => {\n  if (values.length < 2) {\n    // if the number of args is 0 or 1, just use the default behavior from Object.assign\n    return Object.assign(...values);\n  }\n  return values.reduce((accumulator, currentValue) => {\n    if (isObject(currentValue)) {\n      Object.keys(currentValue).forEach((key) => {\n        if (Array.isArray(currentValue[key])) {\n          if (Array.isArray(accumulator[key])) {\n            accumulator[key].push(...currentValue[key]);\n          } else {\n            // clone the array so the original isn't modified.\n            accumulator[key] = [...currentValue[key]];\n          }\n        } else {\n          accumulator[key] = currentValue[key];\n        }\n      });\n    }\n    return accumulator;\n  }); // no default value to pass into reduce because we want to skip the first value\n};\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Takes a base64 string of bytes and returns a Uint8Array.\n * @param {string} base64String\n * @returns {Uint8Array}\n */\nexport const base64ToBytes = (base64String) => {\n  // Add padding if needed\n  const padding = \"=\".repeat((4 - (base64String.length % 4)) % 4);\n\n  // Convert URL-safe base64 to regular base64\n  const base64 = (base64String + padding).replace(/-/g, \"+\").replace(/_/g, \"/\");\n\n  const binString = atob(base64);\n  return Uint8Array.from(binString, (m) => m.codePointAt(0));\n};\n\n/**\n * Takes a Uint8Array and returns a base64 string.\n * @param {Uint8Array} bytes\n * @returns {string}\n */\nexport const bytesToBase64 = (bytes) => btoa(String.fromCharCode(...bytes));\n","/*! js-cookie v3.0.5 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (name, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    name = encodeURIComponent(name)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      name + '=' + converter.write(value, name) + stringifiedAttributes)\n  }\n\n  function get (name) {\n    if (typeof document === 'undefined' || (arguments.length && !name)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var found = decodeURIComponent(parts[0]);\n        jar[found] = converter.read(value, found);\n\n        if (name === found) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return name ? jar[name] : jar\n  }\n\n  return Object.create(\n    {\n      set,\n      get,\n      remove: function (name, attributes) {\n        set(\n          name,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport { api as default };\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport cookie from \"js-cookie\";\n\n\nexport default {\n  get: cookie.get.bind(cookie),\n  set: cookie.set.bind(cookie),\n  remove: cookie.remove.bind(cookie),\n  withConverter: cookie.withConverter.bind(cookie)\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isNil from \"./isNil.js\";\nimport isObject from \"./isObject.js\";\n\nconst deepAssignObject = (target, source) => {\n  Object.keys(source).forEach((key) => {\n    if (isObject(target[key]) && isObject(source[key])) {\n      deepAssignObject(target[key], source[key]);\n      return;\n    }\n\n    target[key] = source[key];\n  });\n};\n\n/**\n * Recursively copy the values of all enumerable own properties from a source item to a target item if the both items are objects\n * @param {Object} target - a target object\n * @param {...Object} source - an array of source objects\n * @example\n * deepAssign({ a: 'a', b: 'b' }, { b: 'B', c: 'c' });\n * // { a: 'a', b: 'B', c: 'c' }\n */\nexport default (target, ...sources) => {\n  if (isNil(target)) {\n    throw new TypeError('deepAssign \"target\" cannot be null or undefined');\n  }\n\n  const result = Object(target);\n\n  sources.forEach((source) => deepAssignObject(result, Object(source)));\n\n  return result;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport deepAssign from \"./deepAssign.js\";\n\n/**\n * Creates a function that, when passed an object of updates, will merge\n * the updates onto the current value of a payload property.\n *\n * @param {object} content The base object to modify\n * @param {string} key The property to merge updates into. This can be a dot-notation property path.\n *\n * @returns {function(object): void}\n */\nexport default (content, key) => (updates) => {\n  const propertyPath = key.split(\".\");\n  const hostObjectForUpdates = propertyPath.reduce((obj, propertyName) => {\n    obj[propertyName] = obj[propertyName] || {};\n    return obj[propertyName];\n  }, content);\n  deepAssign(hostObjectForUpdates, updates);\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Allows callbacks to be registered and then later called. When the\n * callbacks are called, their responses are combined into a single promise.\n */\nexport default () => {\n  const callbacks = [];\n  return {\n    add(callback) {\n      callbacks.push(callback);\n    },\n    call(...args) {\n      // While this utility doesn't necessarily need to be doing the\n      // Promise.all, it's currently useful everywhere this is used and\n      // reduces repetitive code. We can factor it out later if we want\n      // to make this utility more \"pure\".\n      return Promise.all(callbacks.map((callback) => callback(...args)));\n    },\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { Logger } from '../core/types.js' */\n/** @import { CookieJar } from './types.js' */\n\n/**\n * Creates a logging wrapper around a cookie jar that logs cookie operations.\n *\n * @function\n *\n * @param {object} options\n * @param {Logger} options.logger\n * @param {CookieJar} options.cookieJar\n *\n * @returns {CookieJar}\n */\nexport default ({ logger, cookieJar }) => {\n  return {\n    ...cookieJar,\n    set(key, value, options) {\n      logger.info(\"Setting cookie\", { name: key, value, ...options });\n      return cookieJar.set(key, value, options);\n    },\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Sequences tasks.\n */\nexport default () => {\n  let queueLength = 0;\n  let lastPromiseInQueue = Promise.resolve();\n  return {\n    /**\n     * Add a task to the queue. If no task is currenty running,\n     * the task will begin immediately.\n     * @param {Function} task A function that will be called when\n     * the task should be run. If the task it asynchronous, it should\n     * return a promise.\n     * @returns {Promise} A promise that will be resolved or rejected\n     * with whatever value the task resolved or rejects its promise.\n     */\n    addTask(task) {\n      queueLength += 1;\n\n      const lastPromiseFulfilledHandler = () => {\n        return task().finally(() => {\n          queueLength -= 1;\n        });\n      };\n\n      lastPromiseInQueue = lastPromiseInQueue.then(\n        lastPromiseFulfilledHandler,\n        lastPromiseFulfilledHandler,\n      );\n      return lastPromiseInQueue;\n    },\n    /**\n     * How many tasks are in the queue. This includes the task\n     * that's currently running.\n     * @returns {number}\n     */\n    get length() {\n      return queueLength;\n    },\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * A simple utility for managing a promise's state outside of\n * the promise's \"executor\" (the function passed into the constructor).\n */\nexport default () => {\n  const deferred = {};\n\n  deferred.promise = new Promise((resolve, reject) => {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n\n  return deferred;\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nconst REFERENCE_EQUALITY = (a, b) => a === b;\n\nconst findIndex = (array, item, isEqual) => {\n  for (let i = 0; i < array.length; i += 1) {\n    if (isEqual(array[i], item)) {\n      return i;\n    }\n  }\n  return -1;\n};\n\nexport default (array, isEqual = REFERENCE_EQUALITY) => {\n  return array.filter(\n    (item, index) => findIndex(array, item, isEqual) === index,\n  );\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (parent, node) => {\n  return parent.appendChild(node);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport appendNode from \"./appendNode.js\";\nimport isObject from \"../isObject.js\";\n\nconst populateElementProperties = (element, props) => {\n  Object.keys(props).forEach((key) => {\n    // The following is to support setting style properties to avoid CSP errors.\n    if (key === \"style\" && isObject(props[key])) {\n      const styleProps = props[key];\n      Object.keys(styleProps).forEach((styleKey) => {\n        element.style[styleKey] = styleProps[styleKey];\n      });\n    } else {\n      element[key] = props[key];\n    }\n  });\n};\n\nexport default (tag, attrs = {}, props = {}, children = [], doc = document) => {\n  const result = doc.createElement(tag);\n  Object.keys(attrs).forEach((key) => {\n    // TODO: To highlight CSP problems consider throwing a descriptive error\n    //       if nonce is available and key is style.\n    result.setAttribute(key, attrs[key]);\n  });\n  populateElementProperties(result, props);\n  children.forEach((child) => appendNode(result, child));\n  return result;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const BODY = \"BODY\";\nexport const IFRAME = \"IFRAME\";\nexport const IMG = \"IMG\";\nexport const DIV = \"DIV\";\nexport const STYLE = \"STYLE\";\nexport const SCRIPT = \"SCRIPT\";\nexport const HEAD = \"HEAD\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createNode from \"./dom/createNode.js\";\nimport { IMG } from \"../constants/tagName.js\";\n\n/**\n * Fires an image pixel from the current document's window.\n * @param {object} currentDocument\n * @param {string} src\n * @returns {Promise}\n */\nexport default ({ src, currentDocument = document }) => {\n  return new Promise((resolve, reject) => {\n    const attrs = { src };\n    const props = {\n      onload: resolve,\n      onerror: reject,\n      onabort: reject,\n    };\n\n    createNode(IMG, attrs, props, [], currentDocument);\n  });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns whether the value is a function.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) => typeof value === \"function\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns whether the value is a non-empty array.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) => Array.isArray(value) && value.length > 0;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (value) => {\n  if (Array.isArray(value)) {\n    return value;\n  }\n\n  if (value == null) {\n    return [];\n  }\n\n  return [].slice.call(value);\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport toArray from \"../toArray.js\";\n\nconst SIBLING_PATTERN = /^\\s*>/;\n\nexport default (context, selector) => {\n  if (!SIBLING_PATTERN.test(selector)) {\n    return toArray(context.querySelectorAll(selector));\n  }\n  return toArray(context.querySelectorAll(`:scope ${selector}`));\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \":shadow\";\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport querySelectorAll from \"./querySelectorAll.js\";\nimport SHADOW_SEPARATOR from \"../../constants/shadowSeparator.js\";\n\nconst splitWithShadow = (selector) => {\n  return selector.split(SHADOW_SEPARATOR);\n};\n\nconst transformPrefix = (parent, selector) => {\n  const result = selector;\n  const hasChildCombinatorPrefix = result.startsWith(\">\");\n  if (!hasChildCombinatorPrefix) {\n    return result;\n  }\n\n  const prefix =\n    parent instanceof Element || parent instanceof Document\n      ? \":scope\"\n      : \":host\"; // see https://bugs.webkit.org/show_bug.cgi?id=233380\n\n  return `${prefix} ${result}`;\n};\n\nexport default (context, selector) => {\n  const parts = splitWithShadow(selector);\n\n  if (parts.length < 2) {\n    return querySelectorAll(context, selector);\n  }\n\n  // split the selector into parts separated by :shadow pseudo-selectors\n  // find each subselector element based on the previously selected node's shadowRoot\n  let parent = context;\n  for (let i = 0; i < parts.length; i += 1) {\n    const part = parts[i].trim();\n    // if part is empty, it means there's a chained :eq:shadow selector\n    if (part === \"\" && parent.shadowRoot) {\n      parent = parent.shadowRoot;\n\n      continue;\n    }\n    const prefixed = transformPrefix(parent, part);\n    const partNode = querySelectorAll(parent, prefixed);\n\n    if (partNode.length === 0 || !partNode[0] || !partNode[0].shadowRoot) {\n      return partNode;\n    }\n\n    parent = partNode[0].shadowRoot;\n  }\n  return undefined;\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport SHADOW_SEPARATOR from \"../../constants/shadowSeparator.js\";\n\nexport default (str) => str.indexOf(SHADOW_SEPARATOR) !== -1;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport querySelectorAll from \"./querySelectorAll.js\";\nimport selectNodesWithShadow from \"./selectNodesWithShadow.js\";\nimport isShadowSelector from \"./isShadowSelector.js\";\n\n/**\n * Returns an array of matched DOM nodes.\n * @param {String} selector\n * @param {Node} [context=document] defaults to document\n * @returns {Array} an array of DOM nodes\n */\nexport default (selector, context = document) => {\n  if (!isShadowSelector(selector)) {\n    return querySelectorAll(context, selector);\n  }\n\n  return selectNodesWithShadow(context, selector);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isFunction from \"../isFunction.js\";\nimport isNonEmptyArray from \"../isNonEmptyArray.js\";\nimport selectNodes from \"./selectNodes.js\";\n\nconst MUTATION_OBSERVER = \"MutationObserver\";\nconst RAF = \"requestAnimationFrame\";\nconst MUTATION_OBSERVER_CONFIG = { childList: true, subtree: true };\nconst VISIBILITY_STATE = \"visibilityState\";\nconst VISIBLE = \"visible\";\nconst DELAY = 100;\nconst MAX_POLLING_TIMEOUT = 5000;\n\nconst createError = (selector) => {\n  return new Error(`Could not find: ${selector}`);\n};\n\nconst createPromise = (executor) => {\n  return new Promise(executor);\n};\n\nexport const canUseMutationObserver = (win) => {\n  return isFunction(win[MUTATION_OBSERVER]);\n};\n\nexport const awaitUsingMutationObserver = (\n  win,\n  doc,\n  selector,\n  timeout,\n  selectFunc,\n) => {\n  return createPromise((resolve, reject) => {\n    let timer;\n\n    const mutationObserver = new win[MUTATION_OBSERVER](() => {\n      const nodes = selectFunc(selector);\n\n      if (isNonEmptyArray(nodes)) {\n        mutationObserver.disconnect();\n        if (timer) {\n          clearTimeout(timer);\n        }\n        resolve(nodes);\n      }\n    });\n\n    timer = setTimeout(() => {\n      mutationObserver.disconnect();\n      reject(createError(selector));\n    }, timeout);\n\n    mutationObserver.observe(doc, MUTATION_OBSERVER_CONFIG);\n  });\n};\n\nexport const canUseRequestAnimationFrame = (doc) => {\n  return doc[VISIBILITY_STATE] === VISIBLE;\n};\n\nexport const awaitUsingRequestAnimation = (\n  win,\n  selector,\n  timeout,\n  selectFunc,\n) => {\n  return createPromise((resolve, reject) => {\n    const execute = () => {\n      const nodes = selectFunc(selector);\n\n      if (isNonEmptyArray(nodes)) {\n        resolve(nodes);\n        return;\n      }\n\n      win[RAF](execute);\n    };\n\n    execute();\n\n    setTimeout(() => {\n      reject(createError(selector));\n    }, timeout);\n  });\n};\n\nexport const awaitUsingTimer = (selector, timeout, selectFunc) => {\n  return createPromise((resolve, reject) => {\n    const execute = () => {\n      const nodes = selectFunc(selector);\n\n      if (isNonEmptyArray(nodes)) {\n        resolve(nodes);\n        return;\n      }\n\n      setTimeout(execute, DELAY);\n    };\n\n    execute();\n\n    setTimeout(() => {\n      reject(createError(selector));\n    }, timeout);\n  });\n};\n\nexport default (\n  selector,\n  selectFunc = selectNodes,\n  timeout = MAX_POLLING_TIMEOUT,\n  win = window,\n  doc = document,\n) => {\n  const nodes = selectFunc(selector);\n\n  if (isNonEmptyArray(nodes)) {\n    return Promise.resolve(nodes);\n  }\n\n  if (canUseMutationObserver(win)) {\n    return awaitUsingMutationObserver(win, doc, selector, timeout, selectFunc);\n  }\n\n  if (canUseRequestAnimationFrame(doc)) {\n    return awaitUsingRequestAnimation(win, selector, timeout, selectFunc);\n  }\n\n  return awaitUsingTimer(selector, timeout, selectFunc);\n};\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createNode from \"./createNode.js\";\nimport appendNode from \"./appendNode.js\";\n\nlet nonce;\n\n/**\n * Returns the nonce if available.\n * @param {Node} [context=document] defaults to document\n * @returns {(String|undefined)} the nonce or undefined if not available\n */\nconst getNonce = (context = document) => {\n  if (nonce === undefined) {\n    const n = context.querySelector(\"[nonce]\");\n    // NOTE: We're keeping n.getAttribute(\"nonce\") until it is safe to remove:\n    //   ref: https://github.com/whatwg/html/issues/2369#issuecomment-280853946\n    nonce = n && (n.nonce || n.getAttribute(\"nonce\"));\n  }\n  return nonce;\n};\n\n/**\n * Loads an external JavaScript file using Alloy's DOM utilities.\n * Enhanced version that supports additional script attributes.\n * @param {string} url The URL of the script to load.\n * @param {Object} options Additional options for script loading\n * @param {Object} options.attributes Additional attributes to set on script element\n * @param {Function} options.onLoad Optional callback when script loads successfully\n * @param {Function} options.onError Optional callback when script fails to load\n * @returns {Promise<void>} A promise that resolves when the script is loaded or rejects on error.\n */\nconst loadScript = (url, options = {}) => {\n  // Check if script already exists\n  if (document.querySelector(`script[src=\"${url}\"]`)) {\n    if (options.onLoad) options.onLoad();\n    return Promise.resolve();\n  }\n\n  return new Promise((resolve, reject) => {\n    const { attributes = {}, onLoad, onError } = options;\n\n    const script = createNode(\n      \"script\",\n      {\n        type: \"text/javascript\",\n        src: url,\n        async: true,\n        ...(getNonce() && { nonce: getNonce() }),\n        ...attributes, // Allow additional attributes like crossorigin\n      },\n      {\n        onload: () => {\n          if (onLoad) onLoad();\n          resolve();\n        },\n        onerror: () => {\n          const error = new Error(`Failed to load script: ${url}`);\n          if (onError) onError(error);\n          reject(error);\n        },\n      },\n    );\n\n    const appendToDOM = () => {\n      const parent = document.head || document.body;\n      if (parent) {\n        appendNode(parent, script);\n      } else {\n        const error = new Error(\n          \"Neither <head> nor <body> available for script insertion.\",\n        );\n        if (onError) onError(error);\n        reject(error);\n      }\n    };\n\n    if (document.readyState === \"loading\") {\n      document.addEventListener(\"DOMContentLoaded\", appendToDOM);\n    } else {\n      appendToDOM();\n    }\n  });\n};\n\nexport default loadScript;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns true if element matches the selector.\n * @param {String} selector\n * @param {Node} [element]\n * @returns {Boolean}\n */\nexport default (selector, element) => {\n  if (element.matches) {\n    return element.matches(selector);\n  }\n\n  // Making IE 11 happy\n  return element.msMatchesSelector(selector);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (node) => {\n  const parent = node.parentNode;\n\n  if (parent) {\n    return parent.removeChild(node);\n  }\n\n  return null;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport fireImageInDocument from \"./fireImage.js\";\nimport {\n  appendNode as appendNodeToDocument,\n  awaitSelector as awaitSelectorInDocument,\n  createNode as createNodeInDocument,\n} from \"./dom/index.js\";\nimport { BODY, IFRAME } from \"../constants/tagName.js\";\n\nconst IFRAME_ATTRS = {\n  name: \"Adobe Alloy\",\n};\n\nconst IFRAME_PROPS = {\n  style: {\n    display: \"none\",\n    width: 0,\n    height: 0,\n  },\n};\n\nexport default ({\n  appendNode = appendNodeToDocument,\n  awaitSelector = awaitSelectorInDocument,\n  createNode = createNodeInDocument,\n  fireImage = fireImageInDocument,\n} = {}) => {\n  const fireOnPage = fireImage;\n\n  let hiddenIframe;\n\n  const createIframe = () => {\n    return awaitSelector(BODY).then(([body]) => {\n      if (hiddenIframe) {\n        return hiddenIframe;\n      }\n      hiddenIframe = createNode(IFRAME, IFRAME_ATTRS, IFRAME_PROPS);\n      return appendNode(body, hiddenIframe);\n    });\n  };\n\n  const fireInIframe = ({ src }) => {\n    return createIframe().then((iframe) => {\n      const currentDocument = iframe.contentWindow.document;\n      return fireImage({ src, currentDocument });\n    });\n  };\n\n  return (request) => {\n    const { hideReferrer, url } = request;\n    return hideReferrer ? fireInIframe({ src: url }) : fireOnPage({ src: url });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isObject from \"./isObject.js\";\n\n/**\n * Returns whether the value is an empty object.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) => isObject(value) && Object.keys(value).length === 0;\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isEmptyObject from \"./isEmptyObject.js\";\nimport isNil from \"./isNil.js\";\nimport isObject from \"./isObject.js\";\n\n/**\n * Given an object and a function that takes a value and returns a predicate, filter out\n * all non-object deeply nested values that do not pass the predicate.\n *\n * Example: filterObject({ a: 2, b: { c: 6 } }, (val) => val > 5) returns { b { c: 6 } }\n *\n * @param {*} obj\n * @param {* => boolean} predicate a function that takes a value and return a boolean,\n * representing if it should be included in the result object or not.\n * @returns A copy of the original object with the values that fail the predicate, filtered out.\n */\nconst filterObject = (obj, predicate) => {\n  if (isNil(obj) || !isObject(obj)) {\n    return obj;\n  }\n  return Object.keys(obj).reduce((result, key) => {\n    const value = obj[key];\n    if (isObject(value)) {\n      // value is object, go deeper\n      const filteredValue = filterObject(value, predicate);\n      if (isEmptyObject(filteredValue)) {\n        return result;\n      }\n      return { ...result, [key]: filteredValue };\n    }\n    // value is not an object, test predicate\n    if (predicate(value)) {\n      return { ...result, [key]: value };\n    }\n    return result;\n  }, {});\n};\n\nexport default filterObject;\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/* eslint-disable no-bitwise */\n\n/**\n * Generates an FNV1A32 hash for the given input string.\n * @param {string} str - The string to hash\n * @returns {number} - The 32-bit FNV1A hash as a number\n */\nconst fnv1a32 = (str) => {\n  // FNV_offset_basis for 32-bit hash\n  let hash = 0x811c9dc5;\n\n  // FNV_prime for 32-bit hash\n  const prime = 0x01000193;\n\n  // Convert the string to a properly encoded UTF-8 byte array\n  const utf8Encoder = new TextEncoder();\n  const bytes = utf8Encoder.encode(str);\n\n  // Process each byte in the UTF-8 encoded array\n  for (let i = 0; i < bytes.length; i += 1) {\n    // XOR the hash with the byte value, then multiply by prime\n    hash ^= bytes[i];\n    hash = Math.imul(hash, prime);\n  }\n\n  // Return the final hash value (unsigned 32-bit integer)\n  return hash >>> 0;\n};\n\n/**\n * Generates an FNV1A32 hash and returns it as a hexadecimal string.\n * @param {string} str - The string to hash\n * @returns {string} - The 32-bit FNV1A hash as a hexadecimal string\n */\nconst fnv1a32Hex = (str) => fnv1a32(str).toString(16).padStart(8, \"0\");\n\nexport default fnv1a32Hex;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"com.adobe.alloy.\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns the last N number of items from an array.\n * @param {Array} arr\n * @param {number} itemCount\n * @returns {Array}\n */\nexport default (arr, itemCount) => arr.slice(-itemCount);\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport namespace from \"../constants/namespace.js\";\nimport getLastArrayItems from \"./getLastArrayItems.js\";\n\nconst cookieName = `${namespace}getTld`;\n\n/**\n * Of the current web page's hostname, this is the top-most domain that is\n * not a \"public suffix\" as outlined in https://publicsuffix.org/. In other\n * words, this is top-most domain that is able to accept cookies.\n * @param {Object} window\n * @param {Object} cookieJar\n * @returns {string}\n */\nexport default (window, cookieJar) => {\n  let topLevelCookieDomain = \"\";\n\n  // If hostParts.length === 1, we may be on localhost.\n  const hostParts = window.location.hostname.toLowerCase().split(\".\");\n  let i = 1;\n\n  while (i < hostParts.length && !cookieJar.get(cookieName)) {\n    i += 1;\n    topLevelCookieDomain = getLastArrayItems(hostParts, i).join(\".\");\n    cookieJar.set(cookieName, cookieName, { domain: topLevelCookieDomain });\n  }\n\n  cookieJar.remove(cookieName, { domain: topLevelCookieDomain });\n\n  return topLevelCookieDomain;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// Remember to also incorporate the org ID wherever cookies are read or written.\nexport default \"kndctr\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (orgId) => orgId.replace(\"@\", \"_\");\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport COOKIE_NAME_PREFIX from \"../constants/cookieNamePrefix.js\";\nimport sanitizeOrgIdForCookieName from \"./sanitizeOrgIdForCookieName.js\";\n\nexport default (orgId, key) =>\n  `${COOKIE_NAME_PREFIX}_${sanitizeOrgIdForCookieName(orgId)}_${key}`;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Group an array by a key getter provided\n * @param {Array} arr Array to iterate over.\n * @param {Function} keyGetter The key getter by which to group.\n * @returns {Object}\n */\nexport default (arr, keyGetter) => {\n  const result = {};\n\n  arr.forEach((item) => {\n    const key = keyGetter(item);\n\n    if (!result[key]) {\n      result[key] = [];\n    }\n\n    result[key].push(item);\n  });\n\n  return result;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const CHROME = \"Chrome\";\nexport const EDGE = \"Edge\";\nexport const EDGE_CHROMIUM = \"EdgeChromium\";\nexport const FIREFOX = \"Firefox\";\nexport const IE = \"IE\";\nexport const SAFARI = \"Safari\";\nexport const UNKNOWN = \"Unknown\";\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default (fn) => {\n  let called = false;\n  let result;\n  return () => {\n    if (!called) {\n      called = true;\n      result = fn();\n    }\n    return result;\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  CHROME,\n  EDGE,\n  EDGE_CHROMIUM,\n  IE,\n  UNKNOWN,\n} from \"../constants/browser.js\";\n\nimport lazy from \"./lazy.js\";\n\n// Users could have also disabled third-party cookies within these browsers, but\n// we don't know. We also assume \"unknown\" browsers support third-party cookies,\n// though we don't really know that either. We're making best guesses.\nconst browsersSupportingThirdPartyCookie = [\n  CHROME,\n  EDGE,\n  EDGE_CHROMIUM,\n  IE,\n  UNKNOWN,\n];\n\nexport default ({ getBrowser }) =>\n  lazy(() => browsersSupportingThirdPartyCookie.includes(getBrowser()));\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const IDENTITY = \"identity\";\nexport const CONSENT = \"consent\";\nexport const CLUSTER = \"cluster\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport cookieJar from \"./cookieJar.js\";\nimport getNamespacedCookieName from \"./getNamespacedCookieName.js\";\nimport { IDENTITY } from \"../constants/cookieNameKey.js\";\n\nexport default ({ orgId }) => {\n  const identityCookieName = getNamespacedCookieName(orgId, IDENTITY);\n  /**\n   * Returns whether the identity cookie exists.\n   */\n  return () => Boolean(cookieJar.get(identityCookieName));\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport lazy from \"./lazy.js\";\n\nimport {\n  EDGE,\n  EDGE_CHROMIUM,\n  CHROME,\n  FIREFOX,\n  IE,\n  SAFARI,\n  UNKNOWN,\n} from \"../constants/browser.js\";\n\nconst matchUserAgent = (regexs, userAgent) => {\n  const keys = Object.keys(regexs);\n  for (let i = 0; i < keys.length; i += 1) {\n    const key = keys[i];\n    const regex = regexs[key];\n    if (regex.test(userAgent)) {\n      return key;\n    }\n  }\n  return UNKNOWN;\n};\n\nexport default ({ userAgent }) => {\n  return lazy(() =>\n    matchUserAgent(\n      {\n        /*\n      The MIT License (MIT)\n\n      Copyright (c) 2019 Damon Oehlman damon.oehlman@gmail.com\n\n      Permission is hereby granted, free of charge, to any person obtaining a copy\n      of this software and associated documentation files (the \"Software\"), to\n      deal in the Software without restriction, including without limitation the\n      rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n      sell copies of the Software, and to permit persons to whom the Software is\n      furnished to do so, subject to the following conditions:\n\n      The above copyright notice and this permission notice shall be included in\n      all copies or substantial portions of the Software.\n\n      THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n      IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n      FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n      AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n      LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n      FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n      DEALINGS IN THE SOFTWARE.\n      */\n        // Regular expression patterns were copied from\n        // https://github.com/DamonOehlman/detect-browser\n        // These are only the browsers that Alloy officially supports.\n        /* eslint-disable */\n        [EDGE]: /Edge\\/([0-9\\._]+)/,\n        // Edge Chromium can dynamically change its user agent string based\n        // on the host site:\n        // https://winaero.com/blog/microsoft-edge-chromium-dynamically-changes-its-user-agent/\n        [EDGE_CHROMIUM]: /Edg\\/([0-9\\.]+)/,\n        [CHROME]: /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/,\n        [FIREFOX]: /Firefox\\/([0-9\\.]+)(?:\\s|$)/,\n        // This only covers version 11 of IE, but that's all we support.\n        [IE]: /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/,\n        [SAFARI]: /Version\\/([0-9\\._]+).*Safari/,\n        /* eslint-enable */\n      },\n      userAgent,\n    ),\n  );\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { Storage, StorageCreator } from './types.js' */\n\nimport baseNamespace from \"../constants/namespace.js\";\n\n/**\n * Creates a storage interface for a specific storage type with namespaced keys.\n *\n * @param {Object} context - The context object (typically window) that provides storage APIs.\n * @param {string} storageType - The type of storage to use ('localStorage' or 'sessionStorage').\n * @param {string} namespace - The namespace prefix to prepend to all storage keys.\n * @returns {Storage}\n */\nconst getStorageByType = (context, storageType, namespace) => {\n  // When storage is disabled on Safari, the mere act of referencing\n  // window.localStorage or window.sessionStorage throws an error.\n  // For this reason, we wrap in a try-catch.\n  return {\n    /**\n     * Reads a value from storage.\n     * @param {string} name The name of the item to be read.\n     * @returns {string}\n     */\n    getItem(name) {\n      try {\n        return context[storageType].getItem(namespace + name);\n      } catch {\n        return null;\n      }\n    },\n    /**\n     * Saves a value to storage.\n     * @param {string} name The name of the item to be saved.\n     * @param {string} value The value of the item to be saved.\n     * @returns {boolean} Whether the item was successfully saved to storage.\n     */\n    setItem(name, value) {\n      try {\n        context[storageType].setItem(namespace + name, value);\n        return true;\n      } catch {\n        return false;\n      }\n    },\n    /**\n     * Clear all values in storage that match the namespace.\n     */\n    clear() {\n      try {\n        Object.keys(context[storageType]).forEach((key) => {\n          if (key.startsWith(namespace)) {\n            context[storageType].removeItem(key);\n          }\n        });\n        return true;\n      } catch {\n        return false;\n      }\n    },\n  };\n};\n\n/**\n * Creates a storage factory function that provides access to both session and persistent storage\n * with namespaced keys. This is a higher-order function that returns a function which can be\n * used to create storage instances with additional namespace suffixes.\n *\n * @param {Object} context - The context object (typically window) that provides storage APIs.\n * @returns {StorageCreator}\n */\nexport default (context) => (additionalNamespace) => {\n  const finalNamespace = baseNamespace + additionalNamespace;\n  return {\n    session: getStorageByType(context, \"sessionStorage\", finalNamespace),\n    persistent: getStorageByType(context, \"localStorage\", finalNamespace),\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n/**\n * Returns items that are found within both arrays.\n * @param {Array} a\n * @param {Array} b\n * @returns {Array}\n */\nexport default (a, b) => a.filter((x) => b.includes(x));\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns whether the value is a boolean.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) => typeof value === \"boolean\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns whether the value is a number.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) => typeof value === \"number\" && !Number.isNaN(value);\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isNumber from \"./isNumber.js\";\n\n/**\n * Returns whether the value is an integer.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) => {\n  const parsed = parseInt(value, 10);\n\n  return isNumber(parsed) && value === parsed;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport COOKIE_NAME_PREFIX from \"../constants/cookieNamePrefix.js\";\nimport sanitizeOrgIdForCookieName from \"./sanitizeOrgIdForCookieName.js\";\n\n/**\n * Determines whether a cookie name is namespaced according to the contract\n * defined by the server.\n * @param {String} orgId The org ID configured for the Alloy instance.\n * @param {String} name The cookie name.\n * @returns {boolean}\n */\nexport default (orgId, name) =>\n  name.indexOf(\n    `${COOKIE_NAME_PREFIX}_${sanitizeOrgIdForCookieName(orgId)}_`,\n  ) === 0;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns whether the value is a string.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) => typeof value === \"string\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isString from \"./isString.js\";\n\n/**\n * Returns whether the value is a populated string.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) => isString(value) && value.length > 0;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * A function that performs no operations.\n */\nexport default () => {};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport isString from \"./isString.js\";\n\nconst parseDomainBasic = (host) => {\n  const result = {};\n  const domainParts = host.split(\".\");\n\n  switch (domainParts.length) {\n    case 1:\n      result.subdomain = \"\";\n      result.domain = host;\n      result.topLevelDomain = \"\";\n      break;\n    case 2:\n      result.subdomain = \"\";\n      result.domain = host;\n      result.topLevelDomain = domainParts[1];\n      break;\n    case 3:\n      result.subdomain = domainParts[0] === \"www\" ? \"\" : domainParts[0];\n      result.domain = host;\n      result.topLevelDomain = domainParts[2];\n      break;\n    case 4:\n      result.subdomain = domainParts[0] === \"www\" ? \"\" : domainParts[0];\n      result.domain = host;\n      result.topLevelDomain = `${domainParts[2]}.${domainParts[3]}`;\n      break;\n    default:\n      break;\n  }\n\n  return result;\n};\n\n/**\n * @typedef {Object} ParseUriResult\n * @property {string} host\n * @property {string} path\n * @property {string} query\n * @property {string} anchor\n *\n * @param {string} url\n * @returns {ParseUriResult}\n */\nconst parseUri = (url) => {\n  try {\n    const parsed = new URL(url);\n    let path = parsed.pathname;\n    if (!url.endsWith(\"/\") && path === \"/\") {\n      path = \"\";\n    }\n    return {\n      host: parsed.hostname,\n      path,\n      query: parsed.search.replace(/^\\?/, \"\"),\n      anchor: parsed.hash.replace(/^#/, \"\"),\n    };\n  } catch {\n    return {\n      host: \"\",\n      path: \"\",\n      query: \"\",\n      anchor: \"\",\n    };\n  }\n};\n\nconst parseUrl = (url, parseDomain = parseDomainBasic) => {\n  if (!isString(url)) {\n    url = \"\";\n  }\n\n  const parsed = parseUri(url);\n  const { host, path, query, anchor } = parsed;\n\n  return {\n    path,\n    query,\n    fragment: anchor,\n    ...parseDomain(host),\n  };\n};\n\nexport default parseUrl;\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport isNil from \"./isNil.js\";\nimport filterObject from \"./filterObject.js\";\nimport isEmptyObject from \"./isEmptyObject.js\";\nimport isNonEmptyArray from \"./isNonEmptyArray.js\";\nimport isNonEmptyString from \"./isNonEmptyString.js\";\nimport isNumber from \"./isNumber.js\";\nimport isBoolean from \"./isBoolean.js\";\n\n// We want to avoid mapping between specific keys because we want Konductor\n// to be able to add overrides in the future without us needing to make\n// any changes to the Web SDK\nexport default (configuration) => {\n  if (isNil(configuration) || typeof configuration !== \"object\") {\n    return null;\n  }\n  // remove entries that are empty strings or arrays\n  const configOverrides = filterObject(configuration, (value) => {\n    if (isNil(value)) {\n      return false;\n    }\n    if (isBoolean(value)) {\n      return true;\n    }\n    if (isNumber(value)) {\n      return true;\n    }\n    if (isNonEmptyString(value)) {\n      return true;\n    }\n    if (isNonEmptyArray(value)) {\n      return true;\n    }\n    return false;\n  });\n  if (isEmptyObject(configOverrides)) {\n    return null;\n  }\n\n  return configOverrides;\n};\n","/***************************************************************************************\n * (c) 2017 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n ****************************************************************************************/\n'use strict';\n\n/**\n * Parse a query string into an object. Leading `?` or `#` are ignored, so you\n * can pass `location.search` or `location.hash` directly.\n *\n * URL components are decoded with decode-uri-component.\n *\n * Parse arrays with elements using duplicate keys, e.g. ?a=1&a=2 becomes\n * {a: ['1', '2']}.\n *\n * Query keys are sorted alphabetically.\n *\n * Numbers and booleans are NOT parsed; they are left as strings.\n * @param {string} query the query part of a url\n * @returns {{ [key: string]: string | string[] | undefined }} the parsed query string\n */\nvar parseQueryString = function (query) {\n  /** @type {{[key: string]: string | string[] | undefined }} */\n  var result = {};\n\n  if (!query || typeof query !== 'string') {\n    return result;\n  }\n\n  var cleanQuery = query.trim().replace(/^[?#&]/, '');\n  var params = new URLSearchParams(cleanQuery);\n\n  var iter = params.keys();\n  do {\n    var v = iter.next();\n    var key = v.value;\n\n    if (key) {\n      var values = params.getAll(key);\n      if (values.length === 1) {\n        result[key] = values[0];\n      } else {\n        result[key] = values;\n      }\n    }\n  } while (v.done === false);\n\n  return result;\n};\n\n/**\n * Transform an object into a query string.\n *\n * Keys having object values are ignored.\n *\n * @param {object} the object to transform into a query string\n * @returns {string} the parsed query string\n */\n\nvar stringifyObject = function (object) {\n  var spaceToken = '{{space}}';\n  var params = new URLSearchParams();\n\n  Object.keys(object).forEach(function (key) {\n    var value = object[key];\n\n    if (typeof object[key] === 'string') {\n      value = value.replace(/ /g, spaceToken);\n    } else if (\n      ['object', 'undefined'].includes(typeof value) &&\n      !Array.isArray(value)\n    ) {\n      value = '';\n    }\n\n    if (Array.isArray(value)) {\n      value.forEach(function (arrayValue) {\n        params.append(key, arrayValue);\n      });\n    } else {\n      params.append(key, value);\n    }\n  });\n\n  return params\n    .toString()\n    .replace(new RegExp(encodeURIComponent(spaceToken), 'g'), '%20');\n};\n\n// We proxy the underlying querystring module so we can limit the API we expose.\n// This allows us to more easily make changes to the underlying implementation later without\n// having to worry about breaking extensions. If extensions demand additional functionality, we\n// can make adjustments as needed.\nmodule.exports = {\n  parse: function (string) {\n    return parseQueryString(string);\n  },\n  stringify: function (object) {\n    return stringifyObject(object);\n  }\n};\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Recursively sorts the properties of all objects within the provided data structure.\n * @param {Object|Array} data - The data structure to serialize. It can be an object or an array.\n * @returns {Object|Array} - A new object or array with allo the container object having properties sorted.\n */\nconst sortObjectPropertiesDeep = (data) => {\n  if (Array.isArray(data)) {\n    return data.map((value) => sortObjectPropertiesDeep(value));\n  }\n\n  if (typeof data === \"object\" && data !== null) {\n    return Object.keys(data)\n      .sort()\n      .reduce((memo, key) => {\n        memo[key] = sortObjectPropertiesDeep(data[key]);\n        return memo;\n      }, {});\n  }\n\n  return data;\n};\n\n/**\n * This utility helps create consistent serialized representations of objects\n * by eliminating variations caused by property order. This is useful for creating\n * reliable hashes or checksums containing these objects.\n * @param {Object|Array} data - The data structure to serialize. It can be an object or an array.\n * @returns {Object|Array} - A new object or array with allo the container object having properties sorted.\n */\nexport default (data) => sortObjectPropertiesDeep(data);\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Creates and returns a new error using the provided value as a message.\n * If the provided value is already an Error, it will be returned unmodified.\n * @param {*} value\n * @returns {Error}\n */\nexport default (value) => {\n  return value instanceof Error ? value : new Error(value);\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ error, message }) => {\n  try {\n    error.message = message;\n  } catch {\n    // We'll set a new message when we can, but some errors, like DOMException,\n    // have a read-only message property, which limits our options.\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport toError from \"./toError.js\";\nimport updateErrorMessage from \"./updateErrorMessage.js\";\n\n/**\n * Augments an error's message with additional context as it bubbles up the call stack.\n * @param {Object} options\n * @param {String} options.message The message to be added to the error.\n * @param {Error} options.error Optimally, this is an instance of Error. If it is not,\n * this is used as the basis for the message of a newly created Error instance.\n * @returns {*}\n */\nexport default ({ error, message }) => {\n  const errorToStack = toError(error);\n  const newMessage = `${message}\\nCaused by: ${errorToStack.message}`;\n  updateErrorMessage({\n    error: errorToStack,\n    message: newMessage,\n  });\n  return errorToStack;\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport isString from \"./isString.js\";\n\nexport default (str) => {\n  return isString(str) && str.toLowerCase() === \"true\";\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isNumber from \"./isNumber.js\";\nimport isString from \"./isString.js\";\n\n/*\n * coerce `value` to a number or return `defaultValue` if it cannot be.\n *\n * The coersion is attempted if value is a number or string.\n */\nexport default (value, defaultValue) => {\n  if (isNumber(value) || isString(value)) {\n    const n = Math.round(Number(value));\n    if (!Number.isNaN(n)) {\n      return n;\n    }\n  }\n  return defaultValue;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport toInteger from \"./toInteger.js\";\n\n/**\n * Add padString to the start of the string until it reaches the target length\n *\n * Different from String.prototype.padStart because this function coerces the\n * input to a string before padding.\n * @param {any} string\n * @param {number} targetLength\n * @param {string} padString\n * @returns {string}\n */\nconst padStart = (string, targetLength, padString) => {\n  return `${string}`.padStart(targetLength, padString);\n};\n\n/**\n * Formats the date into an ISO date-time string in the local timezone\n * @param {Date} date\n * @returns {string}\n */\nexport default (date) => {\n  const YYYY = date.getFullYear();\n  const MM = padStart(date.getMonth() + 1, 2, \"0\");\n  const DD = padStart(date.getDate(), 2, \"0\");\n\n  const hh = padStart(date.getHours(), 2, \"0\");\n  const mm = padStart(date.getMinutes(), 2, \"0\");\n  const ss = padStart(date.getSeconds(), 2, \"0\");\n  const mmm = padStart(date.getMilliseconds(), 3, \"0\");\n\n  // The time-zone offset is the difference, in minutes, from local time to UTC. Note that this\n  // means that the offset is positive if the local timezone is behind UTC and negative if it is\n  // ahead. For example, for time zone UTC+10:00, -600 will be returned.\n  const timezoneOffset = toInteger(date.getTimezoneOffset(), 0);\n  const ts = timezoneOffset > 0 ? \"-\" : \"+\";\n  const th = padStart(Math.floor(Math.abs(timezoneOffset) / 60), 2, \"0\");\n  const tm = padStart(Math.abs(timezoneOffset) % 60, 2, \"0\");\n\n  return `${YYYY}-${MM}-${DD}T${hh}:${mm}:${ss}.${mmm}${ts}${th}:${tm}`;\n};\n","import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n","let getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n    if (!getRandomValues) {\n        if (typeof crypto === 'undefined' || !crypto.getRandomValues) {\n            throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n        }\n        getRandomValues = crypto.getRandomValues.bind(crypto);\n    }\n    return getRandomValues(rnds8);\n}\n","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default { randomUUID };\n","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nexport default v4;\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Wraps a validator returning the value if it is null or undefined, otherwise\n * it will call the original validator and return the result.\n *\n * @param {function} validator - the validator to call if the value is not null\n */\nconst skipIfNull = (validator) =>\n  function skipIfNullValidator(value, path) {\n    return value == null ? value : validator.call(this, value, path);\n  };\n\n/**\n * Returns a new validator that calls the first validator and then calls the second\n * validator with the result of the first validator. The result of the second validator\n * is returned.\n *\n * @param {function} firstValidator - validator to call first\n * @param {function} secondValidator - validator to call second\n * @returns {function} - a new validator that calls the first and second validators\n */\nconst callSequentially = (firstValidator, secondValidator) =>\n  function callSequentiallyValidator(value, path) {\n    return secondValidator.call(\n      this,\n      firstValidator.call(this, value, path),\n      path,\n    );\n  };\n\n/**\n * Just like callSequentially, but if either validator throws an error, the errors\n * are collected and thrown at the end.\n *\n * @param {function} firstValidator\n * @param {function} secondValidator\n * @returns {function}\n */\nconst callSequentiallyJoinErrors = (firstValidator, secondValidator) =>\n  function callSequentiallyJoinErrorsValidator(value, path) {\n    const errors = [];\n    const newValue = [firstValidator, secondValidator].reduce(\n      (memo, validator) => {\n        try {\n          return validator.call(this, memo, path);\n        } catch (e) {\n          errors.push(e);\n          return memo;\n        }\n      },\n      value,\n    );\n    if (errors.length) {\n      throw new Error(errors.join(\"\\n\"));\n    }\n    return newValue;\n  };\n\n/**\n * Chains two validators together. In addition to calling the validators in\n * sequence, this will also copy over methods from the base validator to the\n * resulting validator and include any additional methods.\n *\n * @param {function} baseValidator - This validator will be called first, and its\n * methods will be copied over to the returned validator.\n * @param {function} newValidator - This validator will be called second.\n * @param {object} additionalMethods - Additional methods to include on the returned\n * validator.\n * @returns {function}\n */\nexport const chain = (baseValidator, newValidator, additionalMethods) => {\n  return Object.assign(\n    callSequentially(baseValidator, newValidator),\n    baseValidator,\n    additionalMethods,\n  );\n};\n\n/**\n * Chains two validators together, but skips the second validator if the value\n * is null. In addition to calling the validators in sequence, this will also\n * copy over methods from the base validator to the resulting validator and\n * include any additional methods.\n *\n * @param {function} baseValidator - This validator will be called first, and its\n * methods will be copied over to the returned validator.\n * @param {function} newValidator - This validator will be called second. If the value\n * is null after the first validator is called, this validator will not be\n * called.\n * @param {object} additionalMethods - Additional methods to include on the returned\n * validator.\n * @returns {function}\n */\nexport const nullSafeChain = (\n  baseValidator,\n  newValidator,\n  additionalMethods,\n) => {\n  return Object.assign(\n    callSequentially(baseValidator, skipIfNull(newValidator)),\n    baseValidator,\n    additionalMethods,\n  );\n};\n\n/**\n * Same as nullSafeChain, but calls the new validator first.\n *\n * @param {function} baseValidator - This validator will be called second, and its\n * methods will be copied over to the returned validator.\n * @param {function} newValidator - This validator will be called first. If the value\n * is null, this validator will not be called.\n * @param {function} additionalMethods - Additional methods to include on the returned\n * validator.\n * @returns {function}\n */\nexport const reverseNullSafeChainJoinErrors = (\n  baseValidator,\n  newValidator,\n  additionalMethods,\n) => {\n  return Object.assign(\n    callSequentiallyJoinErrors(skipIfNull(newValidator), baseValidator),\n    baseValidator,\n    additionalMethods,\n  );\n};\n\n/**\n * Throws an error if the value is not valid.\n *\n * @param {boolean} isValid - Whether or not the value is valid.\n * @param {*} value - The value to validate.\n * @param {string} path - The path to the value.\n * @param {string} message - The expected part of the error message.\n * @throws {Error} - Throws an error if the value is not valid.\n * @returns {void}\n */\nexport const assertValid = (isValid, value, path, message) => {\n  if (!isValid) {\n    throw new Error(\n      `'${path}': Expected ${message}, but got ${JSON.stringify(value)}.`,\n    );\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isBoolean from \"../isBoolean.js\";\nimport { assertValid } from \"./utils.js\";\n\nexport default (value, path) => {\n  assertValid(isBoolean(value), value, path, \"true or false\");\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport isFunction from \"../isFunction.js\";\nimport { assertValid } from \"./utils.js\";\n\nexport default (value, path) => {\n  assertValid(isFunction(value), value, path, \"a function\");\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { assertValid } from \"./utils.js\";\n\nexport default (validators, message) =>\n  function anyOf(value, path) {\n    let newValue;\n    const valid = validators.find((validator) => {\n      try {\n        newValue = validator.call(this, value, path);\n        return true;\n      } catch {\n        return false;\n      }\n    });\n    assertValid(valid, value, path, message);\n    return newValue;\n  };\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { assertValid } from \"./utils.js\";\n\nexport default (elementValidator) =>\n  function arrayOf(value, path) {\n    assertValid(Array.isArray(value), value, path, \"an array\");\n    const errors = [];\n    const validatedArray = value.map((subValue, i) => {\n      try {\n        return elementValidator.call(this, subValue, `${path}[${i}]`, value);\n      } catch (e) {\n        errors.push(e.message);\n        return undefined;\n      }\n    });\n    if (errors.length) {\n      throw new Error(errors.join(\"\\n\"));\n    }\n    return validatedArray;\n  };\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (defaultValue) => (value) => {\n  if (value == null) {\n    return defaultValue;\n  }\n  return value;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (warning = \"This field has been deprecated\") =>\n  function deprecated(value, path) {\n    let message = warning;\n    if (value !== undefined) {\n      if (path) {\n        message = `'${path}': ${message}`;\n      }\n      if (this && this.logger) {\n        this.logger.warn(message);\n      }\n    }\n    return value;\n  };\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { assertValid } from \"./utils.js\";\n\nexport default (literalValue) => (value, path) => {\n  assertValid(value === literalValue, value, path, `${literalValue}`);\n  return value;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isObject from \"../isObject.js\";\nimport { assertValid } from \"./utils.js\";\n\nexport default (valueValidator) =>\n  function mapOfValues(value, path) {\n    assertValid(isObject(value), value, path, \"an object\");\n\n    const errors = [];\n    const validatedObject = {};\n    Object.keys(value).forEach((subKey) => {\n      const subValue = value[subKey];\n      const subPath = path ? `${path}.${subKey}` : subKey;\n      try {\n        const validatedValue = valueValidator.call(this, subValue, subPath);\n        if (validatedValue !== undefined) {\n          validatedObject[subKey] = validatedValue;\n        }\n      } catch (e) {\n        errors.push(e.message);\n      }\n    });\n\n    if (errors.length) {\n      throw new Error(errors.join(\"\\n\"));\n    }\n\n    return validatedObject;\n  };\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { assertValid } from \"./utils.js\";\n\nexport default (typeName, minimum) => (value, path) => {\n  assertValid(\n    value >= minimum,\n    value,\n    path,\n    `${typeName} greater than or equal to ${minimum}`,\n  );\n  return value;\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { assertValid } from \"./utils.js\";\n\nexport default (typeName, maximum) => (value, path) => {\n  assertValid(\n    value <= maximum,\n    value,\n    path,\n    `${typeName} less than or equal to ${maximum}`,\n  );\n  return value;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (schema) => (value, path) => {\n  const errors = [];\n  Object.keys(value).forEach((subKey) => {\n    if (!schema[subKey]) {\n      const subPath = path ? `${path}.${subKey}` : subKey;\n      errors.push(`'${subPath}': Unknown field.`);\n    }\n  });\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"));\n  }\n\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { assertValid } from \"./utils.js\";\nimport isObject from \"../isObject.js\";\nimport isEmptyObject from \"../isEmptyObject.js\";\n\nexport default (message) => (value, path) => {\n  if (isObject(value)) {\n    assertValid(!isEmptyObject(value), value, path, message);\n  } else {\n    assertValid(value.length > 0, value, path, message);\n  }\n  return value;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isObject from \"../isObject.js\";\nimport { assertValid } from \"./utils.js\";\n\nexport default (schema) =>\n  function objectOf(value, path) {\n    assertValid(isObject(value), value, path, \"an object\");\n\n    const errors = [];\n    const validatedObject = {};\n    Object.keys(schema).forEach((subKey) => {\n      const subValue = value[subKey];\n      const subSchema = schema[subKey];\n      const subPath = path ? `${path}.${subKey}` : subKey;\n      try {\n        const validatedValue = subSchema.call(this, subValue, subPath);\n        if (validatedValue !== undefined) {\n          validatedObject[subKey] = validatedValue;\n        }\n      } catch (e) {\n        errors.push(e.message);\n      }\n    });\n\n    // copy over unknown properties\n    Object.keys(value).forEach((subKey) => {\n      if (!Object.prototype.hasOwnProperty.call(validatedObject, subKey)) {\n        validatedObject[subKey] = value[subKey];\n      }\n    });\n\n    if (errors.length) {\n      throw new Error(errors.join(\"\\n\"));\n    }\n    return validatedObject;\n  };\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport isObject from \"../isObject.js\";\nimport { assertValid } from \"./utils.js\";\n\nexport default (oldField, oldSchema, newField) =>\n  function deprecated(value, path) {\n    assertValid(isObject(value), value, path, \"an object\");\n\n    const {\n      [oldField]: oldValue,\n      [newField]: newValue,\n      ...otherValues\n    } = value;\n    const validatedOldValue = oldSchema(oldValue, path);\n\n    if (validatedOldValue !== undefined) {\n      let message = `The field '${oldField}' is deprecated. Use '${newField}' instead.`;\n      if (path) {\n        message = `'${path}': ${message}`;\n      }\n      if (newValue !== undefined && newValue !== validatedOldValue) {\n        throw new Error(message);\n      } else if (this && this.logger) {\n        this.logger.warn(message);\n      }\n    }\n    return {\n      [newField]: newValue || validatedOldValue,\n      ...otherValues,\n    };\n  };\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { assertValid } from \"./utils.js\";\n\nexport default () => {\n  const values = [];\n  return (value, path) => {\n    assertValid(\n      values.indexOf(value) === -1,\n      value,\n      path,\n      \"a unique value across instances\",\n    );\n    values.push(value);\n    return value;\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n/**\n * Returns whether an array contains unique values.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (values) => {\n  const storedVals = Object.create(null);\n  for (let i = 0; i < values.length; i += 1) {\n    const item = values[i];\n    if (item in storedVals) {\n      return false;\n    }\n    storedVals[item] = true;\n  }\n  return true;\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { assertValid } from \"./utils.js\";\nimport isUnique from \"../isUnique.js\";\n\nexport default () => {\n  return (value, path) => {\n    assertValid(isUnique(value), value, path, \"array values to be unique\");\n    return value;\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { assertValid } from \"./utils.js\";\n\nconst DOMAIN_REGEX = /^[a-z0-9.-]{1,}$/i;\n\nexport default (value, path) => {\n  assertValid(DOMAIN_REGEX.test(value), value, path, \"a valid domain\");\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isInteger from \"../isInteger.js\";\nimport { assertValid } from \"./utils.js\";\n\nexport default (value, path) => {\n  assertValid(isInteger(value), value, path, \"an integer\");\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isNumber from \"../isNumber.js\";\nimport { assertValid } from \"./utils.js\";\n\nexport default (value, path) => {\n  assertValid(isNumber(value), value, path, \"a number\");\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Determines whether the value is a valid regular expression.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) => {\n  try {\n    return RegExp(value) !== null;\n  } catch {\n    return false;\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { assertValid } from \"./utils.js\";\nimport isValidRegExp from \"../isValidRegExp.js\";\n\nexport default (value, path) => {\n  assertValid(isValidRegExp(value), value, path, \"a regular expression\");\n  return value;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (value, path) => {\n  if (value == null) {\n    throw new Error(`'${path}' is a required option`);\n  }\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport isString from \"../isString.js\";\nimport { assertValid } from \"./utils.js\";\n\nexport default (value, path) => {\n  assertValid(isString(value), value, path, \"a string\");\n  return value;\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { assertValid } from \"./utils.js\";\n\nexport default (regexp) => (value, path) => {\n  assertValid(\n    regexp.test(value),\n    value,\n    path,\n    `does not match the ${regexp.toString()}`,\n  );\n  return value;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Validators are functions of two parameters (value and path) that return the\n * computed value if the input is valid, or throw an exception if the input is\n * invalid. In most cases the returned value is the same as the input value;\n * however, reference createDefaultValidator.js to see an example where the\n * computed value is different from the input. Additionally, if we ever wanted\n * to coerce types (i.e. parse string values into integers) as part of the\n * validation process we could use the computed value to accomplish that.\n *\n * The path parameter is used to generate informative error messages. It is\n * created by the objectOf, and arrayOf validators so that any error message can\n * describe which key within the object or array is invalid.\n *\n * The validators also have methods to chain additional validation logic. For\n * example, when you call `string()` to start a validator chain, it returns a\n * validator function but it also has methods like `required` and `nonEmpty`.\n * Here you can see that these methods are actually calling `chain`.\n * Specifically in this function, the leftValidator is called first and then the\n * return value of that is sent to the rightValidator. For example, when calling\n * `string().nonEmpty().required()` the following chain is built up:\n * ```\n *              *\n *            /   \\\n *          *     required\n *        /   \\\n *      *     nonEmpty\n *    /   \\\n * base   string\n * ```\n * Where every * is a call to chain where the two are combined. The individual\n * validators are called from left to right in the above tree. The base\n * validator is simply the identity function `value => value`, representing an\n * optional value.\n *\n * After combining the validators, the new validator function is then augmented\n * with the methods from the leftValidator and from the additionalMethods\n * parameter. For example, when the string() function is called it chains to the\n * base validator, but also adds additional methods like (`regexp`, `domain`,\n * `nonEmpty`, and `unique`). When `nonEmpty` is called, which calls chain\n * again, the additional methods are carried forward because they are already\n * defined on the leftValidator.\n *\n * The base validator also contains the two methods `required` and `default`, so\n * these can be used anywhere after any of the exposed validator functions are\n * called.\n *\n * For most validators, we want the validation to be optional (i.e. allow null\n * or undefined values). To accomplish this, the validator needs to have a check\n * at the begining of the function, short circuiting the validation logic and\n * returning value if value is null or undefined. `default` and `required` do\n * not want this null check though. Indeed, `default` should return the default\n * value if value is null, and `required` should throw an error if value is\n * null.\n *\n * So to keep from having to have a null check in front of most validators,\n * nullSafeChain allows you to chain a validator in a null-safe way.\n */\n\nimport {\n  chain,\n  nullSafeChain,\n  reverseNullSafeChainJoinErrors,\n} from \"./utils.js\";\n\nimport booleanValidator from \"./booleanValidator.js\";\nimport callbackValidator from \"./callbackValidator.js\";\nimport createAnyOfValidator from \"./createAnyOfValidator.js\";\nimport createArrayOfValidator from \"./createArrayOfValidator.js\";\nimport createDefaultValidator from \"./createDefaultValidator.js\";\nimport createDeprecatedValidator from \"./createDeprecatedValidator.js\";\nimport createLiteralValidator from \"./createLiteralValidator.js\";\nimport createMapOfValuesValidator from \"./createMapOfValuesValidator.js\";\nimport createMinimumValidator from \"./createMinimumValidator.js\";\nimport createMaximumValidator from \"./createMaximumValidator.js\";\nimport createNoUnknownFieldsValidator from \"./createNoUnknownFieldsValidator.js\";\nimport createNonEmptyValidator from \"./createNonEmptyValidator.js\";\nimport createObjectOfValidator from \"./createObjectOfValidator.js\";\nimport createRenamedValidator from \"./createRenamedValidator.js\";\nimport createUniqueValidator from \"./createUniqueValidator.js\";\nimport createUniqueItemsValidator from \"./createUniqueItemsValidator.js\";\nimport domainValidator from \"./domainValidator.js\";\nimport integerValidator from \"./integerValidator.js\";\nimport numberValidator from \"./numberValidator.js\";\nimport regexpValidator from \"./regexpValidator.js\";\nimport requiredValidator from \"./requiredValidator.js\";\nimport stringValidator from \"./stringValidator.js\";\nimport matchesRegexpValidator from \"./matchesRegexpValidator.js\";\n\n// The base validator does no validation and just returns the value unchanged\nconst base = (value) => value;\n\n// The 'default', 'required', and 'deprecated' methods are available after any\n// data-type method. Don't use the nullSafeChain on 'default' or 'required'\n// because they need to handle the null or undefined case\nbase.default = function _default(defaultValue) {\n  return chain(this, createDefaultValidator(defaultValue));\n};\nbase.required = function required() {\n  return chain(this, requiredValidator);\n};\nbase.deprecated = function deprecated(message) {\n  return chain(this, createDeprecatedValidator(message));\n};\n\n// helper validators\nconst domain = function domain() {\n  return nullSafeChain(this, domainValidator);\n};\nconst minimumInteger = function minimumInteger(minValue) {\n  return nullSafeChain(this, createMinimumValidator(\"an integer\", minValue));\n};\nconst minimumNumber = function minimumNumber(minValue) {\n  return nullSafeChain(this, createMinimumValidator(\"a number\", minValue));\n};\nconst maximumNumber = function maximumNumber(maxValue) {\n  return nullSafeChain(this, createMaximumValidator(\"a number\", maxValue));\n};\nconst integer = function integer() {\n  return nullSafeChain(this, integerValidator, { minimum: minimumInteger });\n};\nconst nonEmptyString = function nonEmptyString() {\n  return nullSafeChain(this, createNonEmptyValidator(\"a non-empty string\"));\n};\nconst nonEmptyArray = function nonEmptyArray() {\n  return nullSafeChain(this, createNonEmptyValidator(\"a non-empty array\"));\n};\nconst nonEmptyObject = function nonEmptyObject() {\n  return nullSafeChain(this, createNonEmptyValidator(\"a non-empty object\"));\n};\nconst regexp = function regexp() {\n  return nullSafeChain(this, regexpValidator);\n};\nconst matches = function matches(regexpPattern) {\n  return nullSafeChain(this, matchesRegexpValidator(regexpPattern));\n};\nconst unique = function createUnique() {\n  return nullSafeChain(this, createUniqueValidator());\n};\nconst uniqueItems = function createUniqueItems() {\n  return nullSafeChain(this, createUniqueItemsValidator());\n};\n\n// top-level validators.  These are the first functions that are called to create a validator.\nconst anyOf = function anyOf(validators, message) {\n  // use chain here because we don't want to accept null or undefined unless at least\n  // one of the validators accept null or undefined.\n  return chain(this, createAnyOfValidator(validators, message));\n};\nconst anything = function anything() {\n  return this;\n};\nconst arrayOf = function arrayOf(elementValidator) {\n  return nullSafeChain(this, createArrayOfValidator(elementValidator), {\n    nonEmpty: nonEmptyArray,\n    uniqueItems,\n  });\n};\nconst boolean = function boolean() {\n  return nullSafeChain(this, booleanValidator);\n};\nconst callback = function callback() {\n  return nullSafeChain(this, callbackValidator);\n};\nconst literal = function literal(literalValue) {\n  return nullSafeChain(this, createLiteralValidator(literalValue));\n};\nconst number = function number() {\n  return nullSafeChain(this, numberValidator, {\n    minimum: minimumNumber,\n    maximum: maximumNumber,\n    integer,\n    unique,\n  });\n};\nconst mapOfValues = function mapOfValues(valuesValidator) {\n  return nullSafeChain(this, createMapOfValuesValidator(valuesValidator), {\n    nonEmpty: nonEmptyObject,\n  });\n};\nconst createObjectOfAdditionalProperties = (schema) => ({\n  noUnknownFields: function noUnknownFields() {\n    return nullSafeChain(this, createNoUnknownFieldsValidator(schema));\n  },\n  nonEmpty: nonEmptyObject,\n  concat: function concat(otherObjectOfValidator) {\n    // combine the schema so that noUnknownFields, and concat have the combined schema\n    const newSchema = { ...schema, ...otherObjectOfValidator.schema };\n    return nullSafeChain(\n      this,\n      otherObjectOfValidator,\n      createObjectOfAdditionalProperties(newSchema),\n    );\n  },\n  renamed: function renamed(oldField, oldSchema, newField) {\n    // Run the deprecated validator first so that the deprecated field is removed\n    // before the objectOf validator runs.\n    return reverseNullSafeChainJoinErrors(\n      this,\n      createRenamedValidator(oldField, oldSchema, newField),\n    );\n  },\n  schema,\n});\nconst objectOf = function objectOf(schema) {\n  return nullSafeChain(\n    this,\n    createObjectOfValidator(schema),\n    createObjectOfAdditionalProperties(schema),\n  );\n};\nconst string = function string() {\n  return nullSafeChain(this, stringValidator, {\n    regexp,\n    domain,\n    nonEmpty: nonEmptyString,\n    unique,\n    matches,\n  });\n};\n\nconst boundAnyOf = anyOf.bind(base);\nconst boundAnything = anything.bind(base);\nconst boundArrayOf = arrayOf.bind(base);\nconst boundBoolean = boolean.bind(base);\nconst boundCallback = callback.bind(base);\nconst boundLiteral = literal.bind(base);\nconst boundNumber = number.bind(base);\nconst boundMapOfValues = mapOfValues.bind(base);\nconst boundObjectOf = objectOf.bind(base);\nconst boundString = string.bind(base);\n\n// compound validators\nconst boundEnumOf = function boundEnumOf(...values) {\n  return boundAnyOf(\n    values.map(boundLiteral),\n    `one of these values: ${JSON.stringify(values)}`,\n  );\n};\n\nexport {\n  boundAnyOf as anyOf,\n  boundAnything as anything,\n  boundArrayOf as arrayOf,\n  boundBoolean as boolean,\n  boundCallback as callback,\n  boundLiteral as literal,\n  boundNumber as number,\n  boundMapOfValues as mapOfValues,\n  boundObjectOf as objectOf,\n  boundString as string,\n  boundEnumOf as enumOf,\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport const AMBIGUOUS = \"ambiguous\";\nexport const AUTHENTICATED = \"authenticated\";\nexport const LOGGED_OUT = \"loggedOut\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  string,\n  objectOf,\n  boolean,\n  arrayOf,\n  enumOf,\n  mapOfValues,\n} from \"./validation/index.js\";\nimport {\n  AMBIGUOUS,\n  AUTHENTICATED,\n  LOGGED_OUT,\n} from \"../constants/identityMapAuthenticatedState.js\";\n\nexport default mapOfValues(\n  arrayOf(\n    objectOf({\n      authenticatedState: enumOf(AMBIGUOUS, AUTHENTICATED, LOGGED_OUT),\n      id: string(),\n      namespace: objectOf({\n        code: string(),\n      }).noUnknownFields(),\n      primary: boolean(),\n      xid: string(),\n    }).noUnknownFields(),\n  ).required(),\n);\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { objectOf } from \"./validation/index.js\";\n\nexport default objectOf({});\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"alloy_debug\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { queryString, stringToBoolean } from \"../utils/index.js\";\nimport debugQueryParam from \"../constants/debugQueryParam.js\";\n\nexport default ({\n  console,\n  locationSearch,\n  createLogger,\n  instanceName,\n  createNamespacedStorage,\n  getMonitors,\n}) => {\n  const parsedQueryString = queryString.parse(locationSearch);\n  const storage = createNamespacedStorage(`instance.${instanceName}.`);\n\n  const debugSessionValue = storage.session.getItem(\"debug\");\n  let debugEnabled = debugSessionValue === \"true\";\n  let debugEnabledWritableFromConfig = debugSessionValue === null;\n\n  const getDebugEnabled = () => debugEnabled;\n  const setDebugEnabled = (value, { fromConfig }) => {\n    if (!fromConfig || debugEnabledWritableFromConfig) {\n      debugEnabled = value;\n    }\n\n    if (!fromConfig) {\n      // Web storage only allows strings, so we explicitly convert to string.\n      storage.session.setItem(\"debug\", value.toString());\n      debugEnabledWritableFromConfig = false;\n    }\n  };\n\n  if (parsedQueryString[debugQueryParam] !== undefined) {\n    setDebugEnabled(stringToBoolean(parsedQueryString[debugQueryParam]), {\n      fromConfig: false,\n    });\n  }\n\n  return {\n    setDebugEnabled,\n    logger: createLogger({\n      getDebugEnabled,\n      context: { instanceName },\n      getMonitors,\n      console,\n    }),\n    createComponentLogger(componentName) {\n      return createLogger({\n        getDebugEnabled,\n        context: { instanceName, componentName },\n        getMonitors,\n        console,\n      });\n    },\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// TO-DOCUMENT: Lifecycle hooks and their params.\nconst hookNames = [\n  // Called after all components have been registered.\n  \"onComponentsRegistered\",\n  // Called before an event is sent on a data collection request\n  \"onBeforeEvent\",\n  // Called before each request is made to the edge.\n  \"onBeforeRequest\",\n  // Called after each response is returned from the edge with a successful\n  // status code\n  \"onResponse\",\n  // Called after a network request to the edge fails. Either the request\n  // didn't make it to the edge, didn't make it to Konductor, or Konductor\n  // failed to return a regularly-structured response. (In this case { error }\n  // is passed as the parameter)\n  // Also called when the respone returns a 400 or 500 error. (In this case\n  // { response } is passed as the parameter)\n  \"onRequestFailure\",\n  // A user clicked on an element.\n  \"onClick\",\n  // Called by RulesEngine when a ruleset is satisfied with a list of\n  // propositions\n  \"onDecision\",\n];\n\nconst createHook = (componentRegistry, hookName) => {\n  return (...args) => {\n    return Promise.all(\n      componentRegistry.getLifecycleCallbacks(hookName).map((callback) => {\n        return new Promise((resolve) => {\n          resolve(callback(...args));\n        });\n      }),\n    );\n  };\n};\n\n/**\n * This ensures that if a component's lifecycle method X\n * attempts to execute lifecycle method Y, that all X methods on all components\n * will have been called before any of their Y methods are called. It does\n * this by kicking the call to the Y method to the next JavaScript tick.\n * @returns {function}\n */\nconst guardHook = (fn) => {\n  return (...args) => {\n    return Promise.resolve().then(() => {\n      return fn(...args);\n    });\n  };\n};\n\nexport default (componentRegistry) => {\n  return hookNames.reduce((memo, hookName) => {\n    memo[hookName] = guardHook(createHook(componentRegistry, hookName));\n    return memo;\n  }, {});\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { intersection, stackError } from \"../utils/index.js\";\n\nconst wrapForErrorHandling = (fn, stackMessage) => {\n  return (...args) => {\n    let result;\n\n    try {\n      result = fn(...args);\n    } catch (error) {\n      throw stackError({ error, message: stackMessage });\n    }\n\n    if (result instanceof Promise) {\n      result = result.catch((error) => {\n        throw stackError({ error, message: stackMessage });\n      });\n    }\n\n    return result;\n  };\n};\n\n// TO-DOCUMENT: All public commands and their signatures.\nexport default () => {\n  const componentsByNamespace = {};\n  const commandsByName = {};\n  const lifecycleCallbacksByName = {};\n\n  const registerComponentCommands = (\n    namespace,\n    componentCommandsByName = {},\n  ) => {\n    const conflictingCommandNames = intersection(\n      Object.keys(commandsByName),\n      Object.keys(componentCommandsByName),\n    );\n\n    if (conflictingCommandNames.length) {\n      throw new Error(\n        `[ComponentRegistry] Could not register ${namespace} ` +\n          `because it has existing command(s): ${conflictingCommandNames.join(\n            \",\",\n          )}`,\n      );\n    }\n\n    Object.keys(componentCommandsByName).forEach((commandName) => {\n      const command = componentCommandsByName[commandName];\n      command.commandName = commandName;\n      command.run = wrapForErrorHandling(\n        command.run,\n        `[${namespace}] An error occurred while executing the ${commandName} command.`,\n      );\n      commandsByName[commandName] = command;\n    });\n  };\n\n  const registerLifecycleCallbacks = (\n    namespace,\n    componentLifecycleCallbacksByName = {},\n  ) => {\n    Object.keys(componentLifecycleCallbacksByName).forEach((hookName) => {\n      lifecycleCallbacksByName[hookName] =\n        lifecycleCallbacksByName[hookName] || [];\n\n      lifecycleCallbacksByName[hookName].push(\n        wrapForErrorHandling(\n          componentLifecycleCallbacksByName[hookName],\n          `[${namespace}] An error occurred while executing the ${hookName} lifecycle hook.`,\n        ),\n      );\n    });\n  };\n\n  return {\n    register(namespace, component) {\n      const { commands, lifecycle } = component;\n      registerComponentCommands(namespace, commands);\n      registerLifecycleCallbacks(namespace, lifecycle);\n      componentsByNamespace[namespace] = component;\n    },\n    getCommand(commandName) {\n      return commandsByName[commandName];\n    },\n    getCommandNames() {\n      return Object.keys(commandsByName);\n    },\n    getLifecycleCallbacks(hookName) {\n      return lifecycleCallbacksByName[hookName] || [];\n    },\n    getComponentNames() {\n      return Object.keys(componentsByNamespace);\n    },\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { stackError } from \"../../utils/index.js\";\n\nexport default ({\n  logger,\n  sendFetchRequest,\n  sendBeaconRequest,\n  isRequestRetryable,\n  getRequestRetryDelay,\n}) => {\n  /**\n   * Send a network request and returns details about the response.\n   */\n  return ({ requestId, url, payload, useSendBeacon }) => {\n    // We want to log raw payload and event data rather than\n    // our fancy wrapper objects. Calling payload.toJSON() is\n    // insufficient to get all the nested raw data, because it's\n    // not recursive (it doesn't call toJSON() on the event objects).\n    // Parsing the result of JSON.stringify(), however, gives the\n    // fully recursive raw data.\n    const stringifiedPayload = JSON.stringify(payload);\n    const parsedPayload = JSON.parse(stringifiedPayload);\n\n    logger.logOnBeforeNetworkRequest({\n      url,\n      requestId,\n      payload: parsedPayload,\n    });\n\n    const executeRequest = (retriesAttempted = 0) => {\n      const requestMethod = useSendBeacon\n        ? sendBeaconRequest\n        : sendFetchRequest;\n\n      return requestMethod(url, stringifiedPayload).then((response) => {\n        const requestIsRetryable = isRequestRetryable({\n          response,\n          retriesAttempted,\n        });\n\n        if (requestIsRetryable) {\n          const requestRetryDelay = getRequestRetryDelay({\n            response,\n            retriesAttempted,\n          });\n          return new Promise((resolve) => {\n            setTimeout(() => {\n              resolve(executeRequest(retriesAttempted + 1));\n            }, requestRetryDelay);\n          });\n        }\n\n        let parsedBody;\n\n        try {\n          parsedBody = JSON.parse(response.body);\n        } catch {\n          // Non-JSON. Something went wrong.\n        }\n\n        logger.logOnNetworkResponse({\n          requestId,\n          url,\n          payload: parsedPayload,\n          ...response,\n          parsedBody,\n          retriesAttempted,\n        });\n\n        return {\n          statusCode: response.statusCode,\n          body: response.body,\n          parsedBody,\n          getHeader: response.getHeader,\n        };\n      });\n    };\n\n    return executeRequest().catch((error) => {\n      logger.logOnNetworkError({\n        requestId,\n        url,\n        payload: parsedPayload,\n        error,\n      });\n      throw stackError({ error, message: \"Network request failed.\" });\n    });\n  };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ logger }) =>\n  (adobeEdgeHeader) => {\n    if (adobeEdgeHeader) {\n      const headerParts = adobeEdgeHeader.split(\";\");\n      if (headerParts.length >= 2 && headerParts[1].length > 0) {\n        try {\n          const regionId = parseInt(headerParts[1], 10);\n          if (!Number.isNaN(regionId)) {\n            return { regionId };\n          }\n        } catch {\n          // No need to do anything. The log statement below will log an error\n        }\n      }\n      logger.warn(`Invalid adobe edge: \"${adobeEdgeHeader}\"`);\n    }\n    return {};\n  };\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n/* eslint-disable no-bitwise */\nimport { getNamespacedCookieName } from \"./index.js\";\nimport { base64ToBytes } from \"./bytes.js\";\n\n// #region decode protobuf\n\n/** Decoding bytes is not something commonly done in vanilla JavaScript work, and as such\n * this file will strive to explain each step of decoding a protobuf in detail.\n * It leans heavily on the protobuf documentation https://protobuf.dev/programming-guides/encoding/,\n * often quoting directly from it without citation.\n */\n\n/**\n * The kndctr cookie protobuf format\n * From https://git.corp.adobe.com/pages/experience-edge/konductor/#/api/identifying-visitors?id=device-identifiers\n * and https://git.corp.adobe.com/experience-edge/konductor/blob/master/feature-identity/src/main/kotlin/com/adobe/edge/features/identity/data/StoredIdentity.kt#L16\n\n * syntax = \"proto3\";\n *\n * // Device-level identity for Experience Edge\n * message Identity {\n *   // The Experience Cloud ID value\n *   string ecid = 1;\n *\n *   IdentityMetadata metadata = 10;\n *\n *   // Used only in the 3rd party domain context.\n *   // It stores the UNIX timestamp and some metadata about the last identity sync triggered by Experience Edge.\n *   int64 last_sync = 20;\n *   int64 sync_hash = 21;\n *   int32 id_sync_container_id = 22;\n *\n *   // UNIX timestamp when the Identity was last returned in a `state:store` instruction.\n *   // The Identity is written at most once every 24h with a large TTL, to ensure it does not expire.\n *   int64 write_time = 30;\n * }\n *\n * message IdentityMetadata {\n *   // UNIX timestamp when this identity was minted.\n *   int64 created_at = 1;\n *\n *   // Whether or not the identity is random (new) or based on an existing seed.\n *   bool is_new = 2;\n *\n *   // Type of device for which the identity was generated.\n *   // 0 = UNKNOWN, 1 = BROWSER, 2 = MOBILE\n *   int32 device_type = 3;\n *\n *   // The Experience Edge region in which the identity was minted.\n *   string region = 5;\n *\n *   // More details on the source of the ECID identity.\n *   // Invariant: when `is_new` = true, the source must be set to `RANDOM`.\n *   // 0 = RANDOM, 1 = THIRD_PARTY_ID, 2 = FIRST_PARTY_ID, 3 = RECEIVED_IN_REQUEST\n *   int32 source = 6;\n * }\n */\n\nconst ECID_FIELD_NUMBER = 1;\n\n/**\n * Decodes a varint from a buffer starting at the given offset.\n *\n * Variable-width integers, or varints, are at the core of the wire format. They\n * allow encoding unsigned 64-bit integers using anywhere between one and ten\n * bytes, with small values using fewer bytes.\n *\n * Each byte in the varint has a continuation bit that indicates if the byte\n * that follows it is part of the varint. This is the most significant bit (MSB)\n * of the byte (sometimes also called the sign bit). The lower 7 bits are a\n * payload; the resulting integer is built by appending together the 7-bit\n * payloads of its constituent bytes.\n *\n * 10010110 00000001        // Original inputs.\n *  0010110  0000001        // Drop continuation bits.\n *  0000001  0010110        // Convert to big-endian.\n *    00000010010110        // Concatenate.\n *  128 + 16 + 4 + 2 = 150  // Interpret as an unsigned 64-bit integer.\n *\n * @example decodeVarint(new Uint8Array([0b0, 0b1]), 0) // { value: 1, length: 2 }\n * @example decodeVarint(new Uint8Array([0b10010110, 0b00000001], 0) // { value: 150, length: 2 })\n * @param {Uint8Array} buffer\n * @param {number} offset\n * @returns {{ value: number, length: number }} The value of the varint and the\n * number of bytes it takes up.\n */\nexport const decodeVarint = (buffer, offset) => {\n  let value = 0;\n  let length = 0;\n  let byte;\n  do {\n    if (offset < 0 || offset + length >= buffer.length) {\n      throw new Error(\"Invalid varint: buffer ended unexpectedly\");\n    }\n    byte = buffer[offset + length];\n    // Drop the continuation bit (the most significant bit), convert it from\n    // little endian to big endian, and add it to the accumulator `value`.\n    value |= (byte & 0b01111111) << (7 * length);\n    // Increase the length of the varint by one byte.\n    length += 1;\n    // A varint can be at most 10 bytes long for a 64-bit integer.\n    if (length > 10) {\n      throw new Error(\"Invalid varint: too long\");\n    }\n  } while (byte & 0b10000000);\n  return { value, length };\n};\n\n/**\n * | ID | Name   | Used for                                                 |\n * |----|--------|----------------------------------------------------------|\n * | 0  | varint | int32, int64, uint32, uint64, sint32, sint64, bool, enum |\n * | 1  | I64    | fixed64, sfixed64, double                                |\n * | 2  | LEN    | string, bytes                                            |\n * | 3  | SGROUP | group start (deprecated)                                 |\n * | 4  | EGROUP | group end (deprecated)                                   |\n * | 5  | I32    | fixed32, sfixed32, float                                 |\n */\nconst WIRE_TYPES = Object.freeze({\n  VARINT: 0,\n  I64: 1,\n  LEN: 2,\n  SGROUP: 3,\n  EGROUP: 4,\n  I32: 5,\n});\n\n/**\n * Given a protobuf as a Uint8Array and based on the protobuf definition for the\n * kndctr cookie provided at https://git.corp.adobe.com/pages/experience-edge/konductor/#/api/identifying-visitors?id=device-identifiers,\n * this function should return the ECID as a string.\n * The decoding of the protobuf is hand-crafted in order to save on size\n * compared to the full protobuf.js library.\n * @param {Uint8Array} buffer\n * @returns {string}\n */\nconst decodeKndctrProtobuf = (buffer) => {\n  let offset = 0;\n  let ecid = null;\n  while (offset < buffer.length && !ecid) {\n    // A protobuf message is a series of records. Each record is a tag, the length,\n    // and the value.\n    // A record always starts with the tag. The tag of a record is encoded as\n    // a varint formed from the field number and the wire type via the formula\n    // `(field_number << 3) | wire_type`. In other words, after decoding the\n    // varint representing a field, the low 3 bits tell us the wire type, and the rest of the integer tells us the field number.\n    // So the first step is to decode the varint\n    const { value: tag, length: tagLength } = decodeVarint(buffer, offset);\n    offset += tagLength;\n    // Next, we get the wire type and the field number.\n    // You take the last three bits to get the wire type and then right-shift by\n    // three to get the field number.\n    const wireType = tag & 0b111;\n    const fieldNumber = tag >> 3;\n    // We only care about the ECID field, so we will skip any other fields until\n    // we find it.\n    if (fieldNumber === ECID_FIELD_NUMBER) {\n      // The wire type for the ECID field is 2, which means it is a length-delimited field.\n      if (wireType === WIRE_TYPES.LEN) {\n        // The next varint will tell us the length of the ECID.\n        const fieldValueLength = decodeVarint(buffer, offset);\n        offset += fieldValueLength.length;\n        // The ECID is a UTF-8 encoded string, so we will decode it as such.\n        ecid = new TextDecoder().decode(\n          buffer.slice(offset, offset + fieldValueLength.value),\n        );\n        offset += fieldValueLength.value;\n        return ecid;\n      }\n    } else {\n      // If we don't care about the field, we skip it.\n      // The wire type tells us how to skip the field.\n      switch (wireType) {\n        case WIRE_TYPES.VARINT:\n          // Skip the varint\n          offset += decodeVarint(buffer, offset).length;\n          break;\n        case WIRE_TYPES.I64:\n          // Skip the 64-bit integer\n          offset += 8;\n          break;\n        case WIRE_TYPES.LEN: {\n          // Find the value that represents the length of the vield\n          const fieldValueLength = decodeVarint(buffer, offset);\n          offset += fieldValueLength.length + fieldValueLength.value;\n          break;\n        }\n        case WIRE_TYPES.SGROUP:\n          // Skip the start group\n          break;\n        case WIRE_TYPES.EGROUP:\n          // Skip the end group\n          break;\n        case WIRE_TYPES.I32:\n          // Skip the 32-bit integer\n          offset += 4;\n          break;\n        default:\n          throw new Error(\n            `Malformed kndctr cookie. Unknown wire type: ${wireType}`,\n          );\n      }\n    }\n  }\n\n  // No ECID was found. Maybe the cookie is malformed, maybe the format was changed.\n  throw new Error(\"No ECID found in cookie.\");\n};\n\n// #endregion\n\n// #region decode cookie\nexport default ({ orgId, cookieJar, logger }) => {\n  const kndctrCookieName = getNamespacedCookieName(orgId, \"identity\");\n  /**\n   * Returns the ECID from the kndctr cookie.\n   * @returns {string|null}\n   */\n  return () => {\n    const cookie = cookieJar.get(kndctrCookieName);\n    if (!cookie) {\n      return null;\n    }\n    try {\n      const decodedCookie = decodeURIComponent(cookie)\n        .replace(/_/g, \"/\")\n        .replace(/-/g, \"+\");\n      // cookie is a base64 encoded byte representation of a Identity protobuf message\n      // and we need to get it to a Uint8Array in order to decode it\n\n      const cookieBytes = base64ToBytes(decodedCookie);\n      return decodeKndctrProtobuf(cookieBytes);\n    } catch (error) {\n      logger.warn(\n        `Unable to decode ECID from ${kndctrCookieName} cookie`,\n        error,\n      );\n      return null;\n    }\n  };\n};\n// #endregion\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { IdentityManager } from './types.js' */\n/** @import { Logger } from '../types.js' */\n/** @import { CookieJar } from '../../utils/types.js' */\n\nimport createDecodeKndctrCookie from \"../../utils/createDecodeKndctrCookie.js\";\n\n/**\n * Creates an identity management service for handling ECID (Experience Cloud ID) resolution and tracking.\n *\n * This factory function creates an identity manager service that manages the state of identity resolution,\n * provides methods to check for existing identity cookies, and handles the asynchronous nature\n * of identity acquisition in Adobe Experience Platform Web SDK.\n *\n * @function\n *\n * @param {Object} options\n * @param {Logger} options.logger\n * @param {CookieJar} options.loggingCookieJar\n * @param {{orgId: string}} options.config\n *\n * @returns {IdentityManager}\n *\n * @example\n * // Create an identity service\n * const identityManager = createIdentity({\n *   logger: myLogger,\n *   loggingCookieJar: myCookieJar,\n *   config: { orgId: 'myOrgId@AdobeOrg' }\n * });\n *\n * // Initialize and check for existing identity\n * identityManager.initialize();\n *\n * // Wait for identity to be available\n * await identityManager.awaitIdentity();\n *\n * // Get ECID from cookie\n * const ecid = identityManager.getEcidFromCookie();\n */\nexport default ({ logger, loggingCookieJar, config }) => {\n  let awaitIdentityResolve = null;\n\n  const awaitIdentityPromise = new Promise((resolve) => {\n    awaitIdentityResolve = resolve;\n  });\n\n  const decodeKndctrCookie = createDecodeKndctrCookie({\n    orgId: config.orgId,\n    cookieJar: loggingCookieJar,\n    logger,\n  });\n\n  return {\n    initialize() {\n      const ecidFromCookie = decodeKndctrCookie();\n      if (ecidFromCookie) {\n        this.setIdentityAcquired();\n      }\n    },\n\n    setIdentityAcquired() {\n      awaitIdentityResolve();\n    },\n\n    awaitIdentity() {\n      return awaitIdentityPromise;\n    },\n\n    getEcidFromCookie: () => decodeKndctrCookie(),\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const IN = \"in\";\nexport const OUT = \"out\";\nexport const PENDING = \"pending\";\nexport const DISABLED = \"disabled\";\nexport const WAIT = \"wait\";\nexport const AUTO = \"auto\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const GENERAL = \"general\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { Logger } from '../../core/types.js' */\n/** @import { ConsentStateMachineUtils, ConsentStateMachine } from './types.js' */\n\nimport { defer } from \"../../utils/index.js\";\n\nexport const DECLINED_CONSENT = \"The user declined consent.\";\nexport const DECLINED_CONSENT_ERROR_CODE = \"declinedConsent\";\nexport const CONSENT_SOURCE_DEFAULT = \"default\";\nexport const CONSENT_SOURCE_INITIAL = \"initial\";\nexport const CONSENT_SOURCE_NEW = \"new\";\n\n/**\n * @private\n * @param {string} errorMessage\n * @returns {Error}\n */\nconst createDeclinedConsentError = (errorMessage) => {\n  const error = new Error(errorMessage);\n  error.code = DECLINED_CONSENT_ERROR_CODE;\n  error.message = errorMessage;\n  return error;\n};\n\n/**\n * Creates a consent state machine that manages user consent preferences and\n * coordinates deferred operations that require consent.\n *\n * The state machine supports the following states:\n * - \"in\": User has provided consent (with default or explicit consent)\n * - \"out\": User has declined consent (with default or explicit decline)\n * - \"pending\": Consent decision is awaiting user input\n *\n * @param {object} options\n * @param {Logger} options.logger\n *\n * @returns {ConsentStateMachine}\n *\n * @example\n * const consentStateMachine = createConsentStateMachine({ logger });\n *\n * // Set consent state\n * consentStateMachine.in('new');\n *\n * // Wait for consent\n * await consentStateMachine.awaitConsent();\n *\n * // Check current state\n * const { state, wasSet } = consentStateMachine.current();\n */\nexport default ({ logger }) => {\n  const deferreds = [];\n\n  const runAll = () => {\n    while (deferreds.length) {\n      deferreds.shift().resolve();\n    }\n  };\n  const discardAll = () => {\n    while (deferreds.length) {\n      deferreds\n        .shift()\n        .reject(createDeclinedConsentError(\"The user declined consent.\"));\n    }\n  };\n\n  const awaitInitial = () => Promise.resolve();\n  const awaitInDefault = () => Promise.resolve();\n  const awaitIn = () => Promise.resolve();\n  const awaitOutDefault = () =>\n    Promise.reject(\n      createDeclinedConsentError(\"No consent preferences have been set.\"),\n    );\n  const awaitOut = () =>\n    Promise.reject(createDeclinedConsentError(\"The user declined consent.\"));\n  const awaitPending = (returnImmediately) => {\n    if (returnImmediately) {\n      return Promise.reject(new Error(\"Consent is pending.\"));\n    }\n    const deferred = defer();\n    deferreds.push(deferred);\n    return deferred.promise;\n  };\n\n  return {\n    in(source) {\n      if (source === CONSENT_SOURCE_DEFAULT) {\n        this.awaitConsent = awaitInDefault;\n      } else {\n        if (source === CONSENT_SOURCE_INITIAL) {\n          logger.info(\n            \"Loaded user consent preferences. The user previously consented.\",\n          );\n        } else if (\n          source === CONSENT_SOURCE_NEW &&\n          this.awaitConsent !== awaitIn\n        ) {\n          logger.info(\"User consented.\");\n        }\n        runAll();\n        this.awaitConsent = awaitIn;\n      }\n    },\n    out(source) {\n      if (source === CONSENT_SOURCE_DEFAULT) {\n        logger.warn(\n          \"User consent preferences not found. Default consent of out will be used.\",\n        );\n        this.awaitConsent = awaitOutDefault;\n      } else {\n        if (source === CONSENT_SOURCE_INITIAL) {\n          logger.warn(\n            \"Loaded user consent preferences. The user previously declined consent.\",\n          );\n        } else if (\n          source === CONSENT_SOURCE_NEW &&\n          this.awaitConsent !== awaitOut\n        ) {\n          logger.warn(\"User declined consent.\");\n        }\n        discardAll();\n        this.awaitConsent = awaitOut;\n      }\n    },\n    pending(source) {\n      if (source === CONSENT_SOURCE_DEFAULT) {\n        logger.info(\n          \"User consent preferences not found. Default consent of pending will be used. Some commands may be delayed.\",\n        );\n      }\n      this.awaitConsent = awaitPending;\n    },\n    awaitConsent: awaitInitial,\n    withConsent() {\n      return this.awaitConsent(true);\n    },\n    current() {\n      switch (this.awaitConsent) {\n        case awaitInDefault:\n          return { state: \"in\", wasSet: false };\n        case awaitIn:\n          return { state: \"in\", wasSet: true };\n        case awaitOutDefault:\n          return { state: \"out\", wasSet: false };\n        case awaitOut:\n          return { state: \"out\", wasSet: true };\n        case awaitPending:\n          return { state: \"pending\", wasSet: false };\n        default:\n          return { state: \"in\", wasSet: false };\n      }\n    },\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { ConsentManager } from './types.js' */\n\nimport { IN, OUT, PENDING } from \"../../constants/consentStatus.js\";\nimport { GENERAL } from \"../../constants/consentPurpose.js\";\nimport {\n  CONSENT_SOURCE_DEFAULT,\n  CONSENT_SOURCE_INITIAL,\n  CONSENT_SOURCE_NEW,\n} from \"./createConsentStateMachine.js\";\n\n/**\n * @function\n *\n * @param {Object} options\n * @param {ConsentStateMachine} options.generalConsentState\n * @param {Logger} options.logger\n *\n * @returns {ConsentManager}\n */\nexport default ({ generalConsentState, logger }) => {\n  const setConsent = (consentByPurpose, source) => {\n    switch (consentByPurpose[GENERAL]) {\n      case IN:\n        generalConsentState.in(source);\n        break;\n      case OUT:\n        generalConsentState.out(source);\n        break;\n      case PENDING:\n        generalConsentState.pending(source);\n        break;\n      default:\n        logger.warn(`Unknown consent value: ${consentByPurpose[GENERAL]}`);\n        break;\n    }\n  };\n  return {\n    initializeConsent(defaultConsentByPurpose, storedConsentByPurpose) {\n      if (storedConsentByPurpose[GENERAL]) {\n        setConsent(storedConsentByPurpose, CONSENT_SOURCE_INITIAL);\n      } else {\n        setConsent(defaultConsentByPurpose, CONSENT_SOURCE_DEFAULT);\n      }\n    },\n    setConsent(consentByPurpose) {\n      setConsent(consentByPurpose, CONSENT_SOURCE_NEW);\n    },\n    suspend() {\n      generalConsentState.pending();\n    },\n    awaitConsent() {\n      return generalConsentState.awaitConsent();\n    },\n    withConsent() {\n      return generalConsentState.withConsent();\n    },\n    current() {\n      return generalConsentState.current();\n    },\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  isEmptyObject,\n  deepAssign,\n  isNonEmptyArray,\n  deduplicateArray,\n} from \"../utils/index.js\";\n\nconst getXdmPropositions = (xdm) => {\n  return xdm &&\n    // eslint-disable-next-line no-underscore-dangle\n    xdm._experience &&\n    // eslint-disable-next-line no-underscore-dangle\n    xdm._experience.decisioning &&\n    // eslint-disable-next-line no-underscore-dangle\n    isNonEmptyArray(xdm._experience.decisioning.propositions)\n    ? // eslint-disable-next-line no-underscore-dangle\n      xdm._experience.decisioning.propositions\n    : [];\n};\n\nexport default () => {\n  const content = {};\n  let userXdm;\n  let userData;\n  let documentMayUnload = false;\n  let isFinalized = false;\n  let shouldSendEvent = true;\n\n  const throwIfEventFinalized = (methodName) => {\n    if (isFinalized) {\n      throw new Error(\n        `${methodName} cannot be called after event is finalized.`,\n      );\n    }\n  };\n\n  const event = {\n    hasQuery() {\n      return Object.prototype.hasOwnProperty.call(this.getContent(), \"query\");\n    },\n    getContent() {\n      const currentContent = JSON.parse(JSON.stringify(content));\n\n      if (userXdm) {\n        deepAssign(currentContent, { xdm: userXdm });\n      }\n\n      if (userData) {\n        deepAssign(currentContent, { data: userData });\n      }\n\n      return currentContent;\n    },\n    setUserXdm(value) {\n      throwIfEventFinalized(\"setUserXdm\");\n      userXdm = value;\n    },\n    setUserData(value) {\n      throwIfEventFinalized(\"setUserData\");\n      userData = value;\n    },\n    mergeXdm(xdm) {\n      throwIfEventFinalized(\"mergeXdm\");\n      if (xdm) {\n        deepAssign(content, { xdm });\n      }\n    },\n    mergeData(data) {\n      throwIfEventFinalized(\"mergeData\");\n      if (data) {\n        deepAssign(content, { data });\n      }\n    },\n    mergeMeta(meta) {\n      throwIfEventFinalized(\"mergeMeta\");\n      if (meta) {\n        deepAssign(content, { meta });\n      }\n    },\n    mergeQuery(query) {\n      throwIfEventFinalized(\"mergeQuery\");\n      if (query) {\n        deepAssign(content, { query });\n      }\n    },\n    documentMayUnload() {\n      documentMayUnload = true;\n    },\n    finalize(onBeforeEventSend) {\n      if (isFinalized) {\n        return;\n      }\n\n      const newPropositions = deduplicateArray(\n        [...getXdmPropositions(userXdm), ...getXdmPropositions(content.xdm)],\n        (a, b) =>\n          a === b ||\n          (a.id &&\n            b.id &&\n            a.id === b.id &&\n            a.scope &&\n            b.scope &&\n            a.scope === b.scope),\n      );\n      if (userXdm) {\n        this.mergeXdm(userXdm);\n      }\n      if (newPropositions.length > 0) {\n        // eslint-disable-next-line no-underscore-dangle\n        content.xdm._experience.decisioning.propositions = newPropositions;\n      }\n\n      if (userData) {\n        event.mergeData(userData);\n      }\n\n      // the event should already be considered finalized in case onBeforeEventSend throws an error\n      isFinalized = true;\n\n      if (onBeforeEventSend) {\n        // assume that the onBeforeEventSend callback will fail (in-case of an error)\n        shouldSendEvent = false;\n\n        // this allows the user to replace the xdm and data properties\n        // on the object passed to the callback\n        const tempContent = {\n          xdm: content.xdm || {},\n          data: content.data || {},\n        };\n\n        const result = onBeforeEventSend(tempContent);\n\n        shouldSendEvent = result !== false;\n\n        content.xdm = tempContent.xdm || {};\n        content.data = tempContent.data || {};\n\n        if (isEmptyObject(content.xdm)) {\n          delete content.xdm;\n        }\n\n        if (isEmptyObject(content.data)) {\n          delete content.data;\n        }\n      }\n    },\n    getDocumentMayUnload() {\n      return documentMayUnload;\n    },\n    isEmpty() {\n      return (\n        isEmptyObject(content) &&\n        (!userXdm || isEmptyObject(userXdm)) &&\n        (!userData || isEmptyObject(userData))\n      );\n    },\n    shouldSend() {\n      return shouldSendEvent;\n    },\n    getViewName() {\n      if (!userXdm || !userXdm.web || !userXdm.web.webPageDetails) {\n        return undefined;\n      }\n\n      return userXdm.web.webPageDetails.viewName;\n    },\n    toJSON() {\n      if (!isFinalized) {\n        throw new Error(\"toJSON called before finalize\");\n      }\n\n      return content;\n    },\n  };\n\n  return event;\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const RETRY_AFTER = \"Retry-After\";\nexport const ADOBE_EDGE = \"x-adobe-edge\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { ResponseCreator } from './types.js' */\n\nimport { ADOBE_EDGE } from \"../constants/httpHeaderNames.js\";\n\n/**\n * Creates a representation of a gateway response with the addition of\n * helper methods.\n *\n * @function\n *\n * @param {object} options\n * @param {function(string): Object} options.extractEdgeInfo\n *\n * @returns {ResponseCreator}\n */\nexport default ({ extractEdgeInfo }) =>\n  ({ content = {}, getHeader }) => {\n    const { handle = [], errors = [], warnings = [] } = content;\n\n    return {\n      /**\n       * Returns matching fragments of the response by type.\n       * @param {string} type A string with the current format: <namespace:action>\n       *\n       * @example\n       * getPayloadsByType(\"identity:persist\")\n       */\n      getPayloadsByType(type) {\n        return handle\n          .filter((fragment) => fragment.type === type)\n          .flatMap((fragment) => fragment.payload);\n      },\n      /**\n       * Returns all errors.\n       */\n      getErrors() {\n        return errors;\n      },\n      /**\n       * Returns all warnings.\n       */\n      getWarnings() {\n        return warnings;\n      },\n      /**\n       * Returns an object containing the regionId from the x-adobe-edge header\n       */\n      getEdge() {\n        return extractEdgeInfo(getHeader(ADOBE_EDGE));\n      },\n      toJSON() {\n        return content;\n      },\n    };\n  };\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const CONFIGURE = \"configure\";\nexport const SET_DEBUG = \"setDebug\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isFunction, isObject } from \"../utils/index.js\";\nimport { CONFIGURE, SET_DEBUG } from \"../constants/coreCommands.js\";\nimport { objectOf, boolean } from \"../utils/validation/index.js\";\n\nexport default ({\n  logger,\n  configureCommand,\n  setDebugCommand,\n  handleError,\n  validateCommandOptions,\n}) => {\n  let configurePromise;\n\n  const getExecutor = (commandName, options) => {\n    let executor;\n\n    if (commandName === CONFIGURE) {\n      if (configurePromise) {\n        throw new Error(\n          \"The library has already been configured and may only be configured once.\",\n        );\n      }\n      executor = () => {\n        configurePromise = configureCommand(options);\n        return configurePromise.then(() => {\n          // Don't expose internals to the user.\n        });\n      };\n    } else {\n      if (!configurePromise) {\n        throw new Error(\n          `The library must be configured first. Please do so by executing the configure command.`,\n        );\n      }\n      if (commandName === SET_DEBUG) {\n        executor = () => {\n          const optionsValidator = objectOf({\n            enabled: boolean().required(),\n          }).noUnknownFields();\n\n          const validatedOptions = validateCommandOptions({\n            command: { commandName: SET_DEBUG, optionsValidator },\n            options,\n          });\n\n          setDebugCommand(validatedOptions);\n        };\n      } else {\n        executor = () => {\n          return configurePromise.then(\n            (componentRegistry) => {\n              const command = componentRegistry.getCommand(commandName);\n              if (!command || !isFunction(command.run)) {\n                const commandNames = [CONFIGURE, SET_DEBUG]\n                  .concat(componentRegistry.getCommandNames())\n                  .join(\", \");\n                throw new Error(\n                  `The ${commandName} command does not exist. List of available commands: ${commandNames}.`,\n                );\n              }\n              const validatedOptions = validateCommandOptions({\n                command,\n                options,\n              });\n              return command.run(validatedOptions);\n            },\n            () => {\n              logger.warn(\n                `An error during configuration is preventing the ${commandName} command from executing.`,\n              );\n              // If configuration failed, we prevent the configuration\n              // error from bubbling here because we don't want the\n              // configuration error to be reported in the console every\n              // time any command is executed. Only having it bubble\n              // once when the configure command runs is sufficient.\n              // Instead, for this command, we'll just return a promise\n              // that never gets resolved.\n              return new Promise(() => {});\n            },\n          );\n        };\n      }\n    }\n\n    return executor;\n  };\n\n  return (commandName, options = {}) => {\n    return new Promise((resolve) => {\n      // We have to wrap the getExecutor() call in the promise so the promise\n      // will be rejected if getExecutor() throws errors.\n      const executor = getExecutor(commandName, options);\n      logger.logOnBeforeCommand({ commandName, options });\n      resolve(executor());\n    })\n      .catch((error) => {\n        return handleError(error, `${commandName} command`);\n      })\n      .catch((error) => {\n        logger.logOnCommandRejected({ commandName, options, error });\n        throw error;\n      })\n      .then((rawResult) => {\n        // We should always be returning an object from every command.\n        const result = isObject(rawResult) ? rawResult : {};\n        logger.logOnCommandResolved({ commandName, options, result });\n        return result;\n      });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nconst COMMAND_DOC_URI = \"https://adobe.ly/3sHgQHb\";\n\nexport default ({ command, options }) => {\n  const {\n    commandName,\n    documentationUri = COMMAND_DOC_URI,\n    optionsValidator,\n  } = command;\n  let validatedOptions = options;\n  if (optionsValidator) {\n    try {\n      validatedOptions = optionsValidator(options);\n    } catch (validationError) {\n      const invalidOptionsMessage = `Invalid ${commandName} command options:\\n\\t - ${validationError} For command documentation see: ${documentationUri}`;\n      throw new Error(invalidOptionsMessage);\n    }\n  }\n  return validatedOptions;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nconst CONFIG_DOC_URI = \"https://adobe.ly/3sHh553\";\n\nconst transformOptions = ({ combinedConfigValidator, options, logger }) => {\n  try {\n    const validator = combinedConfigValidator.noUnknownFields().required();\n    return validator.call({ logger }, options);\n  } catch (e) {\n    throw new Error(\n      `Resolve these configuration problems:\\n\\t - ${e.message\n        .split(\"\\n\")\n        .join(\n          \"\\n\\t - \",\n        )}\\nFor configuration documentation see: ${CONFIG_DOC_URI}`,\n    );\n  }\n};\n\nconst buildAllOnInstanceConfiguredExtraParams = (\n  config,\n  logger,\n  componentCreators,\n) => {\n  return componentCreators.reduce(\n    (memo, { buildOnInstanceConfiguredExtraParams }) => {\n      if (buildOnInstanceConfiguredExtraParams) {\n        memo = {\n          ...memo,\n          ...buildOnInstanceConfiguredExtraParams({ config, logger }),\n        };\n      }\n      return memo;\n    },\n    {},\n  );\n};\n\nconst wrapLoggerInQueue = (logger) => {\n  const queue = [];\n  const queuedLogger = {\n    get enabled() {\n      return logger.enabled;\n    },\n    flush() {\n      queue.forEach(({ method, args }) => logger[method](...args));\n    },\n  };\n  Object.keys(logger)\n    .filter((key) => typeof logger[key] === \"function\")\n    .forEach((method) => {\n      queuedLogger[method] = (...args) => {\n        queue.push({ method, args });\n      };\n    });\n  return queuedLogger;\n};\n\nexport default ({\n  options,\n  componentCreators,\n  coreConfigValidators,\n  createConfig,\n  logger,\n  setDebugEnabled,\n}) => {\n  // We wrap the logger in a queue in case debugEnabled is set in the config\n  // but we need to log something before the config is created.\n  const queuedLogger = wrapLoggerInQueue(logger);\n  const combinedConfigValidator = componentCreators\n    .map(({ configValidators }) => configValidators)\n    .filter((configValidators) => configValidators)\n    .reduce(\n      (validator, configValidators) => validator.concat(configValidators),\n      coreConfigValidators,\n    );\n  const config = createConfig(\n    transformOptions({\n      combinedConfigValidator,\n      options,\n      logger: queuedLogger,\n    }),\n  );\n  setDebugEnabled(config.debugEnabled, { fromConfig: true });\n  queuedLogger.flush();\n\n  const extraParams = buildAllOnInstanceConfiguredExtraParams(\n    config,\n    logger,\n    componentCreators,\n  );\n  logger.logOnInstanceConfigured({ ...extraParams, config });\n  return config;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { stackError } from \"../utils/index.js\";\n\nexport default ({\n  componentCreators,\n  lifecycle,\n  componentRegistry,\n  getImmediatelyAvailableTools,\n}) => {\n  componentCreators.forEach((createComponent) => {\n    const { namespace } = createComponent;\n    // TO-DOCUMENT: Helpers that we inject into factories.\n    const tools = getImmediatelyAvailableTools(namespace);\n    let component;\n    try {\n      component = createComponent(tools);\n    } catch (error) {\n      throw stackError({\n        error,\n        message: `[${namespace}] An error occurred during component creation.`,\n      });\n    }\n    componentRegistry.register(namespace, component);\n  });\n\n  return lifecycle\n    .onComponentsRegistered({\n      lifecycle,\n    })\n    .then(() => componentRegistry);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nconst createConfig = (options) => {\n  return { ...options };\n};\n\nexport default createConfig;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const EDGE = \"edge.adobedc.net\";\nexport const ID_THIRD_PARTY = \"adobedc.demdex.net\";\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default \"ee\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  boolean,\n  string,\n  callback,\n  objectOf,\n} from \"../../utils/validation/index.js\";\nimport { noop, validateConfigOverride } from \"../../utils/index.js\";\nimport { EDGE as EDGE_DOMAIN } from \"../../constants/domain.js\";\nimport EDGE_BASE_PATH from \"../../constants/edgeBasePath.js\";\n\nexport default () =>\n  objectOf({\n    debugEnabled: boolean().default(false),\n    datastreamId: string().unique().required(),\n    edgeDomain: string().domain().default(EDGE_DOMAIN),\n    edgeBasePath: string().nonEmpty().default(EDGE_BASE_PATH),\n    orgId: string().unique().required(),\n    onBeforeEventSend: callback().default(noop),\n    edgeConfigOverrides: validateConfigOverride,\n  }).renamed(\"edgeConfigId\", string().unique(), \"datastreamId\");\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { toError, updateErrorMessage } from \"../utils/index.js\";\nimport { DECLINED_CONSENT_ERROR_CODE } from \"./consent/createConsentStateMachine.js\";\n\nexport default ({ errorPrefix, logger }) =>\n  (error, operation) => {\n    const err = toError(error);\n\n    // In the case of declined consent, we've opted to not reject the promise\n    // returned to the customer, but instead resolve the promise with an\n    // empty result object.\n    if (err.code === DECLINED_CONSENT_ERROR_CODE) {\n      logger.warn(`The ${operation} could not fully complete. ${err.message}`);\n      return {};\n    }\n\n    updateErrorMessage({\n      error: err,\n      message: `${errorPrefix} ${err.message}`,\n    });\n    throw err;\n  };\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ fetch }) => {\n  return (url, body) => {\n    return fetch(url, {\n      method: \"POST\",\n      cache: \"no-cache\",\n      credentials: \"include\", // To set the cookie header in the request.\n      headers: {\n        \"Content-Type\": \"text/plain; charset=UTF-8\",\n      },\n      referrerPolicy: \"no-referrer-when-downgrade\",\n      body,\n    }).then((response) => {\n      return response.text().then((responseBody) => ({\n        statusCode: response.status,\n        // We expose headers through a function instead of creating an object\n        // with all the headers up front largely because the native\n        // request.getResponseHeader method is case-insensitive.\n        getHeader(name) {\n          return response.headers.get(name);\n        },\n        body: responseBody,\n      }));\n    });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ sendBeacon, sendFetchRequest, logger }) => {\n  return (url, body) => {\n    const blob = new Blob([body], { type: \"text/plain; charset=UTF-8\" });\n    if (!sendBeacon(url, blob)) {\n      logger.info(\"Unable to use `sendBeacon`; falling back to `fetch`.\");\n      return sendFetchRequest(url, body);\n    }\n\n    // Using sendBeacon, we technically don't get a response back from\n    // the server, but we'll resolve the promise with an object to maintain\n    // consistency with other network strategies.\n    return Promise.resolve({\n      statusCode: 204,\n      getHeader() {\n        return null;\n      },\n      body: \"\",\n    });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ getDebugEnabled, console, getMonitors, context }) => {\n  let prefix = `[${context.instanceName}]`;\n  if (context.componentName) {\n    prefix += ` [${context.componentName}]`;\n  }\n\n  const notifyMonitors = (method, data) => {\n    const monitors = getMonitors();\n    if (monitors.length > 0) {\n      const dataWithContext = { ...context, ...data };\n      monitors.forEach((monitor) => {\n        if (monitor[method]) {\n          monitor[method](dataWithContext);\n        }\n      });\n    }\n  };\n\n  const log = (level, ...rest) => {\n    notifyMonitors(\"onBeforeLog\", { level, arguments: rest });\n    if (getDebugEnabled()) {\n      console[level](prefix, ...rest);\n    }\n  };\n\n  return {\n    get enabled() {\n      return getMonitors().length > 0 || getDebugEnabled();\n    },\n    logOnInstanceCreated(data) {\n      notifyMonitors(\"onInstanceCreated\", data);\n      log(\"info\", \"Instance initialized.\");\n    },\n    logOnInstanceConfigured(data) {\n      notifyMonitors(\"onInstanceConfigured\", data);\n      log(\"info\", \"Instance configured. Computed configuration:\", data.config);\n    },\n    logOnBeforeCommand(data) {\n      notifyMonitors(\"onBeforeCommand\", data);\n      log(\n        \"info\",\n        `Executing ${data.commandName} command. Options:`,\n        data.options,\n      );\n    },\n    logOnCommandResolved(data) {\n      notifyMonitors(\"onCommandResolved\", data);\n      log(\"info\", `${data.commandName} command resolved. Result:`, data.result);\n    },\n    logOnCommandRejected(data) {\n      notifyMonitors(\"onCommandRejected\", data);\n      log(\n        \"error\",\n        `${data.commandName} command was rejected. Error:`,\n        data.error,\n      );\n    },\n    logOnBeforeNetworkRequest(data) {\n      notifyMonitors(\"onBeforeNetworkRequest\", data);\n      log(\"info\", `Request ${data.requestId}: Sending request.`, data.payload);\n    },\n    logOnNetworkResponse(data) {\n      notifyMonitors(\"onNetworkResponse\", data);\n      const messagesSuffix =\n        data.parsedBody || data.body ? `response body:` : `no response body.`;\n      log(\n        \"info\",\n        `Request ${data.requestId}: Received response with status code ${data.statusCode} and ${messagesSuffix}`,\n        data.parsedBody || data.body,\n      );\n    },\n    logOnNetworkError(data) {\n      notifyMonitors(\"onNetworkError\", data);\n      log(\n        \"error\",\n        `Request ${data.requestId}: Network request failed.`,\n        data.error,\n      );\n    },\n    logOnContentHiding(data) {\n      notifyMonitors(\"onContentHiding\", {\n        status: data.status,\n      });\n      log(data.logLevel, data.message);\n    },\n    logOnContentRendering(data) {\n      notifyMonitors(\"onContentRendering\", {\n        status: data.status,\n        payload: data.detail,\n      });\n      log(data.logLevel, data.message);\n    },\n    /**\n     * Outputs informational message to the web console. In some\n     * browsers a small \"i\" icon is displayed next to these items\n     * in the web console's log.\n     * @param {...*} arg Any argument to be logged.\n     */\n    info: log.bind(null, \"info\"),\n    /**\n     * Outputs a warning message to the web console.\n     * @param {...*} arg Any argument to be logged.\n     */\n    warn: log.bind(null, \"warn\"),\n    /**\n     * Outputs an error message to the web console.\n     * @param {...*} arg Any argument to be logged.\n     */\n    error: log.bind(null, \"error\"),\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"__view__\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default (content) => {\n  return (namespaceCode, identity) => {\n    content.xdm = content.xdm || {};\n    content.xdm.identityMap = content.xdm.identityMap || {};\n    content.xdm.identityMap[namespaceCode] =\n      content.xdm.identityMap[namespaceCode] || [];\n    content.xdm.identityMap[namespaceCode].push(identity);\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { Request, RequestPayload } from './types.js' */\n\nimport { uuid } from \"../index.js\";\n\n/**\n * Creates a request object with methods to access and modify request properties.\n *\n * @function\n *\n * @param {Object} options\n * @param {RequestPayload} options.payload\n * @param {function({isIdentityEstablished: boolean}): string} options.getAction\n * @param {function({isIdentityEstablished: boolean}): boolean} options.getUseSendBeacon\n * @param {string} [options.datastreamIdOverride]\n * @param {string} [options.edgeSubPath]\n *\n * @returns {Request}\n *\n * @example\n * const request = createRequest({\n *   payload: { event: 'pageView' },\n *   getAction: ({ isIdentityEstablished }) => isIdentityEstablished ? 'send' : 'queue',\n *   getUseSendBeacon: ({ isIdentityEstablished }) => isIdentityEstablished,\n *   datastreamIdOverride: 'custom-datastream-id',\n *   edgeSubPath: 'custom/path'\n * });\n *\n * console.log(request.getId()); // Returns unique UUID\n * request.setIsIdentityEstablished();\n * console.log(request.getAction()); // Returns action based on identity status\n */\nexport default (options) => {\n  const {\n    payload,\n    getAction,\n    getUseSendBeacon,\n    datastreamIdOverride,\n    edgeSubPath,\n  } = options;\n\n  const id = uuid();\n  let shouldUseThirdPartyDomain = false;\n  let isIdentityEstablished = false;\n\n  return {\n    getId() {\n      return id;\n    },\n    getPayload() {\n      return payload;\n    },\n    getAction() {\n      return getAction({ isIdentityEstablished });\n    },\n    getDatastreamIdOverride() {\n      return datastreamIdOverride;\n    },\n    getUseSendBeacon() {\n      return getUseSendBeacon({ isIdentityEstablished });\n    },\n    getEdgeSubPath() {\n      if (edgeSubPath) {\n        return edgeSubPath;\n      }\n      return \"\";\n    },\n    getUseIdThirdPartyDomain() {\n      return shouldUseThirdPartyDomain;\n    },\n    setUseIdThirdPartyDomain() {\n      shouldUseThirdPartyDomain = true;\n    },\n    setIsIdentityEstablished() {\n      isIdentityEstablished = true;\n    },\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createRequest from \"./createRequest.js\";\n\nexport default ({\n  payload: dataCollectionRequestPayload,\n  datastreamIdOverride,\n}) => {\n  const getUseSendBeacon = ({ isIdentityEstablished }) => {\n    // When the document may be unloading, we still hit the interact endpoint\n    // using fetch if an identity has not been established. If we were instead\n    // to hit the collect endpoint using sendBeacon in this case, one of three\n    // things would occur:\n    //\n    // 1. The document ultimately isn't unloaded and Alloy receives an empty\n    // response back from the collect endpoint, resulting in an error being\n    // thrown by Alloy because we weren't able to establish an identity.\n    // This is bad.\n    // 2. The document is unloaded, but Alloy receives the empty\n    // response back from the collect endpoint before navigation is completed,\n    // resulting in an error being thrown by Alloy because we weren't able to\n    // establish an identity. This is bad.\n    // 3. The document is unloaded and Alloy does not receive the empty response\n    // back from the collect endpoint before navigation is completed. No error\n    // will be thrown, but no identity was established either. This is okay,\n    // though no identity was established.\n    //\n    // By hitting the interact endpoint using fetch, one of the three things\n    // would occur:\n    //\n    // 1. The document ultimately isn't unloaded and Alloy receives a\n    // response with an identity back from the interact endpoint. No\n    // error will be thrown and an identity is established. This is good.\n    // 2. The document is unloaded and Alloy receives a response with an\n    // identity back from the interact endpoint before navigation is completed.\n    // No error will be thrown and an identity is established. This is good.\n    // 3. The document is unloaded and Alloy does not receive the empty response\n    // back from the collect endpoint before navigation is completed. In this\n    // case, no error is thrown, but no identity was established and it's\n    // more likely that the request never makes it to the server because we're\n    // using fetch instead of sendBeacon.\n    //\n    // The second approach seemed preferable.\n    return (\n      dataCollectionRequestPayload.getDocumentMayUnload() &&\n      isIdentityEstablished\n    );\n  };\n\n  return createRequest({\n    payload: dataCollectionRequestPayload,\n    getAction({ isIdentityEstablished }) {\n      return getUseSendBeacon({ isIdentityEstablished })\n        ? \"collect\"\n        : \"interact\";\n    },\n    getUseSendBeacon,\n    datastreamIdOverride,\n  });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { RequestPayload, Identity } from './types.js' */\n\nimport { createMerger, prepareConfigOverridesForEdge } from \"../index.js\";\n\n/**\n * createMerger creates a function that does a deep merge. Example:\n * ```js\n * payload.mergeConfigOverride({\n *   com_adobe_analytics: {\n *     reportSuites: [\"reportSuite1\"],\n *   },\n * });\n *\n * payload.mergeConfigOverride({\n *   com_adobe_analytics: {\n *     enabled: false,\n *   },\n * });\n *\n *\n * // payload.meta.configOverrides is now:\n * // {\n * //   com_adobe_analytics: {\n * //     enabled: false,\n * //     reportSuites: [\"reportSuite1\"],\n * //   },\n * // }\n * ```\n * however, we need the result to be:\n * ```js\n * // {\n * //   com_adobe_analytics: {\n * //     enabled: false,\n * //   },\n * // }\n * ```\n * aka a shallow merge, where the second object overwrites the first.\n * This is because order matters and we don't want to send reportSuites when something is\n * disabled.\n * This function does that.\n *\n * @param {Object} content\n * @param {string} key\n * @returns {(updates: Object) => void}\n */\nconst createMergeConfigOverride = (content, key) => (updates) => {\n  const propertyPath = key.split(\".\");\n  const hostObjectForUpdates = propertyPath.reduce((obj, propertyName) => {\n    obj[propertyName] = obj[propertyName] || {};\n    return obj[propertyName];\n  }, content);\n\n  Object.assign(hostObjectForUpdates, updates);\n};\n\n/**\n * Creates a request payload object with methods for merging different types of data.\n * This provides the base functionality that all types of request payloads share.\n *\n * @function\n *\n * @param {Object} options\n * @param {Object} options.content\n * @param {function(string, Identity): void} options.addIdentity\n * @param {function(string):  boolean} options.hasIdentity\n *\n * @returns {RequestPayload}\n */\nexport default (options) => {\n  const { content, addIdentity, hasIdentity } = options;\n  const mergeConfigOverrides = createMergeConfigOverride(\n    content,\n    \"meta.configOverrides\",\n  );\n  return {\n    mergeMeta: createMerger(content, \"meta\"),\n    mergeState: createMerger(content, \"meta.state\"),\n    mergeQuery: createMerger(content, \"query\"),\n    mergeConfigOverride: (updates) =>\n      mergeConfigOverrides(prepareConfigOverridesForEdge(updates)),\n    addIdentity,\n    hasIdentity,\n    toJSON() {\n      return content;\n    },\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (content) => (namespaceCode) => {\n  return (\n    (content.xdm &&\n      content.xdm.identityMap &&\n      content.xdm.identityMap[namespaceCode]) !== undefined\n  );\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { DataCollectionRequestPayload } from './types.js' */\n\nimport createRequestPayload from \"./createRequestPayload.js\";\nimport createAddIdentity from \"./createAddIdentity.js\";\nimport createHasIdentity from \"./createHasIdentity.js\";\n\n/**\n * @function\n *\n * @returns {DataCollectionRequestPayload}\n */\nexport default () => {\n  const content = {};\n  const requestPayload = createRequestPayload({\n    content,\n    addIdentity: createAddIdentity(content),\n    hasIdentity: createHasIdentity(content),\n  });\n\n  return {\n    ...requestPayload,\n    addEvent: (event) => {\n      content.events = content.events || [];\n      content.events.push(event);\n    },\n    getDocumentMayUnload: () => {\n      return (content.events || []).some((event) =>\n        event.getDocumentMayUnload(),\n      );\n    },\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { isEmptyObject } from \"../index.js\";\n\n/**\n * @typedef {{ datastreamId: string, [k: string]: Object }} Override\n * @typedef {Object} RequestPayload\n * @property {function(Override): void} mergeConfigOverride\n * @param {Object} params\n * @param {Override} params.localConfigOverrides\n * @param {Override} params.globalConfigOverrides\n * @param {RequestPayload} params.payload\n * @returns {{ payload: RequestPayload, datastreamIdOverride: string }}\n */\nexport default ({ localConfigOverrides, globalConfigOverrides, payload }) => {\n  const requestParams = { payload };\n  const { datastreamId, ...localConfigOverridesWithoutDatastreamId } =\n    localConfigOverrides || {};\n  if (datastreamId) {\n    requestParams.datastreamIdOverride = datastreamId;\n  }\n\n  if (globalConfigOverrides && !isEmptyObject(globalConfigOverrides)) {\n    payload.mergeConfigOverride(globalConfigOverrides);\n  }\n\n  if (\n    localConfigOverridesWithoutDatastreamId &&\n    !isEmptyObject(localConfigOverridesWithoutDatastreamId)\n  ) {\n    payload.mergeConfigOverride(localConfigOverridesWithoutDatastreamId);\n  }\n  return requestParams;\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { uuid, queryString } from \"../index.js\";\n\nconst ASSURANCE_VALIDATION_SESSION_URL_PARAM = \"adb_validation_sessionid\";\nconst ASSURANCE_VALIDATION_NAMESPACE = \"validation.\";\nconst CLIENT_ID = \"clientId\";\n\nconst getOrCreateAssuranceClientId = (storage) => {\n  let clientId = storage.persistent.getItem(CLIENT_ID);\n  if (!clientId) {\n    clientId = uuid();\n    storage.persistent.setItem(CLIENT_ID, clientId);\n  }\n  return clientId;\n};\n\nexport default ({ window, createNamespacedStorage }) => {\n  const storage = createNamespacedStorage(ASSURANCE_VALIDATION_NAMESPACE);\n  return () => {\n    const parsedQuery = queryString.parse(window.location.search);\n    const validationSessionId =\n      parsedQuery[ASSURANCE_VALIDATION_SESSION_URL_PARAM];\n    if (!validationSessionId) {\n      return \"\";\n    }\n    const clientId = getOrCreateAssuranceClientId(storage);\n    const validationToken = `${validationSessionId}|${clientId}`;\n    return `&${queryString.stringify({\n      adobeAepValidationToken: validationToken,\n    })}`;\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport PAGE_WIDE_SCOPE from \"../constants/pageWideScope.js\";\nimport { createCallbackAggregator, noop } from \"../utils/index.js\";\nimport { createRequestParams } from \"../utils/request/index.js\";\n\nconst EVENT_CANCELLATION_MESSAGE =\n  \"Event was canceled because the onBeforeEventSend callback returned false.\";\n\nexport default ({\n  config,\n  logger,\n  lifecycle,\n  consent,\n  createEvent,\n  createDataCollectionRequestPayload,\n  createDataCollectionRequest,\n  sendEdgeNetworkRequest,\n  applyResponse,\n}) => {\n  const { onBeforeEventSend, edgeConfigOverrides: globalConfigOverrides } =\n    config;\n\n  return {\n    createEvent,\n    /**\n     * Sends an event. This includes running the event and payload through the\n     * appropriate lifecycle hooks, sending the request to the server, and\n     * handling the response.\n     * @param {Object} event This will be JSON stringified and used inside the\n     * request payload.\n     * @param {Object} [options] Options to pass on to the onBeforeEvent\n     * lifecycle method\n     * @param {Object} [options.edgeConfigOverrides] Settings that take\n     * precedence over the global datastream configuration, including which\n     * datastream to use.\n     * @returns {*}\n     */\n    sendEvent(event, options = {}) {\n      const { edgeConfigOverrides: localConfigOverrides, ...otherOptions } =\n        options;\n      const requestParams = createRequestParams({\n        payload: createDataCollectionRequestPayload(),\n        localConfigOverrides,\n        globalConfigOverrides,\n      });\n      const request = createDataCollectionRequest(requestParams);\n      const onResponseCallbackAggregator = createCallbackAggregator();\n      const onRequestFailureCallbackAggregator = createCallbackAggregator();\n\n      return lifecycle\n        .onBeforeEvent({\n          ...otherOptions,\n          event,\n          onResponse: onResponseCallbackAggregator.add,\n          onRequestFailure: onRequestFailureCallbackAggregator.add,\n        })\n        .then(() => {\n          requestParams.payload.addEvent(event);\n          return consent.awaitConsent();\n        })\n        .then(() => {\n          try {\n            // NOTE: this calls onBeforeEventSend callback (if configured)\n            event.finalize(onBeforeEventSend);\n          } catch (error) {\n            const throwError = () => {\n              throw error;\n            };\n            onRequestFailureCallbackAggregator.add(lifecycle.onRequestFailure);\n            return onRequestFailureCallbackAggregator\n              .call({ error })\n              .then(throwError, throwError);\n          }\n\n          // if the callback returns false, the event should not be sent\n          if (!event.shouldSend()) {\n            onRequestFailureCallbackAggregator.add(lifecycle.onRequestFailure);\n            logger.info(EVENT_CANCELLATION_MESSAGE);\n            const error = new Error(EVENT_CANCELLATION_MESSAGE);\n            return onRequestFailureCallbackAggregator\n              .call({ error })\n              .then(() => {\n                // Ensure the promise gets resolved with undefined instead\n                // of an array of return values from the callbacks.\n              });\n          }\n\n          return sendEdgeNetworkRequest({\n            request,\n            runOnResponseCallbacks: onResponseCallbackAggregator.call,\n            runOnRequestFailureCallbacks:\n              onRequestFailureCallbackAggregator.call,\n          });\n        });\n    },\n    applyResponse(event, options = {}) {\n      const {\n        renderDecisions = false,\n        decisionContext = {},\n        responseHeaders = {},\n        responseBody = { handle: [] },\n        personalization,\n      } = options;\n\n      const payload = createDataCollectionRequestPayload();\n      const request = createDataCollectionRequest({ payload });\n      const onResponseCallbackAggregator = createCallbackAggregator();\n\n      return lifecycle\n        .onBeforeEvent({\n          event,\n          renderDecisions,\n          decisionContext,\n          decisionScopes: [PAGE_WIDE_SCOPE],\n          personalization,\n          onResponse: onResponseCallbackAggregator.add,\n          onRequestFailure: noop,\n        })\n        .then(() => {\n          payload.addEvent(event);\n          return applyResponse({\n            request,\n            responseHeaders,\n            responseBody,\n            runOnResponseCallbacks: onResponseCallbackAggregator.call,\n          });\n        });\n    },\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nconst STATE_STORE_HANDLE_TYPE = \"state:store\";\n\nexport default ({\n  cookieJar,\n  shouldTransferCookie,\n  apexDomain,\n  dateProvider,\n}) => {\n  return {\n    /**\n     * When sending to a third-party endpoint, the endpoint won't be able to\n     * access first-party cookies, therefore we transfer cookies into\n     * the request body so they can be read by the server.\n     */\n    cookiesToPayload(payload, endpointDomain) {\n      // localhost is a special case where the apexDomain is \"\"\n      // We want to treat localhost as a third-party domain.\n      const isEndpointFirstParty =\n        apexDomain !== \"\" && endpointDomain.endsWith(apexDomain);\n      const state = {\n        domain: apexDomain,\n        cookiesEnabled: true,\n      };\n\n      // If the endpoint is first-party, there's no need to transfer cookies\n      // to the payload since they'll be automatically passed through cookie\n      // headers.\n      if (!isEndpointFirstParty) {\n        const cookies = cookieJar.get();\n\n        const entries = Object.keys(cookies)\n          .filter(shouldTransferCookie)\n          .map((qualifyingCookieName) => {\n            return {\n              key: qualifyingCookieName,\n              value: cookies[qualifyingCookieName],\n            };\n          });\n\n        if (entries.length) {\n          state.entries = entries;\n        }\n      }\n\n      payload.mergeState(state);\n    },\n    /**\n     * When receiving from a third-party endpoint, the endpoint won't be able to\n     * write first-party cookies, therefore we write first-party cookies\n     * as directed in the response body.\n     */\n    responseToCookies(response) {\n      response\n        .getPayloadsByType(STATE_STORE_HANDLE_TYPE)\n        .forEach((stateItem) => {\n          const options = { domain: apexDomain };\n\n          const sameSite =\n            stateItem.attrs &&\n            stateItem.attrs.SameSite &&\n            stateItem.attrs.SameSite.toLowerCase();\n\n          if (stateItem.maxAge !== undefined) {\n            // cookieJar expects \"expires\" as a date object\n            options.expires = new Date(\n              dateProvider().getTime() + stateItem.maxAge * 1000,\n            );\n          }\n          if (sameSite !== undefined) {\n            options.sameSite = sameSite;\n          }\n          // When sameSite is set to none, the secure flag must be set.\n          // Experience edge will not set the secure flag in these cases.\n          if (sameSite === \"none\") {\n            options.secure = true;\n          }\n\n          cookieJar.set(stateItem.key, stateItem.value, options);\n        });\n    },\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const MBOX_EDGE_CLUSTER = \"mboxEdgeCluster\";\nexport const AT_QA_MODE = \"at_qa_mode\";\nexport const MBOX = \"mbox\";\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isNamespacedCookieName } from \"../utils/index.js\";\nimport { AT_QA_MODE, MBOX } from \"../constants/legacyCookies.js\";\n\nexport default ({ orgId, targetMigrationEnabled }) =>\n  (name) => {\n    // We have a contract with the server that we will pass\n    // all cookies whose names are namespaced according to the\n    // logic in isNamespacedCookieName as well as any legacy\n    // cookie names (so that the server can handle migrating\n    // identities on websites previously using Visitor.js)\n    return (\n      isNamespacedCookieName(orgId, name) ||\n      name === AT_QA_MODE ||\n      (targetMigrationEnabled && name === MBOX)\n    );\n  };\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default \"v1\";\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport const TYPE_ERROR = \"TypeError\";\nexport const NETWORK_ERROR = \"NetworkError\";\n\n/**\n * Checks if the error is a network-related error\n * @param {Error} error The error to check\n * @returns {boolean} True if the error is network-related\n */\nexport const isNetworkError = (error) => {\n  return (\n    error.name === TYPE_ERROR ||\n    error.name === NETWORK_ERROR ||\n    error.status === 0\n  );\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { assignConcatArrayValues } from \"../../utils/index.js\";\n\nexport default (returnValues) => {\n  // Merges all returned objects from all `onResponse` callbacks into\n  // a single object that can later be returned to the customer.\n  const lifecycleOnResponseReturnValues = returnValues.shift() || [];\n  const consumerOnResponseReturnValues = returnValues.shift() || [];\n  const lifecycleOnBeforeRequestReturnValues = returnValues;\n\n  return assignConcatArrayValues(\n    {},\n    ...lifecycleOnResponseReturnValues,\n    ...consumerOnResponseReturnValues,\n    ...lifecycleOnBeforeRequestReturnValues,\n  );\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default (onRequestFailureCallbackAggregator) => {\n  return (error) => {\n    // Regardless of whether the network call failed, an unexpected status\n    // code was returned, or the response body was malformed, we want to call\n    // the onRequestFailure callbacks, but still throw the exception.\n    const throwError = () => {\n      throw error;\n    };\n    return onRequestFailureCallbackAggregator\n      .call({ error })\n      .then(throwError, throwError);\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { EdgeRequestExecutor } from './types.js' */\n/** @import { ResponseCreator } from '../types.js' */\n\nimport { ID_THIRD_PARTY as ID_THIRD_PARTY_DOMAIN } from \"../../constants/domain.js\";\nimport apiVersion from \"../../constants/apiVersion.js\";\nimport { createCallbackAggregator, noop } from \"../../utils/index.js\";\nimport { isNetworkError } from \"../../utils/networkErrors.js\";\nimport mergeLifecycleResponses from \"./mergeLifecycleResponses.js\";\nimport handleRequestFailure from \"./handleRequestFailure.js\";\n\nconst isDemdexBlockedError = (error, request) => {\n  return request.getUseIdThirdPartyDomain() && isNetworkError(error);\n};\n\n/**\n * @function\n *\n * @param {object} options\n * @param {{edgeDomain: string, edgeBasePath: string, datastreamId: string}} options.config\n * @param {object} options.lifecycle\n * @param {object} options.cookieTransfer\n * @param {function(object): Promise<Object>} options.sendNetworkRequest\n * @param {ResponseCreator} options.createResponse\n * @param {function(object): void} options.processWarningsAndErrors\n * @param {function(): string|undefined} options.getLocationHint\n * @param {function(): string} options.getAssuranceValidationTokenParams\n\n *\n * @returns {EdgeRequestExecutor} A function that sends edge network requests with lifecycle management\n */\nexport default ({\n  config,\n  lifecycle,\n  cookieTransfer,\n  sendNetworkRequest,\n  createResponse,\n  processWarningsAndErrors,\n  getLocationHint,\n  getAssuranceValidationTokenParams,\n}) => {\n  const { edgeDomain, edgeBasePath, datastreamId } = config;\n  let hasDemdexFailed = false;\n\n  const buildEndpointUrl = (endpointDomain, request) => {\n    const locationHint = getLocationHint();\n    const edgeBasePathWithLocationHint = locationHint\n      ? `${edgeBasePath}/${locationHint}${request.getEdgeSubPath()}`\n      : `${edgeBasePath}${request.getEdgeSubPath()}`;\n    const configId = request.getDatastreamIdOverride() || datastreamId;\n\n    if (configId !== datastreamId) {\n      request.getPayload().mergeMeta({\n        sdkConfig: {\n          datastream: {\n            original: datastreamId,\n          },\n        },\n      });\n    }\n\n    return `https://${endpointDomain}/${edgeBasePathWithLocationHint}/${apiVersion}/${request.getAction()}?configId=${configId}&requestId=${request.getId()}${getAssuranceValidationTokenParams()}`;\n  };\n\n  /**\n   * Sends a network request that is aware of payload interfaces,\n   * lifecycle methods, configured edge domains, response structures, etc.\n   */\n  return ({\n    request,\n    runOnResponseCallbacks = noop,\n    runOnRequestFailureCallbacks = noop,\n  }) => {\n    const onResponseCallbackAggregator = createCallbackAggregator();\n    onResponseCallbackAggregator.add(lifecycle.onResponse);\n    onResponseCallbackAggregator.add(runOnResponseCallbacks);\n\n    const onRequestFailureCallbackAggregator = createCallbackAggregator();\n    onRequestFailureCallbackAggregator.add(lifecycle.onRequestFailure);\n    onRequestFailureCallbackAggregator.add(runOnRequestFailureCallbacks);\n\n    return lifecycle\n      .onBeforeRequest({\n        request,\n        onResponse: onResponseCallbackAggregator.add,\n        onRequestFailure: onRequestFailureCallbackAggregator.add,\n      })\n      .then(() => {\n        const endpointDomain =\n          hasDemdexFailed || !request.getUseIdThirdPartyDomain()\n            ? edgeDomain\n            : ID_THIRD_PARTY_DOMAIN;\n\n        const url = buildEndpointUrl(endpointDomain, request);\n        const payload = request.getPayload();\n        cookieTransfer.cookiesToPayload(payload, endpointDomain);\n\n        return sendNetworkRequest({\n          requestId: request.getId(),\n          url,\n          payload,\n          useSendBeacon: request.getUseSendBeacon(),\n        });\n      })\n      .then((networkResponse) => {\n        processWarningsAndErrors(networkResponse);\n        return networkResponse;\n      })\n      .catch((error) => {\n        if (isDemdexBlockedError(error, request)) {\n          hasDemdexFailed = true;\n          request.setUseIdThirdPartyDomain(false);\n          const url = buildEndpointUrl(edgeDomain, request);\n          const payload = request.getPayload();\n          cookieTransfer.cookiesToPayload(payload, edgeDomain);\n\n          return sendNetworkRequest({\n            requestId: request.getId(),\n            url,\n            payload,\n            useSendBeacon: request.getUseSendBeacon(),\n          });\n        }\n        return handleRequestFailure(onRequestFailureCallbackAggregator)(error);\n      })\n      .then(({ parsedBody, getHeader }) => {\n        // Note that networkResponse.parsedBody may be undefined if it was a\n        // 204 No Content response. That's fine.\n        const response = createResponse({ content: parsedBody, getHeader });\n        cookieTransfer.responseToCookies(response);\n\n        // Notice we're calling the onResponse lifecycle method even if there are errors\n        // inside the response body. This is because the full request didn't actually fail--\n        // only portions of it that are considered non-fatal (a specific, non-critical\n        // Konductor plugin, for example).\n        return onResponseCallbackAggregator\n          .call({\n            response,\n          })\n          .then(mergeLifecycleResponses);\n      });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const NO_CONTENT = 204;\nexport const TOO_MANY_REQUESTS = 429;\nexport const BAD_GATEWAY = 502;\nexport const SERVICE_UNAVAILABLE = 503;\nexport const GATEWAY_TIMEOUT = 504;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { NO_CONTENT } from \"../../constants/httpStatusCode.js\";\n\nconst MESSAGE_PREFIX = \"The server responded with a\";\n\nexport default ({ logger }) => {\n  return (networkResponse) => {\n    const { statusCode, body, parsedBody } = networkResponse;\n\n    if (\n      statusCode < 200 ||\n      statusCode >= 300 ||\n      (!parsedBody && statusCode !== NO_CONTENT) ||\n      (parsedBody && !Array.isArray(parsedBody.handle))\n    ) {\n      const bodyToLog = parsedBody ? JSON.stringify(parsedBody, null, 2) : body;\n      const messageSuffix = bodyToLog\n        ? `response body:\\n${bodyToLog}`\n        : `no response body.`;\n      throw new Error(\n        `${MESSAGE_PREFIX} status code ${statusCode} and ${messageSuffix}`,\n      );\n    }\n\n    if (parsedBody) {\n      const { warnings = [], errors = [] } = parsedBody;\n      warnings.forEach((warning) => {\n        logger.warn(`${MESSAGE_PREFIX} warning:`, warning);\n      });\n      errors.forEach((error) => {\n        logger.error(`${MESSAGE_PREFIX} non-fatal error:`, error);\n      });\n    }\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { getNamespacedCookieName } from \"../../utils/index.js\";\nimport { CLUSTER } from \"../../constants/cookieNameKey.js\";\nimport { MBOX_EDGE_CLUSTER } from \"../../constants/legacyCookies.js\";\n\nexport default ({ orgId, cookieJar }) => {\n  const clusterCookieName = getNamespacedCookieName(orgId, CLUSTER);\n  const fromClusterCookie = () => cookieJar.get(clusterCookieName);\n  const fromTarget = () => {\n    const mboxEdgeCluster = cookieJar.get(MBOX_EDGE_CLUSTER);\n    if (mboxEdgeCluster) {\n      return `t${mboxEdgeCluster}`;\n    }\n    return undefined;\n  };\n\n  return () => {\n    return fromClusterCookie() || fromTarget();\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  TOO_MANY_REQUESTS,\n  SERVICE_UNAVAILABLE,\n  BAD_GATEWAY,\n  GATEWAY_TIMEOUT,\n} from \"../../constants/httpStatusCode.js\";\n\nconst MAX_RETRIES = 3;\n\nconst RETRYABLE_STATUS_CODES = [\n  TOO_MANY_REQUESTS,\n  SERVICE_UNAVAILABLE,\n  BAD_GATEWAY,\n  GATEWAY_TIMEOUT,\n];\n\n// These rules are in accordance with\n// https://git.corp.adobe.com/pages/experience-edge/konductor/#/apis/errors?id=handling-4xx-and-5xx-responses\nexport default ({ response, retriesAttempted }) => {\n  return (\n    retriesAttempted < MAX_RETRIES &&\n    RETRYABLE_STATUS_CODES.includes(response.statusCode)\n  );\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { RETRY_AFTER } from \"../../constants/httpHeaderNames.js\";\nimport { isInteger } from \"../../utils/index.js\";\n\n// The retry gets incrementally (but not exponentially) longer for each retry.\nconst FIRST_DELAY_MILLIS = 1000;\nconst INCREMENTAL_DELAY_MILLIS = 1000;\n\n// When the target delay is randomized, make it within the range of this percentage above or below the target delay.\nconst MAX_RANDOM_VARIANCE_PERCENTAGE = 0.3;\n\nconst calculateRetryDelay = (retriesAttempted) => {\n  const targetDelay =\n    FIRST_DELAY_MILLIS + retriesAttempted * INCREMENTAL_DELAY_MILLIS;\n  const maxVariance = targetDelay * MAX_RANDOM_VARIANCE_PERCENTAGE;\n  const minDelay = targetDelay - maxVariance;\n  const maxDelay = targetDelay + maxVariance;\n  const randomizedDelayWithinRange = Math.round(\n    minDelay + Math.random() * (maxDelay - minDelay),\n  );\n  return randomizedDelayWithinRange;\n};\n\nconst getDelayFromHeader = (response) => {\n  // According to the HTTP spec, if the header is defined, its value will be a string that\n  // represents either:\n  //  * An integer indicating the number of seconds to delay.\n  //  * A date after which a retry may occur. The date would be in HTTP-date\n  //    format (https://tools.ietf.org/html/rfc7231#section-7.1.1.1). When debugging, it can\n  //    be helpful to know that this is the same format that a JavaScript date's\n  //    toGMTString() returns.\n  const headerValue = response.getHeader(RETRY_AFTER);\n  let delayInMillis;\n\n  if (headerValue) {\n    const headerValueInt = parseInt(headerValue, 10);\n    if (isInteger(headerValueInt)) {\n      delayInMillis = headerValueInt * 1000;\n    } else {\n      delayInMillis = Math.max(\n        0,\n        new Date(headerValue).getTime() - new Date().getTime(),\n      );\n    }\n  }\n\n  return delayInMillis;\n};\n\n// These rules are in accordance with\n// https://git.corp.adobe.com/pages/experience-edge/konductor/#/apis/errors?id=handling-4xx-and-5xx-responses\n// For retry delays that don't come from a Retry-After response header, we try to stick with the following best\n// practices outlined in https://docs.microsoft.com/en-us/azure/architecture/best-practices/transient-faults:\n//  * Incremental retry\n//  * Random interval\nexport default ({ response, retriesAttempted }) => {\n  // Technically, only 429 or 503 responses should have a Retry-After header, but we'll respect the\n  // header if we find it on any response.\n  let delayInMillis = getDelayFromHeader(response);\n\n  // Note that the value of delay may be 0 at this point, which would be a valid delay we want to use\n  // and not override, which is why we don't do:\n  // if (!delay) { ... }\n  if (delayInMillis === undefined) {\n    delayInMillis = calculateRetryDelay(retriesAttempted);\n  }\n\n  return delayInMillis;\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { createCallbackAggregator, noop } from \"../../utils/index.js\";\nimport mergeLifecycleResponses from \"./mergeLifecycleResponses.js\";\nimport handleRequestFailure from \"./handleRequestFailure.js\";\n\nconst HTTP_STATUS_OK = 200;\n\nexport default ({\n  cookieTransfer,\n  lifecycle,\n  createResponse,\n  processWarningsAndErrors,\n}) => {\n  return ({\n    request,\n    responseHeaders,\n    responseBody,\n    runOnResponseCallbacks = noop,\n    runOnRequestFailureCallbacks = noop,\n  }) => {\n    const onResponseCallbackAggregator = createCallbackAggregator();\n    onResponseCallbackAggregator.add(lifecycle.onResponse);\n    onResponseCallbackAggregator.add(runOnResponseCallbacks);\n\n    const onRequestFailureCallbackAggregator = createCallbackAggregator();\n    onRequestFailureCallbackAggregator.add(lifecycle.onRequestFailure);\n    onRequestFailureCallbackAggregator.add(runOnRequestFailureCallbacks);\n\n    const getHeader = (key) => responseHeaders[key];\n\n    return lifecycle\n      .onBeforeRequest({\n        request,\n        onResponse: onResponseCallbackAggregator.add,\n        onRequestFailure: onRequestFailureCallbackAggregator.add,\n      })\n      .then(() =>\n        processWarningsAndErrors({\n          statusCode: HTTP_STATUS_OK,\n          getHeader,\n          body: JSON.stringify(responseBody),\n          parsedBody: responseBody,\n        }),\n      )\n      .catch(handleRequestFailure(onRequestFailureCallbackAggregator))\n      .then(() => {\n        const response = createResponse({\n          content: responseBody,\n          getHeader,\n        });\n\n        // This will clobber any cookies set via HTTP from the server.  So care should be given to remove any state:store handles if that is not desirable\n        cookieTransfer.responseToCookies(response);\n\n        return onResponseCallbackAggregator\n          .call({ response })\n          .then(mergeLifecycleResponses);\n      });\n  };\n};\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/* eslint-disable dot-notation */\n\n/** @import { AlloyMonitor } from './types.js' */\n\n/**\n * This factory function creates a getter that combines both provided monitors\n * and any monitors found in the global window.__alloyMonitors array.\n *\n * @param {Array<AlloyMonitor>} [monitors] - Optional array of monitor objects to append to the current one\n * @returns {Function} A function that when called, returns all available monitors\n */\nexport default (monitors) => {\n  /** @type {Array<AlloyMonitor>} */\n  let alloyMonitors = window[\"__alloyMonitors\"] || [];\n\n  if (monitors) {\n    alloyMonitors = alloyMonitors.concat(monitors);\n  }\n\n  return alloyMonitors;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { deepAssign } from \"../../utils/index.js\";\n\nexport default (window) => {\n  return (xdm) => {\n    const web = {\n      webPageDetails: {\n        URL: window.location.href || window.location,\n      },\n      webReferrer: {\n        URL: window.document.referrer,\n      },\n    };\n    deepAssign(xdm, { web });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { deepAssign, isFunction, toInteger } from \"../../utils/index.js\";\n\nconst getScreenOrientationViaProperty = (window) => {\n  const {\n    screen: { orientation },\n  } = window;\n\n  if (orientation == null || orientation.type == null) {\n    return null;\n  }\n\n  const parts = orientation.type.split(\"-\");\n\n  if (parts.length === 0) {\n    return null;\n  }\n\n  if (parts[0] !== \"portrait\" && parts[0] !== \"landscape\") {\n    return null;\n  }\n\n  return parts[0];\n};\n\nconst getScreenOrientationViaMediaQuery = (window) => {\n  if (isFunction(window.matchMedia)) {\n    if (window.matchMedia(\"(orientation: portrait)\").matches) {\n      return \"portrait\";\n    }\n    if (window.matchMedia(\"(orientation: landscape)\").matches) {\n      return \"landscape\";\n    }\n  }\n\n  return null;\n};\n\nexport default (window) => {\n  return (xdm) => {\n    const {\n      screen: { width, height },\n    } = window;\n    const device = {};\n\n    const screenHeight = toInteger(height);\n    if (screenHeight >= 0) {\n      device.screenHeight = screenHeight;\n    }\n\n    const screenWidth = toInteger(width);\n    if (screenWidth >= 0) {\n      device.screenWidth = screenWidth;\n    }\n\n    const orientation =\n      getScreenOrientationViaProperty(window) ||\n      getScreenOrientationViaMediaQuery(window);\n    if (orientation) {\n      device.screenOrientation = orientation;\n    }\n    if (Object.keys(device).length > 0) {\n      deepAssign(xdm, { device });\n    }\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { deepAssign, toInteger } from \"../../utils/index.js\";\n\nexport default (window) => {\n  return (xdm) => {\n    const {\n      document: { documentElement: { clientWidth, clientHeight } = {} },\n    } = window;\n\n    const environment = {\n      type: \"browser\",\n    };\n\n    const viewportWidth = toInteger(clientWidth);\n    if (viewportWidth >= 0) {\n      environment.browserDetails = { viewportWidth };\n    }\n\n    const viewportHeight = toInteger(clientHeight);\n    if (viewportHeight >= 0) {\n      environment.browserDetails = environment.browserDetails || {};\n      environment.browserDetails.viewportHeight = viewportHeight;\n    }\n\n    deepAssign(xdm, { environment });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { deepAssign, toISOStringLocal, toInteger } from \"../../utils/index.js\";\n\nexport default (dateProvider) => {\n  return (xdm) => {\n    const date = dateProvider();\n\n    const placeContext = {};\n\n    const localTimezoneOffset = toInteger(date.getTimezoneOffset());\n    if (localTimezoneOffset !== undefined) {\n      placeContext.localTimezoneOffset = localTimezoneOffset;\n    }\n    // make sure the timezone offset only uses two digits\n    if (\n      localTimezoneOffset === undefined ||\n      Math.abs(localTimezoneOffset) < 6000\n    ) {\n      placeContext.localTime = toISOStringLocal(date);\n    }\n\n    deepAssign(xdm, { placeContext });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { deepAssign } from \"../../utils/index.js\";\n\nexport default (dateProvider) => {\n  return (xdm) => {\n    const timestamp = dateProvider().toISOString();\n    deepAssign(xdm, { timestamp });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"https://ns.adobe.com/experience/alloy\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// The __VERSION__ keyword will be replace at alloy build time with the package.json version.\n// see babel-plugin-version\n\nexport default \"__VERSION__\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { deepAssign } from \"../../utils/index.js\";\nimport libraryName from \"../../constants/libraryName.js\";\nimport libraryVersion from \"../../constants/libraryVersion.js\";\n\nexport default (xdm) => {\n  const implementationDetails = {\n    name: libraryName,\n    version: libraryVersion,\n    environment: \"browser\",\n  };\n  deepAssign(xdm, { implementationDetails });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default (config, logger, optionalContexts, requiredContexts) => {\n  const configuredContexts = config.context;\n\n  const contexts = configuredContexts\n    .flatMap((context, i) => {\n      if (optionalContexts[context]) {\n        return [optionalContexts[context]];\n      }\n      logger.warn(`Invalid context[${i}]: '${context}' is not available.`);\n      return [];\n    })\n    .concat(requiredContexts);\n\n  return {\n    namespace: \"Context\",\n    lifecycle: {\n      onBeforeEvent({ event }) {\n        const xdm = {};\n        return Promise.all(\n          contexts.map((context) => Promise.resolve(context(xdm, logger))),\n        ).then(() => event.mergeXdm(xdm));\n      },\n    },\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default [\n  [\"architecture\", \"string\"],\n  [\"bitness\", \"string\"],\n  [\"model\", \"string\"],\n  [\"platformVersion\", \"string\"],\n  [\"wow64\", \"boolean\"],\n];\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { deepAssign, noop } from \"../../utils/index.js\";\nimport highEntropyUserAgentHints from \"../../constants/highEntropyUserAgentClientHints.js\";\n\nconst browserSupportsUserAgentClientHints = (navigator) => {\n  return \"userAgentData\" in navigator;\n};\n\nexport default (navigator) => {\n  if (!browserSupportsUserAgentClientHints(navigator)) {\n    return noop;\n  }\n  return (xdm, logger) => {\n    try {\n      // eslint-disable-next-line compat/compat -- userAgentData support is checked before calling\n      return navigator.userAgentData\n        .getHighEntropyValues(highEntropyUserAgentHints.map((hint) => hint[0]))\n        .then((hints) => {\n          const userAgentClientHints = {};\n          highEntropyUserAgentHints.forEach(([hintName, hintType]) => {\n            if (\n              Object.prototype.hasOwnProperty.call(hints, hintName) &&\n              /* eslint-disable-next-line valid-typeof */\n              typeof hints[hintName] === hintType\n            ) {\n              userAgentClientHints[hintName] = hints[hintName];\n            }\n          });\n          deepAssign(xdm, {\n            environment: {\n              browserDetails: {\n                userAgentClientHints,\n              },\n            },\n          });\n        });\n    } catch (error) {\n      logger.warn(\n        `Unable to collect user-agent client hints. ${error.message}`,\n      );\n      return noop;\n    }\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport injectWeb from \"./injectWeb.js\";\nimport injectDevice from \"./injectDevice.js\";\nimport injectEnvironment from \"./injectEnvironment.js\";\nimport injectPlaceContext from \"./injectPlaceContext.js\";\nimport injectTimestamp from \"./injectTimestamp.js\";\nimport implementationDetails from \"./implementationDetails.js\";\nimport createComponent from \"./createComponent.js\";\nimport injectHighEntropyUserAgentHints from \"./injectHighEntropyUserAgentHints.js\";\nimport { arrayOf, objectOf, string } from \"../../utils/validation/index.js\";\n\nconst web = injectWeb(window);\nconst device = injectDevice(window);\nconst environment = injectEnvironment(window);\nconst placeContext = injectPlaceContext(() => new Date());\nconst timestamp = injectTimestamp(() => new Date());\nconst highEntropyUserAgentHints = injectHighEntropyUserAgentHints(navigator);\n\nconst defaultEnabledContexts = {\n  web,\n  device,\n  environment,\n  placeContext,\n};\nconst defaultDisabledContexts = {\n  highEntropyUserAgentHints,\n};\nconst optionalContexts = {\n  ...defaultEnabledContexts,\n  ...defaultDisabledContexts,\n};\nconst requiredContexts = [timestamp, implementationDetails];\n\nconst createContext = ({ config, logger }) => {\n  return createComponent(config, logger, optionalContexts, requiredContexts);\n};\ncreateContext.namespace = \"Context\";\ncreateContext.configValidators = objectOf({\n  context: arrayOf(string()).default(Object.keys(defaultEnabledContexts)),\n});\n\nexport default createContext;\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  string,\n  objectOf,\n  boolean,\n  arrayOf,\n  enumOf,\n} from \"../../utils/validation/index.js\";\nimport {\n  validateConfigOverride,\n  validateIdentityMap,\n} from \"../../utils/index.js\";\nimport { DISABLED, WAIT, AUTO } from \"../../constants/consentStatus.js\";\n/**\n * Verifies user provided event options.\n * @param {*} options The user event options to validate\n * @returns {*} Validated options\n */\nexport default ({ options }) => {\n  const eventOptionsValidator = objectOf({\n    type: string(),\n    xdm: objectOf({\n      eventType: string(),\n      identityMap: validateIdentityMap,\n    }),\n    data: objectOf({}),\n    documentUnloading: boolean(),\n    renderDecisions: boolean(),\n    decisionScopes: arrayOf(string()).uniqueItems(),\n    personalization: objectOf({\n      decisionScopes: arrayOf(string()).uniqueItems(),\n      surfaces: arrayOf(string()).uniqueItems(),\n      sendDisplayEvent: boolean().default(true),\n      includeRenderedPropositions: boolean().default(false),\n      defaultPersonalizationEnabled: boolean(),\n      decisionContext: objectOf({}),\n    }).default({ sendDisplayEvent: true }),\n    datasetId: string(),\n    mergeId: string(),\n    edgeConfigOverrides: validateConfigOverride,\n    advertising: objectOf({\n      handleAdvertisingData: enumOf(DISABLED, WAIT, AUTO).default(DISABLED),\n    }),\n  })\n    .required()\n    .noUnknownFields();\n  return eventOptionsValidator(options);\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport {\n  anything,\n  arrayOf,\n  boolean,\n  mapOfValues,\n  objectOf,\n  string,\n} from \"../../utils/validation/index.js\";\n\nexport default ({ options }) => {\n  const validator = objectOf({\n    renderDecisions: boolean(),\n    responseHeaders: mapOfValues(string().required()),\n    responseBody: objectOf({\n      handle: arrayOf(\n        objectOf({\n          type: string().required(),\n          payload: anything().required(),\n        }),\n      ).required(),\n    }).required(),\n    personalization: objectOf({\n      sendDisplayEvent: boolean().default(true),\n      decisionContext: objectOf({}),\n    }).default({ sendDisplayEvent: true }),\n  }).noUnknownFields();\n\n  return validator(options);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport validateUserEventOptions from \"./validateUserEventOptions.js\";\nimport validateApplyResponse from \"./validateApplyResponse.js\";\nimport { deepAssign } from \"../../utils/index.js\";\n\nconst createDataCollector = ({ eventManager, logger }) => {\n  return {\n    commands: {\n      sendEvent: {\n        documentationUri: \"https://adobe.ly/3GQ3Q7t\",\n        optionsValidator: (options) => {\n          return validateUserEventOptions({ options });\n        },\n        run: (options) => {\n          const {\n            xdm,\n            data,\n            documentUnloading,\n            type,\n            mergeId,\n            datasetId,\n            edgeConfigOverrides,\n            ...eventManagerOptions\n          } = options;\n          const event = eventManager.createEvent();\n\n          if (documentUnloading) {\n            event.documentMayUnload();\n          }\n\n          event.setUserXdm(xdm);\n          event.setUserData(data);\n\n          if (type) {\n            event.mergeXdm({\n              eventType: type,\n            });\n          }\n\n          if (mergeId) {\n            event.mergeXdm({\n              eventMergeId: mergeId,\n            });\n          }\n\n          if (edgeConfigOverrides) {\n            eventManagerOptions.edgeConfigOverrides = edgeConfigOverrides;\n          }\n\n          if (datasetId) {\n            logger.warn(\n              \"The 'datasetId' option has been deprecated. Please use 'edgeConfigOverrides.com_adobe_experience_platform.datasets.event.datasetId' instead.\",\n            );\n            eventManagerOptions.edgeConfigOverrides = edgeConfigOverrides || {};\n            deepAssign(eventManagerOptions.edgeConfigOverrides, {\n              com_adobe_experience_platform: {\n                datasets: { event: { datasetId } },\n              },\n            });\n          }\n          return eventManager.sendEvent(event, eventManagerOptions);\n        },\n      },\n      applyResponse: {\n        documentationUri: \"\",\n        optionsValidator: (options) => {\n          return validateApplyResponse({ options });\n        },\n        run: (options) => {\n          const {\n            renderDecisions = false,\n            decisionContext = {},\n            responseHeaders = {},\n            responseBody = { handle: [] },\n            personalization,\n          } = options;\n\n          const event = eventManager.createEvent();\n\n          return eventManager.applyResponse(event, {\n            renderDecisions,\n            decisionContext,\n            responseHeaders,\n            responseBody,\n            personalization,\n          });\n        },\n      },\n    },\n  };\n};\n\ncreateDataCollector.namespace = \"DataCollector\";\n\nexport default createDataCollector;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { noop } from \"../../utils/index.js\";\n\nconst createResultLogMessage = (idSync, success) => {\n  return `ID sync ${success ? \"succeeded\" : \"failed\"}: ${idSync.spec.url}`;\n};\n\nexport default ({ fireReferrerHideableImage, logger }) =>\n  (idSyncs) => {\n    const urlIdSyncs = idSyncs.filter((idSync) => idSync.type === \"url\");\n\n    if (!urlIdSyncs.length) {\n      return Promise.resolve();\n    }\n    return Promise.all(\n      urlIdSyncs.map((idSync) => {\n        return fireReferrerHideableImage(idSync.spec)\n          .then(() => {\n            logger.info(createResultLogMessage(idSync, true));\n          })\n          .catch(() => {\n            // We intentionally do not throw an error if id syncs fail. We\n            // consider it a non-critical failure and therefore do not want it to\n            // reject the promise handed back to the customer.\n            logger.error(createResultLogMessage(idSync, false));\n          });\n      }),\n    ).then(noop);\n  };\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { boolean, objectOf } from \"../../utils/validation/index.js\";\n\nconst configValidators = objectOf({\n  thirdPartyCookiesEnabled: boolean().default(true),\n  idMigrationEnabled: boolean().default(true),\n});\n\nexport default configValidators;\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { validateConfigOverride } from \"../../../utils/index.js\";\nimport { objectOf, string } from \"../../../utils/validation/index.js\";\n/**\n * Verifies user provided event options.\n * @param {*} options The user event options to validate\n * @returns {*} Validated options\n */\nexport default objectOf({\n  url: string().required().nonEmpty(),\n  edgeConfigOverrides: validateConfigOverride,\n})\n  .required()\n  .noUnknownFields();\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"ECID\";\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport appendIdentityToUrlOptionsValidator from \"./appendIdentityToUrl/appendIdentityToUrlOptionsValidator.js\";\nimport ecidNamespace from \"../../constants/ecidNamespace.js\";\n\nexport default ({\n  addEcidQueryToPayload,\n  addQueryStringIdentityToPayload,\n  ensureSingleIdentity,\n  setLegacyEcid,\n  handleResponseForIdSyncs,\n  getNamespacesFromResponse,\n  getIdentity,\n  consent,\n  appendIdentityToUrl,\n  logger,\n  identity,\n  getIdentityOptionsValidator,\n}) => {\n  let namespaces;\n  let edge = {};\n  return {\n    lifecycle: {\n      onBeforeRequest({ request, onResponse, onRequestFailure }) {\n        // Querying the ECID on every request to be able to set the legacy cookie, and make it\n        // available for the `getIdentity` command.\n        addEcidQueryToPayload(request.getPayload());\n        addQueryStringIdentityToPayload(request.getPayload());\n        return ensureSingleIdentity({ request, onResponse, onRequestFailure });\n      },\n      onResponse({ response }) {\n        const newNamespaces = getNamespacesFromResponse(response);\n        if (\n          (!namespaces || !namespaces[ecidNamespace]) &&\n          newNamespaces &&\n          newNamespaces[ecidNamespace]\n        ) {\n          // Only data collection calls will have an ECID in the response.\n          // https://jira.corp.adobe.com/browse/EXEG-1234\n          setLegacyEcid(newNamespaces[ecidNamespace]);\n        }\n\n        if (newNamespaces && Object.keys(newNamespaces).length > 0) {\n          namespaces = { ...namespaces, ...newNamespaces };\n        }\n        // For sendBeacon requests, getEdge() will return {}, so we are using assign here\n        // so that sendBeacon requests don't override the edge info from before.\n        edge = { ...edge, ...response.getEdge() };\n\n        identity.setIdentityAcquired();\n\n        return handleResponseForIdSyncs(response);\n      },\n    },\n    commands: {\n      getIdentity: {\n        optionsValidator: getIdentityOptionsValidator,\n        run: (options) => {\n          const { namespaces: requestedNamespaces } = options;\n          return consent\n            .awaitConsent()\n            .then(() => {\n              if (namespaces) {\n                return undefined;\n              }\n              const ecidFromCookie = identity.getEcidFromCookie();\n              if (\n                ecidFromCookie &&\n                requestedNamespaces.includes(ecidNamespace)\n              ) {\n                if (!namespaces) {\n                  namespaces = {};\n                }\n                namespaces[ecidNamespace] = ecidFromCookie;\n                if (requestedNamespaces.length === 1) {\n                  // If only ECID is requested, we don't need to make an acquire request\n                  // and can return immediately\n                  return undefined;\n                }\n              }\n              return getIdentity(options);\n            })\n            .then(() => {\n              return {\n                identity: requestedNamespaces.reduce((acc, namespace) => {\n                  acc[namespace] = namespaces[namespace] || null;\n                  return acc;\n                }, {}),\n                edge,\n              };\n            });\n        },\n      },\n      appendIdentityToUrl: {\n        optionsValidator: appendIdentityToUrlOptionsValidator,\n        run: (options) => {\n          return consent\n            .withConsent()\n            .then(() => {\n              if (namespaces) {\n                return undefined;\n              }\n              const ecidFromCookie = identity.getEcidFromCookie();\n              if (ecidFromCookie) {\n                if (!namespaces) {\n                  namespaces = {};\n                }\n                namespaces[ecidNamespace] = ecidFromCookie;\n                return undefined;\n              }\n              return getIdentity(options);\n            })\n            .then(() => {\n              return {\n                url: appendIdentityToUrl(\n                  namespaces[ecidNamespace],\n                  options.url,\n                ),\n              };\n            })\n            .catch((error) => {\n              logger.warn(`Unable to append identity to url. ${error.message}`);\n              return options;\n            });\n        },\n      },\n    },\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Handles migration of ECID to and from Visitor.js.\n */\nexport default ({\n  config,\n  getEcidFromVisitor,\n  apexDomain,\n  isPageSsl,\n  cookieJar,\n}) => {\n  const { idMigrationEnabled, orgId } = config;\n  const amcvCookieName = `AMCV_${orgId}`;\n\n  const getEcidFromLegacyCookies = () => {\n    let ecid = null;\n    const secidCookieName = \"s_ecid\";\n\n    const legacyEcidCookieValue =\n      cookieJar.get(secidCookieName) || cookieJar.get(amcvCookieName);\n\n    if (legacyEcidCookieValue) {\n      const reg = /(^|\\|)MCMID\\|(\\d+)($|\\|)/;\n      const matches = legacyEcidCookieValue.match(reg);\n\n      if (matches) {\n        // Destructuring arrays breaks in IE\n        ecid = matches[2];\n      }\n    }\n\n    return ecid;\n  };\n\n  return {\n    getEcid() {\n      if (idMigrationEnabled) {\n        const ecid = getEcidFromLegacyCookies();\n        if (ecid) {\n          return Promise.resolve(ecid);\n        }\n        return getEcidFromVisitor();\n      }\n      return Promise.resolve();\n    },\n    setEcid(ecid) {\n      if (idMigrationEnabled && getEcidFromLegacyCookies() !== ecid) {\n        const extraOptions = isPageSsl\n          ? { sameSite: \"none\", secure: true }\n          : {};\n\n        cookieJar.set(amcvCookieName, `MCMID|${ecid}`, {\n          domain: apexDomain,\n          // Without `expires` this will be a session cookie.\n          expires: 390, // days, or 13 months.\n          ...extraOptions,\n        });\n      }\n    },\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isObject } from \"../../../utils/index.js\";\n\nexport default ({ logger }) => {\n  return new Promise((resolve, reject) => {\n    if (isObject(window.adobe) && isObject(window.adobe.optIn)) {\n      const optInOld = window.adobe.optIn;\n      logger.info(\n        \"Delaying request while waiting for legacy opt-in to let Visitor retrieve ECID from server.\",\n      );\n      optInOld.fetchPermissions(() => {\n        if (optInOld.isApproved([optInOld.Categories.ECID])) {\n          logger.info(\n            \"Received legacy opt-in approval to let Visitor retrieve ECID from server.\",\n          );\n          resolve();\n        } else {\n          reject(new Error(\"Legacy opt-in was declined.\"));\n        }\n      }, true);\n    } else {\n      resolve();\n    }\n  });\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isFunction } from \"../../../utils/index.js\";\n\nexport default (window) => {\n  const Visitor = window.Visitor;\n  return isFunction(Visitor) && isFunction(Visitor.getInstance) && Visitor;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport getVisitor from \"./getVisitor.js\";\n\nexport default ({ logger, orgId, awaitVisitorOptIn }) => {\n  return () => {\n    const Visitor = getVisitor(window);\n    if (Visitor) {\n      // Need to explicitly wait for optIn because visitor will call callback\n      // with invalid values prior to optIn being approved\n      return awaitVisitorOptIn({ logger })\n        .then(() => {\n          logger.info(\n            \"Delaying request while using Visitor to retrieve ECID from server.\",\n          );\n\n          return new Promise((resolve) => {\n            const visitor = Visitor.getInstance(orgId, {});\n            visitor.getMarketingCloudVisitorID((ecid) => {\n              logger.info(\n                \"Resuming previously delayed request that was waiting for ECID from Visitor.\",\n              );\n              resolve(ecid);\n            }, true);\n          });\n        })\n        .catch((error) => {\n          // If consent was denied, get the ECID from experience edge. OptIn and AEP Web SDK\n          // consent should operate independently, but during id migration AEP Web SDK needs\n          // to wait for optIn object consent resolution so that only one ECID is generated.\n          if (error) {\n            logger.info(\n              `${error.message}, retrieving ECID from experience edge`,\n            );\n          } else {\n            logger.info(\n              \"An error occurred while obtaining the ECID from Visitor.\",\n            );\n          }\n        });\n    }\n    return Promise.resolve();\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ processIdSyncs }) => {\n  return (response) => {\n    return processIdSyncs(response.getPayloadsByType(\"identity:exchange\"));\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// TO-DOCUMENT: We queue subsequent requests until we have an identity cookie.\nexport default ({\n  doesIdentityCookieExist,\n  setDomainForInitialIdentityPayload,\n  addLegacyEcidToPayload,\n  awaitIdentityCookie,\n  logger,\n}) => {\n  let obtainedIdentityPromise;\n\n  const allowRequestToGoWithoutIdentity = (request) => {\n    setDomainForInitialIdentityPayload(request);\n    return addLegacyEcidToPayload(request.getPayload());\n  };\n\n  /**\n   * Ensures that if no identity cookie exists, we only let one request at a\n   * time without an identity until its response returns. In the meantime,\n   * we queue all other requests, otherwise the requests could result in\n   * multiple ECIDs being minted for the user. Once we get an identity\n   * cookie, we can let the queued requests be sent all at once, since they\n   * will have the newly minted ECID.\n   *\n   * Konductor should make every effort to return an identity, but in\n   * certain scenarios it may not. For example, in cases where the\n   * request does not match what Konductor is expecting (ie 400s).\n   * In cases where Konductor does not set an identity, there should be\n   * no events recorded so we don't need to worry about multiple ECIDs\n   * being minted for each user.\n   *\n   * The reason we allow for multiple sequential requests to be sent without\n   * an identity is to prevent a single malformed request causing all other\n   * requests to never send.\n   */\n  return ({ request, onResponse, onRequestFailure }) => {\n    if (doesIdentityCookieExist()) {\n      request.setIsIdentityEstablished();\n      return Promise.resolve();\n    }\n\n    if (obtainedIdentityPromise) {\n      // We don't have an identity cookie, but at least one request has\n      // been sent to get it. Konductor may set the identity cookie in the\n      // response. We will hold up this request until the previous request\n      // returns and awaitIdentityCookie confirms the identity was set.\n      logger.info(\"Delaying request while retrieving ECID from server.\");\n      const previousObtainedIdentityPromise = obtainedIdentityPromise;\n\n      // This promise resolves when we have an identity cookie. Additional\n      // requests are chained together so that only one is sent at a time\n      // until we have the identity cookie.\n      obtainedIdentityPromise = previousObtainedIdentityPromise.catch(() => {\n        return awaitIdentityCookie({ onResponse, onRequestFailure });\n      });\n      // This prevents an un-caught promise in the console when the identity isn't set.\n      obtainedIdentityPromise.catch(() => {});\n\n      // When this returned promise resolves, the request will go out.\n      return (\n        previousObtainedIdentityPromise\n          .then(() => {\n            logger.info(\"Resuming previously delayed request.\");\n            request.setIsIdentityEstablished();\n          })\n          // If Konductor did not set the identity cookie on the previous\n          // request, then awaitIdentityCookie will reject its promise.\n          // Catch the rejection here and allow this request to go out.\n          .catch(() => {\n            return allowRequestToGoWithoutIdentity(request);\n          })\n      );\n    }\n\n    // For Alloy+Konductor communication to be as robust as possible and\n    // to ensure we don't mint new ECIDs for requests that would otherwise\n    // be sent in parallel, we'll let this request go out to fetch the\n    // cookie\n    obtainedIdentityPromise = awaitIdentityCookie({\n      onResponse,\n      onRequestFailure,\n    });\n    // This prevents an un-caught promise in the console when the identity isn't set.\n    obtainedIdentityPromise.catch(() => {});\n\n    return allowRequestToGoWithoutIdentity(request);\n  };\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"CORE\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport ecidNamespace from \"../../constants/ecidNamespace.js\";\nimport coreNamespace from \"../../constants/coreNamespace.js\";\n\nexport default ({\n  thirdPartyCookiesEnabled,\n  areThirdPartyCookiesSupportedByDefault,\n}) => {\n  const query = {\n    identity: {\n      fetch: [ecidNamespace],\n    },\n  };\n  if (thirdPartyCookiesEnabled && areThirdPartyCookiesSupportedByDefault()) {\n    query.identity.fetch.push(coreNamespace);\n  }\n  return (payload) => {\n    payload.mergeQuery(query);\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({\n  thirdPartyCookiesEnabled,\n  areThirdPartyCookiesSupportedByDefault,\n}) => {\n  return (request) => {\n    if (thirdPartyCookiesEnabled && areThirdPartyCookiesSupportedByDefault()) {\n      // If third-party cookies are enabled by the customer and\n      // supported by the browser, we will send the request to a\n      // a third-party identification domain that allows for more accurate\n      // identification of the user through use of a third-party cookie.\n      // If we have an identity to migrate, we still want to hit the\n      // third-party identification domain because the third-party identification\n      // domain will use our ECID to set the third-party cookie if the third-party\n      // cookie isn't already set, which provides for better cross-domain\n      // identification for future requests.\n      request.setUseIdThirdPartyDomain();\n    }\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport ecidNamespace from \"../../constants/ecidNamespace.js\";\n\nexport default ({ getLegacyEcid, addEcidToPayload }) => {\n  return (payload) => {\n    if (payload.hasIdentity(ecidNamespace)) {\n      // don't get the legacy identity if we already have the query string identity or if\n      // the user specified it in the identity map\n      return Promise.resolve();\n    }\n    return getLegacyEcid().then((ecidToMigrate) => {\n      if (ecidToMigrate) {\n        addEcidToPayload(payload, ecidToMigrate);\n      }\n    });\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"adobe_mc\";\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (v) => {\n  try {\n    return decodeURIComponent(v);\n  } catch {\n    return \"\";\n  }\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n// Example: adobe_mc=TS%3D1641432103%7CMCMID%3D77094828402023918047117570965393734545%7CMCORGID%3DFAF554945B90342F0A495E2C%40AdobeOrg\n// Decoded: adobe_mc=TS=1641432103|MCMID=77094828402023918047117570965393734545|MCORGID=FAF554945B90342F0A495E2C@AdobeOrg\n\nimport { queryString } from \"../../utils/index.js\";\nimport queryStringIdentityParam from \"../../constants/queryStringIdentityParam.js\";\nimport ecidNamespace from \"../../constants/ecidNamespace.js\";\nimport decodeUriComponentSafely from \"../../utils/decodeUriComponentSafely.js\";\n\nconst LINK_TTL_SECONDS = 300; // 5 minute link time to live\n\nexport default ({ locationSearch, dateProvider, orgId, logger }) =>\n  (payload) => {\n    if (payload.hasIdentity(ecidNamespace)) {\n      // don't overwrite a user provided ecid identity\n      return;\n    }\n\n    const parsedQueryString = queryString.parse(locationSearch);\n    let queryStringValue = parsedQueryString[queryStringIdentityParam];\n\n    if (queryStringValue === undefined) {\n      return;\n    }\n    if (Array.isArray(queryStringValue)) {\n      logger.warn(\n        \"Found multiple adobe_mc query string paramters, only using the last one.\",\n      );\n      queryStringValue = queryStringValue[queryStringValue.length - 1];\n    }\n\n    const properties = queryStringValue.split(\"|\").reduce((memo, keyValue) => {\n      const [key, value] = keyValue.split(\"=\");\n      memo[key] = decodeUriComponentSafely(value);\n      memo[key] = memo[key].replace(/[^a-zA-Z0-9@.]/g, \"\"); // sanitization\n      return memo;\n    }, {});\n    // We are using MCMID and MCORGID to be compatible with Visitor.\n    const ts = parseInt(properties.TS, 10);\n    const mcmid = properties.MCMID;\n    const mcorgid = decodeUriComponentSafely(properties.MCORGID);\n    if (\n      // When TS is not specified or not a number, the following inequality returns false.\n      // All inequalities with NaN variables are false.\n      dateProvider().getTime() / 1000 <= ts + LINK_TTL_SECONDS &&\n      mcorgid === orgId &&\n      mcmid\n    ) {\n      logger.info(\n        `Found valid ECID identity ${mcmid} from the adobe_mc query string parameter.`,\n      );\n      payload.addIdentity(ecidNamespace, {\n        id: mcmid,\n      });\n    } else {\n      logger.info(\n        \"Detected invalid or expired adobe_mc query string parameter.\",\n      );\n    }\n  };\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport ecidNamespace from \"../../constants/ecidNamespace.js\";\n\nexport default (payload, ecid) => {\n  payload.addIdentity(ecidNamespace, {\n    id: ecid,\n  });\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ doesIdentityCookieExist, orgId, logger }) => {\n  /**\n   * Returns a promise that will be resolved once an identity cookie exists.\n   * If an identity cookie doesn't already exist, it should always exist after\n   * the first response.\n   */\n  return ({ onResponse, onRequestFailure }) => {\n    return new Promise((resolve, reject) => {\n      onResponse(() => {\n        if (doesIdentityCookieExist()) {\n          resolve();\n        } else {\n          // This logic assumes that the code setting the cookie is working as expected and that\n          // the cookie was missing from the response.\n          logger.warn(\n            `Identity cookie not found. This could be caused by any of the following issues:\\n` +\n              `\\t* The org ID ${orgId} configured in Alloy doesn't match the org ID specified in the edge configuration.\\n` +\n              `\\t* Experience edge was not able to set the identity cookie due to domain or cookie restrictions.\\n` +\n              `\\t* The request was canceled by the browser and not fully processed.`,\n          );\n\n          // Rejecting the promise will tell queued events to still go out\n          // one at a time.\n          reject(new Error(\"Identity cookie not found.\"));\n        }\n      });\n      onRequestFailure(() => {\n        if (doesIdentityCookieExist()) {\n          resolve();\n        } else {\n          // The error from the request failure will be logged separately. Rejecting this here\n          // will tell ensureSingleIdentity to send the next request without identity\n          reject(new Error(\"Identity cookie not found.\"));\n        }\n      });\n    });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default (response) => {\n  const identityResultPayloads = response.getPayloadsByType(\"identity:result\");\n  return identityResultPayloads.reduce((acc, payload) => {\n    if (payload.namespace && payload.namespace.code) {\n      acc[payload.namespace.code] = payload.id;\n    }\n    return acc;\n  }, {});\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createRequestParams } from \"../../../utils/request/index.js\";\n\nexport default ({\n  sendEdgeNetworkRequest,\n  createIdentityRequestPayload,\n  createIdentityRequest,\n  globalConfigOverrides,\n}) => {\n  return ({ namespaces, edgeConfigOverrides: localConfigOverrides } = {}) => {\n    const requestParams = createRequestParams({\n      payload: createIdentityRequestPayload(namespaces),\n      globalConfigOverrides,\n      localConfigOverrides,\n    });\n    const request = createIdentityRequest(requestParams);\n    return sendEdgeNetworkRequest({\n      request,\n    });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createRequest } from \"../../../utils/request/index.js\";\n\nexport default ({ payload, datastreamIdOverride }) => {\n  return createRequest({\n    payload,\n    datastreamIdOverride,\n    getAction() {\n      return \"identity/acquire\";\n    },\n    getUseSendBeacon() {\n      return false;\n    },\n  });\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  createAddIdentity,\n  createHasIdentity,\n  createRequestPayload,\n} from \"../../../utils/request/index.js\";\n\nexport default (namespaces) => {\n  const content = {\n    query: {\n      identity: {\n        fetch: namespaces,\n      },\n    },\n  };\n  return createRequestPayload({\n    content,\n    addIdentity: createAddIdentity(content),\n    hasIdentity: createHasIdentity(content),\n  });\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nconst URL_REGEX = /^([^?#]*)(\\??[^#]*)(#?.*)$/;\n\nconst getSeparator = (queryString) => {\n  if (queryString === \"\") {\n    return \"?\";\n  }\n  if (queryString === \"?\") {\n    return \"\";\n  }\n  return \"&\";\n};\n\nexport default ({ dateProvider, orgId }) =>\n  (ecid, url) => {\n    const ts = Math.round(dateProvider().getTime() / 1000);\n    const adobemc = encodeURIComponent(\n      `TS=${ts}|MCMID=${ecid}|MCORGID=${encodeURIComponent(orgId)}`,\n    );\n    const [, location, queryString, fragment] = url.match(URL_REGEX);\n    const separator = getSeparator(queryString);\n    return `${location}${queryString}${separator}adobe_mc=${adobemc}${fragment}`;\n  };\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { validateConfigOverride } from \"../../../utils/index.js\";\nimport { objectOf, enumOf, arrayOf } from \"../../../utils/validation/index.js\";\nimport ecidNamespace from \"../../../constants/ecidNamespace.js\";\nimport coreNamespace from \"../../../constants/coreNamespace.js\";\n\n/**\n * Verifies user provided event options.\n * @param {*} options The user event options to validate\n * @returns {*} Validated options\n */\n\nconst validator = objectOf({\n  namespaces: arrayOf(enumOf(ecidNamespace, coreNamespace))\n    .nonEmpty()\n    .uniqueItems()\n    .default([ecidNamespace]),\n  edgeConfigOverrides: validateConfigOverride,\n})\n  .noUnknownFields()\n  .default({\n    namespaces: [ecidNamespace],\n  });\n\nexport default ({ thirdPartyCookiesEnabled }) => {\n  return (options) => {\n    const validatedOptions = validator(options);\n    if (\n      !thirdPartyCookiesEnabled &&\n      validatedOptions.namespaces.includes(coreNamespace)\n    ) {\n      throw new Error(\n        `namespaces: The ${coreNamespace} namespace cannot be requested when third-party cookies are disabled.`,\n      );\n    }\n    return validatedOptions;\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  injectAreThirdPartyCookiesSupportedByDefault,\n  injectDoesIdentityCookieExist,\n  createLoggingCookieJar,\n  cookieJar,\n} from \"../../utils/index.js\";\nimport injectProcessIdSyncs from \"./injectProcessIdSyncs.js\";\nimport configValidators from \"./configValidators.js\";\n\nimport createComponent from \"./createComponent.js\";\nimport createLegacyIdentity from \"./createLegacyIdentity.js\";\nimport awaitVisitorOptIn from \"./visitorService/awaitVisitorOptIn.js\";\nimport injectGetEcidFromVisitor from \"./visitorService/injectGetEcidFromVisitor.js\";\nimport injectHandleResponseForIdSyncs from \"./injectHandleResponseForIdSyncs.js\";\nimport injectEnsureSingleIdentity from \"./injectEnsureSingleIdentity.js\";\nimport injectAddEcidQueryToPayload from \"./injectAddEcidQueryToPayload.js\";\nimport injectSetDomainForInitialIdentityPayload from \"./injectSetDomainForInitialIdentityPayload.js\";\nimport injectAddLegacyEcidToPayload from \"./injectAddLegacyEcidToPayload.js\";\nimport injectAddQueryStringIdentityToPayload from \"./injectAddQueryStringIdentityToPayload.js\";\nimport addEcidToPayload from \"./addEcidToPayload.js\";\nimport injectAwaitIdentityCookie from \"./injectAwaitIdentityCookie.js\";\nimport getNamespacesFromResponse from \"./getNamespacesFromResponse.js\";\nimport createGetIdentity from \"./getIdentity/createGetIdentity.js\";\nimport createIdentityRequest from \"./getIdentity/createIdentityRequest.js\";\nimport createIdentityRequestPayload from \"./getIdentity/createIdentityRequestPayload.js\";\nimport injectAppendIdentityToUrl from \"./appendIdentityToUrl/injectAppendIdentityToUrl.js\";\nimport createGetIdentityOptionsValidator from \"./getIdentity/createGetIdentityOptionsValidator.js\";\n\nconst createIdentity = ({\n  config,\n  logger,\n  consent,\n  fireReferrerHideableImage,\n  sendEdgeNetworkRequest,\n  apexDomain,\n  getBrowser,\n  identity,\n}) => {\n  const {\n    orgId,\n    thirdPartyCookiesEnabled,\n    edgeConfigOverrides: globalConfigOverrides,\n  } = config;\n\n  const getEcidFromVisitor = injectGetEcidFromVisitor({\n    logger,\n    orgId,\n    awaitVisitorOptIn,\n  });\n  const loggingCookieJar = createLoggingCookieJar({ logger, cookieJar });\n  const legacyIdentity = createLegacyIdentity({\n    config,\n    getEcidFromVisitor,\n    apexDomain,\n    cookieJar: loggingCookieJar,\n    isPageSsl: window.location.protocol === \"https:\",\n  });\n  const doesIdentityCookieExist = injectDoesIdentityCookieExist({ orgId });\n  const getIdentity = createGetIdentity({\n    sendEdgeNetworkRequest,\n    createIdentityRequestPayload,\n    createIdentityRequest,\n    globalConfigOverrides,\n  });\n  const areThirdPartyCookiesSupportedByDefault =\n    injectAreThirdPartyCookiesSupportedByDefault({ getBrowser });\n  const setDomainForInitialIdentityPayload =\n    injectSetDomainForInitialIdentityPayload({\n      thirdPartyCookiesEnabled,\n      areThirdPartyCookiesSupportedByDefault,\n    });\n  const addLegacyEcidToPayload = injectAddLegacyEcidToPayload({\n    getLegacyEcid: legacyIdentity.getEcid,\n    addEcidToPayload,\n  });\n  const addQueryStringIdentityToPayload = injectAddQueryStringIdentityToPayload(\n    {\n      locationSearch: window.document.location.search,\n      dateProvider: () => new Date(),\n      orgId,\n      logger,\n    },\n  );\n  const awaitIdentityCookie = injectAwaitIdentityCookie({\n    doesIdentityCookieExist,\n    orgId,\n    logger,\n  });\n  const ensureSingleIdentity = injectEnsureSingleIdentity({\n    doesIdentityCookieExist,\n    setDomainForInitialIdentityPayload,\n    addLegacyEcidToPayload,\n    awaitIdentityCookie,\n    logger,\n  });\n  const processIdSyncs = injectProcessIdSyncs({\n    fireReferrerHideableImage,\n    logger,\n  });\n  const handleResponseForIdSyncs = injectHandleResponseForIdSyncs({\n    processIdSyncs,\n  });\n  const appendIdentityToUrl = injectAppendIdentityToUrl({\n    dateProvider: () => new Date(),\n    orgId,\n    globalConfigOverrides,\n  });\n  const getIdentityOptionsValidator = createGetIdentityOptionsValidator({\n    thirdPartyCookiesEnabled,\n  });\n  const addEcidQueryToPayload = injectAddEcidQueryToPayload({\n    thirdPartyCookiesEnabled,\n    areThirdPartyCookiesSupportedByDefault,\n  });\n  return createComponent({\n    addEcidQueryToPayload,\n    addQueryStringIdentityToPayload,\n    ensureSingleIdentity,\n    setLegacyEcid: legacyIdentity.setEcid,\n    handleResponseForIdSyncs,\n    getNamespacesFromResponse,\n    getIdentity,\n    consent,\n    identity,\n    appendIdentityToUrl,\n    logger,\n    config,\n    getIdentityOptionsValidator,\n  });\n};\n\ncreateIdentity.namespace = \"Identity\";\ncreateIdentity.configValidators = configValidators;\n\nexport default createIdentity;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport libraryVersion from \"../../constants/libraryVersion.js\";\nimport { CONFIGURE, SET_DEBUG } from \"../../constants/coreCommands.js\";\n\nconst prepareLibraryInfo = ({ config, componentRegistry }) => {\n  const allCommands = [\n    ...componentRegistry.getCommandNames(),\n    CONFIGURE,\n    SET_DEBUG,\n  ].sort();\n  const resultConfig = { ...config };\n  Object.keys(config).forEach((key) => {\n    const value = config[key];\n    if (typeof value !== \"function\") {\n      return;\n    }\n    resultConfig[key] = value.toString();\n  });\n  const components = componentRegistry.getComponentNames();\n  return {\n    version: libraryVersion,\n    configs: resultConfig,\n    commands: allCommands,\n    components,\n  };\n};\n\nconst createLibraryInfo = ({ config, componentRegistry }) => {\n  return {\n    commands: {\n      getLibraryInfo: {\n        run: () => {\n          return {\n            libraryInfo: prepareLibraryInfo({ config, componentRegistry }),\n          };\n        },\n      },\n    },\n  };\n};\n\ncreateLibraryInfo.namespace = \"LibraryInfo\";\nexport default createLibraryInfo;\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport { default as context } from \"../components/Context/index.js\";\nexport { default as dataCollector } from \"../components/DataCollector/index.js\";\nexport { default as identity } from \"../components/Identity/index.js\";\nexport { default as libraryInfo } from \"../components/LibraryInfo/index.js\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createInstanceFunction from \"./createInstanceFunction.js\";\nimport {\n  getApexDomain,\n  injectStorage,\n  cookieJar,\n  isFunction,\n  createLoggingCookieJar,\n  injectFireReferrerHideableImage,\n  injectGetBrowser,\n} from \"../utils/index.js\";\nimport createLogController from \"./createLogController.js\";\nimport createLifecycle from \"./createLifecycle.js\";\nimport createComponentRegistry from \"./createComponentRegistry.js\";\nimport injectSendNetworkRequest from \"./network/injectSendNetworkRequest.js\";\nimport injectExtractEdgeInfo from \"./edgeNetwork/injectExtractEdgeInfo.js\";\nimport createIdentity from \"./identity/createIdentity.js\";\nimport createConsent from \"./consent/createConsent.js\";\nimport createConsentStateMachine from \"./consent/createConsentStateMachine.js\";\nimport createEvent from \"./createEvent.js\";\nimport injectCreateResponse from \"./injectCreateResponse.js\";\nimport injectExecuteCommand from \"./injectExecuteCommand.js\";\nimport validateCommandOptions from \"./validateCommandOptions.js\";\nimport buildAndValidateConfig from \"./buildAndValidateConfig.js\";\nimport initializeComponents from \"./initializeComponents.js\";\nimport createConfig from \"./config/createConfig.js\";\nimport createCoreConfigs from \"./config/createCoreConfigs.js\";\nimport injectHandleError from \"./injectHandleError.js\";\nimport injectSendFetchRequest from \"./network/requestMethods/injectSendFetchRequest.js\";\nimport injectSendBeaconRequest from \"./network/requestMethods/injectSendBeaconRequest.js\";\nimport createLogger from \"./createLogger.js\";\nimport createEventManager from \"./createEventManager.js\";\nimport createCookieTransfer from \"./createCookieTransfer.js\";\nimport injectShouldTransferCookie from \"./injectShouldTransferCookie.js\";\nimport {\n  createDataCollectionRequest,\n  createDataCollectionRequestPayload,\n  createGetAssuranceValidationTokenParams,\n} from \"../utils/request/index.js\";\nimport injectSendEdgeNetworkRequest from \"./edgeNetwork/injectSendEdgeNetworkRequest.js\";\nimport injectProcessWarningsAndErrors from \"./edgeNetwork/injectProcessWarningsAndErrors.js\";\nimport injectGetLocationHint from \"./edgeNetwork/injectGetLocationHint.js\";\nimport isRequestRetryable from \"./network/isRequestRetryable.js\";\nimport getRequestRetryDelay from \"./network/getRequestRetryDelay.js\";\nimport injectApplyResponse from \"./edgeNetwork/injectApplyResponse.js\";\nimport getMonitors from \"./getMonitors.js\";\nimport * as requiredComponents from \"./requiredComponentCreators.js\";\n\nconst createNamespacedStorage = injectStorage(window);\n\nconst { console, fetch, navigator } = window;\n\nconst coreConfigValidators = createCoreConfigs();\nconst apexDomain = getApexDomain(window, cookieJar);\nconst sendFetchRequest = injectSendFetchRequest({ fetch });\nconst fireReferrerHideableImage = injectFireReferrerHideableImage();\nconst getAssuranceValidationTokenParams =\n  createGetAssuranceValidationTokenParams({ window, createNamespacedStorage });\n\nconst getBrowser = injectGetBrowser({ userAgent: window.navigator.userAgent });\n\nexport const createExecuteCommand = ({\n  instanceName,\n  logController: { setDebugEnabled, logger, createComponentLogger },\n  components,\n}) => {\n  const componentRegistry = createComponentRegistry();\n  const lifecycle = createLifecycle(componentRegistry);\n\n  const componentCreators = components.concat(\n    Object.values(requiredComponents),\n  );\n\n  const setDebugCommand = (options) => {\n    setDebugEnabled(options.enabled, { fromConfig: false });\n  };\n\n  const loggingCookieJar = createLoggingCookieJar({ logger, cookieJar });\n  const configureCommand = (options) => {\n    const config = buildAndValidateConfig({\n      options,\n      componentCreators,\n      coreConfigValidators,\n      createConfig,\n      logger,\n      setDebugEnabled,\n    });\n    const { orgId, targetMigrationEnabled } = config;\n    const shouldTransferCookie = injectShouldTransferCookie({\n      orgId,\n      targetMigrationEnabled,\n    });\n    const cookieTransfer = createCookieTransfer({\n      cookieJar: loggingCookieJar,\n      shouldTransferCookie,\n      apexDomain,\n      dateProvider: () => new Date(),\n    });\n    const sendBeaconRequest = isFunction(navigator.sendBeacon)\n      ? injectSendBeaconRequest({\n          // Without the bind(), the browser will complain about an\n          // illegal invocation.\n          sendBeacon: navigator.sendBeacon.bind(navigator),\n          sendFetchRequest,\n          logger,\n        })\n      : sendFetchRequest;\n    const sendNetworkRequest = injectSendNetworkRequest({\n      logger,\n      sendFetchRequest,\n      sendBeaconRequest,\n      isRequestRetryable,\n      getRequestRetryDelay,\n    });\n    const processWarningsAndErrors = injectProcessWarningsAndErrors({\n      logger,\n    });\n    const extractEdgeInfo = injectExtractEdgeInfo({ logger });\n    const createResponse = injectCreateResponse({ extractEdgeInfo });\n    const getLocationHint = injectGetLocationHint({ orgId, cookieJar });\n    const sendEdgeNetworkRequest = injectSendEdgeNetworkRequest({\n      config,\n      lifecycle,\n      cookieTransfer,\n      sendNetworkRequest,\n      createResponse,\n      processWarningsAndErrors,\n      getLocationHint,\n      getAssuranceValidationTokenParams,\n    });\n\n    const applyResponse = injectApplyResponse({\n      lifecycle,\n      cookieTransfer,\n      createResponse,\n      processWarningsAndErrors,\n    });\n\n    const generalConsentState = createConsentStateMachine({ logger });\n    const consent = createConsent({\n      generalConsentState,\n      logger,\n    });\n\n    const identity = createIdentity({ config, logger, loggingCookieJar });\n    identity.initialize();\n\n    const eventManager = createEventManager({\n      config,\n      logger,\n      lifecycle,\n      consent,\n      createEvent,\n      createDataCollectionRequestPayload,\n      createDataCollectionRequest,\n      sendEdgeNetworkRequest,\n      applyResponse,\n    });\n    return initializeComponents({\n      componentCreators,\n      lifecycle,\n      componentRegistry,\n      getImmediatelyAvailableTools(componentName) {\n        const componentLogger = createComponentLogger(componentName);\n        return {\n          config,\n          componentRegistry,\n          consent,\n          identity,\n          eventManager,\n          fireReferrerHideableImage,\n          logger: componentLogger,\n          lifecycle,\n          sendEdgeNetworkRequest,\n          handleError: injectHandleError({\n            errorPrefix: `[${instanceName}] [${componentName}]`,\n            logger: componentLogger,\n          }),\n          createNamespacedStorage,\n          apexDomain,\n          getBrowser,\n        };\n      },\n    });\n  };\n\n  const handleError = injectHandleError({\n    errorPrefix: `[${instanceName}]`,\n    logger,\n  });\n\n  const executeCommand = injectExecuteCommand({\n    logger,\n    configureCommand,\n    setDebugCommand,\n    handleError,\n    validateCommandOptions,\n  });\n  return executeCommand;\n};\n\nexport default ({ components }) => {\n  // eslint-disable-next-line no-underscore-dangle\n  const instanceNames = window.__alloyNS;\n\n  if (instanceNames) {\n    instanceNames.forEach((instanceName) => {\n      const logController = createLogController({\n        console,\n        locationSearch: window.location.search,\n        createLogger,\n        instanceName,\n        createNamespacedStorage,\n        getMonitors,\n      });\n\n      const executeCommand = createExecuteCommand({\n        instanceName,\n        logController,\n        components,\n      });\n      const instance = createInstanceFunction(executeCommand);\n\n      const queue = window[instanceName].q;\n      queue.push = instance;\n      logController.logger.logOnInstanceCreated({ instance });\n      queue.forEach(instance);\n    });\n  }\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { noop } from \"../../utils/index.js\";\n\nconst createClickHandler = ({ eventManager, lifecycle, handleError }) => {\n  return (clickEvent) => {\n    // Ignore repropagated clicks from AppMeasurement\n    if (clickEvent.s_fe) {\n      return Promise.resolve();\n    }\n    // TODO: Consider safeguarding from the same object being clicked multiple times in rapid succession?\n    const clickedElement =\n      \"composedPath\" in clickEvent && clickEvent.composedPath().length > 0\n        ? clickEvent.composedPath()[0]\n        : clickEvent.target;\n    const event = eventManager.createEvent();\n    // this is to make sure a exit link personalization metric use send beacon\n    event.documentMayUnload();\n    return (\n      lifecycle\n        .onClick({ event, clickedElement })\n        .then(() => {\n          if (event.isEmpty()) {\n            return Promise.resolve();\n          }\n          return eventManager.sendEvent(event);\n        })\n        // eventManager.sendEvent() will return a promise resolved to an\n        // object and we want to avoid returning any value to the customer\n        .then(noop)\n        .catch((error) => {\n          handleError(error, \"click collection\");\n        })\n    );\n  };\n};\n\nexport default ({ eventManager, lifecycle, handleError }) => {\n  const clickHandler = createClickHandler({\n    eventManager,\n    lifecycle,\n    handleError,\n  });\n  document.addEventListener(\"click\", clickHandler, true);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  boolean,\n  callback,\n  objectOf,\n  string,\n} from \"../../utils/validation/index.js\";\n\nconst DEFAULT_DOWNLOAD_QUALIFIER =\n  \"\\\\.(exe|zip|wav|mp3|mov|mpg|avi|wmv|pdf|doc|docx|xls|xlsx|ppt|pptx)$\";\n\nexport const downloadLinkQualifier = string()\n  .regexp()\n  .default(DEFAULT_DOWNLOAD_QUALIFIER);\n\nconst validators = objectOf({\n  clickCollectionEnabled: boolean().default(true),\n  clickCollection: objectOf({\n    internalLinkEnabled: boolean().default(true),\n    externalLinkEnabled: boolean().default(true),\n    downloadLinkEnabled: boolean().default(true),\n    // TODO: Consider moving downloadLinkQualifier here.\n    sessionStorageEnabled: boolean().default(false),\n    eventGroupingEnabled: boolean().default(false),\n    filterClickProperties: callback(),\n  }).default({\n    internalLinkEnabled: true,\n    externalLinkEnabled: true,\n    downloadLinkEnabled: true,\n    sessionStorageEnabled: false,\n    eventGroupingEnabled: false,\n  }),\n  downloadLinkQualifier,\n  onBeforeLinkClickSend: callback().deprecated(\n    'The field \"onBeforeLinkClickSend\" has been deprecated. Use \"clickCollection.filterClickDetails\" instead.',\n  ),\n});\n\n// Export both the validators and the default qualifier\nexport { DEFAULT_DOWNLOAD_QUALIFIER };\nexport default validators;\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nconst ACTIVITY_MAP_EXTENSION_ID = \"cppXYctnr\";\n\nexport default (context = document) =>\n  context.getElementById(ACTIVITY_MAP_EXTENSION_ID) !== null;\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (uri) => {\n  let fullUrl = uri;\n  if (!/^https?:\\/\\//i.test(fullUrl)) {\n    fullUrl = `${window.location.protocol}//${uri}`;\n  }\n  const url = new URL(fullUrl);\n  return url.hostname;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport extractDomain from \"./dom/extractDomain.js\";\n\nexport default (uri1, uri2) => {\n  const domain1 = extractDomain(uri1);\n  const domain2 = extractDomain(uri2);\n  return domain1 !== domain2;\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport activityMapExtensionEnabled from \"./utils/activityMapExtensionEnabled.js\";\nimport isDifferentDomains from \"./utils/isDifferentDomains.js\";\n\nconst isDissallowedLinkType = (clickCollection, linkType) => {\n  return (\n    linkType &&\n    ((linkType === \"download\" && !clickCollection.downloadLinkEnabled) ||\n      (linkType === \"exit\" && !clickCollection.externalLinkEnabled) ||\n      (linkType === \"other\" && !clickCollection.internalLinkEnabled))\n  );\n};\n\nexport default ({\n  config,\n  logger,\n  getClickedElementProperties,\n  clickActivityStorage,\n}) => {\n  const { clickCollectionEnabled, clickCollection } = config;\n  if (!clickCollectionEnabled) {\n    return () => undefined;\n  }\n\n  return ({ event, clickedElement }) => {\n    const elementProperties = getClickedElementProperties({\n      clickActivityStorage,\n      clickedElement,\n      config,\n      logger,\n    });\n    const linkType = elementProperties.linkType;\n    // Avoid clicks to be collected for the ActivityMap interface\n    if (activityMapExtensionEnabled()) {\n      return;\n    }\n    if (\n      elementProperties.isValidLink() &&\n      isDissallowedLinkType(clickCollection, linkType)\n    ) {\n      logger.info(\n        `Cancelling link click event due to clickCollection.${linkType}LinkEnabled = false.`,\n      );\n    } else if (\n      // Determine if element properties should be sent with event now, or be saved\n      // and grouped with a future page view event.\n      // Event grouping is not supported for the deprecated onBeforeLinkClickSend callback\n      // because only click properties is saved and not XDM and DATA (which could have been modified).\n      // However, if the filterClickDetails callback is available we group events because it takes\n      // priority over onBeforeLinkClickSend and only supports processing click properties.\n      elementProperties.isInternalLink() &&\n      clickCollection.eventGroupingEnabled &&\n      (!config.onBeforeLinkClickSend || clickCollection.filterClickDetails) &&\n      !isDifferentDomains(window.location.hostname, elementProperties.linkUrl)\n    ) {\n      clickActivityStorage.save(elementProperties.properties);\n    } else if (elementProperties.isValidLink()) {\n      // Event will be sent\n      event.mergeXdm(elementProperties.xdm);\n      event.mergeData(elementProperties.data);\n      clickActivityStorage.save({\n        pageName: elementProperties.pageName,\n        pageIDType: elementProperties.pageIDType,\n      });\n    } else if (elementProperties.isValidActivityMapData()) {\n      clickActivityStorage.save(elementProperties.properties);\n    }\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nconst buildXdmFromClickedElementProperties = (props) => {\n  return {\n    eventType: \"web.webinteraction.linkClicks\",\n    web: {\n      webInteraction: {\n        name: props.linkName,\n        region: props.linkRegion,\n        type: props.linkType,\n        URL: props.linkUrl,\n        linkClicks: {\n          value: 1,\n        },\n      },\n    },\n  };\n};\n\nconst buildDataFromClickedElementProperties = (props) => {\n  return {\n    __adobe: {\n      analytics: {\n        contextData: {\n          a: {\n            activitymap: {\n              page: props.pageName,\n              link: props.linkName,\n              region: props.linkRegion,\n              pageIDType: props.pageIDType,\n            },\n          },\n        },\n      },\n    },\n  };\n};\n\nconst populateClickedElementPropertiesFromOptions = (options, props) => {\n  const { xdm, data, clickedElement } = options;\n  props.clickedElement = clickedElement;\n  if (xdm && xdm.web && xdm.web.webInteraction) {\n    const { name, region, type, URL } = xdm.web.webInteraction;\n    props.linkName = name;\n    props.linkRegion = region;\n    props.linkType = type;\n    props.linkUrl = URL;\n  }\n  // DATA has priority over XDM\n  /* eslint no-underscore-dangle: 0 */\n  if (data && data.__adobe && data.__adobe.analytics) {\n    const { contextData } = data.__adobe.analytics;\n    if (contextData && contextData.a && contextData.a.activitymap) {\n      // Set the properties if they exists\n      const { page, link, region, pageIDType } = contextData.a.activitymap;\n      props.pageName = page || props.pageName;\n      props.linkName = link || props.linkName;\n      props.linkRegion = region || props.linkRegion;\n      if (pageIDType !== undefined) {\n        props.pageIDType = pageIDType;\n      }\n    }\n  }\n};\n\nexport default ({ properties, logger } = {}) => {\n  let props = properties || {};\n  const clickedElementProperties = {\n    get pageName() {\n      return props.pageName;\n    },\n    set pageName(value) {\n      props.pageName = value;\n    },\n    get linkName() {\n      return props.linkName;\n    },\n    set linkName(value) {\n      props.linkName = value;\n    },\n    get linkRegion() {\n      return props.linkRegion;\n    },\n    set linkRegion(value) {\n      props.linkRegion = value;\n    },\n    get linkType() {\n      return props.linkType;\n    },\n    set linkType(value) {\n      props.linkType = value;\n    },\n    get linkUrl() {\n      return props.linkUrl;\n    },\n    set linkUrl(value) {\n      props.linkUrl = value;\n    },\n    get pageIDType() {\n      return props.pageIDType;\n    },\n    set pageIDType(value) {\n      props.pageIDType = value;\n    },\n    get clickedElement() {\n      return props.clickedElement;\n    },\n    set clickedElement(value) {\n      props.clickedElement = value;\n    },\n    get properties() {\n      return {\n        pageName: props.pageName,\n        linkName: props.linkName,\n        linkRegion: props.linkRegion,\n        linkType: props.linkType,\n        linkUrl: props.linkUrl,\n        pageIDType: props.pageIDType,\n      };\n    },\n    isValidLink() {\n      return (\n        !!props.linkUrl &&\n        !!props.linkType &&\n        !!props.linkName &&\n        !!props.linkRegion\n      );\n    },\n    isInternalLink() {\n      return this.isValidLink() && props.linkType === \"other\";\n    },\n    isValidActivityMapData() {\n      return (\n        !!props.pageName &&\n        !!props.linkName &&\n        !!props.linkRegion &&\n        props.pageIDType !== undefined\n      );\n    },\n    get xdm() {\n      if (props.filteredXdm) {\n        return props.filteredXdm;\n      }\n      return buildXdmFromClickedElementProperties(this);\n    },\n    get data() {\n      if (props.filteredData) {\n        return props.filteredData;\n      }\n      return buildDataFromClickedElementProperties(this);\n    },\n    applyPropertyFilter(filter) {\n      if (filter && filter(props) === false) {\n        if (logger) {\n          logger.info(\n            `Clicked element properties were rejected by filter function: ${JSON.stringify(\n              this.properties,\n              null,\n              2,\n            )}`,\n          );\n        }\n        props = {};\n      }\n    },\n    applyOptionsFilter(filter) {\n      const opts = this.options;\n      if (opts && opts.clickedElement && (opts.xdm || opts.data)) {\n        // Properties are rejected if filter is explicitly false.\n        if (filter && filter(opts) === false) {\n          if (logger) {\n            logger.info(\n              `Clicked element properties were rejected by filter function: ${JSON.stringify(\n                this.properties,\n                null,\n                2,\n              )}`,\n            );\n          }\n          this.options = undefined;\n          return;\n        }\n        this.options = opts;\n        // This is just to ensure that any fields outside clicked element properties\n        // set by the user filter persists.\n        props.filteredXdm = opts.xdm;\n        props.filteredData = opts.data;\n      }\n    },\n    get options() {\n      const opts = {};\n      if (this.isValidLink()) {\n        opts.xdm = this.xdm;\n      }\n      if (this.isValidActivityMapData()) {\n        opts.data = this.data;\n      }\n      if (this.clickedElement) {\n        opts.clickedElement = this.clickedElement;\n      }\n      if (!opts.xdm && !opts.data) {\n        return undefined;\n      }\n      return opts;\n    },\n    set options(value) {\n      props = {};\n      if (value) {\n        populateClickedElementPropertiesFromOptions(value, props);\n      }\n    },\n  };\n  return clickedElementProperties;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createClickedElementProperties from \"./createClickedElementProperties.js\";\nimport activityMapExtensionEnabled from \"./utils/activityMapExtensionEnabled.js\";\n\nexport default ({ clickActivityStorage }) => {\n  return (event) => {\n    // Avoid clicks to be collected for the ActivityMap interface\n    if (activityMapExtensionEnabled()) {\n      return;\n    }\n    const properties = clickActivityStorage.load();\n    const elementProperties = createClickedElementProperties({ properties });\n    if (\n      elementProperties.isValidLink() ||\n      elementProperties.isValidActivityMapData()\n    ) {\n      if (elementProperties.isValidLink()) {\n        const xdm = elementProperties.xdm;\n        // Have to delete the eventType not to override the page view\n        delete xdm.eventType;\n        event.mergeXdm(xdm);\n      }\n      if (elementProperties.isValidActivityMapData()) {\n        event.mergeData(elementProperties.data);\n      }\n      // NOTE: We can't clear out all the storage here because we might still need to\n      // keep a page-name for multiple link-clicks (e.g. downloads) on the same page.\n      clickActivityStorage.save({\n        pageName: elementProperties.pageName,\n        pageIDType: elementProperties.pageIDType,\n      });\n    }\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createClickedElementProperties from \"./createClickedElementProperties.js\";\n\nexport default ({\n  window,\n  getLinkName,\n  getLinkRegion,\n  getAbsoluteUrlFromAnchorElement,\n  findClickableElement,\n  determineLinkType,\n}) => {\n  return ({ clickedElement, config, logger, clickActivityStorage }) => {\n    const {\n      onBeforeLinkClickSend: optionsFilter, // Deprecated\n      clickCollection,\n    } = config;\n    const { filterClickDetails: propertyFilter } = clickCollection;\n    const elementProperties = createClickedElementProperties({ logger });\n    if (clickedElement) {\n      const clickableElement = findClickableElement(clickedElement);\n      if (clickableElement) {\n        elementProperties.clickedElement = clickedElement;\n        elementProperties.linkUrl = getAbsoluteUrlFromAnchorElement(\n          window,\n          clickableElement,\n        );\n        elementProperties.linkType = determineLinkType(\n          window,\n          config,\n          elementProperties.linkUrl,\n          clickableElement,\n        );\n        elementProperties.linkRegion = getLinkRegion(clickableElement);\n        elementProperties.linkName = getLinkName(clickableElement);\n        elementProperties.pageIDType = 0;\n        elementProperties.pageName = window.location.href;\n        // Check if we have a page-name stored from an earlier page view event\n        const storedLinkData = clickActivityStorage.load();\n        if (storedLinkData && storedLinkData.pageName) {\n          elementProperties.pageName = storedLinkData.pageName;\n          // Perhaps pageIDType should be established after customer filter is applied\n          // Like if pageName starts with \"http\" then pageIDType = 0\n          elementProperties.pageIDType = 1;\n        }\n        // If defined, run user provided filter function\n        if (propertyFilter) {\n          // clickCollection.filterClickDetails\n          elementProperties.applyPropertyFilter(propertyFilter);\n        } else if (optionsFilter) {\n          // onBeforeLinkClickSend\n          elementProperties.applyOptionsFilter(optionsFilter);\n        }\n      }\n    }\n    return elementProperties;\n  };\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport const CLICK_ACTIVITY_DATA = \"clickData\";\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { CLICK_ACTIVITY_DATA } from \"../../constants/sessionDataKeys.js\";\n\nexport default ({ storage }) => {\n  return {\n    save: (data) => {\n      const jsonData = JSON.stringify(data);\n      storage.setItem(CLICK_ACTIVITY_DATA, jsonData);\n    },\n    load: () => {\n      let jsonData = null;\n      const data = storage.getItem(CLICK_ACTIVITY_DATA);\n      if (data) {\n        jsonData = JSON.parse(data);\n      }\n      return jsonData;\n    },\n    remove: () => {\n      storage.removeItem(CLICK_ACTIVITY_DATA);\n    },\n  };\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ clickActivityStorage }) => {\n  return (event) => {\n    clickActivityStorage.save({\n      pageName: event.getContent().xdm.web.webPageDetails.name,\n      pageIDType: 1, // 1 = name, 0 = URL\n    });\n  };\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n// src/components/ActivityCollector/validateClickCollectionConfig.js\n/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { DEFAULT_DOWNLOAD_QUALIFIER } from \"./configValidators.js\";\n\nexport default (config, logger) => {\n  const {\n    clickCollectionEnabled,\n    onBeforeLinkClickSend,\n    downloadLinkQualifier: dlq,\n  } = config;\n\n  if (clickCollectionEnabled === false) {\n    if (onBeforeLinkClickSend) {\n      logger.warn(\n        \"The 'onBeforeLinkClickSend' configuration was provided but will be ignored because clickCollectionEnabled is false.\",\n      );\n    }\n\n    if (dlq && dlq !== DEFAULT_DOWNLOAD_QUALIFIER) {\n      logger.warn(\n        \"The 'downloadLinkQualifier' configuration was provided but will be ignored because clickCollectionEnabled is false.\",\n      );\n    }\n  }\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Reduces repeated whitespace within a string. Whitespace surrounding the string\n * is trimmed and any occurrence of whitespace within the string is replaced with\n * a single space.\n * @param {string} str String to be formatted.\n * @returns {string} Formatted string.\n */\nexport default (str) => {\n  return str && str.replace(/\\s+/g, \" \").trim();\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nconst unsupportedNodeNames = /^(SCRIPT|STYLE|LINK|CANVAS|NOSCRIPT|#COMMENT)$/i;\n\n/**\n * Determines if a node qualifies as a supported link text node.\n * @param {*} node Node to determine support for.\n * @returns {boolean}\n */\nexport default (node) => {\n  if (node && node.nodeName) {\n    if (node.nodeName.match(unsupportedNodeNames)) {\n      return false;\n    }\n  }\n  return true;\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport truncateWhiteSpace from \"./utils/truncateWhiteSpace.js\";\nimport isSupportedTextNode from \"./utils/dom/isSupportedTextNode.js\";\n\n/**\n * Orders and returns specified node and its child nodes in arrays of supported\n * and unsupported nodes.\n * @param {*} node The node to extract supported and unsupported nodes from.\n * @returns {{supportedNodes: Array, includesUnsupportedNodes: boolean}} Node support object.\n */\nconst extractSupportedNodes = (node) => {\n  let supportedNodes = [];\n  let includesUnsupportedNodes = false;\n  if (isSupportedTextNode(node)) {\n    supportedNodes.push(node);\n    if (node.childNodes) {\n      const childNodes = Array.prototype.slice.call(node.childNodes);\n      childNodes.forEach((childNode) => {\n        const nodes = extractSupportedNodes(childNode);\n        supportedNodes = supportedNodes.concat(nodes.supportedNodes);\n        includesUnsupportedNodes =\n          includesUnsupportedNodes || nodes.includesUnsupportedNodes;\n      });\n    }\n  } else {\n    includesUnsupportedNodes = true;\n  }\n  return {\n    supportedNodes,\n    includesUnsupportedNodes,\n  };\n};\n\n/**\n * Returns the value of a node attribute.\n * @param {*} node The node holding the attribute.\n * @param {string} attributeName The name of the attribute.\n * @param {string} nodeName Optional node name constraint.\n * @returns {string} Attribute value or undefined.\n */\nconst getNodeAttributeValue = (node, attributeName, nodeName) => {\n  let attributeValue;\n  if (!nodeName || nodeName === node.nodeName.toUpperCase()) {\n    attributeValue = node.getAttribute(attributeName);\n  }\n  return attributeValue;\n};\n\n/**\n * Extracts the children supported nodes attributes map\n * @param {*} nodes The nodes array holding the children nodes.\n * The returned map contains the supported not empty children attributes values.\n * */\nconst getChildrenAttributes = (nodes) => {\n  const attributes = {\n    texts: [],\n  };\n  nodes.supportedNodes.forEach((supportedNode) => {\n    if (supportedNode.getAttribute) {\n      if (!attributes.alt) {\n        attributes.alt = truncateWhiteSpace(supportedNode.getAttribute(\"alt\"));\n      }\n      if (!attributes.title) {\n        attributes.title = truncateWhiteSpace(\n          supportedNode.getAttribute(\"title\"),\n        );\n      }\n      if (!attributes.inputValue) {\n        attributes.inputValue = truncateWhiteSpace(\n          getNodeAttributeValue(supportedNode, \"value\", \"INPUT\"),\n        );\n      }\n      if (!attributes.imgSrc) {\n        attributes.imgSrc = truncateWhiteSpace(\n          getNodeAttributeValue(supportedNode, \"src\", \"IMG\"),\n        );\n      }\n    }\n    if (supportedNode.nodeValue) {\n      attributes.texts.push(supportedNode.nodeValue);\n    }\n  });\n  return attributes;\n};\n\n/**\n * Extracts a link-name from a given node.\n *\n * The returned link-name is set to one of the following (in order of priority):\n *\n * 1. Clicked node innerText\n * 2. Clicked node textContent\n * 3. Clicked node and its child nodes nodeValue appended together.\n * 4. Clicked node alt attribute or node descendant alt attribute.\n *    Whichever is found first.\n * 5. Clicked node text attribute or node descendant text attribute.\n *    Whichever is found first.\n * 6. Clicked node INPUT descendant value attribute.\n *    Whichever is found first.\n * 7. Clicked node IMG descendant src attribute.\n *    Whichever is found first.\n *\n * @param {*} node The node to find link text for.\n * @returns {string} link-name or an empty string if not link-name is found.\n */\nexport default (node) => {\n  let nodeText = truncateWhiteSpace(node.innerText || node.textContent);\n  const nodes = extractSupportedNodes(node);\n  // if contains unsupported nodes we want children node attributes\n  if (!nodeText || nodes.includesUnsupportedNodes) {\n    const attributesMap = getChildrenAttributes(nodes);\n    nodeText = truncateWhiteSpace(attributesMap.texts.join(\"\"));\n    if (!nodeText) {\n      nodeText =\n        attributesMap.alt ||\n        attributesMap.title ||\n        attributesMap.inputValue ||\n        attributesMap.imgSrc;\n    }\n  }\n  return nodeText || \"\";\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport truncateWhiteSpace from \"./utils/truncateWhiteSpace.js\";\nimport { isNonEmptyString } from \"../../utils/index.js\";\n\nconst semanticElements = /^(HEADER|MAIN|FOOTER|NAV)$/i;\n\nconst getAriaRegionLabel = (node) => {\n  let regionLabel;\n  if (node.role === \"region\" && isNonEmptyString(node[\"aria-label\"])) {\n    regionLabel = node[\"aria-label\"];\n  }\n  return regionLabel;\n};\n\nconst getSectionNodeName = (node) => {\n  let nodeName;\n  if (node && node.nodeName) {\n    if (node.nodeName.match(semanticElements)) {\n      nodeName = node.nodeName;\n    }\n  }\n  return nodeName;\n};\n\n/**\n * Extracts a node link-region.\n *\n * The link-region is determined by traversing up the DOM\n * looking for a region that is determined in order of priority:\n *\n * 1. element.id\n * 2. Aria region label\n * 3. Semantic element name\n * 4. BODY (if no other link-region is found).\n *\n * @param {*} node The node to find link region for.\n * @returns {string} link-region.\n */\nexport default (node) => {\n  let linkParentNode = node.parentNode;\n  let regionName;\n  while (linkParentNode) {\n    regionName = truncateWhiteSpace(\n      linkParentNode.id ||\n        getAriaRegionLabel(linkParentNode) ||\n        getSectionNodeName(linkParentNode),\n    );\n    if (regionName) {\n      return regionName;\n    }\n    linkParentNode = linkParentNode.parentNode;\n  }\n  return \"BODY\";\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (window, element) => {\n  const base = window.location.href;\n  let href = element.href || \"\";\n  // Some objects (like SVG animations) can contain a href object instead of a string\n  if (typeof href !== \"string\") {\n    href = \"\";\n  }\n  try {\n    return new URL(href, base).href;\n  } catch {\n    return base;\n  }\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element) => {\n  if (\n    element.href &&\n    (element.tagName === \"A\" || element.tagName === \"AREA\") &&\n    (!element.onclick ||\n      !element.protocol ||\n      element.protocol.toLowerCase().indexOf(\"javascript\") < 0)\n  ) {\n    return true;\n  }\n  return false;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element) => {\n  return !element ? false : !!element.onclick;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element) => {\n  if (element.tagName === \"INPUT\") {\n    const type = element.getAttribute(\"type\");\n    if (type === \"submit\") {\n      return true;\n    }\n    // Image type input elements are considered submit elements.\n    // https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/image\n    if (type === \"image\" && element.src) {\n      return true;\n    }\n  }\n  return false;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element) => {\n  return element.tagName === \"BUTTON\" && element.type === \"submit\";\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isSupportedAnchorElement from \"./isSupportedAnchorElement.js\";\nimport elementHasClickHandler from \"./elementHasClickHandler.js\";\nimport isInputSubmitElement from \"./isInputSubmitElement.js\";\nimport isButtonSubmitElement from \"./isButtonSubmitElement.js\";\n\nexport default (element) => {\n  let node = element;\n  while (node) {\n    // Stop looking when BODY is reached\n    if (node.nodeName && node.nodeName === \"BODY\") {\n      break;\n    }\n    if (\n      isSupportedAnchorElement(node) ||\n      elementHasClickHandler(node) ||\n      isInputSubmitElement(node) ||\n      isButtonSubmitElement(node)\n    ) {\n      return node;\n    }\n    node = node.parentNode;\n  }\n  return null;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Trims the query from the URL.\n * @param {string} url\n * @returns {string}\n */\nexport default (url) => {\n  const questionMarkIndex = url.indexOf(\"?\");\n  const hashIndex = url.indexOf(\"#\");\n  if (\n    questionMarkIndex >= 0 &&\n    (questionMarkIndex < hashIndex || hashIndex < 0)\n  ) {\n    return url.substring(0, questionMarkIndex);\n  }\n  if (hashIndex >= 0) {\n    return url.substring(0, hashIndex);\n  }\n  return url;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport trimQueryFromUrl from \"../trimQueryFromUrl.js\";\n\nexport default (downloadLinkQualifier, linkUrl, clickedObj) => {\n  let result = false;\n  if (linkUrl) {\n    if (clickedObj && clickedObj.download) {\n      result = true;\n    } else if (downloadLinkQualifier) {\n      const re = new RegExp(downloadLinkQualifier);\n      const trimmedLinkUrl = trimQueryFromUrl(linkUrl).toLowerCase();\n      result = re.test(trimmedLinkUrl);\n    }\n  }\n  return result;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport trimQueryFromUrl from \"../trimQueryFromUrl.js\";\n\nexport default (window, linkUrl) => {\n  let result = false;\n  // window.location.hostname should always be defined, but checking just in case\n  if (linkUrl && window.location.hostname) {\n    const currentHostname = window.location.hostname.toLowerCase();\n    const trimmedLinkUrl = trimQueryFromUrl(linkUrl).toLowerCase();\n    result = trimmedLinkUrl.indexOf(currentHostname) < 0;\n  }\n  return result;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isDownloadLink from \"./dom/isDownloadLink.js\";\nimport isExitLink from \"./dom/isExitLink.js\";\nimport isNonEmptyString from \"../../../utils/isNonEmptyString.js\";\n\nexport default (window, config, linkUrl, clickedObj) => {\n  let linkType = \"other\";\n  if (isNonEmptyString(linkUrl)) {\n    if (isDownloadLink(config.downloadLinkQualifier, linkUrl, clickedObj)) {\n      linkType = \"download\";\n    } else if (isExitLink(window, linkUrl)) {\n      linkType = \"exit\";\n    }\n  }\n  return linkType;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (event) => {\n  const content = event.getContent();\n  return (\n    content.xdm !== undefined &&\n    // NOTE: A page view event should \"ideally\" include the pageViews type\n    // && event.xdm.eventType === \"web.webpagedetails.pageViews\"\n    content.xdm.web !== undefined &&\n    content.xdm.web.webPageDetails !== undefined &&\n    content.xdm.web.webPageDetails.name !== undefined\n  );\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default () => {\n  const storage = {};\n  return {\n    getItem: (key) => {\n      return storage[key];\n    },\n    setItem: (key, value) => {\n      storage[key] = value;\n    },\n    removeItem: (key) => {\n      delete storage[key];\n    },\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport attachClickActivityCollector from \"./attachClickActivityCollector.js\";\nimport configValidators from \"./configValidators.js\";\nimport createInjectClickedElementProperties from \"./createInjectClickedElementProperties.js\";\nimport createRecallAndInjectClickedElementProperties from \"./createRecallAndInjectClickedElementProperties.js\";\nimport createGetClickedElementProperties from \"./createGetClickedElementProperties.js\";\nimport createClickActivityStorage from \"./createClickActivityStorage.js\";\nimport createStorePageViewProperties from \"./createStorePageViewProperties.js\";\nimport validateClickCollectionConfig from \"./validateClickCollectionConfig.js\";\nimport getLinkName from \"./getLinkName.js\";\nimport getLinkRegion from \"./getLinkRegion.js\";\nimport getAbsoluteUrlFromAnchorElement from \"./utils/dom/getAbsoluteUrlFromAnchorElement.js\";\nimport findClickableElement from \"./utils/dom/findClickableElement.js\";\nimport determineLinkType from \"./utils/determineLinkType.js\";\nimport hasPageName from \"./utils/hasPageName.js\";\nimport createTransientStorage from \"./utils/createTransientStorage.js\";\nimport { injectStorage } from \"../../utils/index.js\";\n\nconst getClickedElementProperties = createGetClickedElementProperties({\n  window,\n  getLinkName,\n  getLinkRegion,\n  getAbsoluteUrlFromAnchorElement,\n  findClickableElement,\n  determineLinkType,\n});\n\nlet clickActivityStorage;\nconst initClickActivityStorage = (config) => {\n  if (!clickActivityStorage) {\n    const createNamespacedStorage = injectStorage(window);\n    const nameSpacedStorage = createNamespacedStorage(config.orgId || \"\");\n    // Use transient in-memory if sessionStorage is disabled\n    const transientStorage = createTransientStorage();\n    const storage = config.clickCollection.sessionStorageEnabled\n      ? nameSpacedStorage.session\n      : transientStorage;\n    clickActivityStorage = createClickActivityStorage({ storage });\n  }\n};\n\nconst createActivityCollector = ({\n  config,\n  eventManager,\n  handleError,\n  logger,\n}) => {\n  validateClickCollectionConfig(config, logger);\n\n  const clickCollection = config.clickCollection;\n  if (!clickActivityStorage) {\n    initClickActivityStorage(config);\n  }\n\n  const injectClickedElementProperties = createInjectClickedElementProperties({\n    config,\n    logger,\n    clickActivityStorage,\n    getClickedElementProperties,\n  });\n\n  const recallAndInjectClickedElementProperties =\n    createRecallAndInjectClickedElementProperties({\n      clickActivityStorage,\n    });\n\n  const storePageViewProperties = createStorePageViewProperties({\n    clickActivityStorage,\n  });\n\n  return {\n    lifecycle: {\n      onComponentsRegistered(tools) {\n        const { lifecycle } = tools;\n        attachClickActivityCollector({\n          eventManager,\n          lifecycle,\n          handleError,\n        });\n        // TODO: createScrollActivityCollector ...\n      },\n      onClick({ event, clickedElement }) {\n        injectClickedElementProperties({\n          event,\n          clickedElement,\n        });\n      },\n      onBeforeEvent({ event }) {\n        if (hasPageName(event)) {\n          if (clickCollection.eventGroupingEnabled) {\n            recallAndInjectClickedElementProperties(event);\n          }\n          storePageViewProperties(event, logger, clickActivityStorage);\n        }\n      },\n    },\n  };\n};\n\ncreateActivityCollector.namespace = \"ActivityCollector\";\ncreateActivityCollector.configValidators = configValidators;\ncreateActivityCollector.buildOnInstanceConfiguredExtraParams = ({\n  config,\n  logger,\n}) => {\n  if (!clickActivityStorage) {\n    initClickActivityStorage(config);\n  }\n  return {\n    getLinkDetails: (targetElement) => {\n      return getClickedElementProperties({\n        clickActivityStorage,\n        clickedElement: targetElement,\n        config,\n        logger,\n      }).properties;\n    },\n  };\n};\n\nexport default createActivityCollector;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { noop } from \"../../utils/index.js\";\n\nconst createResultLogMessage = (urlDestination, success) => {\n  return `URL destination ${success ? \"succeeded\" : \"failed\"}: ${\n    urlDestination.spec.url\n  }`;\n};\n\nexport default ({\n  fireReferrerHideableImage,\n  logger,\n  cookieJar,\n  isPageSsl,\n}) => {\n  const extraCookieOptions = isPageSsl\n    ? { sameSite: \"none\", secure: true }\n    : {};\n  const processCookies = (destinations) => {\n    const cookieDestinations = destinations.filter(\n      (dest) => dest.type === \"cookie\",\n    );\n\n    cookieDestinations.forEach((dest) => {\n      const { name, value, domain, ttlDays } = dest.spec;\n      cookieJar.set(name, value || \"\", {\n        domain: domain || \"\",\n        expires: ttlDays || 10, // days\n        ...extraCookieOptions,\n      });\n    });\n  };\n\n  const processUrls = (destinations) => {\n    const urlDestinations = destinations.filter((dest) => dest.type === \"url\");\n\n    return Promise.all(\n      urlDestinations.map((urlDestination) => {\n        return fireReferrerHideableImage(urlDestination.spec)\n          .then(() => {\n            logger.info(createResultLogMessage(urlDestination, true));\n          })\n          .catch(() => {\n            // We intentionally do not throw an error if destinations fail. We\n            // consider it a non-critical failure and therefore do not want it to\n            // reject the promise handed back to the customer.\n          });\n      }),\n    ).then(noop);\n  };\n\n  return (destinations) => {\n    processCookies(destinations);\n    return processUrls(destinations);\n  };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ processDestinations }) => {\n  const processPushDestinations = ({ response }) => {\n    const destinations = response.getPayloadsByType(\"activation:push\");\n    return processDestinations(destinations);\n  };\n\n  const retrievePullDestinations = ({ response }) => {\n    return {\n      destinations: response.getPayloadsByType(\"activation:pull\"),\n    };\n  };\n\n  return ({ response }) => {\n    return processPushDestinations({ response }).then(() =>\n      retrievePullDestinations({ response }),\n    );\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createLoggingCookieJar, cookieJar } from \"../../utils/index.js\";\nimport injectProcessDestinations from \"./injectProcessDestinations.js\";\nimport injectProcessResponse from \"./injectProcessResponse.js\";\n\nconst createAudiences = ({ logger, fireReferrerHideableImage }) => {\n  // we override the js-cookie converter to encode the cookie value similar on how it is in DIL (PDCL-10238)\n  const cookieJarWithEncoding = cookieJar.withConverter({\n    write: (value) => {\n      return encodeURIComponent(value);\n    },\n  });\n  const loggingCookieJar = createLoggingCookieJar({\n    logger,\n    cookieJar: cookieJarWithEncoding,\n  });\n\n  const processDestinations = injectProcessDestinations({\n    fireReferrerHideableImage,\n    logger,\n    cookieJar: loggingCookieJar,\n    isPageSsl: window.location.protocol === \"https:\",\n  });\n\n  const processResponse = injectProcessResponse({ processDestinations });\n\n  return {\n    lifecycle: {\n      onResponse: processResponse,\n    },\n    commands: {},\n  };\n};\n\ncreateAudiences.namespace = \"Audiences\";\n\nexport default createAudiences;\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { GENERAL } from \"../../constants/consentPurpose.js\";\n\nexport default ({\n  storedConsent,\n  taskQueue,\n  defaultConsent,\n  consent,\n  sendSetConsentRequest,\n  validateSetConsentOptions,\n  consentHashStore,\n  doesIdentityCookieExist,\n}) => {\n  const defaultConsentByPurpose = { [GENERAL]: defaultConsent };\n  let storedConsentByPurpose = storedConsent.read();\n\n  const identityCookieExists = doesIdentityCookieExist();\n  const consentCookieExists = storedConsentByPurpose[GENERAL] !== undefined;\n  if (!identityCookieExists || !consentCookieExists) {\n    consentHashStore.clear();\n  }\n  // If the identity cookie is gone, remove the consent cookie because the\n  // consent info is tied to the identity.\n  if (!identityCookieExists) {\n    storedConsent.clear();\n    storedConsentByPurpose = {};\n  }\n\n  consent.initializeConsent(defaultConsentByPurpose, storedConsentByPurpose);\n\n  const readCookieIfQueueEmpty = () => {\n    if (taskQueue.length === 0) {\n      const storedConsentObject = storedConsent.read();\n      // Only read cookies when there are no outstanding setConsent\n      // requests. This helps with race conditions.\n      if (storedConsentObject[GENERAL] !== undefined) {\n        consent.setConsent(storedConsentObject);\n      }\n    }\n  };\n\n  return {\n    commands: {\n      setConsent: {\n        optionsValidator: validateSetConsentOptions,\n        run: ({\n          consent: consentOptions,\n          identityMap,\n          edgeConfigOverrides,\n        }) => {\n          consent.suspend();\n          const consentHashes = consentHashStore.lookup(consentOptions);\n          return taskQueue\n            .addTask(() => {\n              if (consentHashes.isNew()) {\n                return sendSetConsentRequest({\n                  consentOptions,\n                  identityMap,\n                  edgeConfigOverrides,\n                });\n              }\n              return Promise.resolve();\n            })\n            .then(() => consentHashes.save())\n            .finally(readCookieIfQueueEmpty);\n        },\n      },\n    },\n    lifecycle: {\n      // Read the cookie here too because the consent cookie may change on any request\n      onResponse: readCookieIfQueueEmpty,\n      // Even when we get a failure HTTP status code, the consent cookie can\n      // still get updated. This could happen, for example, if the user is\n      // opted out in AudienceManager, but no consent cookie exists on the\n      // client. The request will be sent and the server will respond with a\n      // 403 Forbidden and a consent cookie.\n      onRequestFailure: readCookieIfQueueEmpty,\n    },\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { fnv1a32Hex, sortObjectKeysRecursively } from \"../../utils/index.js\";\n\nexport default (obj) =>\n  fnv1a32Hex(JSON.stringify(sortObjectKeysRecursively(obj)));\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport computeConsentHash from \"./computeConsentHash.js\";\n\nconst getKey = ({ standard, version }) => {\n  return `${standard}.${version}`;\n};\n\nexport default ({ storage }) => {\n  return {\n    clear() {\n      storage.clear();\n    },\n    lookup(consentObjects) {\n      const currentHashes = {};\n      const getCurrentHash = (consentObject) => {\n        const key = getKey(consentObject);\n        const { standard, version, ...rest } = consentObject;\n        if (!currentHashes[key]) {\n          currentHashes[key] = computeConsentHash(rest).toString();\n        }\n        return currentHashes[key];\n      };\n\n      return {\n        isNew() {\n          return consentObjects.some((consentObject) => {\n            const key = getKey(consentObject);\n            const previousHash = storage.getItem(key);\n            return (\n              previousHash === null ||\n              previousHash !== getCurrentHash(consentObject)\n            );\n          });\n        },\n        save() {\n          consentObjects.forEach((consentObject) => {\n            const key = getKey(consentObject);\n            storage.setItem(key, getCurrentHash(consentObject));\n          });\n        },\n      };\n    },\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { ConsentRequestPayload } from './types.js' */\n\nimport { createRequestPayload } from \"../../utils/request/index.js\";\n\n/**\n * @function\n *\n * @returns {ConsentRequestPayload}\n */\nexport default () => {\n  const content = {};\n\n  const requestPayload = createRequestPayload({\n    content,\n    addIdentity: (namespaceCode, identity) => {\n      content.identityMap = content.identityMap || {};\n      content.identityMap[namespaceCode] =\n        content.identityMap[namespaceCode] || [];\n      content.identityMap[namespaceCode].push(identity);\n    },\n    hasIdentity: (namespaceCode) => {\n      return (\n        (content.identityMap && content.identityMap[namespaceCode]) !==\n        undefined\n      );\n    },\n  });\n\n  /** @type {ConsentRequestPayload} */\n  const payload = {\n    ...requestPayload,\n    setConsent: (consent) => {\n      content.consent = consent;\n    },\n  };\n\n  return payload;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createRequest } from \"../../utils/request/index.js\";\n\nexport default ({ payload, datastreamIdOverride }) => {\n  return createRequest({\n    payload,\n    datastreamIdOverride,\n    getAction() {\n      return \"privacy/set-consent\";\n    },\n    getUseSendBeacon() {\n      return false;\n    },\n  });\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { getNamespacedCookieName } from \"../../utils/index.js\";\nimport { CONSENT } from \"../../constants/cookieNameKey.js\";\n\nexport default ({ parseConsentCookie, orgId, cookieJar }) => {\n  const consentCookieName = getNamespacedCookieName(orgId, CONSENT);\n\n  return {\n    read() {\n      const cookieValue = cookieJar.get(consentCookieName);\n      return cookieValue ? parseConsentCookie(cookieValue) : {};\n    },\n    clear() {\n      cookieJar.remove(consentCookieName);\n    },\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isObject } from \"../../utils/index.js\";\nimport { createRequestParams } from \"../../utils/request/index.js\";\n\nexport default ({\n    createConsentRequestPayload,\n    createConsentRequest,\n    sendEdgeNetworkRequest,\n    edgeConfigOverrides: globalConfigOverrides,\n  }) =>\n  ({\n    consentOptions,\n    identityMap,\n    edgeConfigOverrides: localConfigOverrides,\n  }) => {\n    const requestParams = createRequestParams({\n      payload: createConsentRequestPayload(),\n      globalConfigOverrides,\n      localConfigOverrides,\n    });\n    requestParams.payload.setConsent(consentOptions);\n    if (isObject(identityMap)) {\n      Object.keys(identityMap).forEach((key) => {\n        identityMap[key].forEach((identity) => {\n          requestParams.payload.addIdentity(key, identity);\n        });\n      });\n    }\n    const request = createConsentRequest(requestParams);\n    return sendEdgeNetworkRequest({\n      request,\n    }).then(() => {\n      // Don't let response data disseminate beyond this\n      // point unless necessary.\n    });\n  };\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Parses a consent cookie.\n * @param {string} cookieValue Must be in the format a=b;c=d\n * @returns {Object} An object where the keys are purpose names and the values\n * are the consent status for the purpose.\n */\nexport default (cookieValue) => {\n  const categoryPairs = cookieValue.split(\";\");\n  return categoryPairs.reduce((consentByPurpose, categoryPair) => {\n    const [name, value] = categoryPair.split(\"=\");\n    consentByPurpose[name] = value;\n    return consentByPurpose;\n  }, {});\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { objectOf, anything, arrayOf } from \"../../utils/validation/index.js\";\nimport {\n  validateIdentityMap,\n  validateConfigOverride,\n} from \"../../utils/index.js\";\n\nexport default objectOf({\n  consent: arrayOf(anything()).required().nonEmpty(),\n  identityMap: validateIdentityMap,\n  edgeConfigOverrides: validateConfigOverride,\n})\n  .noUnknownFields()\n  .required();\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { IN, OUT, PENDING } from \"../../constants/consentStatus.js\";\nimport { objectOf, enumOf } from \"../../utils/validation/index.js\";\n\nexport default objectOf({\n  defaultConsent: enumOf(IN, OUT, PENDING).default(IN),\n});\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  createTaskQueue,\n  cookieJar,\n  injectDoesIdentityCookieExist,\n  sanitizeOrgIdForCookieName,\n} from \"../../utils/index.js\";\nimport createComponent from \"./createComponent.js\";\nimport createConsentHashStore from \"./createConsentHashStore.js\";\nimport createConsentRequestPayload from \"./createConsentRequestPayload.js\";\nimport createConsentRequest from \"./createConsentRequest.js\";\nimport createStoredConsent from \"./createStoredConsent.js\";\nimport injectSendSetConsentRequest from \"./injectSendSetConsentRequest.js\";\nimport parseConsentCookie from \"./parseConsentCookie.js\";\nimport validateSetConsentOptions from \"./validateSetConsentOptions.js\";\nimport configValidators from \"./configValidators.js\";\n\nconst createConsent = ({\n  config,\n  consent,\n  sendEdgeNetworkRequest,\n  createNamespacedStorage,\n}) => {\n  const { orgId, defaultConsent } = config;\n  const storedConsent = createStoredConsent({\n    parseConsentCookie,\n    orgId,\n    cookieJar,\n  });\n  const taskQueue = createTaskQueue();\n  const sendSetConsentRequest = injectSendSetConsentRequest({\n    createConsentRequestPayload,\n    createConsentRequest,\n    sendEdgeNetworkRequest,\n    edgeConfigOverrides: config.edgeConfigOverrides,\n  });\n  const storage = createNamespacedStorage(\n    `${sanitizeOrgIdForCookieName(orgId)}.consentHashes.`,\n  );\n  const consentHashStore = createConsentHashStore({\n    storage: storage.persistent,\n  });\n\n  const doesIdentityCookieExist = injectDoesIdentityCookieExist({ orgId });\n\n  return createComponent({\n    storedConsent,\n    taskQueue,\n    defaultConsent,\n    consent,\n    sendSetConsentRequest,\n    validateSetConsentOptions,\n    consentHashStore,\n    doesIdentityCookieExist,\n  });\n};\n\ncreateConsent.namespace = \"Consent\";\ncreateConsent.configValidators = configValidators;\nexport default createConsent;\n","/*\nCopyright 20219 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { uuid } from \"../../utils/index.js\";\n\nexport default () => {\n  return {\n    eventMergeId: uuid(),\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ createEventMergeId }) => {\n  return {\n    commands: {\n      createEventMergeId: {\n        run: createEventMergeId,\n      },\n    },\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createEventMergeId from \"./createEventMergeId.js\";\nimport createComponent from \"./createComponent.js\";\n\nconst createEventMerge = () => {\n  return createComponent({ createEventMergeId });\n};\n\ncreateEventMerge.namespace = \"EventMerge\";\n\nexport default createEventMerge;\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default {\n  PAUSE: \"media.pauseStart\",\n  PLAY: \"media.play\",\n  BUFFER_START: \"media.bufferStart\",\n  AD_START: \"media.adStart\",\n  Ad_BREAK_START: \"media.adBreakStart\",\n  SESSION_END: \"media.sessionEnd\",\n  SESSION_START: \"media.sessionStart\",\n  SESSION_COMPLETE: \"media.sessionComplete\",\n  PING: \"media.ping\",\n  AD_BREAK_COMPLETE: \"media.adBreakComplete\",\n  AD_COMPLETE: \"media.adComplete\",\n  AD_SKIP: \"media.adSkip\",\n  BITRATE_CHANGE: \"media.bitrateChange\",\n  CHAPTER_COMPLETE: \"media.chapterComplete\",\n  CHAPTER_SKIP: \"media.chapterSkip\",\n  CHAPTER_START: \"media.chapterStart\",\n  ERROR: \"media.error\",\n  STATES_UPDATE: \"media.statesUpdate\",\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createRequest } from \"../../utils/request/index.js\";\n\nexport default ({ mediaRequestPayload, action }) => {\n  return createRequest({\n    payload: mediaRequestPayload,\n    edgeSubPath: \"/va\",\n    getAction() {\n      return action;\n    },\n    getUseSendBeacon() {\n      return false;\n    },\n  });\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport MediaEvents from \"./constants/eventTypes.js\";\nimport createMediaRequest from \"./createMediaRequest.js\";\nimport { toInteger } from \"../../utils/index.js\";\nimport { createDataCollectionRequestPayload } from \"../../utils/request/index.js\";\n\nexport default ({\n  config,\n  eventManager,\n  consent,\n  sendEdgeNetworkRequest,\n  setTimestamp,\n}) => {\n  return {\n    createMediaEvent({ options }) {\n      const event = eventManager.createEvent();\n      const { xdm } = options;\n      setTimestamp(xdm);\n      event.setUserXdm(xdm);\n\n      if (xdm.eventType === MediaEvents.AD_START) {\n        const { advertisingDetails } = options.xdm.mediaCollection;\n\n        event.mergeXdm({\n          mediaCollection: {\n            advertisingDetails: {\n              playerName:\n                advertisingDetails.playerName ||\n                config.streamingMedia.playerName,\n            },\n          },\n        });\n      }\n      return event;\n    },\n    createMediaSession(options) {\n      const { playerName, channel, appVersion } = config.streamingMedia;\n      const event = eventManager.createEvent();\n      const { sessionDetails } = options.xdm.mediaCollection;\n      event.setUserXdm(options.xdm);\n      event.mergeXdm({\n        eventType: MediaEvents.SESSION_START,\n        mediaCollection: {\n          sessionDetails: {\n            playerName: sessionDetails.playerName || playerName,\n            channel: sessionDetails.channel || channel,\n            appVersion: sessionDetails.appVersion || appVersion,\n          },\n        },\n      });\n\n      return event;\n    },\n    augmentMediaEvent({ event, playerId, getPlayerDetails, sessionID }) {\n      if (!playerId || !getPlayerDetails) {\n        return event;\n      }\n      const { playhead, qoeDataDetails } = getPlayerDetails({ playerId });\n\n      event.mergeXdm({\n        mediaCollection: {\n          playhead: toInteger(playhead),\n          qoeDataDetails,\n          sessionID,\n        },\n      });\n      return event;\n    },\n    trackMediaSession({ event, mediaOptions, edgeConfigOverrides }) {\n      const sendEventOptions = { mediaOptions, edgeConfigOverrides };\n\n      return eventManager.sendEvent(event, sendEventOptions);\n    },\n    trackMediaEvent({ event, action }) {\n      const mediaRequestPayload = createDataCollectionRequestPayload();\n      const request = createMediaRequest({\n        mediaRequestPayload,\n        action,\n      });\n      mediaRequestPayload.addEvent(event);\n      event.finalize();\n\n      return consent.awaitConsent().then(() => {\n        return sendEdgeNetworkRequest({ request }).then(() => {\n          return {};\n        });\n      });\n    },\n  };\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default {\n  MAIN: \"main\",\n  AD: \"ad\",\n  COMPLETED: \"completed\",\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport PlaybackState from \"./constants/playbackState.js\";\n\nexport default () => {\n  let mediaSessionCache;\n\n  const getSession = (playerId) => {\n    return mediaSessionCache[playerId] || {};\n  };\n\n  const savePing = ({ playerId, pingId, playbackState }) => {\n    if (!mediaSessionCache[playerId]) {\n      return;\n    }\n    if (mediaSessionCache[playerId].pingId) {\n      clearTimeout(mediaSessionCache[playerId].pingId);\n    }\n\n    mediaSessionCache[playerId].pingId = pingId;\n    mediaSessionCache[playerId].playbackState = playbackState;\n  };\n\n  const stopPing = ({ playerId }) => {\n    const sessionDetails = mediaSessionCache[playerId];\n\n    if (!sessionDetails) {\n      return;\n    }\n\n    clearTimeout(sessionDetails.pingId);\n\n    sessionDetails.pingId = null;\n    sessionDetails.playbackState = PlaybackState.COMPLETED;\n  };\n  const storeSession = ({ playerId, sessionDetails }) => {\n    if (mediaSessionCache === undefined) {\n      mediaSessionCache = {};\n    }\n\n    mediaSessionCache[playerId] = sessionDetails;\n  };\n\n  return {\n    getSession,\n    storeSession,\n    stopPing,\n    savePing,\n  };\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport MediaEvents from \"./constants/eventTypes.js\";\n\nconst getContentState = (eventType, sessionContentState) => {\n  if (\n    eventType === MediaEvents.AD_START ||\n    eventType === MediaEvents.Ad_BREAK_START ||\n    eventType === MediaEvents.AD_SKIP ||\n    eventType === MediaEvents.AD_COMPLETE\n  ) {\n    return \"ad\";\n  }\n  if (\n    eventType === MediaEvents.AD_BREAK_COMPLETE ||\n    eventType === MediaEvents.CHAPTER_COMPLETE ||\n    eventType === MediaEvents.CHAPTER_START ||\n    eventType === MediaEvents.CHAPTER_SKIP ||\n    eventType === MediaEvents.SESSION_START\n  ) {\n    return \"main\";\n  }\n  if (\n    eventType === MediaEvents.SESSION_END ||\n    eventType === MediaEvents.SESSION_COMPLETE\n  ) {\n    return \"completed\";\n  }\n  return sessionContentState;\n};\n\nexport default ({ mediaEventManager, mediaSessionCacheManager, config }) => {\n  const sendMediaEvent = (options) => {\n    const event = mediaEventManager.createMediaEvent({ options });\n    const { playerId, xdm } = options;\n    const { eventType } = xdm;\n    const action = eventType.split(\".\")[1];\n    const { getPlayerDetails, sessionPromise, playbackState } =\n      mediaSessionCacheManager.getSession(playerId);\n    return sessionPromise.then((result) => {\n      if (!result.sessionId) {\n        return Promise.reject(\n          new Error(\n            `Failed to trigger media event: ${eventType}. Session ID is not available for playerId: ${playerId}.`,\n          ),\n        );\n      }\n      mediaEventManager.augmentMediaEvent({\n        event,\n        eventType,\n        playerId,\n        getPlayerDetails,\n        sessionID: result.sessionId,\n      });\n\n      return mediaEventManager.trackMediaEvent({ event, action }).then(() => {\n        if (playerId) {\n          if (\n            eventType === MediaEvents.SESSION_COMPLETE ||\n            eventType === MediaEvents.SESSION_END\n          ) {\n            mediaSessionCacheManager.stopPing({ playerId });\n          } else {\n            const sessionPlaybackState = getContentState(\n              eventType,\n              playbackState,\n            );\n\n            if (sessionPlaybackState === \"completed\") {\n              return;\n            }\n            const interval =\n              sessionPlaybackState === \"ad\"\n                ? config.streamingMedia.adPingInterval\n                : config.streamingMedia.mainPingInterval;\n\n            const pingId = setTimeout(() => {\n              const pingOptions = {\n                playerId,\n                xdm: {\n                  eventType: MediaEvents.PING,\n                },\n              };\n              sendMediaEvent(pingOptions);\n            }, interval * 1000);\n            mediaSessionCacheManager.savePing({\n              playerId,\n              pingId,\n              playbackState: sessionPlaybackState,\n            });\n          }\n        }\n      });\n    });\n  };\n\n  return (options) => sendMediaEvent(options);\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport PlaybackState from \"./constants/playbackState.js\";\n\nexport default ({\n  config,\n  mediaEventManager,\n  mediaSessionCacheManager,\n  legacy = false,\n}) => {\n  return (options) => {\n    if (!config.streamingMedia) {\n      return Promise.reject(new Error(\"Streaming media is not configured.\"));\n    }\n\n    const { playerId, getPlayerDetails, edgeConfigOverrides } = options;\n    const event = mediaEventManager.createMediaSession(options);\n\n    mediaEventManager.augmentMediaEvent({\n      event,\n      playerId,\n      getPlayerDetails,\n    });\n\n    const sessionPromise = mediaEventManager.trackMediaSession({\n      event,\n      mediaOptions: {\n        playerId,\n        getPlayerDetails,\n        legacy,\n      },\n      edgeConfigOverrides,\n    });\n\n    mediaSessionCacheManager.storeSession({\n      playerId,\n      sessionDetails: {\n        sessionPromise,\n        getPlayerDetails,\n        playbackState: PlaybackState.MAIN,\n      },\n    });\n\n    return sessionPromise;\n  };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isString from \"./isString.js\";\n\n/**\n * Returns whether a string value is blank. Also returns true if the value is not a string.\n * @param {*} value\n * @returns {boolean}\n */\nexport default (value) => (isString(value) ? !value.trim() : true);\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport isBlankString from \"../../utils/isBlankString.js\";\nimport MediaEvents from \"./constants/eventTypes.js\";\nimport { isNonEmptyArray } from \"../../utils/index.js\";\nimport PlaybackState from \"./constants/playbackState.js\";\n\nexport default ({ mediaSessionCacheManager, config, trackMediaEvent }) => {\n  return ({ response, playerId, getPlayerDetails }) => {\n    const mediaPayload = response.getPayloadsByType(\n      \"media-analytics:new-session\",\n    );\n    if (isNonEmptyArray(mediaPayload)) {\n      const { sessionId } = mediaPayload[0];\n      if (isBlankString(sessionId)) {\n        return {};\n      }\n\n      if (!playerId || !getPlayerDetails) {\n        return { sessionId };\n      }\n\n      const pingId = setTimeout(() => {\n        trackMediaEvent({\n          playerId,\n          xdm: {\n            eventType: MediaEvents.PING,\n          },\n        });\n      }, config.streamingMedia.mainPingInterval * 1000);\n\n      mediaSessionCacheManager.savePing({\n        playerId,\n        pingId,\n        playbackState: PlaybackState.MAIN,\n      });\n\n      return { sessionId };\n    }\n    return {};\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const MEDIA_TYPE = {\n  Video: \"video\",\n  Audio: \"audio\",\n};\nexport const STREAM_TYPE = {\n  VOD: \"vod\",\n  Live: \"live\",\n  Linear: \"linear\",\n  Podcast: \"podcast\",\n  Audiobook: \"audiobook\",\n  AOD: \"aod\",\n};\nexport const PLAYER_STATE = {\n  FullScreen: \"fullScreen\",\n  ClosedCaption: \"closedCaptioning\",\n  Mute: \"mute\",\n  PictureInPicture: \"pictureInPicture\",\n  InFocus: \"inFocus\",\n};\n\nexport const EVENT = {\n  /**\n   * Constant defining event type for AdBreak start\n   */\n  AdBreakStart: \"adBreakStart\",\n  /**\n   * Constant defining event type for AdBreak complete\n   */\n  AdBreakComplete: \"adBreakComplete\",\n  /**\n   * Constant defining event type for Ad start\n   */\n  AdStart: \"adStart\",\n  /**\n   * Constant defining event type for Ad complete\n   */\n  AdComplete: \"adComplete\",\n  /**\n   * Constant defining event type for Ad skip\n   */\n  AdSkip: \"adSkip\",\n  /**\n   * Constant defining event type for Chapter start\n   */\n  ChapterStart: \"chapterStart\",\n  /**\n   * Constant defining event type for Chapter complete\n   */\n  ChapterComplete: \"chapterComplete\",\n  /**\n   * Constant defining event type for Chapter skip\n   */\n  ChapterSkip: \"chapterSkip\",\n  /**\n   * Constant defining event type for Seek start\n   */\n  SeekStart: \"seekStart\",\n  /**\n   * Constant defining event type for Seek complete\n   */\n  SeekComplete: \"seekComplete\",\n  /**\n   * Constant defining event type for Buffer start\n   */\n  BufferStart: \"bufferStart\",\n  /**\n   * Constant defining event type for Buffer complete\n   */\n  BufferComplete: \"bufferComplete\",\n  /**\n   * Constant defining event type for change in Bitrate\n   */\n  BitrateChange: \"bitrateChange\",\n  /**\n   * Constant defining event type for Custom State Start\n   */\n  StateStart: \"stateStart\",\n  /**\n   * Constant defining event type for Custom State End\n   */\n  StateEnd: \"stateEnd\",\n};\nexport const MEDIA_EVENTS_INTERNAL = {\n  SessionStart: \"sessionStart\",\n  SessionEnd: \"sessionEnd\",\n  SessionComplete: \"sessionComplete\",\n  Play: \"play\",\n  Pause: \"pauseStart\",\n  Error: \"error\",\n  StateUpdate: \"statesUpdate\",\n};\n\nexport const MEDIA_OBJECT_KEYS = {\n  MediaResumed: \"media.resumed\",\n  GranularAdTracking: \"media.granularadtracking\",\n};\n\nexport const VIDEO_METADATA_KEYS = {\n  Show: \"a.media.show\",\n  Season: \"a.media.season\",\n  Episode: \"a.media.episode\",\n  AssetId: \"a.media.asset\",\n  Genre: \"a.media.genre\",\n  FirstAirDate: \"a.media.airDate\",\n  FirstDigitalDate: \"a.media.digitalDate\",\n  Rating: \"a.media.rating\",\n  Originator: \"a.media.originator\",\n  Network: \"a.media.network\",\n  ShowType: \"a.media.type\",\n  AdLoad: \"a.media.adLoad\",\n  MVPD: \"a.media.pass.mvpd\",\n  Authorized: \"a.media.pass.auth\",\n  DayPart: \"a.media.dayPart\",\n  Feed: \"a.media.feed\",\n  StreamFormat: \"a.media.format\",\n};\n\nexport const AUDIO_METADATA_KEYS = {\n  Artist: \"a.media.artist\",\n  Album: \"a.media.album\",\n  Label: \"a.media.label\",\n  Author: \"a.media.author\",\n  Station: \"a.media.station\",\n  Publisher: \"a.media.publisher\",\n};\n\nexport const AD_METADATA_KEYS = {\n  Advertiser: \"a.media.ad.advertiser\",\n  CampaignId: \"a.media.ad.campaign\",\n  CreativeId: \"a.media.ad.creative\",\n  PlacementId: \"a.media.ad.placement\",\n  SiteId: \"a.media.ad.site\",\n  CreativeUrl: \"a.media.ad.creativeURL\",\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { noop, uuid } from \"../../utils/index.js\";\nimport {\n  AD_METADATA_KEYS as AdMetadataKeys,\n  AUDIO_METADATA_KEYS as AudioMetadataKeys,\n  EVENT as Event,\n  MEDIA_OBJECT_KEYS as MediaObjectKey,\n  MEDIA_TYPE as MediaType,\n  PLAYER_STATE as PlayerState,\n  STREAM_TYPE as StreamType,\n  VIDEO_METADATA_KEYS as VideoMetadataKeys,\n} from \"./constants/constants.js\";\n\nexport default ({\n  trackMediaEvent,\n  trackMediaSession,\n  mediaResponseHandler,\n  logger,\n  createMediaHelper,\n  createGetInstance,\n  config,\n}) => {\n  return {\n    lifecycle: {\n      onBeforeEvent({ mediaOptions, onResponse = noop }) {\n        if (!mediaOptions) {\n          return;\n        }\n        const { legacy, playerId, getPlayerDetails } = mediaOptions;\n\n        if (!legacy) {\n          return;\n        }\n        onResponse(({ response }) => {\n          return mediaResponseHandler({ playerId, getPlayerDetails, response });\n        });\n      },\n    },\n    commands: {\n      getMediaAnalyticsTracker: {\n        run: () => {\n          if (!config.streamingMedia) {\n            return Promise.reject(\n              new Error(\"Streaming media is not configured.\"),\n            );\n          }\n          logger.info(\"Streaming media is configured in legacy mode.\");\n          const mediaAnalyticsHelper = createMediaHelper({ logger });\n\n          return Promise.resolve({\n            getInstance: () => {\n              return createGetInstance({\n                logger,\n                trackMediaEvent,\n                trackMediaSession,\n                uuid,\n              });\n            },\n            Event,\n            MediaType,\n            PlayerState,\n            StreamType,\n            MediaObjectKey,\n            VideoMetadataKeys,\n            AudioMetadataKeys,\n            AdMetadataKeys,\n            ...mediaAnalyticsHelper,\n          });\n        },\n      },\n    },\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { number, objectOf, string } from \"../../utils/validation/index.js\";\n\nexport default ({ logger }) => {\n  const createMediaObject = (\n    friendlyName,\n    name,\n    length,\n    contentType,\n    streamType,\n  ) => {\n    const mediaObject = {\n      friendlyName,\n      name,\n      length,\n      streamType,\n      contentType,\n    };\n\n    const validate = objectOf({\n      friendlyName: string().nonEmpty(),\n      name: string().nonEmpty(),\n      length: number().required(),\n      streamType: string().nonEmpty(),\n      contentType: string().nonEmpty(),\n    });\n\n    try {\n      const result = validate(mediaObject);\n      const sessionDetails = {\n        name: result.name,\n        friendlyName: result.friendlyName,\n        length: Math.round(result.length),\n        streamType: result.streamType,\n        contentType: result.contentType,\n      };\n      return { sessionDetails };\n    } catch (error) {\n      logger.warn(`An error occurred while creating the Media Object.`, error);\n      return {};\n    }\n  };\n\n  const createAdBreakObject = (name, position, startTime) => {\n    const adBreakObject = {\n      friendlyName: name,\n      offset: position,\n      index: startTime,\n    };\n    const validator = objectOf({\n      friendlyName: string().nonEmpty(),\n      offset: number(),\n      index: number(),\n    });\n\n    try {\n      const result = validator(adBreakObject);\n      const advertisingPodDetails = {\n        friendlyName: result.friendlyName,\n        offset: result.offset,\n        index: result.index,\n      };\n\n      return { advertisingPodDetails };\n    } catch (error) {\n      logger.warn(\n        `An error occurred while creating the Ad Break Object.`,\n        error,\n      );\n      return {};\n    }\n  };\n  const createAdObject = (name, id, position, length) => {\n    const adObject = {\n      friendlyName: name,\n      name: id,\n      podPosition: position,\n      length,\n    };\n\n    const validator = objectOf({\n      friendlyName: string().nonEmpty(),\n      name: string().nonEmpty(),\n      podPosition: number(),\n      length: number(),\n    });\n\n    try {\n      const result = validator(adObject);\n      const advertisingDetails = {\n        friendlyName: result.friendlyName,\n        name: result.name,\n        podPosition: result.podPosition,\n        length: result.length,\n      };\n\n      return { advertisingDetails };\n    } catch (error) {\n      logger.warn(\n        `An error occurred while creating the Advertising Object.`,\n        error,\n      );\n      return {};\n    }\n  };\n  const createChapterObject = (name, position, length, startTime) => {\n    const chapterDetailsObject = {\n      friendlyName: name,\n      offset: position,\n      length,\n      index: startTime,\n    };\n\n    const validator = objectOf({\n      friendlyName: string().nonEmpty(),\n      offset: number(),\n      length: number(),\n      index: number(),\n    });\n\n    try {\n      const result = validator(chapterDetailsObject);\n      const chapterDetails = {\n        friendlyName: result.friendlyName,\n        offset: result.offset,\n        index: result.index,\n        length: result.length,\n      };\n\n      return { chapterDetails };\n    } catch (error) {\n      logger.warn(\n        `An error occurred while creating the Chapter Object.`,\n        error,\n      );\n      return {};\n    }\n  };\n  const createStateObject = (stateName) => {\n    const STATE_NAME_REGEX = /^[a-zA-Z0-9_]{1,64}$/;\n\n    const validator = string().matches(\n      STATE_NAME_REGEX,\n      \"This is not a valid state name.\",\n    );\n\n    try {\n      const result = validator(stateName);\n\n      return {\n        name: result,\n      };\n    } catch (error) {\n      logger.warn(`An error occurred while creating the State Object.`, error);\n      return {};\n    }\n  };\n  const createQoEObject = (bitrate, droppedFrames, fps, startupTime) => {\n    const qoeObject = {\n      bitrate,\n      droppedFrames,\n      fps,\n      startupTime,\n    };\n\n    const validator = objectOf({\n      bitrate: number(),\n      droppedFrames: number(),\n      fps: number(),\n      startupTime: number(),\n    });\n\n    try {\n      const result = validator(qoeObject);\n\n      return {\n        bitrate: result.bitrate,\n        droppedFrames: result.droppedFrames,\n        framesPerSecond: result.fps,\n        timeToStart: result.startupTime,\n      };\n    } catch (error) {\n      logger.warn(`An error occurred while creating the QOE Object.`, error);\n      return {};\n    }\n  };\n\n  return {\n    createMediaObject,\n    createAdBreakObject,\n    createAdObject,\n    createChapterObject,\n    createStateObject,\n    createQoEObject,\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const mediaToXdmKeys = {\n  \"a.media.show\": \"show\",\n  \"a.media.season\": \"season\",\n  \"a.media.episode\": \"episode\",\n  \"a.media.asset\": \"assetID\",\n  \"a.media.genre\": \"genre\",\n  \"a.media.airDate\": \"firstAirDate\",\n  \"a.media.digitalDate\": \"firstDigitalDate\",\n  \"a.media.rating\": \"rating\",\n  \"a.media.originator\": \"originator\",\n  \"a.media.network\": \"network\",\n  \"a.media.type\": \"showType\",\n  \"a.media.adLoad\": \"adLoad\",\n  \"a.media.pass.mvpd\": \"mvpd\",\n  \"a.media.pass.auth\": \"authorized\",\n  \"a.media.dayPart\": \"dayPart\",\n  \"a.media.feed\": \"feed\",\n  \"a.media.format\": \"streamFormat\",\n  \"a.media.artist\": \"artist\",\n  \"a.media.album\": \"album\",\n  \"a.media.label\": \"label\",\n  \"a.media.author\": \"author\",\n  \"a.media.station\": \"station\",\n  \"a.media.publisher\": \"publisher\",\n  \"media.resumed\": \"hasResume\",\n};\n\nexport const adsToXdmKeys = {\n  \"a.media.ad.advertiser\": \"advertiser\",\n  \"a.media.ad.campaign\": \"campaignID\",\n  \"a.media.ad.creative\": \"creativeID\",\n  \"a.media.ad.placement\": \"placementID\",\n  \"a.media.ad.site\": \"siteID\",\n  \"a.media.ad.creativeURL\": \"creativeURL\",\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { EVENT, MEDIA_EVENTS_INTERNAL } from \"./constants/constants.js\";\nimport {\n  isEmptyObject,\n  isNil,\n  isNonEmptyArray,\n  isNumber,\n} from \"../../utils/index.js\";\nimport {\n  adsToXdmKeys,\n  mediaToXdmKeys,\n} from \"./constants/mediaKeysToXdmConverter.js\";\n\nexport default ({ logger, trackMediaSession, trackMediaEvent, uuid }) => {\n  let trackerState = null;\n  const instantiateTracker = () => {\n    trackerState = {\n      qoe: null,\n      lastPlayhead: 0,\n      playerId: uuid(),\n    };\n  };\n  const getEventType = ({ eventType }) => {\n    if (\n      eventType === EVENT.BufferComplete ||\n      eventType === EVENT.SeekComplete\n    ) {\n      return MEDIA_EVENTS_INTERNAL.Play;\n    }\n    if (eventType === EVENT.StateStart || eventType === EVENT.StateEnd) {\n      return MEDIA_EVENTS_INTERNAL.StateUpdate;\n    }\n    if (eventType === EVENT.SeekStart) {\n      return MEDIA_EVENTS_INTERNAL.Pause;\n    }\n    return eventType;\n  };\n  const createXdmObject = ({\n    eventType,\n    mediaDetails = {},\n    contextData = [],\n  }) => {\n    const action = getEventType({ eventType });\n\n    if (eventType === EVENT.StateStart) {\n      const xdm = {\n        eventType: `media.${action}`,\n        mediaCollection: {\n          statesStart: [mediaDetails],\n        },\n      };\n      return xdm;\n    }\n    if (eventType === EVENT.StateEnd) {\n      const xdm = {\n        eventType: `media.${action}`,\n        mediaCollection: {\n          statesEnd: [mediaDetails],\n        },\n      };\n      return xdm;\n    }\n    const xdm = {\n      eventType: `media.${action}`,\n      mediaCollection: {\n        ...mediaDetails,\n      },\n    };\n\n    const customMetadata = [];\n    Object.keys(contextData).forEach((key) => {\n      if (mediaToXdmKeys[key]) {\n        xdm.mediaCollection.sessionDetails[mediaToXdmKeys[key]] =\n          contextData[key];\n      } else if (adsToXdmKeys[key]) {\n        xdm.mediaCollection.advertisingDetails[adsToXdmKeys[key]] =\n          contextData[key];\n      } else {\n        customMetadata.push({\n          name: key,\n          value: contextData[key],\n        });\n      }\n    });\n    if (isNonEmptyArray(customMetadata)) {\n      xdm.mediaCollection.customMetadata = customMetadata;\n    }\n\n    return xdm;\n  };\n\n  return {\n    trackSessionStart: (mediaObject, contextData = {}) => {\n      if (isNil(mediaObject) || isEmptyObject(mediaObject)) {\n        logger.warn(\"Invalid media object\");\n        return {};\n      }\n      if (trackerState === null) {\n        logger.warn(\n          \"The Media Session was completed. Restarting a new session.\",\n        );\n        instantiateTracker();\n      }\n      const xdm = createXdmObject({\n        eventType: MEDIA_EVENTS_INTERNAL.SessionStart,\n        mediaDetails: mediaObject,\n        contextData,\n      });\n\n      return trackMediaSession({\n        playerId: trackerState.playerId,\n        getPlayerDetails: () => {\n          return {\n            playhead: trackerState.lastPlayhead,\n            qoeDataDetails: trackerState.qoe,\n          };\n        },\n        xdm,\n      });\n    },\n    trackPlay: () => {\n      if (trackerState === null) {\n        logger.warn(\"The Media Session was completed.\");\n        return {};\n      }\n\n      const xdm = createXdmObject({ eventType: MEDIA_EVENTS_INTERNAL.Play });\n\n      return trackMediaEvent({ playerId: trackerState.playerId, xdm });\n    },\n    trackPause: () => {\n      if (trackerState === null) {\n        logger.warn(\"The Media Session was completed.\");\n        return {};\n      }\n\n      const xdm = createXdmObject({ eventType: MEDIA_EVENTS_INTERNAL.Pause });\n\n      return trackMediaEvent({ playerId: trackerState.playerId, xdm });\n    },\n    trackSessionEnd: () => {\n      if (trackerState === null) {\n        logger.warn(\"The Media Session was completed.\");\n        return {};\n      }\n\n      const xdm = createXdmObject({\n        eventType: MEDIA_EVENTS_INTERNAL.SessionEnd,\n      });\n\n      return trackMediaEvent({ playerId: trackerState.playerId, xdm });\n    },\n    trackComplete: () => {\n      if (trackerState === null) {\n        logger.warn(\"The Media Session was completed.\");\n        return {};\n      }\n\n      const xdm = createXdmObject({\n        eventType: MEDIA_EVENTS_INTERNAL.SessionComplete,\n      });\n\n      return trackMediaEvent({ playerId: trackerState.playerId, xdm });\n    },\n    trackError: (errorId) => {\n      logger.warn(`trackError(${errorId})`);\n      if (trackerState === null) {\n        logger.warn(\"The Media Session was completed.\");\n        return {};\n      }\n\n      const errorDetails = {\n        name: errorId,\n        source: \"player\",\n      };\n\n      const xdm = createXdmObject({\n        eventType: MEDIA_EVENTS_INTERNAL.Error,\n        mediaDetails: { errorDetails },\n      });\n      return trackMediaEvent({ playerId: trackerState.playerId, xdm });\n    },\n    trackEvent: (eventType, info, context) => {\n      if (isEmptyObject(info)) {\n        logger.warn(\"Invalid media object.\");\n        return {};\n      }\n      if (trackerState === null) {\n        logger.warn(\"The Media Session was completed.\");\n        return {};\n      }\n      if (!Object.values(EVENT).includes(eventType)) {\n        logger.warn(\"Invalid event type\");\n        return {};\n      }\n      const xdm = createXdmObject({\n        eventType,\n        mediaDetails: info,\n        contextData: context,\n      });\n\n      return trackMediaEvent({ playerId: trackerState.playerId, xdm });\n    },\n    updatePlayhead: (time) => {\n      if (trackerState === null) {\n        logger.warn(\"The Media Session was completed.\");\n        return;\n      }\n\n      if (isNumber(time)) {\n        trackerState.lastPlayhead = parseInt(time, 10);\n      }\n    },\n    updateQoEObject: (qoeObject) => {\n      if (trackerState === null) {\n        logger.warn(\"The Media Session was completed.\");\n        return;\n      }\n\n      if (!qoeObject) {\n        return;\n      }\n      trackerState.qoe = qoeObject;\n    },\n    destroy: () => {\n      logger.warn(\"Destroy called, destroying the tracker.\");\n      trackerState = null;\n    },\n  };\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n/* eslint-disable import/no-restricted-paths */\n\nimport createMediaEventManager from \"../StreamingMedia/createMediaEventManager.js\";\nimport createMediaSessionCacheManager from \"../StreamingMedia/createMediaSessionCacheManager.js\";\nimport createTrackMediaEvent from \"../StreamingMedia/createTrackMediaEvent.js\";\nimport createTrackMediaSession from \"../StreamingMedia/createTrackMediaSession.js\";\nimport createMediaResponseHandler from \"../StreamingMedia/createMediaResponseHandler.js\";\nimport createMediaAnalyticsBridgeComponent from \"./createMediaAnalyticsBridgeComponent.js\";\nimport createMediaHelper from \"./createMediaHelper.js\";\nimport createGetInstance from \"./createGetInstance.js\";\nimport injectTimestamp from \"../Context/injectTimestamp.js\";\n\nconst createMediaAnalyticsBridge = ({\n  eventManager,\n  sendEdgeNetworkRequest,\n  config,\n  logger,\n  consent,\n}) => {\n  const mediaSessionCacheManager = createMediaSessionCacheManager({ config });\n\n  const mediaEventManager = createMediaEventManager({\n    sendEdgeNetworkRequest,\n    config,\n    consent,\n    eventManager,\n    setTimestamp: injectTimestamp(() => new Date()),\n  });\n\n  const trackMediaEvent = createTrackMediaEvent({\n    mediaSessionCacheManager,\n    mediaEventManager,\n    config,\n  });\n  const trackMediaSession = createTrackMediaSession({\n    config,\n    mediaEventManager,\n    mediaSessionCacheManager,\n    legacy: true,\n  });\n  const mediaResponseHandler = createMediaResponseHandler({\n    mediaSessionCacheManager,\n    config,\n    trackMediaEvent,\n  });\n\n  return createMediaAnalyticsBridgeComponent({\n    mediaResponseHandler,\n    trackMediaSession,\n    trackMediaEvent,\n    createMediaHelper,\n    createGetInstance,\n    logger,\n    config,\n  });\n};\n\ncreateMediaAnalyticsBridge.namespace = \"Legacy Media Analytics\";\n\nexport default createMediaAnalyticsBridge;\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const WEB = \"web\";\nexport const WEBAPP = \"webapp\";\nexport const SURFACE_TYPE_DELIMITER = \"://\";\nexport const FRAGMENT_DELIMITER = \"#\";\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  WEB,\n  WEBAPP,\n  SURFACE_TYPE_DELIMITER,\n  FRAGMENT_DELIMITER,\n} from \"../constants/surface.js\";\nimport { isNil, isNonEmptyString } from \"../../../utils/index.js\";\n\nconst SURFACE_REGEX = /^(\\w+):\\/\\/([^/#]+)(\\/[^#]*)?(#.*)?$/;\nconst AUTHORITY_REGEX =\n  /^(?:.*@)?(?:[a-z\\d\\u00a1-\\uffff.-]+|\\[[a-f\\d:]+])(?::\\d+)?$/;\nconst PATH_REGEX = /^\\/(?:[/\\w\\u00a1-\\uffff-.~]|%[a-fA-F\\d]{2})*$/;\nconst FRAGMENT_REGEX = /^#(?:[/\\w\\u00a1-\\uffff-.~]|%[a-fA-F\\d]{2})+$/;\n\nconst normalizePath = (path = \"/\") => {\n  let end = path.length;\n  while (end > 0 && \"/\".indexOf(path.charAt(end - 1)) !== -1) {\n    end -= 1;\n  }\n  return path.substring(0, end) || \"/\";\n};\n\nconst getSurfaceType = (surfaceTypeMatch) =>\n  isNonEmptyString(surfaceTypeMatch) ? surfaceTypeMatch.toLowerCase() : \"\";\n\nconst getAuthority = (authorityMatch) =>\n  isNonEmptyString(authorityMatch) ? authorityMatch.toLowerCase() : \"\";\n\nconst getPath = (pathMatch) =>\n  isNonEmptyString(pathMatch) ? normalizePath(pathMatch) : \"/\";\n\nconst parseSurface = (surfaceString) => {\n  const matched = surfaceString.match(SURFACE_REGEX);\n  return matched\n    ? {\n        surfaceType: getSurfaceType(matched[1]),\n        authority: getAuthority(matched[2]),\n        path: getPath(matched[3]),\n        fragment: matched[4],\n      }\n    : null;\n};\n\nconst stringifySurface = (surface) =>\n  `${surface.surfaceType}${SURFACE_TYPE_DELIMITER}${\n    surface.authority\n  }${surface.path || \"\"}${surface.fragment || \"\"}`;\n\nexport const buildPageSurface = (getPageLocation) => {\n  const location = getPageLocation();\n  const host = location.host.toLowerCase();\n  const path = location.pathname;\n  return WEB + SURFACE_TYPE_DELIMITER + host + normalizePath(path);\n};\n\nconst expandFragmentSurface = (surface, getPageLocation) =>\n  surface.startsWith(FRAGMENT_DELIMITER)\n    ? buildPageSurface(getPageLocation) + surface\n    : surface;\n\nconst validateSurface = (surface, getPageLocation, logger) => {\n  const invalidateSurface = (validationError) => {\n    logger.warn(validationError);\n    return null;\n  };\n\n  if (!isNonEmptyString(surface)) {\n    return invalidateSurface(`Invalid surface: ${surface}`);\n  }\n  const expanded = expandFragmentSurface(surface, getPageLocation);\n  const parsed = parseSurface(expanded);\n  if (parsed === null) {\n    return invalidateSurface(`Invalid surface: ${surface}`);\n  }\n  if (![WEB, WEBAPP].includes(parsed.surfaceType)) {\n    return invalidateSurface(\n      `Unsupported surface type ${parsed.surfaceType} in surface: ${surface}`,\n    );\n  }\n  if (!parsed.authority || !AUTHORITY_REGEX.test(parsed.authority)) {\n    return invalidateSurface(\n      `Invalid authority ${parsed.authority} in surface: ${surface}`,\n    );\n  }\n  if (parsed.path && !PATH_REGEX.test(parsed.path)) {\n    return invalidateSurface(\n      `Invalid path ${parsed.path} in surface: ${surface}`,\n    );\n  }\n  if (parsed.fragment && !FRAGMENT_REGEX.test(parsed.fragment)) {\n    return invalidateSurface(\n      `Invalid fragment ${parsed.fragment} in surface: ${surface}`,\n    );\n  }\n  return parsed;\n};\n\nexport const isPageWideSurface = (scope) =>\n  !!scope &&\n  scope.indexOf(WEB + SURFACE_TYPE_DELIMITER) === 0 &&\n  scope.indexOf(FRAGMENT_DELIMITER) === -1;\n\n// eslint-disable-next-line default-param-last\nexport const normalizeSurfaces = (surfaces = [], getPageLocation, logger) =>\n  surfaces\n    .map((surface) => validateSurface(surface, getPageLocation, logger))\n    .filter((surface) => !isNil(surface))\n    .map(stringifySurface);\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const DEFAULT_CONTENT_ITEM =\n  \"https://ns.adobe.com/personalization/default-content-item\";\nexport const DOM_ACTION = \"https://ns.adobe.com/personalization/dom-action\";\nexport const HTML_CONTENT_ITEM =\n  \"https://ns.adobe.com/personalization/html-content-item\";\nexport const JSON_CONTENT_ITEM =\n  \"https://ns.adobe.com/personalization/json-content-item\";\nexport const RULESET_ITEM = \"https://ns.adobe.com/personalization/ruleset-item\";\nexport const REDIRECT_ITEM =\n  \"https://ns.adobe.com/personalization/redirect-item\";\n\nexport const MESSAGE_IN_APP =\n  \"https://ns.adobe.com/personalization/message/in-app\";\nexport const MESSAGE_CONTENT_CARD =\n  \"https://ns.adobe.com/personalization/message/content-card\";\nexport const MESSAGE_NATIVE_ALERT =\n  \"https://ns.adobe.com/personalization/message/native-alert\";\n\nexport const MEASUREMENT_SCHEMA =\n  \"https://ns.adobe.com/personalization/measurement\";\n\nexport const EVENT_HISTORY_OPERATION =\n  \"https://ns.adobe.com/personalization/eventHistoryOperation\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isNonEmptyString, isNonEmptyArray } from \"../../utils/index.js\";\nimport { buildPageSurface, normalizeSurfaces } from \"./utils/surfaceUtils.js\";\nimport PAGE_WIDE_SCOPE from \"../../constants/pageWideScope.js\";\nimport {\n  DEFAULT_CONTENT_ITEM,\n  DOM_ACTION,\n  HTML_CONTENT_ITEM,\n  MESSAGE_IN_APP,\n  JSON_CONTENT_ITEM,\n  REDIRECT_ITEM,\n  RULESET_ITEM,\n  MESSAGE_CONTENT_CARD,\n} from \"../../constants/schema.js\";\n\nconst addPageWideScope = (scopes) => {\n  if (!scopes.includes(PAGE_WIDE_SCOPE)) {\n    scopes.push(PAGE_WIDE_SCOPE);\n  }\n};\n\nconst addPageSurface = (surfaces, getPageLocation) => {\n  const pageSurface = buildPageSurface(getPageLocation);\n  if (!surfaces.includes(pageSurface)) {\n    surfaces.push(pageSurface);\n  }\n};\n\nconst dedupe = (array) =>\n  array.filter((item, pos) => array.indexOf(item) === pos);\n\nexport default ({\n  getPageLocation,\n  renderDecisions,\n  decisionScopes,\n  personalization,\n  event,\n  isCacheInitialized,\n  logger,\n}) => {\n  const viewName = event.getViewName();\n  return {\n    isRenderDecisions() {\n      return renderDecisions;\n    },\n    isSendDisplayEvent() {\n      return !!personalization.sendDisplayEvent;\n    },\n    shouldIncludeRenderedPropositions() {\n      return !!personalization.includeRenderedPropositions;\n    },\n    getViewName() {\n      return viewName;\n    },\n    hasScopes() {\n      return (\n        decisionScopes.length > 0 ||\n        isNonEmptyArray(personalization.decisionScopes)\n      );\n    },\n    hasSurfaces() {\n      return isNonEmptyArray(personalization.surfaces);\n    },\n    hasViewName() {\n      return isNonEmptyString(viewName);\n    },\n    createQueryDetails() {\n      const scopes = [...decisionScopes];\n      if (isNonEmptyArray(personalization.decisionScopes)) {\n        scopes.push(...personalization.decisionScopes);\n      }\n      const eventSurfaces = normalizeSurfaces(\n        personalization.surfaces,\n        getPageLocation,\n        logger,\n      );\n\n      if (this.shouldRequestDefaultPersonalization()) {\n        addPageWideScope(scopes);\n        addPageSurface(eventSurfaces, getPageLocation);\n      }\n\n      const schemas = [\n        DEFAULT_CONTENT_ITEM,\n        HTML_CONTENT_ITEM,\n        JSON_CONTENT_ITEM,\n        REDIRECT_ITEM,\n        RULESET_ITEM,\n        MESSAGE_IN_APP,\n        MESSAGE_CONTENT_CARD,\n      ];\n\n      if (scopes.includes(PAGE_WIDE_SCOPE)) {\n        schemas.push(DOM_ACTION);\n      }\n\n      return {\n        schemas,\n        decisionScopes: dedupe(scopes),\n        surfaces: dedupe(eventSurfaces),\n      };\n    },\n    isCacheInitialized() {\n      return isCacheInitialized;\n    },\n    shouldFetchData() {\n      return (\n        this.hasScopes() ||\n        this.hasSurfaces() ||\n        this.shouldRequestDefaultPersonalization()\n      );\n    },\n    shouldUseCachedData() {\n      return this.hasViewName() && !this.shouldFetchData();\n    },\n    shouldRequestDefaultPersonalization() {\n      return (\n        personalization.defaultPersonalizationEnabled ||\n        (!this.isCacheInitialized() &&\n          personalization.defaultPersonalizationEnabled !== false)\n      );\n    },\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport const AUTHORING_ENABLED = \"Rendering is disabled for authoring mode.\";\nexport const REDIRECT_EXECUTION_ERROR =\n  \"An error occurred while executing the redirect offer.\";\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const DISPLAY = \"decisioning.propositionDisplay\";\nexport const INTERACT = \"decisioning.propositionInteract\";\nexport const TRIGGER = \"decisioning.propositionTrigger\";\nexport const DISMISS = \"decisioning.propositionDismiss\";\nexport const SUPPRESS = \"decisioning.propositionSuppressDisplay\";\nexport const EVENT_TYPE_TRUE = 1;\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { DISPLAY, INTERACT, TRIGGER, DISMISS, SUPPRESS } from \"./eventType.js\";\n\nexport const PropositionEventType = {\n  DISPLAY: \"display\",\n  INTERACT: \"interact\",\n  TRIGGER: \"trigger\",\n  DISMISS: \"dismiss\",\n  SUPPRESS: \"suppressDisplay\",\n};\n\nconst eventTypeToPropositionEventTypeMapping = {\n  [DISPLAY]: PropositionEventType.DISPLAY,\n  [INTERACT]: PropositionEventType.INTERACT,\n  [TRIGGER]: PropositionEventType.TRIGGER,\n  [DISMISS]: PropositionEventType.DISMISS,\n  [SUPPRESS]: PropositionEventType.SUPPRESS,\n};\n\nconst propositionEventTypeToEventTypeMapping = {\n  [PropositionEventType.DISPLAY]: DISPLAY,\n  [PropositionEventType.INTERACT]: INTERACT,\n  [PropositionEventType.TRIGGER]: TRIGGER,\n  [PropositionEventType.DISMISS]: DISMISS,\n  [PropositionEventType.SUPPRESS]: SUPPRESS,\n};\n\nexport const getPropositionEventType = (eventType) =>\n  eventTypeToPropositionEventTypeMapping[eventType];\n\nexport const getEventType = (propositionEventType) =>\n  propositionEventTypeToEventTypeMapping[propositionEventType];\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport {\n  anything,\n  objectOf,\n  arrayOf,\n  string,\n} from \"../../utils/validation/index.js\";\n\nexport const EMPTY_PROPOSITIONS = { propositions: [] };\n\nexport default ({ logger, options }) => {\n  const applyPropositionsOptionsValidator = objectOf({\n    propositions: arrayOf(\n      objectOf({\n        id: string().required(),\n        scope: string().required(),\n        scopeDetails: objectOf({\n          decisionProvider: string().required(),\n        }).required(),\n        items: arrayOf(\n          objectOf({\n            id: string().required(),\n            schema: string().required(),\n            data: objectOf(anything()),\n          }),\n        )\n          .nonEmpty()\n          .required(),\n      }).required(),\n    )\n      .nonEmpty()\n      .required(),\n    metadata: objectOf(anything()),\n    viewName: string(),\n  }).required();\n\n  try {\n    return applyPropositionsOptionsValidator(options);\n  } catch (e) {\n    logger.warn(\n      \"Invalid options for applyPropositions. No propositions will be applied.\",\n      e,\n    );\n    return EMPTY_PROPOSITIONS;\n  }\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { noop, isNonEmptyArray } from \"../../utils/index.js\";\nimport createPersonalizationDetails from \"./createPersonalizationDetails.js\";\nimport { AUTHORING_ENABLED } from \"./constants/loggerMessage.js\";\nimport { PropositionEventType } from \"../../constants/propositionEventType.js\";\nimport validateApplyPropositionsOptions from \"./validateApplyPropositionsOptions.js\";\n\nexport default ({\n  getPageLocation,\n  logger,\n  fetchDataHandler,\n  viewChangeHandler,\n  onClickHandler,\n  isAuthoringModeEnabled,\n  mergeQuery,\n  viewCache,\n  showContainers,\n  applyPropositions,\n  setTargetMigration,\n  mergeDecisionsMeta,\n  renderedPropositions,\n  onDecisionHandler,\n  handleConsentFlicker,\n}) => {\n  return {\n    lifecycle: {\n      onComponentsRegistered() {\n        handleConsentFlicker();\n      },\n      onDecision: onDecisionHandler,\n      onBeforeRequest({ request }) {\n        setTargetMigration(request);\n        return Promise.resolve();\n      },\n      onBeforeEvent({\n        event,\n        renderDecisions,\n        decisionScopes = [],\n        personalization = {},\n        onResponse = noop,\n        onRequestFailure = noop,\n      }) {\n        // Include propositions on all responses, overridden with data as needed\n        onResponse(() => ({ propositions: [] }));\n        onRequestFailure(() => showContainers());\n\n        if (isAuthoringModeEnabled()) {\n          logger.warn(AUTHORING_ENABLED);\n\n          // If we are in authoring mode we disable personalization\n          mergeQuery(event, { enabled: false });\n          return Promise.resolve();\n        }\n\n        const personalizationDetails = createPersonalizationDetails({\n          getPageLocation,\n          renderDecisions,\n          decisionScopes,\n          personalization,\n          event,\n          isCacheInitialized: viewCache.isInitialized(),\n          logger,\n        });\n\n        const decisionsMetaPromises = [];\n        if (personalizationDetails.shouldIncludeRenderedPropositions()) {\n          decisionsMetaPromises.push(renderedPropositions.clear());\n        }\n\n        if (personalizationDetails.shouldFetchData()) {\n          const cacheUpdate = viewCache.createCacheUpdate(\n            personalizationDetails.getViewName(),\n          );\n          onRequestFailure(() => cacheUpdate.cancel());\n\n          fetchDataHandler({\n            cacheUpdate,\n            personalizationDetails,\n            event,\n            onResponse,\n          });\n        } else if (personalizationDetails.shouldUseCachedData()) {\n          decisionsMetaPromises.push(\n            viewChangeHandler({\n              personalizationDetails,\n              event,\n              onResponse,\n              onRequestFailure,\n            }),\n          );\n        }\n\n        // This promise.all waits for both the pending display notifications to be resolved\n        // (i.e. the top of page call to finish rendering) and the view change handler to\n        // finish rendering anything for this view.\n        return Promise.all(decisionsMetaPromises).then((decisionsMetas) => {\n          // We only want to call mergeDecisionsMeta once, but we can get the propositions\n          // from two places: the pending display notifications and the view change handler.\n          const decisionsMeta = decisionsMetas.flatMap((dms) => dms);\n          if (isNonEmptyArray(decisionsMeta)) {\n            mergeDecisionsMeta(event, decisionsMeta, [\n              PropositionEventType.DISPLAY,\n            ]);\n          }\n        });\n      },\n      onClick({ event, clickedElement }) {\n        onClickHandler({ event, clickedElement });\n      },\n    },\n    commands: {\n      applyPropositions: {\n        optionsValidator: (options) =>\n          validateApplyPropositionsOptions({ logger, options }),\n        run: applyPropositions,\n      },\n    },\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createNode } from \"../../../../utils/dom/index.js\";\nimport { DIV } from \"../../../../constants/tagName.js\";\n\nexport default (content = \"undefined\") => {\n  return createNode(DIV, {}, { innerHTML: content });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isNonEmptyString } from \"../../../../utils/index.js\";\n\nconst EQ_START = \":eq(\";\nconst EQ_PATTERN = /:eq\\((\\d+)\\)/g;\n\nexport const isNotEqSelector = (str) => str.indexOf(EQ_START) === -1;\n\nexport const splitWithEq = (selector) => {\n  return selector.split(EQ_PATTERN).filter(isNonEmptyString);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { selectNodes } from \"../../../../utils/dom/index.js\";\nimport { isNotEqSelector, splitWithEq } from \"./helperForEq.js\";\n\n// Trying to match ID or CSS class\nconst CSS_IDENTIFIER_PATTERN = /(#|\\.)(-?\\w+)/g;\n// Here we use CSS.escape() to make sure we get\n// correct values for ID and CSS class\n// Please check:  https://www.w3.org/TR/css-syntax-3/#escaping\nconst replaceIdentifier = (_, $1, $2) => `${$1}${CSS.escape($2)}`;\n\nexport const escapeIdentifiersInSelector = (selector) => {\n  return selector.replace(CSS_IDENTIFIER_PATTERN, replaceIdentifier);\n};\n\nexport const parseSelector = (rawSelector) => {\n  const result = [];\n  const selector = escapeIdentifiersInSelector(rawSelector.trim());\n  const parts = splitWithEq(selector);\n  const { length } = parts;\n  let i = 0;\n\n  while (i < length) {\n    const sel = parts[i];\n    const eq = parts[i + 1];\n\n    if (eq) {\n      result.push({ sel, eq: Number(eq) });\n    } else {\n      result.push({ sel });\n    }\n\n    i += 2;\n  }\n\n  return result;\n};\n\n/**\n * Returns an array of matched DOM nodes.\n * @param {String} selector that contains Sizzle \"eq(...)\" pseudo selector\n * @returns {Array} an array of DOM nodes\n */\nexport const selectNodesWithEq = (selector) => {\n  const doc = document;\n\n  if (isNotEqSelector(selector)) {\n    return selectNodes(selector, doc);\n  }\n\n  const parts = parseSelector(selector);\n  const { length } = parts;\n  let result = [];\n  let context = doc;\n  let i = 0;\n\n  while (i < length) {\n    const { sel, eq } = parts[i];\n    const nodes = selectNodes(sel, context);\n    const { length: nodesCount } = nodes;\n\n    if (nodesCount === 0) {\n      break;\n    }\n\n    if (eq != null && eq > nodesCount - 1) {\n      break;\n    }\n\n    if (i < length - 1) {\n      if (eq == null) {\n        [context] = nodes;\n      } else {\n        context = nodes[eq];\n      }\n    }\n\n    if (i === length - 1) {\n      if (eq == null) {\n        result = nodes;\n      } else {\n        result = [nodes[eq]];\n      }\n    }\n\n    i += 1;\n  }\n\n  return result;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns an array of matched DOM nodes.\n * @param {String} id\n * @param {Node} [context=document] defaults to document\n * @returns {HTMLElement} an element of null\n */\nexport default (id, context = document) => {\n  return context.getElementById(id);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element, name, value) => {\n  element.setAttribute(name, value);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element, name) => {\n  return element.getAttribute(name);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element, name) => {\n  element.removeAttribute(name);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element, name, value, priority) => {\n  let css;\n\n  if (priority) {\n    css = `${name}:${value} !${priority};`;\n  } else {\n    css = `${name}:${value};`;\n  }\n\n  element.style.cssText += `;${css}`;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element) => {\n  return element.parentNode;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element) => {\n  return element.nextElementSibling;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport getParent from \"./getParent.js\";\nimport getNextSibling from \"./getNextSibling.js\";\n\nexport default (container, element) => {\n  if (!container) {\n    return;\n  }\n\n  const parent = getParent(container);\n\n  if (parent) {\n    parent.insertBefore(element, getNextSibling(container));\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport getParent from \"./getParent.js\";\n\nexport default (container, element) => {\n  if (!container) {\n    return;\n  }\n\n  const parent = getParent(container);\n\n  if (parent) {\n    parent.insertBefore(element, container);\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { toArray } from \"../../../../utils/index.js\";\n\nexport default (element) => {\n  const { children } = element;\n\n  if (children) {\n    return toArray(children);\n  }\n\n  return [];\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { toArray } from \"../../../../utils/index.js\";\n\nexport default (element) => {\n  const { childNodes } = element;\n\n  if (childNodes) {\n    return toArray(childNodes);\n  }\n\n  return [];\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element) => {\n  return element.firstElementChild;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nlet nonce;\n\n/**\n * Returns the nonce if available.\n * @param {Node} [context=document] defaults to document\n * @returns {(String|undefined)} the nonce or undefined if not available\n */\nexport default (context = document) => {\n  if (nonce === undefined) {\n    const n = context.querySelector(\"[nonce]\");\n    // NOTE: We're keeping n.getAttribute(\"nonce\") until it is safe to remove:\n    //   ref: https://github.com/whatwg/html/issues/2369#issuecomment-280853946\n    nonce = n && (n.nonce || n.getAttribute(\"nonce\"));\n  }\n  return nonce;\n};\n\n// This function is only used for testing and removed when library is built (tree-shaking)\nexport const testResetCachedNonce = () => {\n  nonce = undefined;\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const SRC = \"src\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createNode, selectNodes } from \"../../../utils/dom/index.js\";\nimport { IMG } from \"../../../constants/tagName.js\";\nimport { SRC } from \"../../../constants/elementAttribute.js\";\nimport { getAttribute } from \"./dom/index.js\";\n\nexport const isImage = (element) => element.tagName === IMG;\n\nexport const loadImage = (url) => {\n  return createNode(IMG, { src: url });\n};\n\nexport const loadImages = (fragment) => {\n  const images = selectNodes(IMG, fragment);\n\n  images.forEach((image) => {\n    const url = getAttribute(image, SRC);\n\n    if (url) {\n      loadImage(url);\n    }\n  });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { selectNodes } from \"../../../utils/dom/index.js\";\nimport { STYLE } from \"../../../constants/tagName.js\";\nimport { SRC } from \"../../../constants/elementAttribute.js\";\nimport { getAttribute, getNonce } from \"./dom/index.js\";\n\nconst is = (element, tagName) => element.tagName === tagName;\nconst isInlineStyleElement = (element) =>\n  is(element, STYLE) && !getAttribute(element, SRC);\n\nexport default (fragment) => {\n  const styleNodes = selectNodes(STYLE, fragment);\n  const { length } = styleNodes;\n  const nonce = getNonce();\n  if (!nonce) {\n    return;\n  }\n\n  for (let i = 0; i < length; i += 1) {\n    const element = styleNodes[i];\n    if (!isInlineStyleElement(element)) {\n      continue;\n    }\n    element.nonce = nonce;\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { selectNodes, createNode } from \"../../../utils/dom/index.js\";\nimport { SCRIPT } from \"../../../constants/tagName.js\";\nimport { SRC } from \"../../../constants/elementAttribute.js\";\nimport { getAttribute, getNonce } from \"./dom/index.js\";\n\nconst getPromise = (url, script) => {\n  return new Promise((resolve, reject) => {\n    script.onload = () => {\n      resolve(script);\n    };\n    script.onerror = () => {\n      reject(new Error(`Failed to load script: ${url}`));\n    };\n  });\n};\nconst loadScript = (url) => {\n  const script = document.createElement(\"script\");\n  script.src = url;\n  script.async = true;\n  const promise = getPromise(url, script);\n  document.head.appendChild(script);\n  return promise;\n};\n\nexport const is = (element, tagName) =>\n  !!element && element.tagName === tagName;\n\nconst isInlineScript = (element) =>\n  is(element, SCRIPT) && !getAttribute(element, SRC);\n\nconst isRemoteScript = (element) =>\n  is(element, SCRIPT) && getAttribute(element, SRC);\n\nexport const getInlineScripts = (fragment) => {\n  const scripts = selectNodes(SCRIPT, fragment);\n  const result = [];\n  const { length } = scripts;\n  const nonce = getNonce();\n  const attributes = {\n    ...(nonce && { nonce }),\n  };\n\n  for (let i = 0; i < length; i += 1) {\n    const element = scripts[i];\n\n    if (!isInlineScript(element)) {\n      continue;\n    }\n\n    const { textContent } = element;\n\n    if (!textContent) {\n      continue;\n    }\n\n    result.push(createNode(SCRIPT, attributes, { textContent }));\n  }\n\n  return result;\n};\n\nexport const getRemoteScriptsUrls = (fragment) => {\n  const scripts = selectNodes(SCRIPT, fragment);\n  const result = [];\n  const { length } = scripts;\n\n  for (let i = 0; i < length; i += 1) {\n    const element = scripts[i];\n\n    if (!isRemoteScript(element)) {\n      continue;\n    }\n\n    const url = getAttribute(element, SRC);\n\n    if (!url) {\n      continue;\n    }\n\n    result.push(url);\n  }\n\n  return result;\n};\n\nexport const executeInlineScripts = (parent, scripts) => {\n  scripts.forEach((script) => {\n    parent.appendChild(script);\n    parent.removeChild(script);\n  });\n};\n\nexport const executeRemoteScripts = (urls) => {\n  return Promise.all(urls.map(loadScript));\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { appendNode } from \"../../../utils/dom/index.js\";\nimport { createFragment, getChildNodes } from \"./dom/index.js\";\nimport { loadImages } from \"./images.js\";\nimport addNonceToInlineStyleElements from \"./addNonceToInlineStyleElements.js\";\nimport {\n  executeInlineScripts,\n  executeRemoteScripts,\n  getInlineScripts,\n  getRemoteScriptsUrls,\n} from \"./scripts.js\";\n\nexport default (container, html, decorateProposition) => {\n  const fragment = createFragment(html);\n  addNonceToInlineStyleElements(fragment);\n  const elements = getChildNodes(fragment);\n  const scripts = getInlineScripts(fragment);\n  const scriptsUrls = getRemoteScriptsUrls(fragment);\n\n  loadImages(fragment);\n\n  elements.forEach((element) => {\n    appendNode(container, element);\n  });\n\n  decorateProposition(container);\n\n  executeInlineScripts(container, scripts);\n\n  return executeRemoteScripts(scriptsUrls);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { removeNode } from \"../../../utils/dom/index.js\";\nimport { getChildNodes } from \"./dom/index.js\";\nimport appendHtml from \"./appendHtml.js\";\n\nconst clear = (container) => {\n  // We want to remove ALL nodes, text, comments etc\n  const childNodes = getChildNodes(container);\n\n  childNodes.forEach(removeNode);\n};\n\nexport default (container, html, decorateProposition) => {\n  clear(container);\n  return appendHtml(container, html, decorateProposition);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { appendNode } from \"../../../utils/dom/index.js\";\nimport {\n  createFragment,\n  getChildNodes,\n  getFirstChild,\n  insertBefore,\n} from \"./dom/index.js\";\nimport { loadImages } from \"./images.js\";\nimport addNonceToInlineStyleElements from \"./addNonceToInlineStyleElements.js\";\nimport {\n  executeInlineScripts,\n  executeRemoteScripts,\n  getInlineScripts,\n  getRemoteScriptsUrls,\n} from \"./scripts.js\";\n\nexport default (container, html, decorateProposition) => {\n  const fragment = createFragment(html);\n  addNonceToInlineStyleElements(fragment);\n  const elements = getChildNodes(fragment);\n  const scripts = getInlineScripts(fragment);\n  const scriptsUrls = getRemoteScriptsUrls(fragment);\n  const { length } = elements;\n  let i = length - 1;\n\n  // We have to proactively load images to avoid flicker\n  loadImages(fragment);\n\n  // We are inserting elements in reverse order\n  while (i >= 0) {\n    const element = elements[i];\n    decorateProposition(element);\n\n    const firstChild = getFirstChild(container);\n\n    if (firstChild) {\n      insertBefore(firstChild, element);\n    } else {\n      appendNode(container, element);\n    }\n\n    i -= 1;\n  }\n\n  executeInlineScripts(container, scripts);\n\n  return executeRemoteScripts(scriptsUrls);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  createNode,\n  appendNode,\n  removeNode,\n} from \"../../../utils/dom/index.js\";\nimport { STYLE } from \"../../../constants/tagName.js\";\nimport { getElementById, getNonce } from \"../dom-actions/dom/index.js\";\n\nconst PREHIDING_ID = \"alloy-prehiding\";\nconst HIDING_STYLE_DEFINITION = \"{ visibility: hidden }\";\n\n// Using global is OK since we have a single DOM\n// so storing nodes even for multiple Alloy instances is fine\nconst styleNodes = {};\n\nexport const hideElements = (prehidingSelector) => {\n  // if we have different events with the same\n  // prehiding selector we don't want to recreate\n  // the style tag\n  if (styleNodes[prehidingSelector]) {\n    return;\n  }\n\n  const nonce = getNonce();\n  const attrs = {\n    ...(nonce && { nonce }),\n  };\n  const props = {\n    textContent: `${prehidingSelector} ${HIDING_STYLE_DEFINITION}`,\n  };\n  const node = createNode(STYLE, attrs, props);\n\n  appendNode(document.head, node);\n\n  styleNodes[prehidingSelector] = node;\n};\n\nexport const showElements = (prehidingSelector) => {\n  const node = styleNodes[prehidingSelector];\n\n  if (node) {\n    removeNode(node);\n    delete styleNodes[prehidingSelector];\n  }\n};\n\nexport const createHideContainers = (logger) => {\n  return (prehidingStyle) => {\n    if (!prehidingStyle) {\n      return;\n    }\n\n    // If containers prehiding style has been added\n    // by customer's prehiding snippet we don't\n    // want to add the same node\n    const node = getElementById(PREHIDING_ID);\n\n    if (node) {\n      return;\n    }\n\n    const nonce = getNonce();\n    const attrs = { id: PREHIDING_ID, ...(nonce && { nonce }) };\n    const props = { textContent: prehidingStyle };\n    const styleNode = createNode(STYLE, attrs, props);\n\n    logger.logOnContentHiding({\n      status: \"hide-containers\",\n      message: \"Prehiding style applied to hide containers.\",\n      logLevel: \"info\",\n    });\n\n    appendNode(document.head, styleNode);\n  };\n};\n\nexport const createShowContainers = (logger) => {\n  return () => {\n    // If containers prehiding style exists\n    // we will remove it\n    const node = getElementById(PREHIDING_ID);\n\n    if (!node) {\n      return;\n    }\n\n    logger.logOnContentHiding({\n      status: \"show-containers\",\n      message: \"Prehiding style removed to show containers.\",\n      logLevel: \"info\",\n    });\n    removeNode(node);\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (container, text, decorateProposition) => {\n  decorateProposition(container);\n  container.textContent = text;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createFragment, getChildNodes, insertBefore } from \"./dom/index.js\";\nimport { loadImages } from \"./images.js\";\nimport addNonceToInlineStyleElements from \"./addNonceToInlineStyleElements.js\";\nimport {\n  executeInlineScripts,\n  executeRemoteScripts,\n  getInlineScripts,\n  getRemoteScriptsUrls,\n} from \"./scripts.js\";\n\nexport default (container, html, decorateProposition) => {\n  const fragment = createFragment(html);\n  addNonceToInlineStyleElements(fragment);\n  const elements = getChildNodes(fragment);\n  const scripts = getInlineScripts(fragment);\n  const scriptsUrls = getRemoteScriptsUrls(fragment);\n\n  loadImages(fragment);\n\n  elements.forEach((element) => {\n    decorateProposition(element);\n    insertBefore(container, element);\n  });\n\n  executeInlineScripts(container, scripts);\n\n  return executeRemoteScripts(scriptsUrls);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { removeNode } from \"../../../utils/dom/index.js\";\nimport insertHtmlBefore from \"./insertHtmlBefore.js\";\n\nexport default (container, html, decorateProposition) => {\n  return insertHtmlBefore(container, html, decorateProposition).then(() => {\n    removeNode(container);\n  });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createFragment, getChildNodes, insertAfter } from \"./dom/index.js\";\nimport { loadImages } from \"./images.js\";\nimport addNonceToInlineStyleElements from \"./addNonceToInlineStyleElements.js\";\nimport {\n  getInlineScripts,\n  getRemoteScriptsUrls,\n  executeInlineScripts,\n  executeRemoteScripts,\n} from \"./scripts.js\";\n\nexport default (container, html, decorateProposition) => {\n  const fragment = createFragment(html);\n  addNonceToInlineStyleElements(fragment);\n  const elements = getChildNodes(fragment);\n  const scripts = getInlineScripts(fragment);\n  const scriptsUrls = getRemoteScriptsUrls(fragment);\n\n  loadImages(fragment);\n\n  let insertionPoint = container;\n\n  elements.forEach((element) => {\n    decorateProposition(element);\n    insertAfter(insertionPoint, element);\n    insertionPoint = element;\n  });\n\n  executeInlineScripts(container, scripts);\n\n  return executeRemoteScripts(scriptsUrls);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { setStyle } from \"./dom/index.js\";\n\nexport default (container, styles, decorateProposition) => {\n  const { priority, ...style } = styles;\n\n  Object.keys(style).forEach((key) => {\n    setStyle(container, key, style[key], priority);\n  });\n\n  decorateProposition(container);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { setAttribute } from \"./dom/index.js\";\n\nexport default (container, attributes, decorateProposition) => {\n  Object.keys(attributes).forEach((key) => {\n    setAttribute(container, key, attributes[key]);\n  });\n\n  decorateProposition(container);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { SRC } from \"../../../constants/elementAttribute.js\";\nimport { removeAttribute, setAttribute } from \"./dom/index.js\";\nimport { isImage, loadImage } from \"./images.js\";\n\nexport default (container, url, decorateProposition) => {\n  if (!isImage(container)) {\n    return;\n  }\n\n  // Start downloading the image\n  loadImage(url);\n\n  decorateProposition(container);\n\n  // Remove \"src\" so there is no flicker\n  removeAttribute(container, SRC);\n\n  // Replace the image \"src\"\n  setAttribute(container, SRC, url);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { getChildren, insertAfter, insertBefore } from \"./dom/index.js\";\n\nexport default (container, { from, to }, decorateProposition) => {\n  const children = getChildren(container);\n  const elementFrom = children[from];\n  const elementTo = children[to];\n\n  if (!elementFrom || !elementTo) {\n    // TODO: We will need to add logging\n    // to ease troubleshooting\n    return;\n  }\n\n  if (from < to) {\n    insertAfter(elementTo, elementFrom);\n  } else {\n    insertBefore(elementTo, elementFrom);\n  }\n\n  decorateProposition(elementTo);\n  decorateProposition(elementFrom);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { awaitSelector } from \"../../../utils/dom/index.js\";\nimport { hideElements, showElements } from \"../flicker/index.js\";\nimport { selectNodesWithEq } from \"./dom/index.js\";\n\nexport { default as setText } from \"./setText.js\";\nexport { default as setHtml } from \"./setHtml.js\";\nexport { default as appendHtml } from \"./appendHtml.js\";\nexport { default as prependHtml } from \"./prependHtml.js\";\nexport { default as replaceHtml } from \"./replaceHtml.js\";\nexport { default as insertHtmlBefore } from \"./insertHtmlBefore.js\";\nexport { default as insertHtmlAfter } from \"./insertHtmlAfter.js\";\nexport { default as setStyles } from \"./setStyles.js\";\nexport { default as setAttributes } from \"./setAttributes.js\";\nexport { default as swapImage } from \"./swapImage.js\";\nexport { default as rearrangeChildren } from \"./rearrangeChildren.js\";\n\n/**\n * Renders content into a container element.\n *\n * @param {Object} params\n * @param {Element[]} params.containers\n * @param {string} params.content\n * @param {(element: Element) => void} params.decorateProposition\n * @param {(container: Element, content: string, decorateProposition: (element: Element) => void) => Promise<void>} params.renderFunc\n * @returns {Promise<void>} A promise that resolves when the content is rendered.\n */\nconst renderContent = ({\n  containers,\n  content,\n  decorateProposition,\n  renderFunc,\n  renderStatusHandler,\n  alwaysRender,\n}) => {\n  const executions = containers\n    .filter(\n      (element) => alwaysRender || renderStatusHandler.shouldRender(element),\n    )\n    .map(async (container) => {\n      await renderFunc(container, content, decorateProposition);\n      renderStatusHandler.markAsRendered(container);\n    });\n\n  return Promise.all(executions);\n};\n\n/**\n * Creates an action function that renders content into a container element.\n *\n * @param {Function} renderFunc - The function that performs the rendering.\n * @param {boolean} alwaysRender - Whether to always render the content, even if it has already been rendered.\n */\nexport const createAction = (renderFunc, alwaysRender = false) => {\n  /**\n   * Renders content into a container element.\n   *\n   * @param {{ selector: string, prehidingSelector: string, content: string }} itemData - The item data containing the container selector and prehiding selector.\n   * @param {(element: Element) => void} createDecorateProposition\n   * @param {{ shouldRender: (element: Element) => boolean, markAsRendered: (element: Element) => void }} renderStatusHandler\n   */\n  return async (itemData, decorateProposition, renderStatusHandler) => {\n    const {\n      selector: containerSelector,\n      prehidingSelector,\n      content,\n    } = itemData;\n    hideElements(prehidingSelector);\n    try {\n      const containers = await awaitSelector(\n        containerSelector,\n        selectNodesWithEq,\n      );\n      renderContent({\n        containers,\n        content,\n        decorateProposition,\n        renderFunc,\n        renderStatusHandler,\n        alwaysRender,\n      });\n    } finally {\n      showElements(prehidingSelector);\n    }\n  };\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const addPxIfMissing = (value) => {\n  const hasPx = `${value}`.endsWith(\"px\");\n\n  return hasPx ? value : `${value}px`;\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { setStyle } from \"./dom/index.js\";\nimport { addPxIfMissing } from \"./dom/util.js\";\n\nexport default (container, styles, decorateProposition) => {\n  const { priority, ...style } = styles;\n\n  Object.keys(style).forEach((key) => {\n    let value = style[key];\n    if (key === \"left\" || key === \"top\") {\n      value = addPxIfMissing(value);\n    }\n    setStyle(container, key, value, priority);\n  });\n\n  decorateProposition(container);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (container, content, decorateProposition) => {\n  decorateProposition(container);\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { setStyle } from \"./dom/index.js\";\nimport { addPxIfMissing } from \"./dom/util.js\";\n\nexport default (container, styles, decorateProposition) => {\n  const { priority, ...style } = styles;\n\n  Object.keys(style).forEach((key) => {\n    let value = style[key];\n    if (key === \"width\" || key === \"height\") {\n      value = addPxIfMissing(value);\n    }\n    setStyle(container, key, value, priority);\n  });\n\n  decorateProposition(container);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { removeNode } from \"../../../utils/dom/index.js\";\nimport setHtml from \"./setHtml.js\";\nimport prependHtml from \"./prependHtml.js\";\nimport { createAction } from \"./action.js\";\nimport setText from \"./setText.js\";\nimport setAttributes from \"./setAttributes.js\";\nimport swapImage from \"./swapImage.js\";\nimport setStyles from \"./setStyles.js\";\nimport move from \"./move.js\";\nimport rearrangeChildren from \"./rearrangeChildren.js\";\nimport insertHtmlAfter from \"./insertHtmlAfter.js\";\nimport insertHtmlBefore from \"./insertHtmlBefore.js\";\nimport replaceHtml from \"./replaceHtml.js\";\nimport appendHtml from \"./appendHtml.js\";\nimport collectInteractions from \"./collectInteractions.js\";\nimport resize from \"./resize.js\";\n\nexport const DOM_ACTION_SET_HTML = \"setHtml\";\nexport const DOM_ACTION_CUSTOM_CODE = \"customCode\";\nexport const DOM_ACTION_SET_TEXT = \"setText\";\nexport const DOM_ACTION_SET_ATTRIBUTE = \"setAttribute\";\nexport const DOM_ACTION_SET_IMAGE_SOURCE = \"setImageSource\";\nexport const DOM_ACTION_SET_STYLE = \"setStyle\";\nexport const DOM_ACTION_MOVE = \"move\";\nexport const DOM_ACTION_RESIZE = \"resize\";\nexport const DOM_ACTION_REARRANGE = \"rearrange\";\nexport const DOM_ACTION_REMOVE = \"remove\";\nexport const DOM_ACTION_INSERT_AFTER = \"insertAfter\";\nexport const DOM_ACTION_INSERT_BEFORE = \"insertBefore\";\nexport const DOM_ACTION_REPLACE_HTML = \"replaceHtml\";\nexport const DOM_ACTION_PREPEND_HTML = \"prependHtml\";\nexport const DOM_ACTION_APPEND_HTML = \"appendHtml\";\nexport const DOM_ACTION_CLICK = \"click\";\nexport const DOM_ACTION_COLLECT_INTERACTIONS = \"collectInteractions\";\n\nexport default () => {\n  return {\n    [DOM_ACTION_SET_HTML]: createAction(setHtml, true),\n    [DOM_ACTION_CUSTOM_CODE]: createAction(prependHtml),\n    [DOM_ACTION_SET_TEXT]: createAction(setText, true),\n    [DOM_ACTION_SET_ATTRIBUTE]: createAction(setAttributes, true),\n    [DOM_ACTION_SET_IMAGE_SOURCE]: createAction(swapImage, true),\n    [DOM_ACTION_SET_STYLE]: createAction(setStyles, true),\n    [DOM_ACTION_MOVE]: createAction(move, true),\n    [DOM_ACTION_RESIZE]: createAction(resize, true),\n    [DOM_ACTION_REARRANGE]: createAction(rearrangeChildren),\n    [DOM_ACTION_REMOVE]: createAction(removeNode, true),\n    [DOM_ACTION_INSERT_AFTER]: createAction(insertHtmlAfter),\n    [DOM_ACTION_INSERT_BEFORE]: createAction(insertHtmlBefore),\n    [DOM_ACTION_REPLACE_HTML]: createAction(replaceHtml, true),\n    [DOM_ACTION_PREPEND_HTML]: createAction(prependHtml),\n    [DOM_ACTION_APPEND_HTML]: createAction(appendHtml),\n    [DOM_ACTION_COLLECT_INTERACTIONS]: createAction(collectInteractions, true),\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { DISPLAY } from \"../constants/eventType.js\";\nimport { getPropositionEventType } from \"../constants/propositionEventType.js\";\nimport { isNonEmptyArray } from \"./index.js\";\n\nexport default ({ eventManager, mergeDecisionsMeta }) => {\n  // Called when a decision is auto-rendered for the __view__ scope or a SPA view(display and empty display notification)\n  return ({\n    decisionsMeta = [],\n    propositionAction,\n    documentMayUnload = false,\n    eventType = DISPLAY,\n    propositionEventTypes = [getPropositionEventType(eventType)],\n    viewName,\n  }) => {\n    const event = eventManager.createEvent();\n    const data = { eventType };\n\n    if (viewName) {\n      data.web = {\n        webPageDetails: { viewName },\n      };\n    }\n    if (isNonEmptyArray(decisionsMeta)) {\n      mergeDecisionsMeta(\n        event,\n        decisionsMeta,\n        propositionEventTypes,\n        propositionAction,\n      );\n    }\n\n    event.mergeXdm(data);\n\n    if (documentMayUnload) {\n      event.documentMayUnload();\n    }\n\n    return eventManager.sendEvent(event);\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { groupBy, isNonEmptyArray } from \"../../utils/index.js\";\nimport PAGE_WIDE_SCOPE from \"../../constants/pageWideScope.js\";\n\nconst DECISIONS_HANDLE = \"personalization:decisions\";\n\nexport default ({\n  logger,\n  prehidingStyle,\n  showContainers,\n  hideContainers,\n  mergeQuery,\n  processPropositions,\n  createProposition,\n  notificationHandler,\n  consent,\n}) => {\n  return ({ cacheUpdate, personalizationDetails, event, onResponse }) => {\n    const { state, wasSet } = consent.current();\n    if (!(state === \"out\" && wasSet)) {\n      if (personalizationDetails.isRenderDecisions()) {\n        hideContainers(prehidingStyle);\n      } else {\n        showContainers();\n      }\n    }\n    mergeQuery(event, personalizationDetails.createQueryDetails());\n\n    // This needs to be called before the response so that future sendEvent calls\n    // can know to wait until this request is complete for pending display notifications.\n    const handleNotifications = notificationHandler(\n      personalizationDetails.isRenderDecisions(),\n      personalizationDetails.isSendDisplayEvent(),\n      personalizationDetails.getViewName(),\n    );\n\n    onResponse(({ response }) => {\n      const handles = response.getPayloadsByType(DECISIONS_HANDLE);\n      if (!isNonEmptyArray(handles)) {\n        logger.logOnContentRendering({\n          status: \"no-offers\",\n          message: \"No offers were returned.\",\n          logLevel: \"info\",\n          detail: {\n            query: personalizationDetails.createQueryDetails(),\n          },\n        });\n      }\n      const propositions = handles.map((handle) => createProposition(handle));\n      const {\n        page: pagePropositions = [],\n        view: viewPropositions = [],\n        proposition: nonRenderedPropositions = [],\n      } = groupBy(propositions, (p) => p.getScopeType());\n\n      const currentViewPropositions = cacheUpdate.update(viewPropositions);\n\n      let render;\n      let returnedPropositions;\n      let returnedDecisions;\n\n      if (personalizationDetails.isRenderDecisions()) {\n        ({ render, returnedPropositions, returnedDecisions } =\n          processPropositions(\n            [...pagePropositions, ...currentViewPropositions],\n            nonRenderedPropositions,\n          ));\n        if (isNonEmptyArray(pagePropositions)) {\n          logger.logOnContentRendering({\n            status: \"rendering-started\",\n            message: \"Started rendering propositions for page-wide scope.\",\n            logLevel: \"info\",\n            detail: {\n              scope: PAGE_WIDE_SCOPE,\n              propositions: pagePropositions.map((proposition) =>\n                proposition.toJSON(),\n              ),\n            },\n          });\n        }\n\n        if (isNonEmptyArray(currentViewPropositions)) {\n          logger.logOnContentRendering({\n            status: \"rendering-started\",\n            message: `Rendering propositions started for view scope - ${personalizationDetails.getViewName()}.`,\n            logLevel: \"info\",\n            detail: {\n              scope: personalizationDetails.getViewName(),\n              propositions: currentViewPropositions.map((proposition) =>\n                proposition.toJSON(),\n              ),\n            },\n          });\n        }\n\n        render().then(handleNotifications);\n\n        // Render could take a long time especially if one of the renders\n        // is waiting for html to appear on the page. We show the containers\n        // immediately, and whatever renders quickly will not have flicker.\n        showContainers();\n      } else {\n        ({ returnedPropositions, returnedDecisions } = processPropositions(\n          [],\n          [\n            ...pagePropositions,\n            ...currentViewPropositions,\n            ...nonRenderedPropositions,\n          ],\n        ));\n      }\n\n      return {\n        propositions: returnedPropositions,\n        decisions: returnedDecisions,\n      };\n    });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { matchesSelector } from \"../../../../utils/dom/index.js\";\nimport { isNotEqSelector } from \"./helperForEq.js\";\nimport { selectNodesWithEq } from \"./selectNodesWithEq.js\";\n\nexport default (selector, element) => {\n  if (isNotEqSelector(selector)) {\n    return matchesSelector(selector, element);\n  }\n\n  // Using node selection vs matches selector, because of :eq()\n  // Find all nodes using document as context\n  const nodes = selectNodesWithEq(selector);\n  let result = false;\n\n  // Iterate through all the identified elements\n  // and reference compare with element\n  for (let i = 0; i < nodes.length; i += 1) {\n    if (nodes[i] === element) {\n      result = true;\n      break;\n    }\n  }\n\n  return result;\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const VIEW_SCOPE_TYPE = \"view\";\nexport const PAGE_SCOPE_TYPE = \"page\";\nexport const PROPOSITION_SCOPE_TYPE = \"proposition\";\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport const cleanMetas = (metas) =>\n  metas.map((meta) => {\n    const { trackingLabel, scopeType, ...rest } = meta;\n    return rest;\n  });\n\nexport const dedupeMetas = (metas) =>\n  metas.filter((meta, index) => {\n    const stringifiedMeta = JSON.stringify(meta);\n    return (\n      index ===\n      metas.findIndex(\n        (innerMeta) => JSON.stringify(innerMeta) === stringifiedMeta,\n      )\n    );\n  });\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport matchesSelectorWithEq from \"../dom/matchesSelectorWithEq.js\";\nimport { VIEW_SCOPE_TYPE } from \"../../constants/scopeType.js\";\nimport { cleanMetas, dedupeMetas } from \"../../utils/metaUtils.js\";\n\nconst getMetasIfMatches = (clickedElement, selector, getClickMetas) => {\n  const { documentElement } = document;\n  let element = clickedElement;\n  let i = 0;\n\n  while (element && element !== documentElement) {\n    if (matchesSelectorWithEq(selector, element)) {\n      const matchedMetas = getClickMetas(selector);\n      const returnValue = {\n        metas: matchedMetas,\n      };\n      const foundMetaWithLabel = matchedMetas.find(\n        (meta) => meta.trackingLabel,\n      );\n      if (foundMetaWithLabel) {\n        returnValue.label = foundMetaWithLabel.trackingLabel;\n        returnValue.weight = i;\n      }\n      const foundMetaWithScopeTypeView = matchedMetas.find(\n        (meta) => meta.scopeType === VIEW_SCOPE_TYPE,\n      );\n      if (foundMetaWithScopeTypeView) {\n        returnValue.viewName = foundMetaWithScopeTypeView.scope;\n        returnValue.weight = i;\n      }\n      return returnValue;\n    }\n\n    element = element.parentNode;\n    i += 1;\n  }\n\n  return {\n    metas: null,\n  };\n};\n\nexport default (clickedElement, selectors, getClickMetas) => {\n  const result = [];\n  let resultLabel = \"\";\n  let resultLabelWeight = Number.MAX_SAFE_INTEGER;\n  let resultViewName;\n  let resultViewNameWeight = Number.MAX_SAFE_INTEGER;\n\n  for (let i = 0; i < selectors.length; i += 1) {\n    const { metas, label, weight, viewName } = getMetasIfMatches(\n      clickedElement,\n      selectors[i],\n      getClickMetas,\n    );\n\n    if (!metas) {\n      continue;\n    }\n\n    if (label && weight <= resultLabelWeight) {\n      resultLabel = label;\n      resultLabelWeight = weight;\n    }\n    if (viewName && weight <= resultViewNameWeight) {\n      resultViewName = viewName;\n      resultViewNameWeight = weight;\n    }\n    result.push(...cleanMetas(metas));\n  }\n\n  return {\n    decisionsMeta: dedupeMetas(result),\n    propositionActionLabel: resultLabel,\n    propositionActionToken: undefined,\n    viewName: resultViewName,\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (doc = document) => {\n  return doc.location.href.indexOf(\"adobe_authoring_enabled\") !== -1;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { EVENT_TYPE_TRUE } from \"../constants/eventType.js\";\n\n/* eslint-disable no-underscore-dangle */\nexport const mergeDecisionsMeta = (\n  event,\n  decisionsMeta,\n  propositionEventTypes,\n  propositionAction,\n) => {\n  // Do not send a display notification with no decisions. Even empty view changes\n  // should include a proposition.\n  if (decisionsMeta.length === 0) {\n    return;\n  }\n  const propositionEventType = {};\n\n  propositionEventTypes.forEach((type) => {\n    propositionEventType[type] = EVENT_TYPE_TRUE;\n  });\n\n  const xdm = {\n    _experience: {\n      decisioning: {\n        propositions: decisionsMeta,\n        propositionEventType,\n      },\n    },\n  };\n\n  if (propositionAction) {\n    xdm._experience.decisioning.propositionAction = propositionAction;\n  }\n  event.mergeXdm(xdm);\n};\n\nexport const mergeQuery = (event, details) => {\n  event.mergeQuery({ personalization: { ...details } });\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isNonEmptyArray } from \"../../utils/index.js\";\nimport { INTERACT } from \"../../constants/eventType.js\";\nimport { PropositionEventType } from \"../../constants/propositionEventType.js\";\n\nconst createPropositionAction = (clickLabel, clickToken) => {\n  if (!clickToken && !clickLabel) {\n    return undefined;\n  }\n\n  const propositionAction = {};\n\n  if (clickLabel) {\n    propositionAction.label = clickLabel;\n  }\n\n  if (clickToken) {\n    propositionAction.tokens = [clickToken];\n  }\n\n  return propositionAction;\n};\n\nexport default ({\n  mergeDecisionsMeta,\n  collectInteractions,\n  collectClicks,\n  getInteractionMetas,\n  getClickMetas,\n  getClickSelectors,\n  autoCollectPropositionInteractions,\n}) => {\n  // Called when an element qualifying for conversion within an offer is clicked.\n  return ({ event, clickedElement }) => {\n    const decisionsMeta = [];\n    let propositionActionLabel;\n    let propositionActionToken;\n    let viewName;\n\n    [\n      collectInteractions(\n        clickedElement,\n        getInteractionMetas,\n        autoCollectPropositionInteractions,\n      ),\n      collectClicks(clickedElement, getClickSelectors(), getClickMetas),\n    ].forEach(\n      ({\n        decisionsMeta: curDecisionsMeta,\n        propositionActionLabel: curPropositionActionLabel,\n        propositionActionToken: curPropositionActionToken,\n        viewName: curViewName,\n      }) => {\n        Array.prototype.push.apply(decisionsMeta, curDecisionsMeta);\n\n        if (!propositionActionLabel && curPropositionActionLabel) {\n          propositionActionLabel = curPropositionActionLabel;\n        }\n\n        if (!propositionActionToken && curPropositionActionToken) {\n          propositionActionToken = curPropositionActionToken;\n        }\n\n        if (!viewName && curViewName) {\n          viewName = curViewName;\n        }\n      },\n    );\n\n    if (isNonEmptyArray(decisionsMeta)) {\n      const xdm = { eventType: INTERACT };\n\n      if (viewName) {\n        xdm.web = {\n          webPageDetails: {\n            viewName,\n          },\n        };\n      }\n\n      event.mergeXdm(xdm);\n\n      mergeDecisionsMeta(\n        event,\n        decisionsMeta,\n        [PropositionEventType.INTERACT],\n        createPropositionAction(propositionActionLabel, propositionActionToken),\n      );\n    }\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { groupBy } from \"../../utils/index.js\";\nimport defer from \"../../utils/defer.js\";\nimport { DEFAULT_CONTENT_ITEM } from \"../../constants/schema.js\";\nimport { VIEW_SCOPE_TYPE } from \"./constants/scopeType.js\";\n\nexport default ({ createProposition }) => {\n  let cacheUpdateCreatedAtLeastOnce = false;\n  let viewStoragePromise = Promise.resolve({});\n\n  const getViewPropositions = (viewStorage, viewName) => {\n    const viewPropositions = viewStorage[viewName.toLowerCase()];\n    if (viewPropositions && viewPropositions.length > 0) {\n      return viewPropositions;\n    }\n\n    const emptyViewProposition = createProposition(\n      {\n        scope: viewName,\n        scopeDetails: {\n          characteristics: {\n            scopeType: VIEW_SCOPE_TYPE,\n          },\n        },\n        items: [\n          {\n            schema: DEFAULT_CONTENT_ITEM,\n          },\n        ],\n      },\n      false,\n    );\n    return [emptyViewProposition];\n  };\n\n  // This should be called before making the request to experience edge.\n  const createCacheUpdate = (viewName) => {\n    const updateCacheDeferred = defer();\n\n    cacheUpdateCreatedAtLeastOnce = true;\n\n    // Additional updates will merge the new view propositions with the old.\n    // i.e. if there are new \"cart\" view propositions they will overwrite the\n    // old \"cart\" view propositions, but if there are no new \"cart\" view\n    // propositions the old \"cart\" view propositions will remain.\n    viewStoragePromise = viewStoragePromise.then((oldViewStorage) => {\n      return updateCacheDeferred.promise\n        .then((newViewStorage) => {\n          return { ...oldViewStorage, ...newViewStorage };\n        })\n        .catch(() => oldViewStorage);\n    });\n\n    return {\n      update(viewPropositions) {\n        const viewPropositionsWithScope = viewPropositions.filter(\n          (proposition) => proposition.getScope(),\n        );\n        const newViewStorage = groupBy(\n          viewPropositionsWithScope,\n          (proposition) => proposition.getScope().toLowerCase(),\n        );\n        updateCacheDeferred.resolve(newViewStorage);\n        if (viewName) {\n          return getViewPropositions(newViewStorage, viewName);\n        }\n        return [];\n      },\n      cancel() {\n        updateCacheDeferred.reject();\n      },\n    };\n  };\n\n  const getView = (viewName) => {\n    return viewStoragePromise.then((viewStorage) =>\n      getViewPropositions(viewStorage, viewName),\n    );\n  };\n\n  const isInitialized = () => {\n    return cacheUpdateCreatedAtLeastOnce;\n  };\n\n  return {\n    createCacheUpdate,\n    getView,\n    isInitialized,\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ processPropositions, viewCache, logger }) => {\n  return ({ personalizationDetails, onResponse }) => {\n    let returnedPropositions;\n    let returnedDecisions;\n    const viewName = personalizationDetails.getViewName();\n\n    onResponse(() => {\n      return {\n        propositions: returnedPropositions,\n        decisions: returnedDecisions,\n      };\n    });\n\n    return viewCache.getView(viewName).then((propositions) => {\n      let render;\n      if (personalizationDetails.isRenderDecisions()) {\n        ({ render, returnedPropositions, returnedDecisions } =\n          processPropositions(propositions));\n\n        logger.logOnContentRendering({\n          status: \"rendering-started\",\n          message: `Started rendering propositions for view scope - ${viewName}.`,\n          logLevel: \"info\",\n          detail: {\n            scope: viewName,\n            propositions: propositions.map((proposition) =>\n              proposition.toJSON(),\n            ),\n          },\n        });\n\n        return render();\n      }\n      ({ returnedPropositions, returnedDecisions } = processPropositions(\n        [],\n        propositions,\n      ));\n      return [];\n    });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nconst metasToArray = (metas) => {\n  return Object.keys(metas).map((key) => {\n    return {\n      id: key,\n      ...metas[key],\n    };\n  });\n};\n\nexport default () => {\n  const clickStorage = {};\n\n  const storeClickMeta = ({\n    selector,\n    meta: { id, scope, scopeDetails, trackingLabel, scopeType },\n  }) => {\n    if (!clickStorage[selector]) {\n      clickStorage[selector] = {};\n    }\n    clickStorage[selector][id] = {\n      scope,\n      scopeDetails,\n      trackingLabel,\n      scopeType,\n    };\n  };\n\n  const getClickSelectors = () => {\n    return Object.keys(clickStorage);\n  };\n\n  const getClickMetas = (selector) => {\n    const metas = clickStorage[selector];\n    if (!metas) {\n      return {};\n    }\n    return metasToArray(clickStorage[selector]);\n  };\n  return {\n    storeClickMeta,\n    getClickSelectors,\n    getClickMetas,\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default () => {\n  const clickMetaStorage = {};\n  /*\n        clickMetaStorage example.\n        `abc' and 'def' are proposition IDs.  1 is an interact id.  The object with an id, scope and scopeDetails\n        is the notification.\n\n          {\n            1: {\n              \"abc\": { \"id\": \"abc\", \"scope\": \"proposition\", \"scopeDetails\": {} },\n              \"def\": { \"id\": \"def\", \"scope\": \"proposition\", \"scopeDetails\": {} }\n            }\n          }\n  */\n\n  const clickItemStorage = {};\n  /*\n        clickItemStorage example.\n        `abc' and 'def' are proposition IDs.  1 is an interact id.  The sets contain proposition-item IDs which\n        are used in notifications that are sent.\n\n          {\n            1: {\n              abc: new Set([\"itemAAA\", \"itemCCC\"]),\n              def: new Set([\"itemEEE\", \"itemFFF\"]),\n            },\n          }\n  */\n\n  const storeInteractionMeta = (\n    propositionId,\n    itemId,\n    scopeType,\n    notification,\n    interactId,\n  ) => {\n    interactId = parseInt(interactId, 10);\n\n    if (!clickMetaStorage[interactId]) {\n      clickMetaStorage[interactId] = {};\n      clickItemStorage[interactId] = {};\n    }\n\n    if (!clickItemStorage[interactId][propositionId]) {\n      clickItemStorage[interactId][propositionId] = new Set();\n    }\n\n    clickItemStorage[interactId][propositionId].add(itemId);\n\n    clickMetaStorage[interactId][propositionId] = {\n      ...notification,\n      scopeType,\n    };\n  };\n\n  const getInteractionMetas = (interactIds) => {\n    if (!Array.isArray(interactIds) || interactIds.length === 0) {\n      return [];\n    }\n\n    return Object.values(\n      interactIds\n        .map((value) => parseInt(value, 10))\n        .reduce((metaMap, interactId) => {\n          Object.keys(clickMetaStorage[interactId] || {}).forEach(\n            (propositionId) => {\n              if (!metaMap[propositionId]) {\n                metaMap[propositionId] = {\n                  proposition: clickMetaStorage[interactId][propositionId],\n                  items: new Set(),\n                };\n              }\n\n              metaMap[propositionId].items = new Set([\n                ...metaMap[propositionId].items,\n                ...clickItemStorage[interactId][propositionId],\n              ]);\n            },\n          );\n          return metaMap;\n        }, {}),\n    ).map(({ proposition, items }) => ({\n      ...proposition,\n      items: Array.from(items).map((id) => ({ id })),\n    }));\n  };\n\n  return {\n    storeInteractionMeta,\n    getInteractionMetas,\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { defer, isEmptyObject, isNonEmptyArray } from \"../../utils/index.js\";\nimport {\n  DEFAULT_CONTENT_ITEM,\n  DOM_ACTION,\n  HTML_CONTENT_ITEM,\n  JSON_CONTENT_ITEM,\n  MESSAGE_IN_APP,\n} from \"../../constants/schema.js\";\nimport PAGE_WIDE_SCOPE from \"../../constants/pageWideScope.js\";\nimport { DOM_ACTION_COLLECT_INTERACTIONS } from \"./dom-actions/initDomActionsModules.js\";\n\nconst isInteractionTrackingItem = (schema, actionType) =>\n  schema === JSON_CONTENT_ITEM &&\n  actionType === DOM_ACTION_COLLECT_INTERACTIONS;\n\nconst SUPPORTED_SCHEMAS = {\n  [DOM_ACTION]: () => true,\n  [HTML_CONTENT_ITEM]: () => true,\n  [JSON_CONTENT_ITEM]: isInteractionTrackingItem,\n  [MESSAGE_IN_APP]: () => true,\n  [DEFAULT_CONTENT_ITEM]: () => true,\n};\n\nconst filterItemsPredicate = (schema, actionType) =>\n  typeof SUPPORTED_SCHEMAS[schema] === \"function\" &&\n  SUPPORTED_SCHEMAS[schema](schema, actionType);\n\nexport default ({\n  processPropositions,\n  createProposition,\n  renderedPropositions,\n  viewCache,\n}) => {\n  const updatePropositionItems = ({ items, metadataForScope = {} }) => {\n    const { actionType, selector } = metadataForScope;\n\n    return items\n      .filter((item) => filterItemsPredicate(item.schema, actionType))\n      .map((item) => {\n        const { schema } = item;\n\n        if (\n          schema !== HTML_CONTENT_ITEM &&\n          !isInteractionTrackingItem(schema, actionType)\n        ) {\n          return { ...item };\n        }\n        if (!isEmptyObject(metadataForScope)) {\n          return {\n            ...item,\n            schema: isInteractionTrackingItem(schema, actionType)\n              ? DOM_ACTION\n              : schema,\n            data: {\n              ...item.data,\n              selector,\n              type: actionType,\n            },\n          };\n        }\n        return undefined;\n      })\n      .filter((item) => item);\n  };\n\n  const filterPropositionsPredicate = (proposition) => {\n    return !(\n      proposition.scope === PAGE_WIDE_SCOPE && proposition.renderAttempted\n    );\n  };\n\n  const preparePropositions = ({ propositions, metadata }) => {\n    return propositions\n      .filter(filterPropositionsPredicate)\n      .map((proposition) => {\n        if (isNonEmptyArray(proposition.items)) {\n          const { id, scope, scopeDetails } = proposition;\n          return {\n            id,\n            scope,\n            scopeDetails,\n            items: updatePropositionItems({\n              items: proposition.items,\n              metadataForScope: metadata[proposition.scope],\n            }),\n          };\n        }\n        return proposition;\n      })\n      .filter((proposition) => isNonEmptyArray(proposition.items));\n  };\n\n  return ({ propositions = [], metadata = {}, viewName }) => {\n    // We need to immediately call concat so that subsequent sendEvent\n    // calls will wait for applyPropositions to complete before executing.\n    const renderedPropositionsDeferred = defer();\n    renderedPropositions.concat(renderedPropositionsDeferred.promise);\n\n    const propositionsToExecute = preparePropositions({\n      propositions,\n      metadata,\n    }).map((proposition) => createProposition(proposition));\n\n    return Promise.resolve()\n      .then(() => {\n        if (viewName) {\n          return viewCache.getView(viewName);\n        }\n        return [];\n      })\n      .then((additionalPropositions) => {\n        const { render, returnedPropositions } = processPropositions([\n          ...propositionsToExecute,\n          ...additionalPropositions,\n        ]);\n\n        render().then(renderedPropositionsDeferred.resolve);\n\n        return {\n          propositions: returnedPropositions,\n        };\n      });\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ window }) =>\n  () => {\n    return window.location;\n  };\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { noop } from \"../../utils/index.js\";\n\nexport default ({ targetMigrationEnabled }) => {\n  if (targetMigrationEnabled) {\n    return (request) => {\n      request.getPayload().mergeMeta({ target: { migration: true } });\n    };\n  }\n  return noop;\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/*\n * Preprocess customCode actions before rendering, so that offer selectors are remapped appropriately for\n * target offers, to align with the way it works in at.js.\n */\nimport { DOM_ACTION_CUSTOM_CODE } from \"./initDomActionsModules.js\";\n\nconst TARGET_BODY_SELECTOR = \"BODY > *:eq(0)\";\n\nexport default (action) => {\n  const { selector, type } = action;\n\n  if (type !== DOM_ACTION_CUSTOM_CODE) {\n    return action;\n  }\n\n  if (selector !== TARGET_BODY_SELECTOR) {\n    return action;\n  }\n\n  return { ...action, ...{ selector: \"BODY\" } };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/*\n * Preprocess actions before rendering, so that offers are remapped to appendHtml when these are\n * to be applied to page HEAD, to align with the way it works in at.js.\n * Offer content should also be filtered, so that only tags allowed in HEAD are preserved.\n */\n\nimport { selectNodes } from \"../../../utils/dom/index.js\";\nimport { is } from \"./scripts.js\";\nimport { createFragment, selectNodesWithEq } from \"./dom/index.js\";\nimport isBlankString from \"../../../utils/isBlankString.js\";\nimport { HEAD } from \"../../../constants/tagName.js\";\nimport { DOM_ACTION_APPEND_HTML } from \"./initDomActionsModules.js\";\n\nconst HEAD_TAGS_SELECTOR = \"SCRIPT,LINK,STYLE\";\n\nconst filterHeadContent = (content) => {\n  const container = createFragment(content);\n  const headNodes = selectNodes(HEAD_TAGS_SELECTOR, container);\n  return headNodes.map((node) => node.outerHTML).join(\"\");\n};\n\nexport default (action) => {\n  const result = { ...action };\n  const { content, selector } = result;\n\n  if (isBlankString(content)) {\n    return result;\n  }\n\n  if (selector == null) {\n    return result;\n  }\n\n  const container = selectNodesWithEq(selector);\n  if (!is(container[0], HEAD)) {\n    return result;\n  }\n\n  result.type = DOM_ACTION_APPEND_HTML;\n  result.content = filterHeadContent(content);\n\n  return result;\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (preprocessors) => (action) => {\n  if (!action) {\n    return action;\n  }\n  return preprocessors.reduce(\n    (processed, fn) => ({ ...processed, ...fn(processed) }),\n    action,\n  );\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport PAGE_WIDE_SCOPE from \"../../../constants/pageWideScope.js\";\nimport {\n  PAGE_SCOPE_TYPE,\n  PROPOSITION_SCOPE_TYPE,\n  VIEW_SCOPE_TYPE,\n} from \"../constants/scopeType.js\";\n\nexport default ({ preprocess, isPageWideSurface }) => {\n  const createItem = (item, proposition) => {\n    const { id, schema, data, characteristics: { trackingLabel } = {} } = item;\n\n    const schemaType = data ? data.type : undefined;\n\n    const processedData = preprocess(data);\n\n    return {\n      getId() {\n        return id;\n      },\n      getSchema() {\n        return schema;\n      },\n      getSchemaType() {\n        return schemaType;\n      },\n      getData() {\n        return processedData;\n      },\n      getProposition() {\n        return proposition;\n      },\n      getTrackingLabel() {\n        return trackingLabel;\n      },\n      getOriginalItem() {\n        return item;\n      },\n      toString() {\n        return JSON.stringify(item);\n      },\n      toJSON() {\n        return item;\n      },\n    };\n  };\n\n  return (\n    payload,\n    visibleInReturnedItems = true,\n    shouldSuppressDisplay = false,\n  ) => {\n    const { id, scope, scopeDetails, items = [] } = payload;\n    const { characteristics: { scopeType } = {} } = scopeDetails || {};\n\n    return {\n      getScope() {\n        return scope;\n      },\n      getScopeType() {\n        if (scope === PAGE_WIDE_SCOPE || isPageWideSurface(scope)) {\n          return PAGE_SCOPE_TYPE;\n        }\n        if (scopeType === VIEW_SCOPE_TYPE) {\n          return VIEW_SCOPE_TYPE;\n        }\n        return PROPOSITION_SCOPE_TYPE;\n      },\n      getItems() {\n        return items.map((item) => createItem(item, this));\n      },\n      getNotification() {\n        return { id, scope, scopeDetails };\n      },\n      getId() {\n        return id;\n      },\n      toJSON() {\n        return payload;\n      },\n      shouldSuppressDisplay() {\n        return shouldSuppressDisplay;\n      },\n      addToReturnValues(\n        propositions,\n        decisions,\n        includedItems,\n        renderAttempted,\n      ) {\n        if (visibleInReturnedItems) {\n          propositions.push({\n            ...payload,\n            items: includedItems.map((i) => i.getOriginalItem()),\n            renderAttempted,\n          });\n          if (!renderAttempted) {\n            decisions.push({\n              ...payload,\n              items: includedItems.map((i) => i.getOriginalItem()),\n            });\n          }\n        }\n      },\n    };\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default () => {\n  let latest = Promise.resolve([]);\n  return {\n    concat(promise) {\n      latest = latest.then((existingPropositions) => {\n        return promise\n          .then((newPropositions) => {\n            return existingPropositions.concat(newPropositions);\n          })\n          .catch(() => {\n            return existingPropositions;\n          });\n      });\n    },\n    /**\n     * Clears the saved propositions, waiting until the next propositions are resolved and available.\n     *\n     * @returns {Promise<Array>} A promise that resolves to the latest propositions.\n     */\n    clear() {\n      const oldLatest = latest;\n      latest = Promise.resolve([]);\n      return oldLatest;\n    },\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport noop from \"../../../utils/noop.js\";\n\nexport default () => {\n  return {\n    render: noop,\n    setRenderAttempted: true,\n    includeInNotification: true,\n  };\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport const ALWAYS = \"always\";\nexport const NEVER = \"never\";\nexport const DECORATED_ELEMENTS_ONLY = \"decoratedElementsOnly\";\n\nexport const PROPOSITION_INTERACTION_TYPES = [\n  ALWAYS,\n  NEVER,\n  DECORATED_ELEMENTS_ONLY,\n];\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { getAttribute, setAttribute } from \"../dom-actions/dom/index.js\";\nimport { noop } from \"../../../utils/index.js\";\nimport { DOM_ACTION_CLICK } from \"../dom-actions/initDomActionsModules.js\";\nimport {\n  ALWAYS,\n  DECORATED_ELEMENTS_ONLY,\n} from \"../../../constants/propositionInteractionType.js\";\n\nexport const INTERACT_ID_DATA_ATTRIBUTE = \"data-aep-interact-id\";\nexport const CLICK_LABEL_DATA_ATTRIBUTE = \"data-aep-click-label\";\nexport const CLICK_TOKEN_DATA_ATTRIBUTE = \"data-aep-click-token\";\n\nlet lastInteractId = 0;\n\nconst getInteractId = (propositionId, existingInteractId) => {\n  if (existingInteractId) {\n    return parseInt(existingInteractId, 10);\n  }\n\n  return ++lastInteractId;\n};\n\nconst interactionTrackingSupported = (\n  autoCollectPropositionInteractions,\n  decisionProvider,\n) => {\n  if (!autoCollectPropositionInteractions) {\n    return false;\n  }\n\n  if (!autoCollectPropositionInteractions[decisionProvider]) {\n    return false;\n  }\n\n  return [ALWAYS, DECORATED_ELEMENTS_ONLY].includes(\n    autoCollectPropositionInteractions[decisionProvider],\n  );\n};\n\nconst createDecorateProposition = (\n  autoCollectPropositionInteractions,\n  type,\n  propositionId,\n  itemId,\n  trackingLabel,\n  scopeType,\n  notification,\n  storeInteractionMeta,\n) => {\n  const { scopeDetails = {} } = notification;\n  const { decisionProvider } = scopeDetails;\n\n  if (\n    !interactionTrackingSupported(\n      autoCollectPropositionInteractions,\n      decisionProvider,\n    ) &&\n    type !== DOM_ACTION_CLICK\n  ) {\n    return noop;\n  }\n\n  return (element) => {\n    if (!element.tagName) {\n      return;\n    }\n\n    const interactId = getInteractId(\n      propositionId,\n      getAttribute(element, INTERACT_ID_DATA_ATTRIBUTE),\n    );\n\n    storeInteractionMeta(\n      propositionId,\n      itemId,\n      scopeType,\n      notification,\n      interactId,\n    );\n\n    setAttribute(element, INTERACT_ID_DATA_ATTRIBUTE, interactId);\n\n    if (trackingLabel && !getAttribute(element, CLICK_LABEL_DATA_ATTRIBUTE)) {\n      setAttribute(element, CLICK_LABEL_DATA_ATTRIBUTE, trackingLabel);\n    }\n  };\n};\n\nexport default createDecorateProposition;\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { VIEW_SCOPE_TYPE } from \"../constants/scopeType.js\";\n\n/**\n * Creates a handler to manage the rendering status of elements in personalization\n *\n * @param {string} scopeType - The type of scope (e.g. 'view', 'page')\n * @param {string} itemId - The unique identifier for the item being rendered\n */\nexport default (scopeType, itemId) => {\n  // We only care about tracking renders for view scope\n  if (scopeType !== VIEW_SCOPE_TYPE) {\n    return {\n      shouldRender: () => true,\n      markAsRendered: () => {},\n    };\n  }\n  return {\n    /**\n     * Determines if an element should be rendered based on scopeType and previous render status\n     *\n     * @param {Element|null} propositionContainer - The DOM element to check\n     * @returns {boolean} True if the element should be rendered, false otherwise\n     */\n    shouldRender: (propositionContainer) => {\n      if (!propositionContainer) {\n        return true;\n      }\n      const previouslyRendered = (\n        propositionContainer.dataset.adobePropositionIds ?? \"\"\n      ).split(\",\");\n      return !previouslyRendered.includes(itemId);\n    },\n    /**\n     * Marks an element as rendered by setting a data attribute\n     *\n     * @param {Element} propositionContainer - The DOM element to mark as rendered\n     * @returns {void}\n     */\n    markAsRendered: (propositionContainer) => {\n      const previouslyRendered = (\n        propositionContainer.dataset.adobePropositionIds ?? \"\"\n      ).split(\",\");\n      if (!previouslyRendered.includes(itemId)) {\n        previouslyRendered.push(itemId);\n      }\n      propositionContainer.dataset.adobePropositionIds = previouslyRendered\n        .sort()\n        .join(\",\");\n    },\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createDecorateProposition from \"./createDecorateProposition.js\";\nimport createRenderStatusHandler from \"./createRenderStatusHandler.js\";\nimport { DOM_ACTION_CLICK } from \"../dom-actions/initDomActionsModules.js\";\n\nexport default ({\n    modules,\n    logger,\n    storeInteractionMeta,\n    storeClickMeta,\n    autoCollectPropositionInteractions,\n  }) =>\n  (item) => {\n    const { type, selector } = item.getData() || {};\n\n    if (!type) {\n      logger.warn(\"Invalid DOM action data: missing type.\", item.getData());\n      return { setRenderAttempted: false, includeInNotification: false };\n    }\n\n    if (type === DOM_ACTION_CLICK) {\n      if (!selector) {\n        logger.warn(\n          \"Invalid DOM action data: missing selector.\",\n          item.getData(),\n        );\n        return { setRenderAttempted: false, includeInNotification: false };\n      }\n\n      storeClickMeta({\n        selector,\n        meta: {\n          ...item.getProposition().getNotification(),\n          trackingLabel: item.getTrackingLabel(),\n          scopeType: item.getProposition().getScopeType(),\n        },\n      });\n\n      return { setRenderAttempted: true, includeInNotification: false };\n    }\n\n    if (!modules[type]) {\n      logger.warn(\"Invalid DOM action data: unknown type.\", item.getData());\n      return { setRenderAttempted: false, includeInNotification: false };\n    }\n\n    const renderStatusHandler = createRenderStatusHandler(\n      item.getProposition().getScopeType(),\n      item.getId(),\n    );\n    const decorateProposition = createDecorateProposition(\n      autoCollectPropositionInteractions,\n      type,\n      item.getProposition().getId(),\n      item.getId(),\n      item.getTrackingLabel(),\n      item.getProposition().getScopeType(),\n      item.getProposition().getNotification(),\n      storeInteractionMeta,\n    );\n\n    return {\n      render: () =>\n        modules[type](item.getData(), decorateProposition, renderStatusHandler),\n      setRenderAttempted: true,\n      includeInNotification: true,\n    };\n  };\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport createDecorateProposition from \"./createDecorateProposition.js\";\nimport createRenderStatusHandler from \"./createRenderStatusHandler.js\";\n\nexport default ({\n    modules,\n    logger,\n    storeInteractionMeta,\n    autoCollectPropositionInteractions,\n  }) =>\n  (item) => {\n    const { type, selector } = item.getData() || {};\n\n    if (!selector || !type) {\n      return { setRenderAttempted: false, includeInNotification: false };\n    }\n\n    if (!modules[type]) {\n      logger.warn(\"Invalid HTML content data\", item.getData());\n      return { setRenderAttempted: false, includeInNotification: false };\n    }\n\n    const decorateProposition = createDecorateProposition(\n      autoCollectPropositionInteractions,\n      type,\n      item.getProposition().getId(),\n      item.getId(),\n      item.getTrackingLabel(),\n      item.getProposition().getScopeType(),\n      item.getProposition().getNotification(),\n      storeInteractionMeta,\n    );\n\n    const renderStatusHandler = createRenderStatusHandler(\n      item.getProposition().getScopeType(),\n      item.getId(),\n    );\n\n    return {\n      render: () => {\n        return modules[type](\n          item.getData(),\n          decorateProposition,\n          renderStatusHandler,\n        );\n      },\n      setRenderAttempted: true,\n      includeInNotification: true,\n    };\n  };\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { hideElements, showElements } from \"../flicker/index.js\";\n\nconst REDIRECT_HIDING_ELEMENT = \"BODY\";\nexport default ({ logger, executeRedirect, collect }) =>\n  (item) => {\n    const { content } = item.getData() || {};\n\n    if (!content) {\n      logger.warn(\"Invalid Redirect data\", item.getData());\n      return {};\n    }\n\n    const render = () => {\n      hideElements(REDIRECT_HIDING_ELEMENT);\n      return collect({\n        decisionsMeta: [item.getProposition().getNotification()],\n        documentMayUnload: true,\n      })\n        .then(() => {\n          logger.logOnContentRendering({\n            status: \"rendering-redirect\",\n            detail: {\n              propositionDetails: item.getProposition().getNotification(),\n              redirect: content,\n            },\n            message: `Redirect action ${item.toString()} executed.`,\n            logLevel: \"info\",\n          });\n          return executeRedirect(content);\n          // Execute redirect will never resolve. If there are bottom of page events that are waiting\n          // for display notifications from this request, they will never run because this promise will\n          // not resolve. This is intentional because we don't want to run bottom of page events if\n          // there is a redirect.\n        })\n        .catch((error) => {\n          showElements(REDIRECT_HIDING_ELEMENT);\n          throw error;\n        });\n    };\n\n    return { render, setRenderAttempted: true, onlyRenderThis: true };\n  };\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { groupBy, isNonEmptyArray } from \"../../../utils/index.js\";\n\nexport default ({ schemaProcessors, logger }) => {\n  const wrapRenderWithLogging = (render, item) => () => {\n    return Promise.resolve()\n      .then(render)\n      .then(() => {\n        if (logger.enabled) {\n          logger.info(`Action ${item.toString()} executed.`);\n        }\n        return item.toJSON();\n      })\n      .catch((error) => {\n        const { message, stack } = error;\n        const warning = `Failed to execute action ${item.toString()}. ${message} ${stack}`;\n        logger.logOnContentRendering({\n          status: \"rendering-failed\",\n          detail: {\n            propositionDetails: item.getProposition().getNotification(),\n            item: item.toJSON(),\n          },\n          error,\n          message: warning,\n          logLevel: \"warn\",\n        });\n\n        return undefined;\n      });\n  };\n\n  const renderItems = async (renderers, meta) => {\n    const results = await Promise.allSettled(\n      renderers.map((renderer) => renderer()),\n    );\n    const successes = results\n      .filter((result) => result.status === \"fulfilled\")\n      .map((result) => result.value);\n    // as long as at least one renderer succeeds, we want to add the notification\n    // to the display notifications\n    if (meta && isNonEmptyArray(successes)) {\n      return { ...meta, items: successes };\n    }\n    return undefined;\n  };\n\n  const processItem = (item) => {\n    const processor = schemaProcessors[item.getSchema()];\n    if (!processor) {\n      return {};\n    }\n    return processor(item);\n  };\n\n  const processItems = ({\n    renderers: existingRenderers,\n    returnedPropositions: existingReturnedPropositions,\n    returnedDecisions: existingReturnedDecisions,\n    items,\n    proposition,\n  }) => {\n    let renderers = [...existingRenderers];\n    let returnedPropositions = [...existingReturnedPropositions];\n    let returnedDecisions = [...existingReturnedDecisions];\n    let renderedItems = [];\n    let nonRenderedItems = [];\n    let itemRenderers = [];\n    let atLeastOneWithNotification = false;\n    let render;\n    let setRenderAttempted;\n    let includeInNotification;\n    let onlyRenderThis = false;\n    let i = 0;\n    let item;\n\n    while (items.length > i) {\n      item = items[i];\n      ({ render, setRenderAttempted, includeInNotification, onlyRenderThis } =\n        processItem(item));\n\n      if (onlyRenderThis) {\n        returnedPropositions = [];\n        returnedDecisions = [];\n        if (setRenderAttempted) {\n          renderedItems = [item];\n          nonRenderedItems = [];\n        } else {\n          renderedItems = [];\n          nonRenderedItems = [item];\n        }\n        renderers = [];\n        itemRenderers = [render];\n        atLeastOneWithNotification = includeInNotification;\n        break;\n      }\n\n      if (render) {\n        itemRenderers.push(wrapRenderWithLogging(render, item));\n      }\n      if (includeInNotification) {\n        atLeastOneWithNotification = true;\n      }\n      if (setRenderAttempted) {\n        renderedItems.push(item);\n      } else {\n        nonRenderedItems.push(item);\n      }\n      i += 1;\n    }\n    if (itemRenderers.length > 0) {\n      const meta = atLeastOneWithNotification\n        ? proposition.getNotification()\n        : undefined;\n      renderers.push(() => renderItems(itemRenderers, meta));\n    } else if (atLeastOneWithNotification) {\n      renderers.push(() => Promise.resolve(proposition.getNotification()));\n    }\n    if (renderedItems.length > 0) {\n      proposition.addToReturnValues(\n        returnedPropositions,\n        returnedDecisions,\n        renderedItems,\n        true,\n      );\n    }\n    if (nonRenderedItems.length > 0) {\n      proposition.addToReturnValues(\n        returnedPropositions,\n        returnedDecisions,\n        nonRenderedItems,\n        false,\n      );\n    }\n\n    return {\n      renderers,\n      returnedPropositions,\n      returnedDecisions,\n      onlyRenderThis,\n    };\n  };\n\n  return (renderPropositions, nonRenderPropositions = []) => {\n    let renderers = [];\n    let returnedPropositions = [];\n    let returnedDecisions = [];\n    let onlyRenderThis;\n    let i = 0;\n    let proposition;\n    let items;\n\n    while (renderPropositions.length > i) {\n      proposition = renderPropositions[i];\n      items = proposition.getItems();\n      ({ renderers, returnedPropositions, returnedDecisions, onlyRenderThis } =\n        processItems({\n          renderers,\n          returnedPropositions,\n          returnedDecisions,\n          items,\n          proposition,\n        }));\n      if (onlyRenderThis) {\n        break;\n      }\n      i += 1;\n    }\n\n    if (onlyRenderThis) {\n      // if onlyRenderThis is true, that means returnedPropositions and returnedDecisions\n      // only contains the proposition that triggered only rendering this. We need to\n      // add the other propositions to the returnedPropositions and returnedDecisions.\n      renderPropositions.forEach((p, index) => {\n        if (index !== i) {\n          p.addToReturnValues(\n            returnedPropositions,\n            returnedDecisions,\n            p.getItems(),\n            false,\n          );\n        }\n      });\n    }\n\n    nonRenderPropositions.forEach((p) => {\n      p.addToReturnValues(\n        returnedPropositions,\n        returnedDecisions,\n        p.getItems(),\n        false,\n      );\n    });\n\n    const render = () => {\n      return Promise.all(renderers.map((renderer) => renderer())).then(\n        (metas) => {\n          const propositions = metas.filter((meta) => meta);\n          const renderedPropositions = propositions.map((prop) => {\n            const { id, scope, scopeDetails } = prop;\n            return { id, scope, scopeDetails };\n          });\n          if (isNonEmptyArray(propositions)) {\n            const propsByScope = groupBy(propositions, (p) => p.scope);\n            logger.logOnContentRendering({\n              status: \"rendering-succeeded\",\n              detail: { ...propsByScope },\n              message: `Scopes: ${JSON.stringify(propsByScope)} successfully executed.`,\n              logLevel: \"info\",\n            });\n          }\n          return renderedPropositions;\n        },\n      );\n    };\n    return { returnedPropositions, returnedDecisions, render };\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { MESSAGE_IN_APP } from \"../../constants/schema.js\";\n\n// When multiple In-App messages propositions are returned, we need to show only one\n// of them (the one with lowest rank). This function keep track of the number of\n// times it was called. It returns false for the first proposition that contains\n// In-App messages items, true afterwards.\nconst createShouldSuppressDisplay = () => {\n  let count = 0;\n  return (proposition) => {\n    const { items = [] } = proposition;\n\n    if (!items.some((item) => item.schema === MESSAGE_IN_APP)) {\n      return false;\n    }\n    count += 1;\n\n    return count > 1;\n  };\n};\n\nexport default ({\n  processPropositions,\n  createProposition,\n  notificationHandler,\n}) => {\n  return ({ renderDecisions, propositions, event, personalization = {} }) => {\n    if (!renderDecisions) {\n      return Promise.resolve();\n    }\n\n    const { sendDisplayEvent = true } = personalization;\n    const viewName = event ? event.getViewName() : undefined;\n\n    const shouldSuppressDisplay = createShouldSuppressDisplay();\n\n    const propositionsToExecute = propositions.map((proposition) =>\n      createProposition(proposition, true, shouldSuppressDisplay(proposition)),\n    );\n\n    const { render, returnedPropositions } = processPropositions(\n      propositionsToExecute,\n    );\n\n    const handleNotifications = notificationHandler(\n      renderDecisions,\n      sendDisplayEvent,\n      viewName,\n    );\n\n    const propositionsById = propositionsToExecute.reduce(\n      (tot, proposition) => {\n        tot[proposition.getId()] = proposition;\n        return tot;\n      },\n      {},\n    );\n\n    render().then((decisionsMeta) => {\n      const decisionsMetaDisplay = decisionsMeta.filter(\n        (meta) => !propositionsById[meta.id].shouldSuppressDisplay(),\n      );\n\n      const decisionsMetaSuppressed = decisionsMeta.filter((meta) =>\n        propositionsById[meta.id].shouldSuppressDisplay(),\n      );\n\n      handleNotifications(decisionsMetaDisplay, decisionsMetaSuppressed);\n    });\n\n    return Promise.resolve({\n      propositions: returnedPropositions,\n    });\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport const TEXT_HTML = \"text/html\";\nexport const APPLICATION_JSON = \"application/json\";\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { APPLICATION_JSON } from \"../../../constants/contentType.js\";\n\nconst DEFAULT_CONTENT = \"defaultContent\";\n\nconst expectedProps = [\"content\", \"contentType\"];\nconst expectedContentProps = [\"mobileParameters\", \"webParameters\", \"html\"];\n\nconst isValidInAppMessage = (data, logger) => {\n  for (let i = 0; i < expectedProps.length; i += 1) {\n    const prop = expectedProps[i];\n    if (!Object.prototype.hasOwnProperty.call(data, prop)) {\n      logger.warn(\n        `Invalid in-app message data: missing property '${prop}'.`,\n        data,\n      );\n      return false;\n    }\n  }\n\n  const { content, contentType } = data;\n\n  if (contentType === APPLICATION_JSON) {\n    for (let i = 0; i < expectedContentProps.length; i += 1) {\n      const prop = expectedContentProps[i];\n      if (!Object.prototype.hasOwnProperty.call(content, prop)) {\n        logger.warn(\n          `Invalid in-app message data.content: missing property '${prop}'.`,\n          data,\n        );\n        return false;\n      }\n    }\n  }\n\n  return true;\n};\n\nexport default ({ modules, logger }) => {\n  return (item) => {\n    const data = item.getData();\n    const proposition = item.getProposition();\n    const meta = { ...proposition.getNotification() };\n    const shouldSuppressDisplay = proposition.shouldSuppressDisplay();\n\n    if (!data) {\n      logger.warn(\"Invalid in-app message data: undefined.\", data);\n      return {};\n    }\n\n    const { type = DEFAULT_CONTENT } = data;\n\n    if (!modules[type]) {\n      logger.warn(\"Invalid in-app message data: unknown type.\", data);\n      return {};\n    }\n\n    if (!isValidInAppMessage(data, logger)) {\n      return {};\n    }\n\n    if (!meta) {\n      logger.warn(\"Invalid in-app message meta: undefined.\", meta);\n      return {};\n    }\n\n    return {\n      render: () => {\n        return shouldSuppressDisplay\n          ? null\n          : modules[type]({\n              ...data,\n              meta,\n            });\n      },\n      setRenderAttempted: true,\n      includeInNotification: true,\n    };\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { isNonEmptyArray, queryString } from \"../../../utils/index.js\";\nimport { removeNode, selectNodes } from \"../../../utils/dom/index.js\";\nimport decodeUriComponentSafely from \"../../../utils/decodeUriComponentSafely.js\";\n\nexport const removeElementById = (id) => {\n  const element = selectNodes(`#${id}`, document);\n  if (element && element.length > 0) {\n    removeNode(element[0]);\n  }\n};\nexport const parseAnchor = (anchor) => {\n  const nothing = {};\n\n  if (!anchor || anchor.tagName.toLowerCase() !== \"a\") {\n    return nothing;\n  }\n\n  const { href } = anchor;\n  if (!href || !href.startsWith(\"adbinapp://\")) {\n    return nothing;\n  }\n\n  const hrefParts = href.split(\"?\");\n\n  const action = hrefParts[0].split(\"://\")[1];\n  const label = anchor.innerText;\n  const uuid = anchor.getAttribute(\"data-uuid\") || \"\";\n\n  let interaction;\n  let link;\n\n  if (isNonEmptyArray(hrefParts)) {\n    const queryParams = queryString.parse(hrefParts[1]);\n    interaction = queryParams.interaction || \"\";\n    link = decodeUriComponentSafely(queryParams.link || \"\");\n  }\n  return {\n    action,\n    interaction,\n    link,\n    label,\n    uuid,\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (window) =>\n  (url, preserveHistory = false) => {\n    if (preserveHistory) {\n      window.location.href = url;\n    } else {\n      window.location.replace(url);\n    }\n    // Return a promise that never resolves because redirects never complete\n    // within the current page.\n    return new Promise(() => {});\n  };\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { getNonce } from \"../../dom-actions/dom/index.js\";\nimport { parseAnchor, removeElementById } from \"../utils.js\";\nimport { TEXT_HTML } from \"../../../../constants/contentType.js\";\nimport { isNonEmptyString } from \"../../../../utils/index.js\";\nimport { createNode } from \"../../../../utils/dom/index.js\";\nimport { objectOf } from \"../../../../utils/validation/index.js\";\nimport { PropositionEventType } from \"../../../../constants/propositionEventType.js\";\nimport { EVENT_TYPE_TRUE, INTERACT } from \"../../../../constants/eventType.js\";\nimport createRedirect from \"../../dom-actions/createRedirect.js\";\n\nconst MESSAGING_CONTAINER_ID = \"alloy-messaging-container\";\nconst OVERLAY_CONTAINER_ID = \"alloy-overlay-container\";\nconst IFRAME_ID = \"alloy-content-iframe\";\n\nconst dismissMessage = () =>\n  [MESSAGING_CONTAINER_ID, OVERLAY_CONTAINER_ID].forEach(removeElementById);\nexport const createIframeClickHandler = (\n  interact,\n  navigateToUrl = createRedirect(window),\n) => {\n  return (event) => {\n    event.preventDefault();\n    event.stopImmediatePropagation();\n\n    const { target } = event;\n\n    const anchor =\n      target.tagName.toLowerCase() === \"a\" ? target : target.closest(\"a\");\n\n    if (!anchor) {\n      return;\n    }\n\n    const { action, interaction, link, label, uuid } = parseAnchor(anchor);\n\n    interact(action, {\n      label,\n      id: interaction,\n      uuid,\n      link,\n    });\n\n    if (action === \"dismiss\") {\n      dismissMessage();\n    }\n\n    if (isNonEmptyString(link) && link.length > 0) {\n      navigateToUrl(link, true);\n    }\n  };\n};\n\nexport const createIframe = (htmlContent, clickHandler) => {\n  const parser = new DOMParser();\n  const htmlDocument = parser.parseFromString(htmlContent, TEXT_HTML);\n  const scriptTag = htmlDocument.querySelector(\"script\");\n\n  if (scriptTag) {\n    scriptTag.setAttribute(\"nonce\", getNonce());\n  }\n  const element = createNode(\"iframe\", {\n    src: URL.createObjectURL(\n      new Blob([htmlDocument.documentElement.outerHTML], { type: \"text/html\" }),\n    ),\n    id: IFRAME_ID,\n  });\n\n  element.addEventListener(\"load\", () => {\n    const { addEventListener } =\n      element.contentDocument || element.contentWindow.document;\n    addEventListener(\"click\", clickHandler);\n  });\n\n  return element;\n};\n\nconst renderMessage = (iframe, webParameters, container, overlay) => {\n  [\n    { id: OVERLAY_CONTAINER_ID, element: overlay },\n    { id: MESSAGING_CONTAINER_ID, element: container },\n    { id: IFRAME_ID, element: iframe },\n  ].forEach(({ id, element }) => {\n    const { style = {}, params = {} } = webParameters[id];\n\n    Object.assign(element.style, style);\n\n    const {\n      parentElement = \"body\",\n      insertionMethod = \"appendChild\",\n      enabled = true,\n    } = params;\n\n    const parent = document.querySelector(parentElement);\n    if (enabled && parent && typeof parent[insertionMethod] === \"function\") {\n      parent[insertionMethod](element);\n    }\n  });\n};\n\nexport const buildStyleFromMobileParameters = (mobileParameters) => {\n  const {\n    verticalAlign,\n    width,\n    horizontalAlign,\n    backdropColor,\n    height,\n    cornerRadius,\n    horizontalInset,\n    verticalInset,\n    uiTakeover = false,\n  } = mobileParameters;\n\n  const style = {\n    width: width ? `${width}%` : \"100%\",\n    backgroundColor: backdropColor || \"rgba(0, 0, 0, 0.5)\",\n    borderRadius: cornerRadius ? `${cornerRadius}px` : \"0px\",\n    border: \"none\",\n    position: uiTakeover ? \"fixed\" : \"relative\",\n    overflow: \"hidden\",\n  };\n  if (horizontalAlign === \"left\") {\n    style.left = horizontalInset ? `${horizontalInset}%` : \"0\";\n  } else if (horizontalAlign === \"right\") {\n    style.right = horizontalInset ? `${horizontalInset}%` : \"0\";\n  } else if (horizontalAlign === \"center\") {\n    style.left = \"50%\";\n    style.transform = \"translateX(-50%)\";\n  }\n\n  if (verticalAlign === \"top\") {\n    style.top = verticalInset ? `${verticalInset}%` : \"0\";\n  } else if (verticalAlign === \"bottom\") {\n    style.position = \"fixed\";\n    style.bottom = verticalInset ? `${verticalInset}%` : \"0\";\n  } else if (verticalAlign === \"center\") {\n    style.top = \"50%\";\n    style.transform = `${\n      horizontalAlign === \"center\" ? `${style.transform} ` : \"\"\n    }translateY(-50%)`;\n    style.display = \"flex\";\n    style.alignItems = \"center\";\n    style.justifyContent = \"center\";\n  }\n\n  if (height) {\n    style.height = `${height}vh`;\n  } else {\n    style.height = \"100%\";\n  }\n  return style;\n};\n\nexport const mobileOverlay = (mobileParameters) => {\n  const { backdropOpacity, backdropColor } = mobileParameters;\n  const opacity = backdropOpacity || 0.5;\n  const color = backdropColor || \"#FFFFFF\";\n  const style = {\n    position: \"fixed\",\n    top: \"0\",\n    left: \"0\",\n    width: \"100%\",\n    height: \"100%\",\n    background: \"transparent\",\n    opacity,\n    backgroundColor: color,\n  };\n  return style;\n};\n\nconst REQUIRED_PARAMS = [\"enabled\", \"parentElement\", \"insertionMethod\"];\n\nconst isValidWebParameters = (webParameters) => {\n  if (!webParameters) {\n    return false;\n  }\n\n  const ids = Object.keys(webParameters);\n\n  if (!ids.includes(MESSAGING_CONTAINER_ID)) {\n    return false;\n  }\n\n  if (!ids.includes(OVERLAY_CONTAINER_ID)) {\n    return false;\n  }\n\n  const valuesArray = Object.values(webParameters);\n\n  for (let i = 0; i < valuesArray.length; i += 1) {\n    if (!objectOf(valuesArray[i], \"style\")) {\n      return false;\n    }\n\n    if (!objectOf(valuesArray[i], \"params\")) {\n      return false;\n    }\n\n    for (let j = 0; j < REQUIRED_PARAMS.length; j += 1) {\n      if (!objectOf(valuesArray[i].params, REQUIRED_PARAMS[j])) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n};\n\nconst generateWebParameters = (mobileParameters) => {\n  if (!mobileParameters) {\n    return undefined;\n  }\n\n  const { uiTakeover = false } = mobileParameters;\n\n  return {\n    [IFRAME_ID]: {\n      style: {\n        border: \"none\",\n        width: \"100%\",\n        height: \"100%\",\n      },\n      params: {\n        enabled: true,\n        parentElement: \"#alloy-messaging-container\",\n        insertionMethod: \"appendChild\",\n      },\n    },\n    [MESSAGING_CONTAINER_ID]: {\n      style: buildStyleFromMobileParameters(mobileParameters),\n      params: {\n        enabled: true,\n        parentElement: \"body\",\n        insertionMethod: \"appendChild\",\n      },\n    },\n    [OVERLAY_CONTAINER_ID]: {\n      style: mobileOverlay(mobileParameters),\n      params: {\n        enabled: uiTakeover === true,\n        parentElement: \"body\",\n        insertionMethod: \"appendChild\",\n      },\n    },\n  };\n};\n\n// eslint-disable-next-line default-param-last\nexport const displayHTMLContentInIframe = (settings = {}, interact) => {\n  dismissMessage();\n  const { content, contentType, mobileParameters } = settings;\n  let { webParameters } = settings;\n\n  if (contentType !== TEXT_HTML) {\n    return;\n  }\n\n  const container = createNode(\"div\", { id: MESSAGING_CONTAINER_ID });\n  const iframe = createIframe(content, createIframeClickHandler(interact));\n  const overlay = createNode(\"div\", { id: OVERLAY_CONTAINER_ID });\n\n  if (!isValidWebParameters(webParameters)) {\n    webParameters = generateWebParameters(mobileParameters);\n  }\n\n  if (!webParameters) {\n    return;\n  }\n\n  renderMessage(iframe, webParameters, container, overlay);\n};\n\nexport default (settings, collect) => {\n  return new Promise((resolve) => {\n    const { meta } = settings;\n    displayHTMLContentInIframe(settings, (action, propositionAction) => {\n      const propositionEventTypes = {};\n      propositionEventTypes[PropositionEventType.INTERACT] = EVENT_TYPE_TRUE;\n\n      if (Object.values(PropositionEventType).indexOf(action) !== -1) {\n        propositionEventTypes[action] = EVENT_TYPE_TRUE;\n      }\n\n      collect({\n        decisionsMeta: [meta],\n        propositionAction,\n        eventType: INTERACT,\n        propositionEventTypes: Object.keys(propositionEventTypes),\n      });\n    });\n\n    resolve({ meta });\n  });\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport displayIframeContent from \"./actions/displayIframeContent.js\";\n\nexport default (collect) => {\n  return {\n    defaultContent: (settings) => displayIframeContent(settings, collect),\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { defer } from \"../../utils/index.js\";\nimport { SUPPRESS } from \"../../constants/eventType.js\";\nimport isNonEmptyArray from \"../../utils/isNonEmptyArray.js\";\n\nexport default (collect, renderedPropositions) => {\n  return (isRenderDecisions, isSendDisplayEvent, viewName) => {\n    if (!isRenderDecisions) {\n      // If we aren't rendering anything, then we don't need to sendDisplayEvents.\n      return () => undefined;\n    }\n\n    if (!isSendDisplayEvent) {\n      const renderedPropositionsDeferred = defer();\n      renderedPropositions.concat(renderedPropositionsDeferred.promise);\n      return renderedPropositionsDeferred.resolve;\n    }\n\n    return (decisionsMetaDisplay = [], decisionsMetaSuppressed = []) => {\n      if (isNonEmptyArray(decisionsMetaDisplay)) {\n        collect({\n          decisionsMeta: decisionsMetaDisplay,\n          viewName,\n        });\n      }\n\n      if (isNonEmptyArray(decisionsMetaSuppressed)) {\n        collect({\n          decisionsMeta: decisionsMetaSuppressed,\n          eventType: SUPPRESS,\n          propositionAction: { reason: \"Conflict\" },\n          viewName,\n        });\n      }\n    };\n  };\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { OUT } from \"../../constants/consentStatus.js\";\n\nexport default ({ showContainers, consent }) =>\n  () => {\n    const { state, wasSet } = consent.current();\n    if (state === OUT && wasSet) {\n      showContainers();\n    } else {\n      consent.awaitConsent().catch(showContainers);\n    }\n  };\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { VIEW_SCOPE_TYPE } from \"../../constants/scopeType.js\";\nimport getAttribute from \"../dom/getAttribute.js\";\nimport {\n  CLICK_LABEL_DATA_ATTRIBUTE,\n  CLICK_TOKEN_DATA_ATTRIBUTE,\n  INTERACT_ID_DATA_ATTRIBUTE,\n} from \"../../handlers/createDecorateProposition.js\";\nimport { cleanMetas } from \"../../utils/metaUtils.js\";\nimport {\n  ALWAYS,\n  DECORATED_ELEMENTS_ONLY,\n} from \"../../../../constants/propositionInteractionType.js\";\n\nconst getInteractionDetail = (clickedElement) => {\n  const { documentElement } = document;\n  let element = clickedElement;\n\n  const interactIds = new Set();\n  let clickLabel;\n  let clickToken;\n\n  while (\n    element &&\n    element !== documentElement &&\n    !(element instanceof ShadowRoot)\n  ) {\n    const interactId = getAttribute(element, INTERACT_ID_DATA_ATTRIBUTE);\n\n    if (interactId) {\n      interactIds.add(interactId);\n    }\n\n    clickLabel =\n      clickLabel || getAttribute(element, CLICK_LABEL_DATA_ATTRIBUTE);\n\n    clickToken =\n      clickToken || getAttribute(element, CLICK_TOKEN_DATA_ATTRIBUTE);\n\n    element = element.parentNode;\n  }\n\n  return { interactIds: [...interactIds], clickLabel, clickToken };\n};\n\nconst extractViewName = (metas) => {\n  const foundMetaWithScopeTypeView = metas.find(\n    (meta) => meta.scopeType === VIEW_SCOPE_TYPE,\n  );\n\n  return foundMetaWithScopeTypeView\n    ? foundMetaWithScopeTypeView.scope\n    : undefined;\n};\n\nconst createMetaFilter =\n  (autoCollectPropositionInteractions, clickLabel, clickToken) => (meta) => {\n    const { scopeDetails = {} } = meta;\n    const { decisionProvider } = scopeDetails;\n    if (autoCollectPropositionInteractions[decisionProvider] === ALWAYS) {\n      return true;\n    }\n\n    return (\n      autoCollectPropositionInteractions[decisionProvider] ===\n        DECORATED_ELEMENTS_ONLY &&\n      (clickLabel || clickToken)\n    );\n  };\n\nexport default (\n  clickedElement,\n  getInteractionMetas,\n  autoCollectPropositionInteractions,\n) => {\n  const {\n    interactIds,\n    clickLabel = \"\",\n    clickToken,\n  } = getInteractionDetail(clickedElement);\n\n  const metasMatchingConfigurationOptions = createMetaFilter(\n    autoCollectPropositionInteractions,\n    clickLabel,\n    clickToken,\n  );\n\n  if (interactIds.length === 0) {\n    return {};\n  }\n\n  const metas = getInteractionMetas(interactIds).filter(\n    metasMatchingConfigurationOptions,\n  );\n\n  return {\n    decisionsMeta: cleanMetas(metas),\n    propositionActionLabel: clickLabel,\n    propositionActionToken: clickToken,\n    viewName: extractViewName(metas),\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport const PERSONALIZATION_DECISIONS_HANDLE = \"personalization:decisions\";\nexport const ADOBE_JOURNEY_OPTIMIZER = \"AJO\";\nexport const ADOBE_TARGET = \"TGT\";\n","/*\nCopyright 2019 Adobe. Ackll rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  anyOf,\n  boolean,\n  literal,\n  objectOf,\n  string,\n} from \"../../utils/validation/index.js\";\nimport createComponent from \"./createComponent.js\";\nimport { initDomActionsModules } from \"./dom-actions/index.js\";\nimport createCollect from \"../../utils/createCollect.js\";\nimport { createHideContainers, createShowContainers } from \"./flicker/index.js\";\nimport createFetchDataHandler from \"./createFetchDataHandler.js\";\nimport collectClicks from \"./dom-actions/clicks/collectClicks.js\";\nimport isAuthoringModeEnabled from \"./utils/isAuthoringModeEnabled.js\";\nimport { mergeDecisionsMeta, mergeQuery } from \"../../utils/event.js\";\nimport createOnClickHandler from \"./createOnClickHandler.js\";\nimport createViewCacheManager from \"./createViewCacheManager.js\";\nimport createViewChangeHandler from \"./createViewChangeHandler.js\";\nimport createClickStorage from \"./createClickStorage.js\";\nimport createInteractionStorage from \"./createInteractionStorage.js\";\nimport createApplyPropositions from \"./createApplyPropositions.js\";\nimport createGetPageLocation from \"./createGetPageLocation.js\";\nimport createSetTargetMigration from \"./createSetTargetMigration.js\";\nimport remapCustomCodeOffers from \"./dom-actions/remapCustomCodeOffers.js\";\nimport remapHeadOffers from \"./dom-actions/remapHeadOffers.js\";\nimport createPreprocess from \"./dom-actions/createPreprocess.js\";\nimport injectCreateProposition from \"./handlers/injectCreateProposition.js\";\nimport createAsyncArray from \"./utils/createAsyncArray.js\";\nimport * as schema from \"../../constants/schema.js\";\nimport processDefaultContent from \"./handlers/processDefaultContent.js\";\nimport { isPageWideSurface } from \"./utils/surfaceUtils.js\";\nimport createProcessDomAction from \"./handlers/createProcessDomAction.js\";\nimport createProcessHtmlContent from \"./handlers/createProcessHtmlContent.js\";\nimport createProcessRedirect from \"./handlers/createProcessRedirect.js\";\nimport createProcessPropositions from \"./handlers/createProcessPropositions.js\";\nimport createOnDecisionHandler from \"./createOnDecisionHandler.js\";\nimport createProcessInAppMessage from \"./handlers/createProcessInAppMessage.js\";\nimport initInAppMessageActionsModules from \"./in-app-message-actions/initInAppMessageActionsModules.js\";\nimport createRedirect from \"./dom-actions/createRedirect.js\";\nimport createNotificationHandler from \"./createNotificationHandler.js\";\nimport createHandleConsentFlicker from \"./createHandleConsentFlicker.js\";\nimport collectInteractions from \"./dom-actions/clicks/collectInteractions.js\";\nimport {\n  ALWAYS,\n  NEVER,\n  PROPOSITION_INTERACTION_TYPES,\n} from \"../../constants/propositionInteractionType.js\";\nimport {\n  ADOBE_JOURNEY_OPTIMIZER,\n  ADOBE_TARGET,\n} from \"../../constants/decisionProvider.js\";\n\nconst createPersonalization = ({ config, logger, eventManager, consent }) => {\n  const {\n    targetMigrationEnabled,\n    prehidingStyle,\n    autoCollectPropositionInteractions,\n  } = config;\n  const collect = createCollect({ eventManager, mergeDecisionsMeta });\n\n  const showContainers = createShowContainers(logger);\n  const hideContainers = createHideContainers(logger);\n\n  const { storeInteractionMeta, getInteractionMetas } =\n    createInteractionStorage();\n\n  const { storeClickMeta, getClickSelectors, getClickMetas } =\n    createClickStorage();\n\n  const getPageLocation = createGetPageLocation({ window });\n  const domActionsModules = initDomActionsModules();\n\n  const preprocess = createPreprocess([remapHeadOffers, remapCustomCodeOffers]);\n  const createProposition = injectCreateProposition({\n    preprocess,\n    isPageWideSurface,\n  });\n  const viewCache = createViewCacheManager({ createProposition });\n\n  const executeRedirect = createRedirect(window);\n  const schemaProcessors = {\n    [schema.DEFAULT_CONTENT_ITEM]: processDefaultContent,\n    [schema.DOM_ACTION]: createProcessDomAction({\n      modules: domActionsModules,\n      logger,\n      storeInteractionMeta,\n      storeClickMeta,\n      autoCollectPropositionInteractions,\n    }),\n    [schema.HTML_CONTENT_ITEM]: createProcessHtmlContent({\n      modules: domActionsModules,\n      logger,\n      storeInteractionMeta,\n      autoCollectPropositionInteractions,\n    }),\n    [schema.REDIRECT_ITEM]: createProcessRedirect({\n      logger,\n      executeRedirect,\n      collect,\n    }),\n    [schema.MESSAGE_IN_APP]: createProcessInAppMessage({\n      modules: initInAppMessageActionsModules(collect),\n      logger,\n    }),\n  };\n\n  const processPropositions = createProcessPropositions({\n    schemaProcessors,\n    logger,\n  });\n\n  const renderedPropositions = createAsyncArray();\n  const notificationHandler = createNotificationHandler(\n    collect,\n    renderedPropositions,\n  );\n\n  const fetchDataHandler = createFetchDataHandler({\n    prehidingStyle,\n    showContainers,\n    hideContainers,\n    mergeQuery,\n    processPropositions,\n    createProposition,\n    notificationHandler,\n    consent,\n    logger,\n  });\n\n  const onClickHandler = createOnClickHandler({\n    mergeDecisionsMeta,\n    collectInteractions,\n    collectClicks,\n    getInteractionMetas,\n    getClickMetas,\n    getClickSelectors,\n    autoCollectPropositionInteractions,\n  });\n\n  const viewChangeHandler = createViewChangeHandler({\n    processPropositions,\n    viewCache,\n    logger,\n  });\n  const applyPropositions = createApplyPropositions({\n    processPropositions,\n    createProposition,\n    renderedPropositions,\n    viewCache,\n  });\n  const setTargetMigration = createSetTargetMigration({\n    targetMigrationEnabled,\n  });\n\n  const onDecisionHandler = createOnDecisionHandler({\n    processPropositions,\n    createProposition,\n    notificationHandler,\n  });\n\n  const handleConsentFlicker = createHandleConsentFlicker({\n    showContainers,\n    consent,\n  });\n\n  return createComponent({\n    getPageLocation,\n    logger,\n    fetchDataHandler,\n    viewChangeHandler,\n    onClickHandler,\n    isAuthoringModeEnabled,\n    mergeQuery,\n    viewCache,\n    showContainers,\n    applyPropositions,\n    setTargetMigration,\n    mergeDecisionsMeta,\n    renderedPropositions,\n    onDecisionHandler,\n    handleConsentFlicker,\n  });\n};\n\ncreatePersonalization.namespace = \"Personalization\";\n\nconst interactionConfigOptions = PROPOSITION_INTERACTION_TYPES.map(\n  (propositionInteractionType) => literal(propositionInteractionType),\n);\n\ncreatePersonalization.configValidators = objectOf({\n  prehidingStyle: string().nonEmpty(),\n  targetMigrationEnabled: boolean().default(false),\n  autoCollectPropositionInteractions: objectOf({\n    [ADOBE_JOURNEY_OPTIMIZER]: anyOf(interactionConfigOptions).default(ALWAYS),\n    [ADOBE_TARGET]: anyOf(interactionConfigOptions).default(NEVER),\n  })\n    .default({\n      [ADOBE_JOURNEY_OPTIMIZER]: ALWAYS,\n      [ADOBE_TARGET]: NEVER,\n    })\n    .noUnknownFields(),\n});\n\nexport default createPersonalization;\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nconst isPlainObject = (obj) =>\n  obj !== null &&\n  typeof obj === \"object\" &&\n  Object.getPrototypeOf(obj) === Object.prototype;\n\nconst flattenObject = (obj, result = {}, keys = []) => {\n  Object.keys(obj).forEach((key) => {\n    if (isPlainObject(obj[key]) || Array.isArray(obj[key])) {\n      flattenObject(obj[key], result, [...keys, key]);\n    } else {\n      result[[...keys, key].join(\".\")] = obj[key];\n    }\n  });\n\n  return result;\n};\n\nexport default (obj) => {\n  if (!isPlainObject(obj)) {\n    return obj;\n  }\n\n  return flattenObject(obj);\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { PERSONALIZATION_DECISIONS_HANDLE } from \"../../constants/decisionProvider.js\";\nimport flattenObject from \"../../utils/flattenObject.js\";\n\nexport default ({\n  renderDecisions,\n  decisionProvider,\n  applyResponse,\n  event,\n  personalization,\n  decisionContext,\n}) => {\n  const context = {\n    ...flattenObject(event.getContent()),\n    ...decisionContext,\n  };\n\n  return ({ response }) => {\n    decisionProvider.addPayloads(\n      response.getPayloadsByType(PERSONALIZATION_DECISIONS_HANDLE),\n    );\n\n    // only evaluate events that include a personalization query\n    if (!event.hasQuery()) {\n      return { propositions: [] };\n    }\n\n    const propositions = decisionProvider.evaluate(context);\n\n    return applyResponse({\n      renderDecisions,\n      propositions,\n      event,\n      personalization,\n    });\n  };\n};\n","const ConditionType = {\n  MATCHER: \"matcher\",\n  GROUP: \"group\",\n  HISTORICAL: \"historical\"\n};\nconst MatcherType = {\n  EQUALS: \"eq\",\n  NOT_EQUALS: \"ne\",\n  EXISTS: \"ex\",\n  NOT_EXISTS: \"nx\",\n  GREATER_THAN: \"gt\",\n  GREATER_THAN_OR_EQUAL_TO: \"ge\",\n  LESS_THAN: \"lt\",\n  LESS_THAN_OR_EQUAL_TO: \"le\",\n  CONTAINS: \"co\",\n  NOT_CONTAINS: \"nc\",\n  STARTS_WITH: \"sw\",\n  ENDS_WITH: \"ew\"\n};\nconst LogicType = {\n  AND: \"and\",\n  OR: \"or\"\n};\nconst SearchType = {\n  ORDERED: \"ordered\",\n  MOST_RECENT: \"mostRecent\"\n};\n\nfunction isObjectOrUndefined(value) {\n  return typeof value === \"object\" || typeof value === \"undefined\";\n}\n\nfunction createEquals() {\n  return {\n    matches: (context, key, values = []) => {\n      if (isObjectOrUndefined(context[key])) {\n        return false;\n      }\n      const contextValue = String(context[key]).toLowerCase();\n      for (let i = 0; i < values.length; i += 1) {\n        if (!isObjectOrUndefined(values[i]) && contextValue === String(values[i]).toLowerCase()) {\n          return true;\n        }\n      }\n      return false;\n    }\n  };\n}\n\nfunction createNotEquals() {\n  return {\n    matches: (context, key, values = []) => {\n      if (isObjectOrUndefined(context[key])) {\n        return false;\n      }\n      const contextValue = String(context[key]).toLowerCase();\n      for (let i = 0; i < values.length; i += 1) {\n        if (!isObjectOrUndefined(values[i]) && contextValue === String(values[i]).toLowerCase()) {\n          return false;\n        }\n      }\n      return true;\n    }\n  };\n}\n\nfunction createExists() {\n  return {\n    matches: (context, key) => {\n      return typeof context[key] !== \"undefined\" && context[key] !== null;\n    }\n  };\n}\n\nfunction createNotExists() {\n  return {\n    matches: (context, key) => {\n      return typeof context[key] === \"undefined\" || context[key] === null;\n    }\n  };\n}\n\nfunction isNumber(value) {\n  return typeof value === \"number\";\n}\n\nfunction createGreaterThan() {\n  return {\n    matches: (context, key, values = []) => {\n      const needle = context[key];\n      if (!isNumber(needle)) {\n        return false;\n      }\n      for (let i = 0; i < values.length; i += 1) {\n        if (isNumber(values[i]) && needle > values[i]) {\n          return true;\n        }\n      }\n      return false;\n    }\n  };\n}\n\nfunction createGreaterThanEquals() {\n  return {\n    matches: (context, key, values = []) => {\n      const needle = context[key];\n      if (!isNumber(needle)) {\n        return false;\n      }\n      for (let i = 0; i < values.length; i += 1) {\n        if (isNumber(values[i]) && needle >= values[i]) {\n          return true;\n        }\n      }\n      return false;\n    }\n  };\n}\n\nfunction createLessThan() {\n  return {\n    matches: (context, key, values = []) => {\n      const needle = context[key];\n      if (!isNumber(needle)) {\n        return false;\n      }\n      for (let i = 0; i < values.length; i += 1) {\n        if (isNumber(values[i]) && needle < values[i]) {\n          return true;\n        }\n      }\n      return false;\n    }\n  };\n}\n\nfunction createLessThanEquals() {\n  return {\n    matches: (context, key, values = []) => {\n      const needle = context[key];\n      if (!isNumber(needle)) {\n        return false;\n      }\n      for (let i = 0; i < values.length; i += 1) {\n        if (isNumber(values[i]) && needle <= values[i]) {\n          return true;\n        }\n      }\n      return false;\n    }\n  };\n}\n\nfunction createContains() {\n  return {\n    matches: (context, key, values = []) => {\n      if (isObjectOrUndefined(context[key])) {\n        return false;\n      }\n      const contextValue = String(context[key]).toLowerCase();\n      for (let i = 0; i < values.length; i += 1) {\n        if (!isObjectOrUndefined(values[i]) && contextValue.indexOf(String(values[i]).toLowerCase()) !== -1) {\n          return true;\n        }\n      }\n      return false;\n    }\n  };\n}\n\nfunction createNotContains() {\n  return {\n    matches: (context, key, values = []) => {\n      if (isObjectOrUndefined(context[key])) {\n        return false;\n      }\n      const contextValue = String(context[key]).toLowerCase();\n      for (let i = 0; i < values.length; i += 1) {\n        if (!isObjectOrUndefined(values[i]) && contextValue.indexOf(String(values[i]).toLowerCase()) !== -1) {\n          return false;\n        }\n      }\n      return true;\n    }\n  };\n}\n\nfunction createStartsWith() {\n  return {\n    matches: (context, key, values = []) => {\n      if (isObjectOrUndefined(context[key])) {\n        return false;\n      }\n      const contextValue = String(context[key]).toLowerCase();\n      for (let i = 0; i < values.length; i += 1) {\n        if (!isObjectOrUndefined(values[i]) && contextValue.startsWith(String(values[i]).toLowerCase())) {\n          return true;\n        }\n      }\n      return false;\n    }\n  };\n}\n\nfunction createEndsWith() {\n  return {\n    matches: (context, key, values = []) => {\n      if (isObjectOrUndefined(context[key])) {\n        return false;\n      }\n      const contextValue = String(context[key]).toLowerCase();\n      for (let i = 0; i < values.length; i += 1) {\n        if (!isObjectOrUndefined(values[i]) && contextValue.endsWith(values[i].toLowerCase())) {\n          return true;\n        }\n      }\n      return false;\n    }\n  };\n}\n\nconst MATCHERS = {\n  [MatcherType.EQUALS]: createEquals(),\n  [MatcherType.NOT_EQUALS]: createNotEquals(),\n  [MatcherType.EXISTS]: createExists(),\n  [MatcherType.NOT_EXISTS]: createNotExists(),\n  [MatcherType.GREATER_THAN]: createGreaterThan(),\n  [MatcherType.GREATER_THAN_OR_EQUAL_TO]: createGreaterThanEquals(),\n  [MatcherType.LESS_THAN]: createLessThan(),\n  [MatcherType.LESS_THAN_OR_EQUAL_TO]: createLessThanEquals(),\n  [MatcherType.CONTAINS]: createContains(),\n  [MatcherType.NOT_CONTAINS]: createNotContains(),\n  [MatcherType.STARTS_WITH]: createStartsWith(),\n  [MatcherType.ENDS_WITH]: createEndsWith()\n};\nfunction getMatcher(key) {\n  return MATCHERS[key];\n}\n\nfunction isUndefined(value) {\n  return typeof value === \"undefined\";\n}\n\nconst IAM_ID = \"iam.id\";\nconst EVENT_ID = \"eventId\";\nconst ID = \"id\";\nconst IAM_EVENT_TYPE = \"iam.eventType\";\nconst EVENT_TYPE = \"eventType\";\nconst TYPE = \"type\";\nconst VALID_EVENT_TYPES = [IAM_EVENT_TYPE, EVENT_TYPE, TYPE];\nconst VALID_EVENT_IDS = [IAM_ID, ID];\nconst checkForHistoricalMatcher = (eventCount, matcherKey, value) => {\n  switch (matcherKey) {\n    case MatcherType.GREATER_THAN:\n      return eventCount > value;\n    case MatcherType.GREATER_THAN_OR_EQUAL_TO:\n      return eventCount >= value;\n    case MatcherType.LESS_THAN:\n      return eventCount < value;\n    case MatcherType.LESS_THAN_OR_EQUAL_TO:\n      return eventCount <= value;\n    case MatcherType.EQUALS:\n      return eventCount === value;\n    case MatcherType.NOT_EQUALS:\n      return eventCount !== value;\n    default:\n      return false;\n  }\n};\nconst detectKeyName = (context, properties) => {\n  for (let i = 0; i < properties.length; i += 1) {\n    if (!isUndefined(context[properties[i]])) {\n      return properties[i];\n    }\n  }\n  throw new Error(\"The event does not match the expected schema.\");\n};\nconst normalizeEvent = originalEvent => {\n  const event = structuredClone(originalEvent);\n  [[detectKeyName(event, VALID_EVENT_TYPES), EVENT_TYPE], [detectKeyName(event, VALID_EVENT_IDS), EVENT_ID]].forEach(([keyName, normalizedKeyName]) => {\n    if (keyName === normalizedKeyName) {\n      return;\n    }\n    event[normalizedKeyName] = event[keyName];\n    delete event[keyName];\n  });\n  return event;\n};\nfunction queryAndCountAnyEvent(events, context, options, from = 0, to = Infinity) {\n  return events.reduce((countTotal, event) => {\n    try {\n      const eventHash = options.generateEventHash(normalizeEvent(event));\n      const contextEvent = context.events[eventHash];\n      if (!contextEvent) {\n        return countTotal;\n      }\n      const {\n        timestamps = []\n      } = contextEvent;\n      return countTotal + timestamps.filter(t => t >= from && t <= to).length;\n    } catch {\n      return countTotal;\n    }\n  }, 0);\n}\nfunction queryAndCountOrderedEvent(events, context, options, from = 0, to = Infinity) {\n  try {\n    let previousEventTimestamp = from;\n    const sameSequence = events.every(event => {\n      const eventHash = options.generateEventHash(normalizeEvent(event));\n      const contextEvent = context.events[eventHash];\n      if (!contextEvent) {\n        return false;\n      }\n      const contextEventFirstTimestamp = contextEvent.timestamps[0];\n      const isOrdered = contextEventFirstTimestamp >= previousEventTimestamp && contextEventFirstTimestamp <= to;\n      previousEventTimestamp = contextEventFirstTimestamp;\n      return isOrdered;\n    });\n    return Number(sameSequence);\n  } catch {\n    return 0;\n  }\n}\nfunction queryAndCountMostRecentEvent(events, context, options, from = 0, to = Infinity) {\n  try {\n    return events.reduce((mostRecent, event, index) => {\n      const eventHash = options.generateEventHash(normalizeEvent(event));\n      const contextEvent = context.events[eventHash];\n      if (!contextEvent) {\n        return mostRecent;\n      }\n      const mostRecentTimestamp = contextEvent.timestamps.filter(t => t >= from && t <= to).pop();\n      return mostRecentTimestamp && mostRecentTimestamp > mostRecent.timestamp ? {\n        index,\n        timestamp: mostRecentTimestamp\n      } : mostRecent;\n    }, {\n      index: -1,\n      timestamp: 0\n    }).index;\n  } catch {\n    return -1;\n  }\n}\n\nfunction evaluateAnd(context, conditions, options) {\n  let result = true;\n  for (let i = 0; i < conditions.length; i += 1) {\n    result = result && conditions[i].evaluate(context, options);\n  }\n  return result;\n}\nfunction evaluateOr(context, conditions, options) {\n  let result = false;\n  for (let i = 0; i < conditions.length; i += 1) {\n    result = result || conditions[i].evaluate(context, options);\n    if (result) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction createRules(version, rules, metadata) {\n  return {\n    version,\n    rules,\n    metadata\n  };\n}\nfunction createRule(condition, consequences, key) {\n  return {\n    key,\n    execute: (context, options) => {\n      if (condition.evaluate(context, options)) {\n        return consequences;\n      }\n      return [];\n    },\n    toString: () => {\n      return `Rule{condition=${condition}, consequences=${consequences}}`;\n    }\n  };\n}\nfunction createCondition(type, definition) {\n  return {\n    evaluate: (context, options) => {\n      return definition.evaluate(context, options);\n    },\n    toString() {\n      return `Condition{type=${type}, definition=${definition}}`;\n    }\n  };\n}\nfunction createConsequence(id, type, detail) {\n  return {\n    id,\n    type,\n    detail\n  };\n}\nfunction createGroupDefinition(logic, conditions) {\n  return {\n    evaluate: (context, options) => {\n      if (LogicType.AND === logic) {\n        return evaluateAnd(context, conditions, options);\n      }\n      if (LogicType.OR === logic) {\n        return evaluateOr(context, conditions, options);\n      }\n      return false;\n    }\n  };\n}\nfunction createMatcherDefinition(key, matcherKey, values) {\n  return {\n    evaluate: context => {\n      const matcher = getMatcher(matcherKey);\n      if (!matcher) {\n        return false;\n      }\n      return matcher.matches(context, key, values);\n    }\n  };\n}\nfunction createHistoricalDefinition(events, matcherKey, value, from, to, searchType) {\n  return {\n    evaluate: (context, options) => {\n      let eventCount;\n      if (SearchType.MOST_RECENT === searchType) {\n        eventCount = queryAndCountMostRecentEvent(events, context, options, from, to);\n      } else if (SearchType.ORDERED === searchType) {\n        eventCount = queryAndCountOrderedEvent(events, context, options, from, to);\n      } else {\n        eventCount = queryAndCountAnyEvent(events, context, options, from, to);\n      }\n      return checkForHistoricalMatcher(eventCount, matcherKey, value);\n    }\n  };\n}\n\nfunction parseMatcherDefinition(definition) {\n  const {\n    key,\n    matcher,\n    values\n  } = definition;\n  return createMatcherDefinition(key, matcher, values);\n}\nfunction parseGroupDefinition(definition) {\n  const {\n    logic,\n    conditions\n  } = definition;\n  return createGroupDefinition(logic, conditions.map(parseCondition));\n}\nfunction parseHistoricalDefinition(definition) {\n  const {\n    events,\n    from,\n    to,\n    matcher,\n    value,\n    searchType\n  } = definition;\n  return createHistoricalDefinition(events, matcher, value, from, to, searchType);\n}\nfunction parseCondition(condition) {\n  const {\n    type,\n    definition\n  } = condition;\n  if (ConditionType.MATCHER === type) {\n    const matchers = parseMatcherDefinition(definition);\n    return createCondition(type, matchers);\n  }\n  if (ConditionType.GROUP === type) {\n    const definitions = parseGroupDefinition(definition);\n    return createCondition(type, definitions);\n  }\n  if (ConditionType.HISTORICAL === type) {\n    const definitions = parseHistoricalDefinition(definition);\n    return createCondition(type, definitions);\n  }\n  throw new Error(\"Can not parse condition\");\n}\nfunction parseConsequence(consequence) {\n  const {\n    id,\n    type,\n    detail\n  } = consequence;\n  return createConsequence(id, type, detail);\n}\nfunction parseRule(rule) {\n  const {\n    condition,\n    consequences,\n    key\n  } = rule;\n  const parsedCondition = parseCondition(condition);\n  const parsedConsequences = consequences.map(parseConsequence);\n  return createRule(parsedCondition, parsedConsequences, key);\n}\nfunction parseMetadata(metadata) {\n  if (!metadata) {\n    return undefined;\n  }\n  const result = {\n    provider: metadata.provider,\n    providerData: Object.assign({}, metadata.providerData)\n  };\n  return result;\n}\nfunction parseRules(ruleset) {\n  const {\n    version,\n    rules,\n    metadata\n  } = ruleset;\n  const parsedRules = rules.map(parseRule);\n  const parsedMetadata = parseMetadata(metadata);\n  return createRules(version, parsedRules, parsedMetadata);\n}\n\nconst TARGET_PROVIDER = \"TGT\";\nconst DEFAULT_PROVIDER = \"DEFAULT\";\n\nfunction createDefaultRulesExecutor(rules, options) {\n  return {\n    provider: DEFAULT_PROVIDER,\n    execute: context => rules.map(rule => rule.execute(context, options)).filter(arr => arr.length > 0)\n  };\n}\n\nfunction validateMetadata(metadata) {\n  const {\n    providerData\n  } = metadata;\n  if (!providerData) {\n    throw new Error(\"Provider data is missing in metadata\");\n  }\n  const {\n    identityTemplate,\n    buckets\n  } = providerData;\n  if (!identityTemplate) {\n    throw new Error(\"Identity template is missing in provider data\");\n  }\n  if (!buckets) {\n    throw new Error(\"Buckets is missing in provider data\");\n  }\n}\n\nconst NAMESPACE = \"ECID\";\nfunction extractIdentity(context) {\n  const {\n    xdm\n  } = context;\n  if (!xdm) {\n    throw new Error(\"XDM object is missing in the context\");\n  }\n  const {\n    identityMap\n  } = xdm;\n  if (!identityMap) {\n    throw new Error(\"Identity map is missing in the XDM object\");\n  }\n  const identities = identityMap[NAMESPACE];\n  if (!identities) {\n    throw new Error(\"ECID identity namespace is missing in the identity map\");\n  }\n  if (!Array.isArray(identities) || identities.length === 0) {\n    throw new Error(\"ECID identities array is empty or not an array\");\n  }\n  const result = identities[0].id;\n  if (!result) {\n    throw new Error(\"ECID identity is missing in the identities array\");\n  }\n  return result;\n}\n\nconst KEY_PATTERN = \"<key>\";\nconst IDENTITY_PATTERN = \"<identity>\";\nfunction createId(identity, key, metadata) {\n  const {\n    providerData\n  } = metadata;\n  const {\n    identityTemplate\n  } = providerData;\n  return identityTemplate.replace(KEY_PATTERN, key).replace(IDENTITY_PATTERN, identity);\n}\n\nfunction isDefined(value) {\n  return !isUndefined(value);\n}\n\nfunction memoize(func, keyResolverFunc = arr => arr[0]) {\n  const memoizedValues = {};\n  return function memoized(...funcArgs) {\n    const key = keyResolverFunc(funcArgs);\n    if (!isDefined(memoizedValues[key])) {\n      memoizedValues[key] = func(...funcArgs);\n    }\n    return memoizedValues[key];\n  };\n}\n\nfunction mul32(m, n) {\n  const nlo = n & 0xffff;\n  const nhi = n - nlo;\n  return (nhi * m | 0) + (nlo * m | 0) | 0;\n}\nfunction hashUnencodedCharsRaw(stringValue, seed = 0) {\n  let k1;\n  const len = stringValue.length;\n  const c1 = 0xcc9e2d51;\n  const c2 = 0x1b873593;\n  let h1 = seed;\n  const roundedEnd = len & -2;\n  for (let i = 0; i < roundedEnd; i += 2) {\n    k1 = stringValue.charCodeAt(i) | stringValue.charCodeAt(i + 1) << 16;\n    k1 = mul32(k1, c1);\n    k1 = (k1 & 0x1ffff) << 15 | k1 >>> 17;\n    k1 = mul32(k1, c2);\n    h1 ^= k1;\n    h1 = (h1 & 0x7ffff) << 13 | h1 >>> 19;\n    h1 = h1 * 5 + 0xe6546b64 | 0;\n  }\n  if (len % 2 === 1) {\n    k1 = stringValue.charCodeAt(roundedEnd);\n    k1 = mul32(k1, c1);\n    k1 = (k1 & 0x1ffff) << 15 | k1 >>> 17;\n    k1 = mul32(k1, c2);\n    h1 ^= k1;\n  }\n  h1 ^= len << 1;\n  h1 ^= h1 >>> 16;\n  h1 = mul32(h1, 0x85ebca6b);\n  h1 ^= h1 >>> 13;\n  h1 = mul32(h1, 0xc2b2ae35);\n  h1 ^= h1 >>> 16;\n  return h1;\n}\nconst hashUnencodedChars = memoize(hashUnencodedCharsRaw, arr => arr.join(\"-\"));\n\nconst MAX_PERCENTAGE = 100;\nfunction createAllocation(id, buckets) {\n  const signedNumericHashValue = hashUnencodedChars(id);\n  const hashFixedBucket = Math.abs(signedNumericHashValue) % buckets;\n  const allocationValue = hashFixedBucket / buckets * MAX_PERCENTAGE;\n  return Math.round(allocationValue * MAX_PERCENTAGE) / MAX_PERCENTAGE;\n}\nconst createAllocationMemoized = memoize(createAllocation);\nfunction createContext(id, buckets, context) {\n  const allocation = createAllocationMemoized(id, buckets);\n  return {\n    allocation,\n    ...context\n  };\n}\n\nfunction groupRules(rules) {\n  const result = {};\n  for (let i = 0; i < rules.length; i += 1) {\n    const rule = rules[i];\n    if (!rule.key) {\n      continue;\n    }\n    if (!result[rule.key]) {\n      result[rule.key] = [];\n    }\n    result[rule.key].push(rule);\n  }\n  return result;\n}\nfunction evaluateRules(context, rules) {\n  return rules.map(rule => rule.execute(context)).filter(arr => arr.length > 0);\n}\nfunction createTargetRulesExecutor(rules, metadata) {\n  validateMetadata(metadata);\n  const rulesNoKey = rules.filter(rule => !rule.key);\n  const rulesWithKeys = groupRules(rules);\n  const {\n    buckets\n  } = metadata.providerData;\n  return {\n    provider: TARGET_PROVIDER,\n    execute: context => {\n      const identity = extractIdentity(context);\n      const consequencesNoKey = evaluateRules(context, rulesNoKey);\n      const rulesKeys = Object.keys(rulesWithKeys);\n      const consequencesWithKeys = [];\n      for (let i = 0; i < rulesKeys.length; i += 1) {\n        const key = rulesKeys[i];\n        const rulesForKey = rulesWithKeys[key];\n        const id = createId(identity, key, metadata);\n        const contextForKey = createContext(id, buckets, context);\n        const consequences = evaluateRules(contextForKey, rulesForKey);\n        consequencesWithKeys.push(...consequences);\n      }\n      return [...consequencesNoKey, ...consequencesWithKeys];\n    }\n  };\n}\n\nfunction createExecutor(rules, metadata, options) {\n  const {\n    provider\n  } = metadata;\n  if (provider === TARGET_PROVIDER) {\n    return createTargetRulesExecutor(rules, metadata);\n  }\n  return createDefaultRulesExecutor(rules, options);\n}\n\nfunction RulesEngine(ruleset, options = {\n  generateEventHash: () => {\n    throw new Error(\"No hash function provided\");\n  }\n}) {\n  const {\n    rules,\n    metadata = {}\n  } = parseRules(ruleset);\n  return createExecutor(rules, metadata, options);\n}\n\nexport { RulesEngine as default };\n//# sourceMappingURL=index.js.map\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport fnv1a32Hex from \"../../../utils/fnv1a32Hex.js\";\n\n/**\n * Generates an event history hash from an object by removing keys with empty values, sorting the keys,\n * converting the object to a string, and hashing the string.\n * @param {Object} o - The object to process.\n * @returns {string} - The hash of the processed object.\n */\nexport default (o) => {\n  const obj = structuredClone(o);\n\n  const objectString = Object.keys(obj)\n    .sort()\n    .reduce((result, key) => {\n      const value = obj[key];\n\n      // eslint-disable-next-line eqeqeq\n      if (value == undefined || value === \"\") {\n        return result;\n      }\n\n      result += `${key}:${value}`;\n      return result;\n    }, \"\");\n\n  return fnv1a32Hex(objectString);\n};\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default (retentionPeriod) => {\n  const expirationDate = new Date();\n  expirationDate.setDate(expirationDate.getDate() - retentionPeriod);\n  return expirationDate;\n};\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport const EVENT_HISTORY_MAX_RECORDS = 1000;\nexport const EVENT_HISTORY_RETENTION_PERIOD = 30; // 30 days\nexport const EVENT_HISTORY_STORAGE_KEY = \"events\";\nexport const EVENT_HISTORY_MAX_LENGTH = 2 * 1024 * 1024; // 2MB\n\nexport const CONTEXT_KEY = {\n  TYPE: \"~type\",\n  SOURCE: \"~source\",\n};\n\nexport const CONTEXT_EVENT_TYPE = {\n  LIFECYCLE: \"com.adobe.eventType.lifecycle\",\n  TRACK: \"com.adobe.eventType.generic.track\",\n  EDGE: \"com.adobe.eventType.edge\",\n  RULES_ENGINE: \"com.adobe.eventType.rulesEngine\",\n};\n\nexport const CONTEXT_EVENT_SOURCE = {\n  LAUNCH: \"com.adobe.eventSource.applicationLaunch\",\n  REQUEST: \"com.adobe.eventSource.requestContent\",\n};\n\nexport const CJM_IN_APP_MESSAGE_TYPE = \"cjmiam\";\nexport const SCHEMA = \"schema\";\n\nexport const INSERT_OPERATION = \"insert\";\nexport const INSERT_IF_NOT_EXISTS_OPERATION = \"insertIfNotExists\";\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport {\n  EVENT_HISTORY_MAX_RECORDS,\n  EVENT_HISTORY_RETENTION_PERIOD,\n} from \"../constants/index.js\";\nimport getExpirationDate from \"./getExpirationDate.js\";\n\n/**\n * Creates an event pruner function that filters events based on retention period and maximum count\n *\n * @param {number} [retentionPeriod=EVENT_HISTORY_RETENTION_PERIOD] - The retention period in days\n * @param {number} [limit=EVENT_HISTORY_MAX_RECORDS] - Maximum number of events to keep\n * @returns {Function} A function that takes an events object and returns a pruned version of it\n * @param {Object} events - Object containing events with timestamps\n * @returns {Object} Pruned events object with events filtered by retention period and limited to max count\n */\nexport default (\n    retentionPeriod = EVENT_HISTORY_RETENTION_PERIOD,\n    limit = EVENT_HISTORY_MAX_RECORDS,\n  ) =>\n  (events) => {\n    let eventsWithHash = Object.entries(events).reduce(\n      (accumulator, [key, { timestamps = [] }]) => {\n        timestamps.forEach((timestamp) => {\n          accumulator.push({\n            key,\n            timestamp,\n          });\n        });\n\n        return accumulator;\n      },\n      [],\n    );\n\n    const expirationDate = getExpirationDate(retentionPeriod);\n\n    eventsWithHash = eventsWithHash.filter(\n      ({ timestamp }) => timestamp >= expirationDate,\n    );\n\n    eventsWithHash.sort((a, b) => a.timestamp - b.timestamp);\n    eventsWithHash = eventsWithHash.slice(-limit);\n\n    return eventsWithHash.reduce((accumulator, { key, timestamp }) => {\n      if (!accumulator[key]) {\n        accumulator[key] = {\n          timestamps: [],\n        };\n      }\n\n      accumulator[key].timestamps.push(timestamp);\n      return accumulator;\n    }, {});\n  };\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default (xdm) => {\n  const { _experience } = xdm || {};\n  return !!_experience && typeof _experience === \"object\";\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const getActivityId = (proposition) =>\n  proposition?.scopeDetails?.activity?.id;\n\nexport const getDecisionProvider = (proposition) =>\n  proposition?.scopeDetails?.decisionProvider;\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const createRestoreStorage = (storage, storageKey) => {\n  return (defaultValue) => {\n    try {\n      const stored = storage.getItem(storageKey);\n      const s = JSON.parse(stored);\n      return [s, stored.length];\n      // eslint-disable-next-line no-empty\n    } catch {}\n\n    return [defaultValue, 0];\n  };\n};\n\nexport const createSaveStorage = (storage, storageKey) => (value) => {\n  storage.setItem(storageKey, JSON.stringify(value));\n};\n\nexport const createInMemoryStorage = () => {\n  const inMemoryStorage = {};\n\n  return {\n    getItem: (key) => {\n      return key in inMemoryStorage ? inMemoryStorage[key] : null;\n    },\n\n    setItem: (key, value) => {\n      inMemoryStorage[key] = value;\n    },\n  };\n};\n\nexport const clearLocalStorage = (storage) => {\n  storage.clear();\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (arr = []) => (Array.isArray(arr) ? arr.flat(Infinity) : arr);\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { MESSAGE_IN_APP } from \"../../../constants/schema.js\";\nimport { TEXT_HTML } from \"../../../constants/contentType.js\";\n\nexport default (id, type, detail) => {\n  const { html, mobileParameters } = detail;\n\n  const webParameters = {};\n\n  return {\n    schema: MESSAGE_IN_APP,\n    data: {\n      mobileParameters,\n      webParameters,\n      content: html,\n      contentType: TEXT_HTML,\n    },\n    id,\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (id, type, detail) => {\n  const { schema, data, id: detailId } = detail;\n\n  return { schema, data, id: detailId || id };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport inAppMessageConsequenceAdapter from \"./consequenceAdapters/inAppMessageConsequenceAdapter.js\";\nimport schemaTypeConsequenceAdapter from \"./consequenceAdapters/schemaTypeConsequenceAdapter.js\";\nimport { CJM_IN_APP_MESSAGE_TYPE, SCHEMA } from \"./constants/index.js\";\n\nconst adapters = {\n  [CJM_IN_APP_MESSAGE_TYPE]: inAppMessageConsequenceAdapter,\n  [SCHEMA]: schemaTypeConsequenceAdapter,\n};\n\nexport default () => {\n  return (consequence) => {\n    const { id, type, detail } = consequence;\n\n    return typeof adapters[type] === \"function\"\n      ? adapters[type](id, type, detail)\n      : detail;\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport RulesEngine from \"@adobe/aep-rules-engine\";\nimport { JSON_CONTENT_ITEM, RULESET_ITEM } from \"../../constants/schema.js\";\nimport { DISPLAY } from \"../../constants/eventType.js\";\nimport { PropositionEventType } from \"../../constants/propositionEventType.js\";\nimport { generateEventHash, getActivityId } from \"./utils/index.js\";\n\nimport flattenArray from \"../../utils/flattenArray.js\";\nimport createConsequenceAdapter from \"./createConsequenceAdapter.js\";\n\nconst isRulesetItem = (item) => {\n  const { schema, data } = item;\n\n  if (schema === RULESET_ITEM) {\n    return true;\n  }\n\n  if (schema !== JSON_CONTENT_ITEM) {\n    return false;\n  }\n\n  try {\n    const content =\n      typeof data.content === \"string\"\n        ? JSON.parse(data.content)\n        : data.content;\n\n    return (\n      content &&\n      Object.prototype.hasOwnProperty.call(content, \"version\") &&\n      Object.prototype.hasOwnProperty.call(content, \"rules\")\n    );\n  } catch {\n    return false;\n  }\n};\n\nexport default (payload, eventRegistry) => {\n  const consequenceAdapter = createConsequenceAdapter();\n  const activityId = getActivityId(payload);\n  const items = [];\n\n  const addItem = (item) => {\n    const { data = {}, schema } = item;\n\n    const content = schema === RULESET_ITEM ? data : data.content;\n\n    if (!content) {\n      return;\n    }\n\n    items.push(\n      RulesEngine(typeof content === \"string\" ? JSON.parse(content) : content, {\n        generateEventHash,\n      }),\n    );\n  };\n\n  const evaluate = (context) => {\n    const displayEvent = eventRegistry.getEvent(DISPLAY, activityId);\n    const displayedDate = displayEvent?.timestamps[0];\n\n    const qualifyingItems = flattenArray(\n      items.map((item) => item.execute(context)),\n    )\n      .map(consequenceAdapter)\n      .map((item) => {\n        const event = eventRegistry.addEvent({\n          eventType: PropositionEventType.TRIGGER,\n          eventId: activityId,\n        });\n\n        const qualifiedDate = event.timestamps[0];\n\n        return {\n          ...item,\n          data: { ...item.data, qualifiedDate, displayedDate },\n        };\n      });\n\n    return {\n      ...payload,\n      items: qualifyingItems,\n    };\n  };\n\n  if (Array.isArray(payload.items)) {\n    payload.items.filter(isRulesetItem).forEach(addItem);\n  }\n\n  return {\n    rank: payload?.scopeDetails?.rank || Infinity,\n    evaluate,\n    isEvaluable: items.length > 0,\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport createEvaluableRulesetPayload from \"./createEvaluableRulesetPayload.js\";\nimport { getActivityId } from \"./utils/index.js\";\n\nexport default ({ eventRegistry }) => {\n  const payloadsBasedOnActivityId = {};\n\n  const addPayload = (payload) => {\n    const activityId = getActivityId(payload);\n    if (!activityId) {\n      return;\n    }\n\n    const evaluableRulesetPayload = createEvaluableRulesetPayload(\n      payload,\n      eventRegistry,\n    );\n\n    if (evaluableRulesetPayload.isEvaluable) {\n      payloadsBasedOnActivityId[activityId] = evaluableRulesetPayload;\n    }\n  };\n\n  const evaluate = (context = {}) => {\n    const sortedPayloadsBasedOnActivityId = Object.values(\n      payloadsBasedOnActivityId,\n    ).sort(({ rank: rankA }, { rank: rankB }) => rankA - rankB);\n\n    return sortedPayloadsBasedOnActivityId\n      .map((payload) => payload.evaluate(context))\n      .filter((payload) => payload.items.length > 0);\n  };\n\n  const addPayloads = (personalizationPayloads) => {\n    personalizationPayloads.forEach(addPayload);\n  };\n\n  return {\n    addPayload,\n    addPayloads,\n    evaluate,\n  };\n};\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { PropositionList,  EventPayload } from '../types.js' */\nimport { EVENT_HISTORY_OPERATION } from \"../../../constants/schema.js\";\n\n/**\n * Extracts event history operations from a proposition list and filters them out.\n *\n * This function processes the provided proposition list by:\n * 1. Identifying items with the EVENT_HISTORY_OPERATION schema\n * 2. Converting these items into event payloads and tie them with the operation\n * 3. Removing these items from the original propositions\n * 4. Returning an array of the extracted event payloads\n *\n * @param {PropositionList} propositionList - The list of propositions to process\n * @returns {Array<EventPayload>} Array of extracted event payloads with operation\n */\nexport default (propositionList) => {\n  const result = [];\n\n  propositionList.forEach((proposition) => {\n    const filteredItems = [];\n    proposition.items.forEach((item) => {\n      if (item.schema === EVENT_HISTORY_OPERATION) {\n        result.push({\n          operation: item.data.operation,\n          event: {\n            eventId: item.data.content[\"iam.id\"],\n            eventType: item.data.content[\"iam.eventType\"],\n          },\n        });\n      } else {\n        filteredItems.push(item);\n      }\n    });\n\n    proposition.items = filteredItems;\n  });\n\n  return result;\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport extractPayloadsFromEventHistoryOperations from \"./utils/extractPayloadsFromEventHistoryOperations.js\";\n\nexport default ({ lifecycle, eventRegistry }) => {\n  return ({\n    renderDecisions = false,\n    propositions = [],\n    event,\n    personalization,\n  }) => {\n    if (lifecycle) {\n      // Some propositions may contains event history operations.\n      // We extract them and add the events to the event registry.\n      const eventPayloads =\n        extractPayloadsFromEventHistoryOperations(propositions);\n      eventRegistry.addEventPayloads(eventPayloads);\n\n      lifecycle.onDecision({\n        renderDecisions,\n        propositions,\n        event,\n        personalization,\n      });\n    }\n    return { propositions };\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { EventData, EventPayload, EventRecord, EventRegistry } from './types.js' */\n\nimport {\n  getActivityId,\n  hasExperienceData,\n  getDecisionProvider,\n  createRestoreStorage,\n  createSaveStorage,\n  createEventPruner,\n  generateEventHash,\n} from \"./utils/index.js\";\nimport { EVENT_TYPE_TRUE } from \"../../constants/eventType.js\";\nimport { ADOBE_JOURNEY_OPTIMIZER } from \"../../constants/decisionProvider.js\";\nimport {\n  EVENT_HISTORY_STORAGE_KEY,\n  EVENT_HISTORY_MAX_LENGTH,\n  INSERT_OPERATION,\n  INSERT_IF_NOT_EXISTS_OPERATION,\n} from \"./constants/index.js\";\n\n/**\n * Creates an event registry to track and manage events\n * @param {Object} options - The options object\n * @param {Object} options.storage - The storage object used to persist events\n * @param {Object} options.logger - The logger object used for logging\n * @returns {Object} The event registry interface\n */\nexport default ({ storage, logger }) => {\n  let currentStorage = storage;\n  let save;\n\n  /** @type {EventRegistry} */\n  let eventRegistry;\n\n  /** @type {number} */\n  let eventRegistrySize;\n\n  /**\n   * Sets a new storage object for the event registry\n   * @param {Object} newStorage\n   */\n  const setStorage = (newStorage) => {\n    currentStorage = newStorage;\n\n    const restore = createRestoreStorage(\n      currentStorage,\n      EVENT_HISTORY_STORAGE_KEY,\n    );\n\n    save = createSaveStorage(currentStorage, EVENT_HISTORY_STORAGE_KEY);\n\n    [eventRegistry, eventRegistrySize] = restore({});\n\n    if (eventRegistrySize > EVENT_HISTORY_MAX_LENGTH) {\n      const eventPruner = createEventPruner();\n      eventRegistry = eventPruner(eventRegistry);\n      save(eventRegistry);\n    }\n  };\n\n  setStorage(storage);\n\n  /**\n   * Adds a single event to the event registry\n   * @param {EventData} event\n   * @param {string} operation\n   * @returns {EventRecord|undefined}\n   */\n  const addEvent = (\n    event = { eventType: null, eventId: null },\n    operation = INSERT_OPERATION,\n  ) => {\n    const { eventType, eventId } = event;\n\n    if (!eventType || !eventId) {\n      return undefined;\n    }\n\n    const eventHash = generateEventHash(event);\n\n    if (\n      operation === INSERT_IF_NOT_EXISTS_OPERATION &&\n      eventRegistry[eventHash]\n    ) {\n      return undefined;\n    }\n\n    if (\n      !eventRegistry[eventHash] ||\n      !Array.isArray(eventRegistry[eventHash].timestamps)\n    ) {\n      eventRegistry[eventHash] = {\n        timestamps: [],\n      };\n    }\n\n    const timestamp = new Date().getTime();\n\n    eventRegistry[eventHash].timestamps.push(timestamp);\n    eventRegistry[eventHash].timestamps.sort();\n\n    logger.info(\n      \"[Event History] Added event for\",\n      event,\n      \"with hash\",\n      eventHash,\n      \"and timestamp\",\n      timestamp,\n    );\n\n    save(eventRegistry);\n\n    return eventRegistry[eventHash];\n  };\n\n  /**\n   * Adds multiple events to the event registry\n   * @param {Array<EventPayload>} eventPayloads\n   * @returns {Array<EventRecord>}\n   */\n  const addEventPayloads = (eventPayloads = []) =>\n    eventPayloads.map(({ operation, event }) => addEvent(event, operation));\n\n  /**\n   * Processes and adds Experience Edge events to the registry\n   * @param {Object} event - The Experience Edge event object\n   * @returns {void}\n   */\n  const addExperienceEdgeEvent = (event) => {\n    const { xdm } = event.getContent();\n\n    if (!hasExperienceData(xdm)) {\n      return;\n    }\n\n    const {\n      _experience: {\n        decisioning: {\n          propositionEventType = {},\n          propositionAction: { id: action } = {},\n          propositions = [],\n        } = {},\n      },\n    } = xdm;\n\n    Object.keys(propositionEventType)\n      .filter(\n        (eventType) => propositionEventType[eventType] === EVENT_TYPE_TRUE,\n      )\n      .forEach((eventType) => {\n        propositions.forEach((proposition) => {\n          if (getDecisionProvider(proposition) !== ADOBE_JOURNEY_OPTIMIZER) {\n            return;\n          }\n\n          addEvent({\n            eventId: getActivityId(proposition),\n            eventType,\n            action,\n          });\n        });\n      });\n  };\n\n  /**\n   * Retrieves an event from the registry based on type and ID\n   * @param {string} eventType - The type of the event to retrieve\n   * @param {string} eventId - The ID of the event to retrieve\n   * @returns {EventRecord|undefined} The event object if found, otherwise undefined\n   */\n  const getEvent = (eventType, eventId) => {\n    const h = generateEventHash({ eventType, eventId });\n\n    if (!eventRegistry[h]) {\n      return undefined;\n    }\n\n    return eventRegistry[h];\n  };\n\n  return {\n    addExperienceEdgeEvent,\n    addEvent,\n    addEventPayloads,\n    getEvent,\n    toJSON: () => eventRegistry,\n    setStorage,\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport parseUrl from \"../../utils/parseUrl.js\";\nimport flattenObject from \"../../utils/flattenObject.js\";\nimport libraryVersion from \"../../constants/libraryVersion.js\";\n\nexport default ({ eventRegistry, window, getBrowser }) => {\n  const pageLoadTimestamp = new Date().getTime();\n  const getBrowserContext = () => {\n    return {\n      name: getBrowser(),\n    };\n  };\n  const getPageContext = () => {\n    return {\n      title: window.title,\n      url: window.url,\n      ...parseUrl(window.url),\n    };\n  };\n\n  const getReferrerContext = () => {\n    return {\n      url: window.referrer,\n      ...parseUrl(window.referrer),\n    };\n  };\n  const getTimeContext = () => {\n    const now = new Date();\n    const currentTimestamp = now.getTime();\n\n    return {\n      pageLoadTimestamp,\n      currentTimestamp,\n      currentDate: now.getDate(),\n      // Day of the week starts on Monday as is practiced in ISO 8601, but we want it to start on Sunday to match the authoring UI rule\n      \"~state.com.adobe.module.lifecycle/lifecyclecontextdata.dayofweek\":\n        now.getDay() + 1,\n      \"~state.com.adobe.module.lifecycle/lifecyclecontextdata.hourofday\":\n        now.getHours(),\n      currentMinute: now.getMinutes(),\n      currentMonth: now.getMonth(),\n      currentYear: now.getFullYear(),\n      pageVisitDuration: currentTimestamp - pageLoadTimestamp,\n      \"~timestampu\": currentTimestamp / 1000,\n      \"~timestampz\": now.toISOString(),\n    };\n  };\n\n  const getWindowContext = () => {\n    const height = window.height;\n    const width = window.width;\n    const scrollY = window.scrollY;\n    const scrollX = window.scrollX;\n    return {\n      height,\n      width,\n      scrollY,\n      scrollX,\n    };\n  };\n\n  const coreGlobalContext = {\n    browser: getBrowserContext(),\n    page: getPageContext(),\n    referringPage: getReferrerContext(),\n  };\n\n  const getGlobalContext = () => {\n    return {\n      ...coreGlobalContext,\n      ...getTimeContext(),\n      window: getWindowContext(),\n      \"~sdkver\": libraryVersion,\n    };\n  };\n\n  const getContext = (addedContext = {}) => {\n    const context = {\n      ...getGlobalContext(),\n      ...addedContext,\n    };\n\n    return { ...flattenObject(context), events: eventRegistry.toJSON() };\n  };\n  return {\n    getContext,\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nconst defaultPreprocessor = (params, ...args) => {\n  return args;\n};\n\n// eslint-disable-next-line no-unused-vars\nconst defaultEmissionCondition = (params, ...args) => true;\n\nconst createSubscription = () => {\n  let preprocessor = defaultPreprocessor;\n  let emissionCondition = defaultEmissionCondition;\n  let counter = 0;\n  const subscriptions = {};\n\n  const createUnsubscribe = (id) => {\n    return () => {\n      delete subscriptions[id];\n    };\n  };\n\n  const add = (callback, params = undefined) => {\n    if (typeof callback !== \"function\") {\n      return () => undefined;\n    }\n\n    counter += 1;\n\n    subscriptions[counter] = { callback, params };\n    return { id: counter, unsubscribe: createUnsubscribe(counter) };\n  };\n\n  const setEmissionPreprocessor = (value) => {\n    if (typeof value === \"function\") {\n      preprocessor = value;\n    }\n  };\n\n  const setEmissionCondition = (value) => {\n    if (typeof value === \"function\") {\n      emissionCondition = value;\n    }\n  };\n\n  const emit = (...args) => {\n    Object.values(subscriptions).forEach(({ callback, params }) => {\n      const result = preprocessor(params, ...args);\n      if (emissionCondition(params, ...result)) {\n        callback(...result);\n      }\n    });\n  };\n\n  const emitOne = (subscriptionId, ...args) => {\n    if (!subscriptionId || !subscriptions[subscriptionId]) {\n      return;\n    }\n\n    const { callback, params } = subscriptions[subscriptionId];\n\n    const result = preprocessor(params, ...args);\n    if (emissionCondition(params, ...result)) {\n      callback(...result);\n    }\n  };\n\n  const hasSubscriptions = () => Object.keys(subscriptions).length > 0;\n\n  return {\n    add,\n    emit,\n    emitOne,\n    hasSubscriptions,\n    setEmissionPreprocessor,\n    setEmissionCondition,\n  };\n};\n\nexport default createSubscription;\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport {\n  arrayOf,\n  callback as callbackType,\n  objectOf,\n  string,\n} from \"../../utils/validation/index.js\";\nimport createSubscription from \"../../utils/createSubscription.js\";\nimport {\n  getEventType,\n  PropositionEventType,\n} from \"../../constants/propositionEventType.js\";\n\nconst validateOptions = ({ options }) => {\n  const validator = objectOf({\n    surfaces: arrayOf(string()).uniqueItems(),\n    schemas: arrayOf(string()).uniqueItems(),\n    callback: callbackType().required(),\n  }).noUnknownFields();\n\n  return validator(options);\n};\n\nconst getAnalyticsDetail = (proposition) => {\n  const { id, scope, scopeDetails } = proposition;\n  return { id, scope, scopeDetails };\n};\n\nexport default ({ collect }) => {\n  let emitPropositions = () => undefined;\n\n  const collectedEventsThisSession = new Set();\n\n  const shouldAlwaysCollect = (propositionEventType) =>\n    [PropositionEventType.INTERACT, PropositionEventType.DISMISS].includes(\n      propositionEventType,\n    );\n\n  const shouldCollect = (\n    propositionEventType,\n    analyticsMetaId,\n    collectedEventsThisRequest,\n  ) => {\n    const eventId = [propositionEventType, analyticsMetaId].join(\"-\");\n\n    const result =\n      !collectedEventsThisRequest.has(eventId) &&\n      (shouldAlwaysCollect(propositionEventType) ||\n        !collectedEventsThisSession.has(eventId));\n\n    collectedEventsThisRequest.add(eventId);\n    collectedEventsThisSession.add(eventId);\n\n    return result;\n  };\n\n  const collectEvent = (propositionEventType, propositions = []) => {\n    if (!(propositions instanceof Array)) {\n      return Promise.resolve();\n    }\n\n    if (!Object.values(PropositionEventType).includes(propositionEventType)) {\n      return Promise.resolve();\n    }\n\n    const decisionsMeta = [];\n\n    const collectedEventsThisRequest = new Set();\n\n    propositions.forEach((proposition) => {\n      const analyticsMeta = getAnalyticsDetail(proposition);\n      if (\n        !shouldCollect(\n          propositionEventType,\n          analyticsMeta.id,\n          collectedEventsThisRequest,\n        )\n      ) {\n        return;\n      }\n\n      decisionsMeta.push(analyticsMeta);\n    });\n\n    return decisionsMeta.length > 0\n      ? collect({\n          decisionsMeta,\n          eventType: getEventType(propositionEventType),\n          documentMayUnload: true,\n        })\n      : Promise.resolve();\n  };\n\n  const subscriptions = createSubscription();\n\n  const emissionPreprocessor = (params, propositions) => {\n    const { surfacesFilter, schemasFilter } = params;\n\n    const result = {\n      propositions: propositions\n        .filter((payload) =>\n          surfacesFilter ? surfacesFilter.includes(payload.scope) : true,\n        )\n        .map((payload) => {\n          const { items = [] } = payload;\n          return {\n            ...payload,\n            items: items.filter((item) =>\n              schemasFilter ? schemasFilter.includes(item.schema) : true,\n            ),\n          };\n        })\n        .filter((payload) => payload.items.length > 0),\n    };\n\n    return [result, collectEvent];\n  };\n\n  subscriptions.setEmissionPreprocessor(emissionPreprocessor);\n\n  const run = ({ surfaces, schemas, callback }) => {\n    const { id, unsubscribe } = subscriptions.add(callback, {\n      surfacesFilter: surfaces instanceof Array ? surfaces : undefined,\n      schemasFilter: schemas instanceof Array ? schemas : undefined,\n    });\n    emitPropositions(id);\n    return Promise.resolve({ unsubscribe });\n  };\n\n  const optionsValidator = (options) => validateOptions({ options });\n\n  const refresh = (propositions) => {\n    emitPropositions = (subscriptionId) => {\n      if (subscriptionId) {\n        subscriptions.emitOne(subscriptionId, propositions);\n        return;\n      }\n\n      subscriptions.emit(propositions);\n    };\n\n    emitPropositions();\n  };\n\n  return {\n    refresh,\n    command: {\n      optionsValidator,\n      run,\n    },\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { boolean, objectOf } from \"../../utils/validation/index.js\";\n\nconst validateOptions = ({ options }) => {\n  const validator = objectOf({\n    renderDecisions: boolean(),\n    personalization: objectOf({\n      decisionContext: objectOf({}),\n    }),\n  }).noUnknownFields();\n\n  return validator(options);\n};\n\nexport default ({ contextProvider, decisionProvider }) => {\n  const run = ({ renderDecisions, decisionContext, applyResponse }) => {\n    return applyResponse({\n      renderDecisions,\n      propositions: decisionProvider.evaluate(\n        contextProvider.getContext(decisionContext),\n      ),\n    });\n  };\n\n  const optionsValidator = (options) => validateOptions({ options });\n\n  return {\n    optionsValidator,\n    run,\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { noop, sanitizeOrgIdForCookieName } from \"../../utils/index.js\";\nimport createOnResponseHandler from \"./createOnResponseHandler.js\";\nimport createDecisionProvider from \"./createDecisionProvider.js\";\nimport createApplyResponse from \"./createApplyResponse.js\";\nimport createEventRegistry from \"./createEventRegistry.js\";\nimport createContextProvider from \"./createContextProvider.js\";\nimport createSubscribeRulesetItems from \"./createSubscribeRulesetItems.js\";\nimport {\n  CONTEXT_KEY,\n  CONTEXT_EVENT_SOURCE,\n  CONTEXT_EVENT_TYPE,\n} from \"./constants/index.js\";\nimport createEvaluateRulesetsCommand from \"./createEvaluateRulesetsCommand.js\";\nimport { clearLocalStorage, createInMemoryStorage } from \"./utils/storage.js\";\nimport { objectOf, boolean } from \"../../utils/validation/index.js\";\nimport createCollect from \"../../utils/createCollect.js\";\nimport { mergeDecisionsMeta } from \"../../utils/event.js\";\n\nconst createRulesEngine = ({\n  config,\n  eventManager,\n  createNamespacedStorage,\n  consent,\n  getBrowser,\n  logger,\n}) => {\n  const { orgId, personalizationStorageEnabled } = config;\n  const collect = createCollect({ eventManager, mergeDecisionsMeta });\n\n  const storage = createNamespacedStorage(\n    `${sanitizeOrgIdForCookieName(orgId)}.decisioning.`,\n  );\n  if (!personalizationStorageEnabled) {\n    clearLocalStorage(storage.persistent);\n  }\n\n  const eventRegistry = createEventRegistry({\n    storage: createInMemoryStorage(),\n    logger,\n  });\n  const decisionProvider = createDecisionProvider({ eventRegistry });\n  const contextProvider = createContextProvider({\n    eventRegistry,\n    window,\n    getBrowser,\n  });\n\n  const evaluateRulesetsCommand = createEvaluateRulesetsCommand({\n    contextProvider,\n    decisionProvider,\n  });\n  const subscribeRulesetItems = createSubscribeRulesetItems({ collect });\n  let applyResponse;\n\n  return {\n    lifecycle: {\n      onDecision({ propositions }) {\n        subscribeRulesetItems.refresh(propositions);\n      },\n      onComponentsRegistered(tools) {\n        applyResponse = createApplyResponse({\n          lifecycle: tools.lifecycle,\n          eventRegistry,\n        });\n        if (personalizationStorageEnabled) {\n          consent\n            .awaitConsent()\n            .then(() => {\n              eventRegistry.setStorage(storage.persistent);\n            })\n            .catch(() => {\n              if (storage) {\n                clearLocalStorage(storage.persistent);\n              }\n            });\n        }\n      },\n      onBeforeEvent({\n        event,\n        renderDecisions,\n        personalization = {},\n        onResponse = noop,\n      }) {\n        const { decisionContext = {} } = personalization;\n\n        onResponse(\n          createOnResponseHandler({\n            renderDecisions,\n            decisionProvider,\n            applyResponse,\n            event,\n            personalization,\n            decisionContext: contextProvider.getContext({\n              [CONTEXT_KEY.TYPE]: CONTEXT_EVENT_TYPE.EDGE,\n              [CONTEXT_KEY.SOURCE]: CONTEXT_EVENT_SOURCE.REQUEST,\n              ...decisionContext,\n            }),\n          }),\n        );\n      },\n      onBeforeRequest({ request }) {\n        const payload = request.getPayload().toJSON();\n        const { events = [] } = payload;\n        if (events.length === 0) {\n          return;\n        }\n        events.forEach((event) => eventRegistry.addExperienceEdgeEvent(event));\n      },\n    },\n    commands: {\n      evaluateRulesets: {\n        run: ({ renderDecisions, personalization = {} }) => {\n          const { decisionContext = {} } = personalization;\n          return evaluateRulesetsCommand.run({\n            renderDecisions,\n            decisionContext: {\n              [CONTEXT_KEY.TYPE]: CONTEXT_EVENT_TYPE.RULES_ENGINE,\n              [CONTEXT_KEY.SOURCE]: CONTEXT_EVENT_SOURCE.REQUEST,\n              ...decisionContext,\n            },\n            applyResponse,\n          });\n        },\n        optionsValidator: evaluateRulesetsCommand.optionsValidator,\n      },\n      subscribeRulesetItems: subscribeRulesetItems.command,\n    },\n  };\n};\n\ncreateRulesEngine.namespace = \"RulesEngine\";\ncreateRulesEngine.configValidators = objectOf({\n  personalizationStorageEnabled: boolean().default(false),\n});\nexport default createRulesEngine;\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { number, objectOf, string } from \"../../utils/validation/index.js\";\n\nexport default objectOf({\n  streamingMedia: objectOf({\n    channel: string().nonEmpty().required(),\n    playerName: string().nonEmpty().required(),\n    appVersion: string(),\n    mainPingInterval: number().minimum(10).maximum(50).default(10),\n    adPingInterval: number().minimum(1).maximum(10).default(10),\n  }).noUnknownFields(),\n});\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  anyOf,\n  anything,\n  callback,\n  number,\n  objectOf,\n  string,\n} from \"../../utils/validation/index.js\";\nimport { validateConfigOverride } from \"../../utils/index.js\";\n\nexport default ({ options }) => {\n  const sessionValidator = anyOf(\n    [\n      objectOf({\n        playerId: string().required(),\n        getPlayerDetails: callback().required(),\n        xdm: objectOf({\n          mediaCollection: objectOf({\n            sessionDetails: objectOf(anything()).required(),\n          }),\n        }),\n        edgeConfigOverrides: validateConfigOverride,\n      }).required(),\n\n      objectOf({\n        xdm: objectOf({\n          mediaCollection: objectOf({\n            playhead: number().required(),\n            sessionDetails: objectOf(anything()).required(),\n          }),\n        }),\n        edgeConfigOverrides: validateConfigOverride,\n      }).required(),\n    ],\n\n    \"an object with playerId, getPlayerDetails and xdm.mediaCollection.sessionDetails, or an object with xdm.mediaCollection.playhead and xdm.mediaCollection.sessionDetails\",\n  );\n\n  return sessionValidator(options);\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport {\n  anyOf,\n  anything,\n  enumOf,\n  number,\n  objectOf,\n  string,\n} from \"../../utils/validation/index.js\";\nimport EventTypes from \"./constants/eventTypes.js\";\n\nexport default ({ options }) => {\n  const validator = anyOf(\n    [\n      objectOf({\n        playerId: string().required(),\n        xdm: objectOf({\n          eventType: enumOf(...Object.values(EventTypes)).required(),\n          mediaCollection: objectOf(anything()),\n        }).required(),\n      }).required(),\n\n      objectOf({\n        xdm: objectOf({\n          eventType: enumOf(...Object.values(EventTypes)).required(),\n          mediaCollection: objectOf({\n            playhead: number().integer().required(),\n            sessionID: string().required(),\n          }).required(),\n        }).required(),\n      }).required(),\n    ],\n\n    \"Error validating the sendMediaEvent command options.\",\n  );\n\n  return validator(options);\n};\n","/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { noop } from \"../../utils/index.js\";\nimport validateSessionOptions from \"./validateMediaSessionOptions.js\";\nimport validateMediaEventOptions from \"./validateMediaEventOptions.js\";\n\nexport default ({\n  config,\n  trackMediaEvent,\n  trackMediaSession,\n  mediaResponseHandler,\n}) => {\n  return {\n    lifecycle: {\n      onBeforeEvent({ mediaOptions, onResponse = noop }) {\n        if (!mediaOptions) {\n          return;\n        }\n        const { legacy, playerId, getPlayerDetails } = mediaOptions;\n        if (legacy) {\n          return;\n        }\n        onResponse(({ response }) => {\n          return mediaResponseHandler({ playerId, getPlayerDetails, response });\n        });\n      },\n    },\n    commands: {\n      createMediaSession: {\n        optionsValidator: (options) => validateSessionOptions({ options }),\n\n        run: trackMediaSession,\n      },\n\n      sendMediaEvent: {\n        optionsValidator: (options) => validateMediaEventOptions({ options }),\n\n        run: (options) => {\n          if (!config.streamingMedia) {\n            return Promise.reject(\n              new Error(\"Streaming media is not configured.\"),\n            );\n          }\n\n          return trackMediaEvent(options);\n        },\n      },\n    },\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n/* eslint-disable import/no-restricted-paths */\nimport createMediaSessionCacheManager from \"./createMediaSessionCacheManager.js\";\nimport createMediaEventManager from \"./createMediaEventManager.js\";\nimport createTrackMediaEvent from \"./createTrackMediaEvent.js\";\nimport configValidators from \"./configValidators.js\";\nimport createStreamingMediaComponent from \"./createStreamingMediaComponent.js\";\nimport createTrackMediaSession from \"./createTrackMediaSession.js\";\nimport createMediaResponseHandler from \"./createMediaResponseHandler.js\";\nimport injectTimestamp from \"../Context/injectTimestamp.js\";\n\nconst createStreamingMedia = ({\n  config,\n  logger,\n  eventManager,\n  sendEdgeNetworkRequest,\n  consent,\n}) => {\n  const mediaSessionCacheManager = createMediaSessionCacheManager({ config });\n  const mediaEventManager = createMediaEventManager({\n    config,\n    eventManager,\n    logger,\n    consent,\n    sendEdgeNetworkRequest,\n    setTimestamp: injectTimestamp(() => new Date()),\n  });\n\n  const trackMediaEvent = createTrackMediaEvent({\n    mediaSessionCacheManager,\n    mediaEventManager,\n    config,\n  });\n\n  const trackMediaSession = createTrackMediaSession({\n    config,\n    mediaEventManager,\n    mediaSessionCacheManager,\n  });\n\n  const mediaResponseHandler = createMediaResponseHandler({\n    mediaSessionCacheManager,\n    config,\n    trackMediaEvent,\n  });\n\n  return createStreamingMediaComponent({\n    config,\n    trackMediaEvent,\n    mediaEventManager,\n    mediaResponseHandler,\n    trackMediaSession,\n  });\n};\ncreateStreamingMedia.namespace = \"Streaming media\";\n\ncreateStreamingMedia.configValidators = configValidators;\nexport default createStreamingMedia;\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// Cookie Keys\nexport const ADVERTISING_COOKIE_KEY = \"advertising\";\nexport const SURFER_ID_COOKIE_KEY = \"surfer_id\";\nexport const RAMP_ID_COOKIE_KEY = \"ramp_id\";\nexport const ID5_COOKIE_KEY = \"id5_id\";\nexport const LAST_CLICK_COOKIE_KEY = \"_les_lsc\";\nexport const LAST_CONVERSION_TIME_KEY = \"lastConversionTime\";\nexport const DISPLAY_CLICK_COOKIE_KEY_EXPIRES = \"displayClickCookieExpires\";\nexport const RAMP_ID_EXPIRES = \"rampIdExpires\";\nexport const LAST_CONVERSION_TIME_KEY_EXPIRES = \"lastConversionTimeExpires\";\n// URL Parameters\nexport const SKWCID_PARAM = \"s_kwcid\";\nexport const EFID_PARAM = \"ef_id\";\n\n// Identity Types\nexport const SURFER_ID = \"surferId\";\nexport const RAMP_ID = \"rampId\";\nexport const ID5_ID = \"id5Id\";\n\n// Default Values\nexport const UNKNOWN_ADVERTISER = \"\";\nexport const DEFAULT_THROTTLE_MINUTES = 30;\nexport const DEFAULT_COOKIE_EXPIRATION_MINUTES = 527040; // 365 days\n\n// Event Types\nexport const AD_CONVERSION_CLICK_EVENT_TYPE = \"advertising.enrichment_ct\";\nexport const AD_CONVERSION_VIEW_EVENT_TYPE = \"advertising.enrichment\";\n\n// XDM Paths\nexport const XDM_AD_CLOUD_PATH = \"_experience.adloud\";\nexport const XDM_AD_ASSET_REFERENCE = \"adAssetReference\";\nexport const XDM_AD_STITCH_DATA = \"adStitchData\";\nexport const XDM_AD_ASSET_DATA = \"adAssetData\";\nexport const XDM_ADVERTISER = \"advertiser\";\nexport const TRACKING_CODE = \"trackingCode\";\nexport const TRACKING_IDENTITIES = \"trackingIdentities\";\n\n// Script URLs\nexport const ID5_SCRIPT_URL = \"https://www.everestjs.net/static/id5-api.js\";\n\n// Surfer ID Configuration\nexport const SURFER_PIXEL_HOST = \"pixel.everesttech.net\";\nexport const SURFER_USER_ID = \"1\";\nexport const SURFER_TIMEOUT_MS = 5000;\nexport const SURFER_TRUSTED_ORIGIN = \"www.everestjs.net\";\nexport const SURFER_PARAM_KEY = \"gsurfer\";\n\n// Error Messages\nexport const ERROR_ID5_PARTNER_ID_REQUIRED = \"ID5 partner ID is required\";\nexport const ERROR_RAMP_ID_MAX_RETRIES =\n  \"Failed to retrieve RampID after maximum retries\";\n\n// Log Messages\nexport const LOG_AD_CONVERSION_START = \"Processing ad conversion\";\nexport const LOG_COOKIE_WRITTEN = \"Ad tracking data saved\";\nexport const LOG_CONVERSION_TIME_UPDATED = \"Conversion timing recorded\";\nexport const LOG_SENDING_CONVERSION = \"Submitting ad conversion data\";\nexport const LOG_ALL_IDS_THROTTLED =\n  \"Ad conversion paused to prevent duplicate submissions\";\nexport const LOG_ALL_IDS_USED = \"Ad conversion already processed\";\nexport const LOG_ID_RESOLVED = \"Ad identity available\";\nexport const LOG_ERROR_RESOLVING_ID = \"Unable to obtain ad identity\";\nexport const LOG_ID_CONVERSION_SUCCESS = \"Ad conversion submitted successfully\";\nexport const LOG_AD_CONVERSION_FAILED = \"Ad conversion submission failed\";\nexport const DISPLAY_CLICK_COOKIE_KEY = \"ev_lcc\";\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  LAST_CLICK_COOKIE_KEY,\n  LAST_CONVERSION_TIME_KEY,\n  LOG_AD_CONVERSION_START,\n  LOG_AD_CONVERSION_FAILED,\n  AD_CONVERSION_CLICK_EVENT_TYPE,\n  TRACKING_CODE,\n  TRACKING_IDENTITIES,\n  LAST_CONVERSION_TIME_KEY_EXPIRES,\n} from \"../constants/index.js\";\n\n/**\n * Handles click-through ad conversions\n * @param {Object} params - All required parameters\n * @param {Object} params.eventManager - Event manager for creating events\n * @param {Object} params.cookieManager - Session manager for cookie operations\n * @param {Object} params.adConversionHandler - Handler for sending ad conversion events\n * @param {Object} params.logger - Logger instance\n * @param {string} params.skwcid - Search keyword click ID\n * @param {string} params.efid - EF ID parameter\n * @param {Object} params.optionsFromCommand - Additional options from command\n * @returns {Promise} Result of the ad conversion tracking\n */\nexport default async function handleClickThrough({\n  eventManager,\n  cookieManager,\n  adConversionHandler,\n  logger,\n  skwcid,\n  efid,\n}) {\n  logger.info(LOG_AD_CONVERSION_START, { skwcid, efid });\n\n  const event = eventManager.createEvent();\n  if (\n    typeof skwcid !== \"undefined\" &&\n    typeof efid !== \"undefined\" &&\n    skwcid.startsWith(\"AL!\")\n  ) {\n    const clickData = {\n      click_time: Date.now(),\n      ...(typeof skwcid !== \"undefined\" && { skwcid }),\n      ...(typeof efid !== \"undefined\" && { efid }),\n    };\n    cookieManager.setValue(LAST_CLICK_COOKIE_KEY, clickData);\n  }\n\n  const xdm = {\n    _experience: {\n      adcloud: {\n        conversionDetails: {\n          ...(typeof skwcid !== \"undefined\" && { [TRACKING_CODE]: skwcid }),\n          ...(typeof efid !== \"undefined\" && {\n            [TRACKING_IDENTITIES]: efid,\n          }),\n        },\n      },\n    },\n    eventType: AD_CONVERSION_CLICK_EVENT_TYPE,\n    timestamp: new Date().toISOString(),\n  };\n\n  event.setUserXdm(xdm);\n\n  cookieManager.setValue(LAST_CONVERSION_TIME_KEY);\n  cookieManager.setValue(\n    LAST_CONVERSION_TIME_KEY_EXPIRES,\n    Date.now() + 91 * 24 * 60 * 60 * 1000,\n  ); //expires in 91 days\n\n  try {\n    return await adConversionHandler.trackAdConversion({ event });\n  } catch (error) {\n    logger.error(LOG_AD_CONVERSION_FAILED, error);\n    throw error;\n  }\n}\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed under the Apache License, Version 2.0.\n*/\n\nimport {\n  DISPLAY_CLICK_COOKIE_KEY,\n  SURFER_ID,\n  SURFER_PIXEL_HOST,\n  SURFER_USER_ID,\n  SURFER_TIMEOUT_MS,\n  SURFER_TRUSTED_ORIGIN,\n  SURFER_PARAM_KEY,\n  DISPLAY_CLICK_COOKIE_KEY_EXPIRES,\n} from \"../constants/index.js\";\nimport createNode from \"../../../utils/dom/createNode.js\";\nimport { injectAreThirdPartyCookiesSupportedByDefault } from \"../../../utils/index.js\";\n\nlet surferId = \"\";\nlet displayClickCookie = \"\";\nlet inProgressSurferPromise = null;\n\nconst addToDom = (element) => {\n  if (document.body) {\n    document.body.appendChild(element);\n  } else {\n    window.addEventListener(\n      \"load\",\n      () => {\n        document.body.appendChild(element);\n      },\n      false,\n    );\n  }\n};\n\nconst getInvisibleIframeElement = (url) =>\n  createNode(\n    \"iframe\",\n    { src: url },\n    {\n      height: 0,\n      width: 0,\n      frameBorder: 0,\n      style: { display: \"none\" },\n    },\n    [],\n  );\n\nconst addListener = (fn) => window.addEventListener(\"message\", fn, false);\n\nconst removeListener = (fn) => window.removeEventListener(\"message\", fn, false);\n\nconst initiateAdvertisingIdentityCall = () => {\n  if (inProgressSurferPromise) {\n    return inProgressSurferPromise;\n  }\n\n  inProgressSurferPromise = new Promise((resolve, reject) => {\n    setTimeout(() => {\n      const scheme =\n        document.location.protocol === \"https:\" ? \"https:\" : \"http:\";\n\n      const nestedParams = new URLSearchParams({\n        google: \"__EFGCK__\",\n        gsurfer: \"__EFGSURFER__\",\n        imsId: \"__EFIMSORGID__\",\n        is_fb_cookie_synced: \"__EFFB__\",\n        optout: \"__EFOPTOUT__\",\n        throttleCookie: \"__EFSYNC__\",\n        time: \"__EFTIME__\",\n        ev_lcc: \"__LCC__\",\n      });\n      const nestedUrl = `${scheme}//www.everestjs.net/static/pixel_details.html#${nestedParams.toString()}`;\n\n      const mainParams = new URLSearchParams({\n        ev_gb: \"0\",\n        url: nestedUrl,\n      });\n      const pixelDetailsUrl = `${scheme}//${SURFER_PIXEL_HOST}/${SURFER_USER_ID}/gr?${mainParams.toString()}`;\n\n      const iframeElement = getInvisibleIframeElement(pixelDetailsUrl);\n      addToDom(iframeElement);\n\n      const pixelDetailsReceiver = function pixelDetailsReceiver(message) {\n        if (!message.origin.includes(SURFER_TRUSTED_ORIGIN)) {\n          return;\n        }\n\n        try {\n          const pixelRedirectUri = message.data;\n          const hashIndex = pixelRedirectUri.indexOf(\"#\");\n          if (hashIndex === -1) {\n            resolve({ surferId: null, displayClickCookie: null });\n            return;\n          }\n\n          const hashParams = new URLSearchParams(\n            pixelRedirectUri.substring(hashIndex + 1),\n          );\n          let resolvedSurferId;\n          let resolvedDisplayClickCookie;\n\n          const surferValue = hashParams.get(SURFER_PARAM_KEY);\n          if (surferValue) {\n            resolvedSurferId = surferValue;\n          }\n\n          const displayClickValue = hashParams.get(DISPLAY_CLICK_COOKIE_KEY);\n          if (displayClickValue && displayClickValue !== \"__LCC__\") {\n            resolvedDisplayClickCookie = displayClickValue;\n          }\n\n          removeListener(pixelDetailsReceiver);\n\n          if (resolvedSurferId) {\n            surferId = resolvedSurferId;\n            displayClickCookie = resolvedDisplayClickCookie;\n            resolve({ surferId, displayClickCookie });\n          } else {\n            resolve({ surferId: null, displayClickCookie: null });\n          }\n        } catch (err) {\n          reject(err);\n        } finally {\n          inProgressSurferPromise = null;\n        }\n      };\n\n      addListener(pixelDetailsReceiver);\n    }, SURFER_TIMEOUT_MS);\n  });\n\n  return inProgressSurferPromise;\n};\n\nconst collectSurferId = function collectSurferId(\n  cookieManager,\n  getBrowser,\n  resolveSurferIdIfNotAvailable = true,\n) {\n  if (getBrowser) {\n    const areThirdPartyCookiesSupportedByDefault =\n      injectAreThirdPartyCookiesSupportedByDefault({ getBrowser });\n\n    if (!areThirdPartyCookiesSupportedByDefault()) {\n      return Promise.resolve(null);\n    }\n  }\n\n  if (surferId && surferId !== \"\") {\n    return Promise.resolve(surferId);\n  }\n\n  if (cookieManager) {\n    const cookieSurferId = cookieManager.getValue(SURFER_ID);\n    if (cookieSurferId) {\n      surferId = cookieSurferId;\n      return Promise.resolve(cookieSurferId);\n    }\n  }\n\n  if (resolveSurferIdIfNotAvailable) {\n    return initiateAdvertisingIdentityCall().then((resolvedId) => {\n      if (cookieManager && resolvedId) {\n        if (resolvedId.surferId) {\n          cookieManager.setValue(SURFER_ID, resolvedId.surferId);\n        }\n        if (resolvedId.displayClickCookie) {\n          cookieManager.setValue(\n            DISPLAY_CLICK_COOKIE_KEY,\n            resolvedId.displayClickCookie,\n          );\n          cookieManager.setValue(\n            DISPLAY_CLICK_COOKIE_KEY_EXPIRES,\n            Date.now() + 15 * 60 * 1000,\n          );\n        }\n      }\n      return resolvedId.surferId;\n    });\n  }\n  return Promise.resolve(null);\n};\n\nexport default collectSurferId;\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { loadScript } from \"../../../utils/dom/index.js\";\nimport { RAMP_ID, RAMP_ID_EXPIRES } from \"../constants/index.js\";\n\nconst RETRY_CONFIG = {\n  MAX_COUNT: 15,\n  MAX_TIME_MS: 30000,\n  DELAY_BASE_MS: 500,\n  MAX_DELAY_MS: 5000,\n  SHORT_TIMEOUT_MS: 2000,\n};\n\nconst state = {\n  rampIdEnv: undefined,\n  rampIdCallInitiated: false,\n  inProgressRampIdPromise: null,\n  scriptLoadingInitiated: false,\n  envelopeRetrievalInProgress: false,\n};\n\nconst processEnvelope = (envelope, resolve, cookieManager, logger) => {\n  let parsedEnvelope;\n  try {\n    parsedEnvelope = JSON.parse(envelope).envelope;\n  } catch {\n    parsedEnvelope = envelope;\n  }\n\n  if (parsedEnvelope && !state.rampIdCallInitiated) {\n    state.rampIdCallInitiated = true;\n    state.rampIdEnv = parsedEnvelope;\n    state.envelopeRetrievalInProgress = false;\n    state.inProgressRampIdPromise = null;\n    cookieManager.setValue(RAMP_ID, state.rampIdEnv);\n    cookieManager.setValue(RAMP_ID_EXPIRES, Date.now() + 48 * 60 * 60 * 1000); //expires in 48 hours\n    resolve(state.rampIdEnv);\n  } else {\n    logger.warn(\"Invalid RampID envelope received\", {\n      envelope: parsedEnvelope,\n    });\n    state.envelopeRetrievalInProgress = false;\n  }\n};\n\nconst retrieveEnvelopeWithRetries = (\n  resolve,\n  reject,\n  cookieManager,\n  logger,\n) => {\n  let retryCount = RETRY_CONFIG.MAX_COUNT;\n  let timerMultiplier = 1;\n  let totalElapsedTime = 0;\n\n  const tryToRetrieve = () => {\n    if (state.rampIdEnv) return;\n\n    if (totalElapsedTime > RETRY_CONFIG.MAX_TIME_MS) {\n      logger.error(\"Maximum retry time exceeded\");\n      state.envelopeRetrievalInProgress = false;\n      reject(new Error(\"Failed to retrieve RampID - timeout\"));\n      state.inProgressRampIdPromise = null;\n      return;\n    }\n\n    if (retryCount === 0) {\n      logger.error(\"Maximum retries exceeded\");\n      state.envelopeRetrievalInProgress = false;\n      reject(new Error(\"Failed to retrieve RampID after maximum retries\"));\n      state.inProgressRampIdPromise = null;\n      return;\n    }\n\n    const delay = Math.min(\n      RETRY_CONFIG.DELAY_BASE_MS * timerMultiplier,\n      RETRY_CONFIG.MAX_DELAY_MS,\n    );\n\n    setTimeout(() => {\n      totalElapsedTime += delay;\n      retryCount -= 1;\n      timerMultiplier += 1;\n\n      if (\n        typeof window.ats !== \"undefined\" &&\n        window.ats !== null &&\n        !state.rampIdEnv &&\n        !state.envelopeRetrievalInProgress\n      ) {\n        state.envelopeRetrievalInProgress = true;\n        window.ats.retrieveEnvelope().then(\n          (rampIdResponse) => {\n            processEnvelope(rampIdResponse, resolve, cookieManager, logger);\n            if (!state.rampIdEnv) tryToRetrieve();\n          },\n          () => {\n            logger.warn(\"Failed to retrieve envelope\");\n            state.envelopeRetrievalInProgress = false;\n            tryToRetrieve();\n          },\n        );\n      } else {\n        tryToRetrieve();\n      }\n    }, delay);\n  };\n\n  tryToRetrieve();\n};\n\nconst initiateRampIDCall = (\n  rampIdScriptPath,\n  cookieManager,\n  logger,\n  useShortTimeout = false,\n) => {\n  if (state.inProgressRampIdPromise) {\n    return state.inProgressRampIdPromise;\n  }\n\n  const timeoutMs = useShortTimeout\n    ? RETRY_CONFIG.SHORT_TIMEOUT_MS\n    : RETRY_CONFIG.MAX_TIME_MS;\n\n  let timedOut = false;\n\n  const mainPromise = new Promise((resolve, reject) => {\n    loadScript(rampIdScriptPath, {\n      onLoad: () => {\n        if (\n          typeof window.ats !== \"undefined\" &&\n          !state.envelopeRetrievalInProgress\n        ) {\n          state.envelopeRetrievalInProgress = true;\n          window.ats\n            .retrieveEnvelope()\n            .then((envelopeResponse) => {\n              if (envelopeResponse) {\n                if (!timedOut) {\n                  processEnvelope(\n                    envelopeResponse,\n                    resolve,\n                    cookieManager,\n                    logger,\n                  );\n                }\n              } else {\n                state.envelopeRetrievalInProgress = false;\n                window.addEventListener(\"lrEnvelopePresent\", () => {\n                  if (state.envelopeRetrievalInProgress || timedOut) return;\n                  state.envelopeRetrievalInProgress = true;\n                  window.ats.retrieveEnvelope().then(\n                    (envelopeResult) => {\n                      if (!timedOut) {\n                        processEnvelope(\n                          envelopeResult,\n                          resolve,\n                          cookieManager,\n                          logger,\n                        );\n                      }\n                    },\n                    (error) => {\n                      if (!timedOut) {\n                        logger.error(\n                          \"Failed to retrieve envelope after event\",\n                          error,\n                        );\n                        state.envelopeRetrievalInProgress = false;\n                        reject(error);\n                        state.inProgressRampIdPromise = null;\n                      }\n                    },\n                  );\n                });\n              }\n            })\n            .catch((error) => {\n              if (!timedOut) {\n                logger.error(\"Error retrieving envelope\", error);\n                state.envelopeRetrievalInProgress = false;\n                reject(error);\n                state.inProgressRampIdPromise = null;\n              }\n            });\n        }\n\n        retrieveEnvelopeWithRetries(\n          (val) => {\n            if (!timedOut) resolve(val);\n          },\n          (err) => {\n            if (!timedOut) reject(err);\n          },\n          cookieManager,\n          logger,\n        );\n      },\n      onError: (error) => {\n        if (!timedOut) {\n          reject(error);\n        }\n        state.inProgressRampIdPromise = null;\n      },\n    });\n  });\n\n  const timeoutPromise = new Promise((resolve) => {\n    setTimeout(() => {\n      timedOut = true;\n      resolve(null);\n    }, timeoutMs);\n  });\n\n  state.inProgressRampIdPromise = Promise.race([\n    mainPromise,\n    timeoutPromise,\n  ]).finally(() => {\n    state.inProgressRampIdPromise = null;\n  });\n\n  return state.inProgressRampIdPromise;\n};\n\nconst getRampId = (\n  logger,\n  rampIdScriptPath,\n  cookieManager,\n  resolveRampIdIfNotAvailable = true,\n  useShortTimeout = false,\n) => {\n  if (state.rampIdEnv) {\n    return Promise.resolve(state.rampIdEnv);\n  }\n  if (cookieManager) {\n    const rampIdFromCookie = cookieManager.getValue(RAMP_ID);\n    const rampIdExpires = cookieManager.getValue(RAMP_ID_EXPIRES);\n    if (rampIdFromCookie && rampIdExpires && rampIdExpires > Date.now()) {\n      state.rampIdEnv = rampIdFromCookie;\n      return Promise.resolve(rampIdFromCookie);\n    }\n  }\n  if (!resolveRampIdIfNotAvailable || rampIdScriptPath == null) {\n    return Promise.resolve(null);\n  }\n  return initiateRampIDCall(\n    rampIdScriptPath,\n    cookieManager,\n    logger,\n    useShortTimeout,\n  );\n};\n\nexport { getRampId, initiateRampIDCall };\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { loadScript } from \"../../../utils/dom/index.js\";\nimport { ID5_SCRIPT_URL } from \"../constants/index.js\";\n\nlet id5Id = \"\";\nlet inProgressId5Promise = null;\nconst SHORT_TIMEOUT_MS = 2000;\nconst DEFAULT_TIMEOUT_MS = 30000;\n\nconst initiateID5Call = (partnerId, useShortTimeout, logger) => {\n  partnerId = Math.floor(Number(partnerId));\n\n  if (inProgressId5Promise) {\n    return inProgressId5Promise;\n  }\n\n  const timeoutMs = useShortTimeout ? SHORT_TIMEOUT_MS : DEFAULT_TIMEOUT_MS;\n\n  let iD5TimedOut = false;\n\n  const id5ResolutionPromise = new Promise((resolve, reject) => {\n    if (!partnerId) {\n      logger.error(\"Missing partner ID\");\n      reject(new Error(\"ID5 partner ID is required\"));\n      return;\n    }\n\n    const handleId5 = () => {\n      try {\n        if (typeof window.ID5 === \"undefined\") {\n          reject(new Error(\"ID5 object not available after script load\"));\n          return;\n        }\n\n        const id5Instance = window.ID5.init({ partnerId });\n        id5Id = id5Instance.getUserId();\n\n        const safeResolve = (val) => {\n          if (!iD5TimedOut) resolve(val);\n        };\n\n        if (!id5Id) {\n          window.ID5.init({ partnerId }).onAvailable(function firstRetry(\n            retryStatus,\n          ) {\n            id5Id = retryStatus.getUserId();\n            if (id5Id) {\n              safeResolve(id5Id);\n            } else {\n              window.ID5.init({ partnerId }).onAvailable(\n                function secondRetry(secondRetryStatus) {\n                  id5Id = secondRetryStatus.getUserId();\n                  if (id5Id) {\n                    safeResolve(id5Id);\n                  } else {\n                    logger.error(\"Failed to get ID5 ID after all retries\");\n                    safeResolve(null);\n                  }\n                },\n              );\n            }\n          }, 1000);\n        } else {\n          safeResolve(id5Id);\n        }\n      } catch (error) {\n        logger.error(\"Error during ID5 initialization\", error);\n        reject(error);\n      }\n    };\n\n    if (typeof window.ID5 !== \"undefined\") {\n      handleId5();\n    } else {\n      loadScript(ID5_SCRIPT_URL, {\n        onLoad: handleId5,\n        onError: (error) => {\n          logger.error(\"Script loading failed\", error);\n          reject(error);\n        },\n      });\n    }\n  });\n\n  const timeoutPromise = new Promise((resolve) => {\n    setTimeout(() => {\n      iD5TimedOut = true;\n      resolve(null);\n    }, timeoutMs);\n  });\n\n  inProgressId5Promise = Promise.race([\n    id5ResolutionPromise,\n    timeoutPromise,\n  ]).finally(() => {\n    inProgressId5Promise = null;\n  });\n\n  return inProgressId5Promise;\n};\n\nconst getID5Id = function getID5Id(\n  logger,\n  partnerId,\n  resolveId5IfNotAvailable = true,\n  useShortTimeout = false,\n) {\n  if (id5Id && id5Id !== \"\") {\n    return Promise.resolve(id5Id);\n  }\n  if (!resolveId5IfNotAvailable) {\n    return Promise.resolve(null);\n  }\n\n  return initiateID5Call(partnerId, useShortTimeout, logger)\n    .then((resolvedId) => resolvedId)\n    .catch((error) => {\n      logger.error(\"Failed to get ID5 ID\", error);\n      throw error;\n    });\n};\n\nexport { getID5Id, initiateID5Call };\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  SKWCID_PARAM,\n  EFID_PARAM,\n  UNKNOWN_ADVERTISER,\n  LAST_CLICK_COOKIE_KEY,\n  LOG_ID_CONVERSION_SUCCESS,\n  LAST_CONVERSION_TIME_KEY,\n  DISPLAY_CLICK_COOKIE_KEY,\n  AD_CONVERSION_VIEW_EVENT_TYPE,\n  SURFER_ID,\n  ID5_ID,\n  RAMP_ID,\n  DISPLAY_CLICK_COOKIE_KEY_EXPIRES,\n} from \"../constants/index.js\";\n\nimport { queryString } from \"../../../utils/index.js\";\n\nconst getUrlParams = () => {\n  const parsedParams = queryString.parse(window.location.search);\n  return {\n    skwcid: parsedParams[SKWCID_PARAM], // \"s_kwcid\"\n    efid: parsedParams[EFID_PARAM], // \"ef_id\"\n  };\n};\n\n/**\n * Manages a single, ongoing asynchronous operation to prevent redundant calls.\n * @param {string} operationName - A name for the operation for logging purposes.\n * @param {Function} workerFn - A function that returns a Promise to be executed.\n * @returns {Function} A function that, when called, will either start the worker or return the in-progress promise.\n */\nconst createManagedAsyncOperation = (operationName, workerFn) => {\n  let inProgressPromise = null;\n\n  return (...args) => {\n    if (inProgressPromise) {\n      return inProgressPromise;\n    }\n    inProgressPromise = workerFn(...args).finally(() => {\n      inProgressPromise = null;\n    });\n\n    return inProgressPromise;\n  };\n};\n\n/**\n * Normalizes advertiser settings - extracts enabled advertiser IDs\n * @param {Object[]} advertiserSettings - Array of advertiserSettings objects with advertiserId and enabled properties\n * @returns {string} Comma-separated string of enabled advertiser IDs\n */\nconst normalizeAdvertiser = (advertiserSettings) => {\n  if (!advertiserSettings || !Array.isArray(advertiserSettings)) {\n    return UNKNOWN_ADVERTISER;\n  }\n\n  return advertiserSettings\n    .filter((item) => item && item.enabled === true && item.advertiserId)\n    .map((item) => item.advertiserId)\n    .join(\", \");\n};\n\nconst appendAdvertisingIdQueryToEvent = (\n  idsToInclude,\n  event,\n  cookieManager,\n  componentConfig,\n  addEventType = false,\n) => {\n  const searchClickData = cookieManager.getValue(LAST_CLICK_COOKIE_KEY);\n  let displayClickCookie = null;\n  const displayClickCookieExpires = cookieManager.getValue(\n    DISPLAY_CLICK_COOKIE_KEY_EXPIRES,\n  );\n  if (displayClickCookieExpires && displayClickCookieExpires > Date.now()) {\n    displayClickCookie = cookieManager.getValue(DISPLAY_CLICK_COOKIE_KEY);\n  }\n  const query = {\n    advertising: {\n      ...(searchClickData?.click_time && {\n        lastSearchClick: searchClickData.click_time,\n      }),\n      ...(displayClickCookie && {\n        lastDisplayClick: displayClickCookie,\n      }),\n      stitchIds: {\n        ...(idsToInclude[SURFER_ID] && {\n          surferId: idsToInclude[SURFER_ID],\n        }),\n        ...(idsToInclude[ID5_ID] && { id5: idsToInclude[ID5_ID] }),\n        ...(idsToInclude[RAMP_ID] && { rampIdEnv: idsToInclude[RAMP_ID] }),\n        ipAddress: \"DUMMY_IP_ADDRESS\",\n      },\n      advIds: normalizeAdvertiser(componentConfig.advertiserSettings),\n      ...(addEventType && { eventType: AD_CONVERSION_VIEW_EVENT_TYPE }),\n    },\n  };\n\n  event.mergeQuery(query);\n  return event;\n};\n\nconst isAnyIdUnused = (availableIds, conversionCalled) => {\n  return Object.entries(availableIds).some(([idType]) => {\n    return !conversionCalled[idType];\n  });\n};\n\nconst markIdsAsConverted = (\n  idTypes,\n  conversionCalled,\n  cookieManager,\n  logger,\n) => {\n  const now = Date.now();\n\n  idTypes.forEach((idType) => {\n    conversionCalled[idType] = true;\n    cookieManager.setValue(`${idType}_last_conversion`, now);\n    logger.info(LOG_ID_CONVERSION_SUCCESS.replace(\"{0}\", idType));\n  });\n\n  cookieManager.setValue(LAST_CONVERSION_TIME_KEY, now);\n};\n\nconst isThrottled = (idType, cookieManager) => {\n  const now = Date.now();\n  const THROTTLE_WINDOW = 30 * 60 * 1000; // 30 minutes\n  const lastSuccessfulConversion = cookieManager.getValue(\n    `${idType}_last_conversion`,\n  );\n  return Boolean(\n    lastSuccessfulConversion &&\n      now - lastSuccessfulConversion < THROTTLE_WINDOW,\n  );\n};\n\nconst shouldThrottle = (idType, cookieManager) => {\n  return isThrottled(idType, cookieManager);\n};\n\nexport {\n  getUrlParams,\n  normalizeAdvertiser,\n  createManagedAsyncOperation,\n  appendAdvertisingIdQueryToEvent,\n  isAnyIdUnused,\n  markIdsAsConverted,\n  isThrottled,\n  shouldThrottle,\n};\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport collectSurferId from \"./collectSurferId.js\";\nimport { getRampId } from \"./collectRampId.js\";\nimport { getID5Id } from \"./collectID5Id.js\";\nimport { ID5_ID, RAMP_ID, SURFER_ID } from \"../constants/index.js\";\nimport { isThrottled } from \"../utils/helpers.js\";\n\nconst collectAllIdentities = (\n  logger,\n  componentConfig,\n  cookieManager,\n  getBrowser,\n) => {\n  const promises = {};\n\n  if (!isThrottled(SURFER_ID, cookieManager)) {\n    promises.surferId = collectSurferId(cookieManager, getBrowser, true).catch(\n      () => null,\n    );\n  }\n\n  if (\n    componentConfig.id5PartnerId &&\n    componentConfig.dspEnabled &&\n    !isThrottled(ID5_ID, cookieManager)\n  ) {\n    promises.id5Id = getID5Id(logger, componentConfig.id5PartnerId).catch(\n      () => null,\n    );\n  }\n\n  if (\n    componentConfig.rampIdJSPath &&\n    componentConfig.dspEnabled &&\n    !isThrottled(RAMP_ID, cookieManager)\n  ) {\n    promises.rampId = getRampId(\n      logger,\n      componentConfig.rampIdJSPath,\n      cookieManager,\n      true,\n    ).catch(() => null);\n  }\n\n  return promises;\n};\n\nexport default collectAllIdentities;\n","/*\nCopyright 2025 Adobe. All rights reserved.\nLicensed under the Apache License, Version 2.0.\nhttp://www.apache.org/licenses/LICENSE-2.0\n*/\n\nimport collectAllIdentities from \"../identities/collectAllIdentities.js\";\nimport {\n  LOG_ERROR_RESOLVING_ID,\n  LOG_AD_CONVERSION_FAILED,\n  AD_CONVERSION_VIEW_EVENT_TYPE,\n} from \"../constants/index.js\";\nimport {\n  isAnyIdUnused,\n  appendAdvertisingIdQueryToEvent,\n  markIdsAsConverted,\n} from \"../utils/helpers.js\";\n\nexport default async function handleViewThrough({\n  eventManager,\n  cookieManager,\n  logger,\n  componentConfig,\n  adConversionHandler,\n  getBrowser,\n}) {\n  const resolvedIds = {};\n  const usedIdTracker = {};\n  const triggerConversion = async () => {\n    if (!isAnyIdUnused(resolvedIds, usedIdTracker)) return null;\n\n    const idTypesToUse = Object.keys(resolvedIds);\n\n    try {\n      const event = appendAdvertisingIdQueryToEvent(\n        resolvedIds,\n        eventManager.createEvent(),\n        cookieManager,\n        componentConfig,\n        true,\n      );\n      const xdm = {\n        eventType: AD_CONVERSION_VIEW_EVENT_TYPE,\n        timestamp: new Date().toISOString(),\n      };\n      event.setUserXdm(xdm);\n\n      const result = await adConversionHandler.trackAdConversion({ event });\n\n      markIdsAsConverted(idTypesToUse, usedIdTracker, cookieManager, logger);\n      return result;\n    } catch (error) {\n      logger.error(LOG_AD_CONVERSION_FAILED, error);\n      return null;\n    }\n  };\n\n  const identityPromisesMap = collectAllIdentities(\n    logger,\n    componentConfig,\n    cookieManager,\n    getBrowser,\n  );\n\n  if (Object.keys(identityPromisesMap).length === 0) {\n    return [];\n  }\n\n  const identityPromises = Object.entries(identityPromisesMap).map(\n    ([idType, idPromise]) =>\n      idPromise\n        .then((idValue) => {\n          if (idValue) {\n            resolvedIds[idType] = idValue;\n            return triggerConversion();\n          }\n        })\n        .catch((error) => {\n          logger.error(LOG_ERROR_RESOLVING_ID.replace(\"{0}\", idType), error);\n          return null;\n        }),\n  );\n  return Promise.allSettled(identityPromises);\n}\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport handleClickThrough from \"./clickThroughHandler.js\";\nimport handleViewThrough from \"./viewThroughHandler.js\";\nimport { getUrlParams, normalizeAdvertiser } from \"../utils/helpers.js\";\n\n/**\n * Creates a handler for sending ad conversions.\n * Handles both click-through and view-through conversions.\n * This is a workaround to avoid the full lifecycle of the eventManager.sendEvent\n */\nexport default ({\n  eventManager,\n  cookieManager,\n  adConversionHandler,\n  logger,\n  componentConfig,\n  getBrowser,\n}) => {\n  const activeAdvertiserIds = componentConfig?.advertiserSettings\n    ? normalizeAdvertiser(componentConfig.advertiserSettings)\n    : \"\";\n\n  return async () => {\n    const { skwcid, efid } = getUrlParams();\n    const isClickThru = !!(skwcid || efid);\n\n    try {\n      if (isClickThru) {\n        // wait for click through to complete\n        return handleClickThrough({\n          eventManager,\n          cookieManager,\n          adConversionHandler,\n          logger,\n          skwcid,\n          efid,\n        });\n      } else if (activeAdvertiserIds) {\n        // fire and forget view through\n        handleViewThrough({\n          eventManager,\n          cookieManager,\n          logger,\n          componentConfig,\n          adConversionHandler,\n          getBrowser,\n        }).catch((error) => logger.error(\"Error in view through:\", error));\n      }\n    } catch (error) {\n      logger.error(\"Error in sendAdConversion:\", error);\n    }\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nLicensed under the Apache License, Version 2.0.\nhttp://www.apache.org/licenses/LICENSE-2.0\n*/\n\nimport collectSurferId from \"../identities/collectSurferId.js\";\nimport { getID5Id } from \"../identities/collectID5Id.js\";\nimport { getRampId } from \"../identities/collectRampId.js\";\nimport {\n  appendAdvertisingIdQueryToEvent,\n  getUrlParams,\n  isThrottled,\n} from \"../utils/helpers.js\";\nimport { SURFER_ID, ID5_ID, RAMP_ID } from \"../constants/index.js\";\nimport { AUTO, WAIT } from \"../../../constants/consentStatus.js\";\nimport { CHROME } from \"../../../constants/browser.js\";\n\nconst isAdvertisingDisabled = (advertising) => {\n  return ![AUTO, WAIT].includes(\n    advertising?.handleAdvertisingData?.toLowerCase(),\n  );\n};\n\nconst waitForAdvertisingId = (advertising) => {\n  return advertising?.handleAdvertisingData?.toLowerCase() === WAIT;\n};\n\n/**\n * Appends advertising identity IDs to AEP event query if not already added.\n * @param {Object} params\n * @param {Object} params.cookieManager\n * @param {Object} params.logger\n * @param {Object} params.state\n * @param {Object} params.event\n * @param {Object} params.componentConfig\n * @param {Object} params.advertising\n * @param {Function} params.getBrowser\n */\nexport default async function handleOnBeforeSendEvent({\n  cookieManager,\n  logger,\n  event,\n  componentConfig,\n  advertising,\n  getBrowser,\n}) {\n  const { skwcid, efid } = getUrlParams();\n  const isClickThru = !!(skwcid && efid);\n  if (\n    isAdvertisingDisabled(advertising) ||\n    isClickThru ||\n    (isThrottled(SURFER_ID, cookieManager) &&\n      isThrottled(ID5_ID, cookieManager) &&\n      isThrottled(RAMP_ID, cookieManager))\n  )\n    return;\n\n  try {\n    const useShortTimeout = waitForAdvertisingId(advertising);\n\n    let rampIdPromise = null;\n\n    if (!getBrowser || getBrowser() !== CHROME) {\n      rampIdPromise = getRampId(\n        logger,\n        componentConfig.rampIdJSPath,\n        cookieManager,\n        useShortTimeout,\n        useShortTimeout,\n      );\n    }\n    const [surferIdResult, id5IdResult, rampIdResult] =\n      await Promise.allSettled([\n        collectSurferId(cookieManager, getBrowser, useShortTimeout),\n        getID5Id(\n          logger,\n          componentConfig.id5PartnerId,\n          useShortTimeout,\n          useShortTimeout,\n        ),\n        rampIdPromise,\n      ]);\n\n    const availableIds = {};\n    if (\n      surferIdResult.status === \"fulfilled\" &&\n      surferIdResult.value &&\n      !isThrottled(SURFER_ID, cookieManager)\n    ) {\n      availableIds.surferId = surferIdResult.value;\n    }\n    if (\n      id5IdResult.status === \"fulfilled\" &&\n      id5IdResult.value &&\n      !isThrottled(ID5_ID, cookieManager)\n    ) {\n      availableIds.id5Id = id5IdResult.value;\n    }\n    if (\n      rampIdResult.status === \"fulfilled\" &&\n      rampIdResult.value &&\n      !isThrottled(RAMP_ID, cookieManager)\n    ) {\n      availableIds.rampId = rampIdResult.value;\n    }\n    // If no IDs are available and any ID is throttled, return , because we dont have new info to send\n    if (\n      Object.keys(availableIds).length === 0 &&\n      (isThrottled(SURFER_ID, cookieManager) ||\n        isThrottled(ID5_ID, cookieManager) ||\n        isThrottled(RAMP_ID, cookieManager))\n    ) {\n      return;\n    }\n    appendAdvertisingIdQueryToEvent(\n      availableIds,\n      event,\n      cookieManager,\n      componentConfig,\n    );\n  } catch (error) {\n    logger.error(\"Error in onBeforeSendEvent hook:\", error);\n  }\n}\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createSendAdConversion from \"./handlers/sendAdConversion.js\";\nimport handleOnBeforeSendEvent from \"./handlers/onBeforeSendEventHandler.js\";\n\nexport default ({\n  logger,\n  config,\n  eventManager,\n  cookieManager,\n  adConversionHandler,\n  getBrowser,\n}) => {\n  const componentConfig = config.advertising;\n\n  const sendAdConversionHandler = createSendAdConversion({\n    eventManager,\n    cookieManager,\n    adConversionHandler,\n    logger,\n    componentConfig,\n    getBrowser,\n  });\n\n  return {\n    lifecycle: {\n      onComponentsRegistered() {\n        return sendAdConversionHandler();\n      },\n      onBeforeEvent: ({ event, advertising = {} }) => {\n        return handleOnBeforeSendEvent({\n          cookieManager,\n          logger,\n          event,\n          componentConfig,\n          advertising,\n          getBrowser,\n        });\n      },\n    },\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  objectOf,\n  string,\n  arrayOf,\n  boolean,\n} from \"../../utils/validation/index.js\";\n\nexport default objectOf({\n  advertising: objectOf({\n    id5PartnerId: string(),\n    rampIdJSPath: string(),\n    dspEnabled: boolean(),\n    advertiserSettings: arrayOf(\n      objectOf({\n        advertiserId: string().required(),\n        enabled: boolean().required(),\n      }).noUnknownFields(),\n    ),\n  }).noUnknownFields(),\n});\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Creates a specialized handler for ad conversion events.\n * This follows a similar pattern to the media event handling in the StreamingMedia component.\n */\nexport default ({\n  sendEdgeNetworkRequest,\n  consent,\n  createDataCollectionRequest,\n  createDataCollectionRequestPayload,\n  logger,\n}) => {\n  /**\n   * Tracks an ad conversion event by sending it directly to the Edge Network\n   */\n  const trackAdConversion = ({ event }) => {\n    const dataCollectionRequestPayload = createDataCollectionRequestPayload();\n    dataCollectionRequestPayload.addEvent(event);\n    event.finalize();\n    const request = createDataCollectionRequest({\n      payload: dataCollectionRequestPayload,\n    });\n\n    return consent.awaitConsent().then(() => {\n      return sendEdgeNetworkRequest({ request })\n        .then(() => {\n          return { success: true };\n        })\n        .catch((error) => {\n          logger.error(\"Failed to send ad conversion event\", error);\n          throw error;\n        });\n    });\n  };\n\n  return {\n    trackAdConversion,\n  };\n};\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { getNamespacedCookieName, cookieJar } from \"../../../utils/index.js\";\nimport createLoggingCookieJar from \"../../../utils/createLoggingCookieJar.js\";\nimport {\n  ADVERTISING_COOKIE_KEY,\n  DEFAULT_COOKIE_EXPIRATION_MINUTES,\n  DEFAULT_THROTTLE_MINUTES,\n} from \"../constants/index.js\";\n\nexport default ({ orgId, logger }) => {\n  const loggingCookieJar = createLoggingCookieJar({ logger, cookieJar });\n\n  const getCookieName = (key, useNamespace = true) =>\n    useNamespace ? getNamespacedCookieName(orgId, key) : key;\n\n  const getDefaultExpiration = (minutes = DEFAULT_THROTTLE_MINUTES) =>\n    new Date(Date.now() + minutes * 60 * 1000);\n\n  const safeJsonParse = (value) => {\n    try {\n      if (value?.startsWith(\"%7B\") || value?.startsWith(\"{\")) {\n        return JSON.parse(decodeURIComponent(value));\n      }\n    } catch {\n      // pass\n    }\n    return value;\n  };\n\n  const safeJsonStringify = (value) =>\n    typeof value === \"object\" && value !== null\n      ? encodeURIComponent(JSON.stringify(value))\n      : value;\n\n  const readCookie = (key, useNamespace = true) => {\n    try {\n      const name = getCookieName(key, useNamespace);\n      const value = loggingCookieJar.get(name);\n      return value ? safeJsonParse(value) : null;\n    } catch (error) {\n      logger.error(`Error reading cookie: ${key}`, error);\n      return null;\n    }\n  };\n\n  const writeCookie = (key, value, options = {}, useNamespace = true) => {\n    try {\n      const name = getCookieName(key, useNamespace);\n      const storedValue = safeJsonStringify(value);\n      loggingCookieJar.set(name, storedValue, options);\n      return true;\n    } catch (error) {\n      logger.error(`Error writing cookie: ${key}`, error);\n      return false;\n    }\n  };\n\n  const setValue = (key, value, options = {}) => {\n    const existing = readCookie(ADVERTISING_COOKIE_KEY) || {};\n\n    const updated = {\n      ...existing,\n      [key]: value,\n    };\n\n    return writeCookie(ADVERTISING_COOKIE_KEY, updated, {\n      expires: getDefaultExpiration(DEFAULT_COOKIE_EXPIRATION_MINUTES),\n      ...options,\n    });\n  };\n\n  const getValue = (key) => {\n    const data = readCookie(ADVERTISING_COOKIE_KEY) || {};\n    return data[key];\n  };\n\n  return {\n    setValue,\n    getValue,\n  };\n};\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createComponent from \"./createComponent.js\";\nimport configValidators from \"./configValidators.js\";\nimport {\n  createDataCollectionRequest,\n  createDataCollectionRequestPayload,\n} from \"../../utils/request/index.js\";\nimport createAdConversionHandler from \"./handlers/createAdConversionHandler.js\";\nimport createCookieManager from \"./utils/advertisingCookieManager.js\";\n\nconst createAdvertising = ({\n  logger,\n  config,\n  eventManager,\n  sendEdgeNetworkRequest,\n  consent,\n  getBrowser,\n}) => {\n  const cookieManager = createCookieManager({\n    orgId: config.orgId,\n    logger,\n  });\n\n  const adConversionHandler = createAdConversionHandler({\n    eventManager,\n    sendEdgeNetworkRequest,\n    consent,\n    createDataCollectionRequest,\n    createDataCollectionRequestPayload,\n    logger,\n  });\n  return createComponent({\n    logger,\n    config,\n    eventManager,\n    cookieManager,\n    adConversionHandler,\n    getBrowser,\n  });\n};\n\ncreateAdvertising.namespace = \"Advertising\";\ncreateAdvertising.configValidators = configValidators;\n\nexport default createAdvertising;\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { PushSubscription } from '../types.js' */\n\nimport { base64ToBytes, bytesToBase64 } from \"../../../utils/index.js\";\n\n/**\n * Gets push subscription details for the current browser.\n *\n * @async\n * @function\n *\n * @param {object} options\n * @param {string} options.vapidPublicKey - The VAPID public key in base64 format used for push notification authentication.\n * @param {Window} options.window\n *\n * @returns {Promise<PushSubscription>} A promise that resolves to an object containing the push subscription details.\n\n * @throws {Error} Throws an error if service workers are not supported in the browser.\n * @throws {Error} Throws an error if user didn't approve push notifications for the domain.\n * @throws {Error} Throws an error if push notifications are not supported in the browser.\n * @throws {Error} Throws an error if no VAPID public key was provided.\n *\n * @example\n * // Get subscription details with VAPID key\n * const vapidKey = \"BEl62iUYgUivxIkv69yViEuiBIa40HI5hmjHbKPlXO...\";\n * const subscription = await getPushSubscriptionDetails(vapidKey);\n * console.log(subscription.endpoint); // \"https://fcm.googleapis.com/fcm/send/...\"\n */\nconst getPushSubscriptionDetails = async ({ vapidPublicKey, window }) => {\n  if (!(\"serviceWorker\" in window.navigator)) {\n    throw new Error(\"Service workers are not supported in this browser.\");\n  }\n\n  if (!(\"PushManager\" in window) || !(\"Notification\" in window)) {\n    throw new Error(\"Push notifications are not supported in this browser.\");\n  }\n\n  /** @type {object} */\n  const notification = window.Notification;\n  if (notification.permission !== \"granted\") {\n    throw new Error(\n      \"The user has not given permission to send push notifications.\",\n    );\n  }\n\n  const serviceWorkerRegistration =\n    // eslint-disable-next-line compat/compat\n    await window.navigator.serviceWorker.getRegistration();\n\n  if (!serviceWorkerRegistration) {\n    throw new Error(\"No service worker registration was found.\");\n  }\n\n  // Even `applicationServerKey` is not required in the spec, some browsers like Chrome are requiring it.\n  if (!vapidPublicKey) {\n    throw new Error(\"No VAPID public key was provided.\");\n  }\n\n  const subscriptionOptions = {\n    userVisibleOnly: true,\n    applicationServerKey: base64ToBytes(vapidPublicKey),\n  };\n\n  // Push subscription handling strategy:\n  //\n  // 1. We always call subscribe() to either get the current subscription or create a new one.\n  //    - If called with the same VAPID key as an existing subscription, it returns that subscription\n  //    - If called with a different VAPID key when a subscription exists, it throws an error\n  //\n  // 2. Error handling approach:\n  //    - Browser error messages vary and don't clearly indicate VAPID key conflicts\n  //    - When subscribe() fails, we assume it's likely due to a VAPID key mismatch\n  //    - We attempt recovery by unsubscribing the existing subscription and retrying\n  //    - If the retry also fails, we re-throw the original error\n  //\n  // This strategy ensures we can handle both new subscriptions and VAPID key changes\n  // while gracefully falling back to error reporting when recovery isn't possible.\n  try {\n    const subscription =\n      await serviceWorkerRegistration.pushManager.subscribe(\n        subscriptionOptions,\n      );\n\n    return {\n      endpoint: subscription.endpoint,\n      keys: {\n        p256dh: bytesToBase64(new Uint8Array(subscription.getKey(\"p256dh\"))),\n        auth: bytesToBase64(new Uint8Array(subscription.getKey(\"auth\"))),\n      },\n    };\n  } catch (e) {\n    const subscription =\n      await serviceWorkerRegistration.pushManager.getSubscription();\n    if (!subscription) {\n      throw e;\n    }\n\n    const unsubscribeResult = await subscription.unsubscribe();\n    if (!unsubscribeResult) {\n      throw e;\n    }\n\n    return getPushSubscriptionDetails({ vapidPublicKey, window });\n  }\n};\n\nexport default getPushSubscriptionDetails;\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { DataCollectionRequestPayload, Request } from '../../../utils/request/types.js' */\n\nimport { createRequest } from \"../../../utils/request/index.js\";\n\n/**\n * @function\n *\n * @param {{ payload: DataCollectionRequestPayload }} options\n *\n * @returns {Request}\n */\nexport default ({ payload }) =>\n  createRequest({\n    payload,\n\n    getAction() {\n      return \"interact\";\n    },\n\n    getUseSendBeacon() {\n      return false;\n    },\n  });\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { EventManager } from \"../../../core/types.js\" */\n/** @import { DataCollectionRequestPayload } from \"../../../utils/request/types.js\" */\n\nimport createDataCollectionRequestPayload from \"../../../utils/request/createDataCollectionRequestPayload.js\";\n\n/**\n * Creates a data collection request payload for sending push subscription details to Adobe Experience Platform.\n *\n * This function constructs an event containing push notification subscription information,\n * including the subscription details, platform information, and identity data. The event\n * is then packaged into a data collection request payload for transmission to the edge network.\n *\n * @async\n * @function\n *\n * @param {Object} options\n * @param {string} options.ecid\n * @param {EventManager} options.eventManager\n * @param {string} options.serializedPushSubscriptionDetails\n * @param {Window} options.window\n *\n * @returns {Promise<DataCollectionRequestPayload>}\n */\nexport default async ({\n  ecid,\n  eventManager,\n  serializedPushSubscriptionDetails,\n  window,\n}) => {\n  const event = eventManager.createEvent();\n\n  event.setUserData({\n    pushNotificationDetails: [\n      {\n        appID: window.location.host,\n        token: serializedPushSubscriptionDetails,\n        platform: \"web\",\n        denylisted: false,\n        identity: {\n          namespace: {\n            code: \"ECID\",\n          },\n          id: ecid,\n        },\n      },\n    ],\n  });\n  event.finalize();\n\n  const payload = createDataCollectionRequestPayload();\n  payload.addEvent(event);\n\n  return payload;\n};\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { Storage } from '../../../utils/types.js' */\n/** @import { EventManager, Logger } from '../../../core/types.js' */\n/** @import { IdentityManager } from '../../../core/identity/types.js' */\n/** @import { ConsentManager } from '../../../core/consent/types.js' */\n/** @import { EdgeRequestExecutor } from '../../../core/edgeNetwork/types.js' */\n\nimport { sortObjectKeysRecursively } from \"../../../utils/index.js\";\nimport getPushSubscriptionDetails from \"../helpers/getPushSubscriptionDetails.js\";\nimport createSendPushSubscriptionRequest from \"./createSendPushSubscriptionRequest.js\";\nimport createSendPushSubscriptionPayload from \"./createSendPushSubscriptionPayload.js\";\n\nconst SUBSCRIPTION_DETAILS = \"subscriptionDetails\";\n\n/**\n * Retrieves and returns push subscription details with sorted object keys.\n *\n * This function gets the push subscription details using the provided VAPID public key\n * and returns the details with all object keys sorted recursively for consistent output.\n *\n * @async\n * @function\n *\n * @param {Object} options\n * @param {{vapidPublicKey: string}} options.config\n * @param {Storage} options.storage\n * @param {Logger} options.logger\n * @param {EventManager} options.eventManager\n * @param {IdentityManager} options.identity\n * @param {EdgeRequestExecutor} options.sendEdgeNetworkRequest\n * @param {ConsentManager} options.consent\n * @param {Window} options.window\n *\n * @returns {Promise<void>}\n */\nexport default async ({\n  config: { vapidPublicKey },\n  storage,\n  logger,\n  sendEdgeNetworkRequest,\n  consent,\n  eventManager,\n  identity,\n  window,\n}) => {\n  await identity.awaitIdentity();\n  const ecid = identity.getEcidFromCookie();\n\n  const pushSubscriptionDetails = await getPushSubscriptionDetails({\n    vapidPublicKey,\n    window,\n  });\n\n  const serializedPushSubscriptionDetails = JSON.stringify(\n    sortObjectKeysRecursively(pushSubscriptionDetails),\n  );\n\n  const cacheValue = `${ecid}${serializedPushSubscriptionDetails}`;\n\n  if (cacheValue === storage.getItem(SUBSCRIPTION_DETAILS)) {\n    logger.info(\n      \"Subscription details have not changed. Not sending to the server.\",\n    );\n\n    return;\n  }\n\n  storage.setItem(SUBSCRIPTION_DETAILS, cacheValue);\n\n  const payload = await createSendPushSubscriptionPayload({\n    eventManager,\n    ecid,\n    serializedPushSubscriptionDetails,\n    window,\n  });\n\n  const request = createSendPushSubscriptionRequest({\n    payload,\n  });\n\n  await consent.awaitConsent();\n  await sendEdgeNetworkRequest({ request });\n};\n","/*\nCopyright 2025 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/** @import { StorageCreator } from '../../utils/types.js' */\n/** @import { EventManager, Logger } from '../../core/types.js' */\n/** @import { IdentityManager } from '../../core/identity/types.js' */\n/** @import { ConsentManager } from '../../core/consent/types.js' */\n/** @import { EdgeRequestExecutor } from '../../core/edgeNetwork/types.js' */\n\nimport { objectOf, string } from \"../../utils/validation/index.js\";\nimport { sanitizeOrgIdForCookieName } from \"../../utils/index.js\";\nimport makeSendPushSubscriptionRequest from \"./request/makeSendPushSubscriptionRequest.js\";\n\nconst isComponentConfigured = ({\n  orgId,\n  pushNotifications: { vapidPublicKey } = {\n    vapidPublicKey: undefined,\n  },\n}) => orgId && vapidPublicKey;\n\n/**\n * @function\n *\n * @param {Object} options\n * @param {{ orgId: string, pushNotifications: { vapidPublicKey: string }}} options.config\n * @param {StorageCreator} options.createNamespacedStorage\n * @param {EventManager} options.eventManager\n * @param {Logger} options.logger\n * @param {ConsentManager} options.consent\n * @param {IdentityManager} options.identity\n * @param {EdgeRequestExecutor} options.sendEdgeNetworkRequest\n * @returns {{  commands: { sendPushSubscription: object } }}\n */\nconst createPushNotifications = ({\n  createNamespacedStorage,\n  eventManager,\n  config,\n  logger,\n  consent,\n  identity,\n  sendEdgeNetworkRequest,\n}) => {\n  return {\n    commands: {\n      sendPushSubscription: {\n        run: async () => {\n          if (!isComponentConfigured(config)) {\n            throw new Error(\n              \"Push notifications module is not configured. No VAPID public key was provided.\",\n            );\n          }\n\n          const {\n            orgId,\n            pushNotifications: { vapidPublicKey } = {\n              vapidPublicKey: undefined,\n            },\n          } = config || {};\n\n          const storage = createNamespacedStorage(\n            `${sanitizeOrgIdForCookieName(orgId)}.pushNotifications.`,\n          );\n\n          return makeSendPushSubscriptionRequest({\n            config: {\n              vapidPublicKey,\n            },\n            storage: storage.persistent,\n            logger,\n            sendEdgeNetworkRequest,\n            consent,\n            eventManager,\n            identity,\n            window,\n          });\n        },\n        optionsValidator: objectOf({}).noUnknownFields(),\n      },\n    },\n  };\n};\n\ncreatePushNotifications.namespace = \"Push Notifications\";\ncreatePushNotifications.configValidators = objectOf({\n  pushNotifications: objectOf({\n    vapidPublicKey: string().required(),\n  }).noUnknownFields(),\n});\n\nexport default createPushNotifications;\n","/*\nCopyright 2023 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// This file contains the optional components that can be included in an alloy build.\n// The exports names must have the camel case format. If you need to add a required\n// module, you should add it to the core/requiredComponentCreators.js file.\n\nexport { default as activityCollector } from \"../components/ActivityCollector/index.js\";\nexport { default as audiences } from \"../components/Audiences/index.js\";\nexport { default as consent } from \"../components/Consent/index.js\";\nexport { default as eventMerge } from \"../components/EventMerge/index.js\";\nexport { default as mediaAnalyticsBridge } from \"../components/MediaAnalyticsBridge/index.js\";\nexport { default as personalization } from \"../components/Personalization/index.js\";\nexport { default as rulesEngine } from \"../components/RulesEngine/index.js\";\nexport { default as streamingMedia } from \"../components/StreamingMedia/index.js\";\nexport { default as advertising } from \"../components/Advertising/index.js\";\nexport { default as pushNotifications } from \"../components/PushNotifications/index.js\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// This file is used by rollup to create the browser version that is uploaded to cdn\n\nimport core from \"./core/index.js\";\nimport * as components from \"./core/componentCreators.js\";\n\n// If you change this line, check if the custom build script is still working.\n// You might need to change the babel plugin in scripts/helpers/entryPointGeneratorBabelPlugin.js.\ncore({ components: Object.values(components) });\n"],"names":["executeCommand","resolve","reject","commandName","options","then","value","isNil","Array","isArray","values","length","Object","assign","reduce","accumulator","currentValue","isObject","keys","forEach","key","push","base64ToBytes","base64String","padding","repeat","base64","replace","binString","atob","Uint8Array","from","m","codePointAt","bytesToBase64","bytes","btoa","String","fromCharCode","target","i","arguments","source","defaultConverter","read","slice","decodeURIComponent","write","encodeURIComponent","init","converter","defaultAttributes","set","name","attributes","document","expires","Date","now","toUTCString","escape","stringifiedAttributes","attributeName","split","cookie","get","cookies","jar","parts","join","found","e","create","remove","withAttributes","withConverter","freeze","api","path","bind","deepAssignObject","sources","TypeError","result","content","updates","propertyPath","hostObjectForUpdates","obj","propertyName","deepAssign","callbacks","add","callback","call","args","Promise","all","map","logger","cookieJar","info","queueLength","lastPromiseInQueue","addTask","task","lastPromiseFulfilledHandler","finally","deferred","promise","REFERENCE_EQUALITY","a","b","findIndex","array","item","isEqual","filter","index","parent","node","appendChild","populateElementProperties","element","props","styleProps","styleKey","style","tag","attrs","children","doc","createElement","setAttribute","child","appendNode","BODY","IFRAME","IMG","DIV","STYLE","SCRIPT","HEAD","src","currentDocument","onload","onerror","onabort","createNode","SIBLING_PATTERN","context","selector","test","toArray","querySelectorAll","splitWithShadow","SHADOW_SEPARATOR","transformPrefix","hasChildCombinatorPrefix","startsWith","prefix","Element","Document","part","trim","shadowRoot","prefixed","partNode","undefined","str","indexOf","isShadowSelector","selectNodesWithShadow","MUTATION_OBSERVER","RAF","MUTATION_OBSERVER_CONFIG","childList","subtree","VISIBILITY_STATE","VISIBLE","DELAY","MAX_POLLING_TIMEOUT","createError","Error","createPromise","executor","canUseMutationObserver","win","isFunction","awaitUsingMutationObserver","timeout","selectFunc","timer","mutationObserver","nodes","isNonEmptyArray","disconnect","clearTimeout","setTimeout","observe","canUseRequestAnimationFrame","awaitUsingRequestAnimation","execute","awaitUsingTimer","selectNodes","window","nonce","getNonce","n","querySelector","getAttribute","loadScript","url","onLoad","onError","script","type","async","error","appendToDOM","head","body","readyState","addEventListener","matches","msMatchesSelector","parentNode","removeChild","IFRAME_ATTRS","IFRAME_PROPS","display","width","height","appendNodeToDocument","awaitSelector","awaitSelectorInDocument","createNodeInDocument","fireImage","fireImageInDocument","fireOnPage","hiddenIframe","createIframe","fireInIframe","iframe","contentWindow","request","hideReferrer","filterObject","predicate","filteredValue","isEmptyObject","fnv1a32","hash","prime","utf8Encoder","TextEncoder","encode","Math","imul","fnv1a32Hex","toString","padStart","arr","itemCount","cookieName","namespace","topLevelCookieDomain","hostParts","location","hostname","toLowerCase","getLastArrayItems","domain","orgId","COOKIE_NAME_PREFIX","sanitizeOrgIdForCookieName","keyGetter","CHROME","EDGE","EDGE_CHROMIUM","FIREFOX","IE","SAFARI","UNKNOWN","fn","called","browsersSupportingThirdPartyCookie","getBrowser","lazy","includes","IDENTITY","CONSENT","CLUSTER","identityCookieName","getNamespacedCookieName","Boolean","matchUserAgent","regexs","userAgent","regex","getStorageByType","storageType","getItem","setItem","clear","removeItem","additionalNamespace","finalNamespace","baseNamespace","session","persistent","x","Number","isNaN","parsed","parseInt","isNumber","isString","parseDomainBasic","host","domainParts","subdomain","topLevelDomain","parseUri","URL","pathname","endsWith","query","search","anchor","parseUrl","parseDomain","fragment","configuration","configOverrides","isBoolean","isNonEmptyString","parseQueryString","cleanQuery","params","URLSearchParams","iter","v","next","getAll","done","stringifyObject","object","spaceToken","arrayValue","append","RegExp","reactorQueryString","parse","string","stringify","sortObjectPropertiesDeep","data","sort","memo","message","errorToStack","toError","newMessage","updateErrorMessage","defaultValue","round","targetLength","padString","date","YYYY","getFullYear","MM","getMonth","DD","getDate","hh","getHours","mm","getMinutes","ss","getSeconds","mmm","getMilliseconds","timezoneOffset","toInteger","getTimezoneOffset","ts","th","floor","abs","tm","byteToHex","unsafeStringify","offset","getRandomValues","rnds8","rng","crypto","randomUUID","v4","buf","native","rnds","random","RangeError","skipIfNull","validator","skipIfNullValidator","callSequentially","firstValidator","secondValidator","callSequentiallyValidator","callSequentiallyJoinErrors","callSequentiallyJoinErrorsValidator","errors","newValue","chain","baseValidator","newValidator","additionalMethods","nullSafeChain","reverseNullSafeChainJoinErrors","assertValid","isValid","JSON","validators","anyOf","valid","find","elementValidator","arrayOf","validatedArray","subValue","warning","deprecated","warn","literalValue","valueValidator","mapOfValues","validatedObject","subKey","subPath","validatedValue","typeName","minimum","maximum","schema","objectOf","subSchema","prototype","hasOwnProperty","oldField","oldSchema","newField","oldValue","otherValues","validatedOldValue","storedVals","isUnique","DOMAIN_REGEX","isInteger","isValidRegExp","regexp","base","default","_default","createDefaultValidator","required","requiredValidator","createDeprecatedValidator","domainValidator","minimumInteger","minValue","createMinimumValidator","minimumNumber","maximumNumber","maxValue","createMaximumValidator","integer","integerValidator","nonEmptyString","createNonEmptyValidator","nonEmptyArray","nonEmptyObject","regexpValidator","regexpPattern","matchesRegexpValidator","unique","createUnique","createUniqueValidator","uniqueItems","createUniqueItems","createUniqueItemsValidator","createAnyOfValidator","anything","createArrayOfValidator","nonEmpty","boolean","booleanValidator","callbackValidator","literal","createLiteralValidator","number","numberValidator","valuesValidator","createMapOfValuesValidator","createObjectOfAdditionalProperties","noUnknownFields","createNoUnknownFieldsValidator","concat","otherObjectOfValidator","newSchema","renamed","createRenamedValidator","createObjectOfValidator","stringValidator","boundAnyOf","boundAnything","boundArrayOf","boundBoolean","boundCallback","boundLiteral","boundNumber","boundMapOfValues","boundObjectOf","boundString","boundEnumOf","AMBIGUOUS","AUTHENTICATED","LOGGED_OUT","authenticatedState","enumOf","id","code","primary","xid","console","locationSearch","createLogger","instanceName","createNamespacedStorage","getMonitors","parsedQueryString","queryString","storage","debugSessionValue","debugEnabled","debugEnabledWritableFromConfig","getDebugEnabled","setDebugEnabled","fromConfig","debugQueryParam","stringToBoolean","createComponentLogger","componentName","hookNames","createHook","componentRegistry","hookName","getLifecycleCallbacks","guardHook","wrapForErrorHandling","stackMessage","stackError","catch","componentsByNamespace","commandsByName","lifecycleCallbacksByName","registerComponentCommands","componentCommandsByName","conflictingCommandNames","intersection","command","run","registerLifecycleCallbacks","componentLifecycleCallbacksByName","register","component","commands","lifecycle","getCommand","getCommandNames","getComponentNames","sendFetchRequest","sendBeaconRequest","isRequestRetryable","getRequestRetryDelay","requestId","payload","useSendBeacon","stringifiedPayload","parsedPayload","logOnBeforeNetworkRequest","executeRequest","retriesAttempted","requestMethod","response","requestIsRetryable","requestRetryDelay","parsedBody","logOnNetworkResponse","statusCode","getHeader","logOnNetworkError","adobeEdgeHeader","headerParts","regionId","ECID_FIELD_NUMBER","decodeVarint","buffer","byte","WIRE_TYPES","VARINT","I64","LEN","SGROUP","EGROUP","I32","decodeKndctrProtobuf","ecid","tagLength","wireType","fieldNumber","fieldValueLength","TextDecoder","decode","kndctrCookieName","decodedCookie","cookieBytes","loggingCookieJar","config","awaitIdentityResolve","awaitIdentityPromise","decodeKndctrCookie","createDecodeKndctrCookie","initialize","ecidFromCookie","setIdentityAcquired","awaitIdentity","getEcidFromCookie","IN","OUT","PENDING","DISABLED","WAIT","AUTO","GENERAL","DECLINED_CONSENT_ERROR_CODE","CONSENT_SOURCE_DEFAULT","CONSENT_SOURCE_INITIAL","CONSENT_SOURCE_NEW","createDeclinedConsentError","errorMessage","deferreds","runAll","shift","discardAll","awaitInitial","awaitInDefault","awaitIn","awaitOutDefault","awaitOut","awaitPending","returnImmediately","defer","in","awaitConsent","out","pending","withConsent","current","state","wasSet","generalConsentState","setConsent","consentByPurpose","initializeConsent","defaultConsentByPurpose","storedConsentByPurpose","suspend","getXdmPropositions","xdm","_experience","decisioning","propositions","userXdm","userData","documentMayUnload","isFinalized","shouldSendEvent","throwIfEventFinalized","methodName","event","hasQuery","getContent","currentContent","setUserXdm","setUserData","mergeXdm","mergeData","mergeMeta","meta","mergeQuery","finalize","onBeforeEventSend","newPropositions","deduplicateArray","scope","tempContent","getDocumentMayUnload","isEmpty","shouldSend","getViewName","web","webPageDetails","viewName","toJSON","RETRY_AFTER","ADOBE_EDGE","extractEdgeInfo","handle","warnings","getPayloadsByType","flatMap","getErrors","getWarnings","getEdge","CONFIGURE","SET_DEBUG","configureCommand","setDebugCommand","handleError","validateCommandOptions","configurePromise","getExecutor","optionsValidator","enabled","validatedOptions","commandNames","logOnBeforeCommand","logOnCommandRejected","rawResult","logOnCommandResolved","COMMAND_DOC_URI","documentationUri","validationError","invalidOptionsMessage","CONFIG_DOC_URI","transformOptions","combinedConfigValidator","buildAllOnInstanceConfiguredExtraParams","componentCreators","buildOnInstanceConfiguredExtraParams","wrapLoggerInQueue","queue","queuedLogger","flush","method","coreConfigValidators","createConfig","configValidators","extraParams","logOnInstanceConfigured","getImmediatelyAvailableTools","createComponent","tools","onComponentsRegistered","ID_THIRD_PARTY","datastreamId","edgeDomain","EDGE_DOMAIN","edgeBasePath","EDGE_BASE_PATH","noop","edgeConfigOverrides","validateConfigOverride","errorPrefix","operation","err","fetch","cache","credentials","headers","referrerPolicy","text","responseBody","status","sendBeacon","blob","Blob","notifyMonitors","monitors","dataWithContext","monitor","log","level","rest","logOnInstanceCreated","messagesSuffix","logOnContentHiding","logLevel","logOnContentRendering","detail","namespaceCode","identity","identityMap","getAction","getUseSendBeacon","datastreamIdOverride","edgeSubPath","uuid","shouldUseThirdPartyDomain","isIdentityEstablished","getId","getPayload","getDatastreamIdOverride","getEdgeSubPath","getUseIdThirdPartyDomain","setUseIdThirdPartyDomain","setIsIdentityEstablished","dataCollectionRequestPayload","createRequest","createMergeConfigOverride","addIdentity","hasIdentity","mergeConfigOverrides","createMerger","mergeState","mergeConfigOverride","prepareConfigOverridesForEdge","requestPayload","createRequestPayload","createAddIdentity","createHasIdentity","addEvent","events","some","localConfigOverrides","globalConfigOverrides","requestParams","localConfigOverridesWithoutDatastreamId","ASSURANCE_VALIDATION_SESSION_URL_PARAM","ASSURANCE_VALIDATION_NAMESPACE","CLIENT_ID","getOrCreateAssuranceClientId","clientId","parsedQuery","validationSessionId","validationToken","adobeAepValidationToken","EVENT_CANCELLATION_MESSAGE","consent","createEvent","createDataCollectionRequestPayload","createDataCollectionRequest","sendEdgeNetworkRequest","applyResponse","sendEvent","otherOptions","createRequestParams","onResponseCallbackAggregator","createCallbackAggregator","onRequestFailureCallbackAggregator","onBeforeEvent","onResponse","onRequestFailure","throwError","runOnResponseCallbacks","runOnRequestFailureCallbacks","renderDecisions","decisionContext","responseHeaders","personalization","decisionScopes","PAGE_WIDE_SCOPE","STATE_STORE_HANDLE_TYPE","shouldTransferCookie","apexDomain","dateProvider","cookiesToPayload","endpointDomain","isEndpointFirstParty","cookiesEnabled","entries","qualifyingCookieName","responseToCookies","stateItem","sameSite","SameSite","maxAge","getTime","secure","MBOX_EDGE_CLUSTER","AT_QA_MODE","MBOX","targetMigrationEnabled","isNamespacedCookieName","TYPE_ERROR","NETWORK_ERROR","isNetworkError","returnValues","lifecycleOnResponseReturnValues","consumerOnResponseReturnValues","lifecycleOnBeforeRequestReturnValues","assignConcatArrayValues","isDemdexBlockedError","cookieTransfer","sendNetworkRequest","createResponse","processWarningsAndErrors","getLocationHint","getAssuranceValidationTokenParams","hasDemdexFailed","buildEndpointUrl","locationHint","edgeBasePathWithLocationHint","configId","sdkConfig","datastream","original","apiVersion","onBeforeRequest","ID_THIRD_PARTY_DOMAIN","networkResponse","handleRequestFailure","mergeLifecycleResponses","NO_CONTENT","TOO_MANY_REQUESTS","BAD_GATEWAY","SERVICE_UNAVAILABLE","GATEWAY_TIMEOUT","MESSAGE_PREFIX","bodyToLog","messageSuffix","clusterCookieName","fromClusterCookie","fromTarget","mboxEdgeCluster","MAX_RETRIES","RETRYABLE_STATUS_CODES","FIRST_DELAY_MILLIS","INCREMENTAL_DELAY_MILLIS","MAX_RANDOM_VARIANCE_PERCENTAGE","calculateRetryDelay","targetDelay","maxVariance","minDelay","maxDelay","randomizedDelayWithinRange","getDelayFromHeader","headerValue","delayInMillis","headerValueInt","max","HTTP_STATUS_OK","alloyMonitors","href","webReferrer","referrer","getScreenOrientationViaProperty","screen","orientation","getScreenOrientationViaMediaQuery","matchMedia","device","screenHeight","screenWidth","screenOrientation","documentElement","clientWidth","clientHeight","environment","viewportWidth","browserDetails","viewportHeight","placeContext","localTimezoneOffset","localTime","toISOStringLocal","timestamp","toISOString","implementationDetails","libraryName","version","libraryVersion","optionalContexts","requiredContexts","configuredContexts","contexts","browserSupportsUserAgentClientHints","navigator","userAgentData","getHighEntropyValues","highEntropyUserAgentHints","hint","hints","userAgentClientHints","hintName","hintType","injectWeb","injectDevice","injectEnvironment","injectPlaceContext","injectTimestamp","injectHighEntropyUserAgentHints","defaultEnabledContexts","defaultDisabledContexts","createContext","eventOptionsValidator","eventType","validateIdentityMap","documentUnloading","surfaces","sendDisplayEvent","includeRenderedPropositions","defaultPersonalizationEnabled","datasetId","mergeId","advertising","handleAdvertisingData","createDataCollector","eventManager","validateUserEventOptions","eventManagerOptions","eventMergeId","com_adobe_experience_platform","datasets","validateApplyResponse","createResultLogMessage","idSync","success","spec","fireReferrerHideableImage","idSyncs","urlIdSyncs","thirdPartyCookiesEnabled","idMigrationEnabled","addEcidQueryToPayload","addQueryStringIdentityToPayload","ensureSingleIdentity","setLegacyEcid","handleResponseForIdSyncs","getNamespacesFromResponse","getIdentity","appendIdentityToUrl","getIdentityOptionsValidator","namespaces","edge","newNamespaces","ecidNamespace","requestedNamespaces","acc","appendIdentityToUrlOptionsValidator","getEcidFromVisitor","isPageSsl","amcvCookieName","getEcidFromLegacyCookies","secidCookieName","legacyEcidCookieValue","reg","match","getEcid","setEcid","extraOptions","adobe","optIn","optInOld","fetchPermissions","isApproved","Categories","ECID","Visitor","getInstance","awaitVisitorOptIn","getVisitor","visitor","getMarketingCloudVisitorID","processIdSyncs","doesIdentityCookieExist","setDomainForInitialIdentityPayload","addLegacyEcidToPayload","awaitIdentityCookie","obtainedIdentityPromise","allowRequestToGoWithoutIdentity","previousObtainedIdentityPromise","areThirdPartyCookiesSupportedByDefault","coreNamespace","getLegacyEcid","addEcidToPayload","ecidToMigrate","LINK_TTL_SECONDS","queryStringValue","queryStringIdentityParam","properties","keyValue","decodeUriComponentSafely","TS","mcmid","MCMID","mcorgid","MCORGID","identityResultPayloads","createIdentityRequestPayload","createIdentityRequest","URL_REGEX","getSeparator","adobemc","separator","createIdentity","injectGetEcidFromVisitor","createLoggingCookieJar","legacyIdentity","createLegacyIdentity","protocol","injectDoesIdentityCookieExist","createGetIdentity","injectAreThirdPartyCookiesSupportedByDefault","injectSetDomainForInitialIdentityPayload","injectAddLegacyEcidToPayload","injectAddQueryStringIdentityToPayload","injectAwaitIdentityCookie","injectEnsureSingleIdentity","injectProcessIdSyncs","injectHandleResponseForIdSyncs","injectAppendIdentityToUrl","createGetIdentityOptionsValidator","injectAddEcidQueryToPayload","prepareLibraryInfo","allCommands","resultConfig","components","configs","createLibraryInfo","getLibraryInfo","libraryInfo","injectStorage","createCoreConfigs","getApexDomain","injectSendFetchRequest","injectFireReferrerHideableImage","createGetAssuranceValidationTokenParams","injectGetBrowser","createExecuteCommand","logController","createComponentRegistry","createLifecycle","requiredComponents","buildAndValidateConfig","injectShouldTransferCookie","createCookieTransfer","injectSendBeaconRequest","injectSendNetworkRequest","injectProcessWarningsAndErrors","injectExtractEdgeInfo","injectCreateResponse","injectGetLocationHint","injectSendEdgeNetworkRequest","injectApplyResponse","createConsentStateMachine","createConsent","createEventManager","initializeComponents","componentLogger","injectHandleError","injectExecuteCommand","instanceNames","__alloyNS","createLogController","instance","createInstanceFunction","q","createClickHandler","clickEvent","s_fe","clickedElement","composedPath","onClick","clickHandler","DEFAULT_DOWNLOAD_QUALIFIER","downloadLinkQualifier","clickCollectionEnabled","clickCollection","internalLinkEnabled","externalLinkEnabled","downloadLinkEnabled","sessionStorageEnabled","eventGroupingEnabled","filterClickProperties","onBeforeLinkClickSend","ACTIVITY_MAP_EXTENSION_ID","getElementById","uri","fullUrl","uri1","uri2","domain1","extractDomain","domain2","isDissallowedLinkType","linkType","getClickedElementProperties","clickActivityStorage","elementProperties","activityMapExtensionEnabled","isValidLink","isInternalLink","filterClickDetails","isDifferentDomains","linkUrl","save","pageName","pageIDType","isValidActivityMapData","buildXdmFromClickedElementProperties","webInteraction","linkName","region","linkRegion","linkClicks","buildDataFromClickedElementProperties","__adobe","analytics","contextData","activitymap","page","link","populateClickedElementPropertiesFromOptions","clickedElementProperties","filteredXdm","filteredData","applyPropertyFilter","applyOptionsFilter","opts","load","createClickedElementProperties","getLinkName","getLinkRegion","getAbsoluteUrlFromAnchorElement","findClickableElement","determineLinkType","optionsFilter","propertyFilter","clickableElement","storedLinkData","CLICK_ACTIVITY_DATA","jsonData","dlq","unsupportedNodeNames","nodeName","extractSupportedNodes","supportedNodes","includesUnsupportedNodes","isSupportedTextNode","childNodes","childNode","getNodeAttributeValue","attributeValue","toUpperCase","getChildrenAttributes","texts","supportedNode","alt","truncateWhiteSpace","title","inputValue","imgSrc","nodeValue","nodeText","innerText","textContent","attributesMap","semanticElements","getAriaRegionLabel","regionLabel","role","getSectionNodeName","linkParentNode","regionName","tagName","onclick","isSupportedAnchorElement","elementHasClickHandler","isInputSubmitElement","isButtonSubmitElement","questionMarkIndex","hashIndex","substring","clickedObj","download","re","trimmedLinkUrl","trimQueryFromUrl","currentHostname","isDownloadLink","isExitLink","createGetClickedElementProperties","initClickActivityStorage","nameSpacedStorage","transientStorage","createTransientStorage","createClickActivityStorage","createActivityCollector","validateClickCollectionConfig","injectClickedElementProperties","createInjectClickedElementProperties","recallAndInjectClickedElementProperties","createRecallAndInjectClickedElementProperties","storePageViewProperties","createStorePageViewProperties","attachClickActivityCollector","hasPageName","getLinkDetails","targetElement","urlDestination","extraCookieOptions","processCookies","destinations","cookieDestinations","dest","ttlDays","processUrls","urlDestinations","processDestinations","processPushDestinations","retrievePullDestinations","createAudiences","cookieJarWithEncoding","injectProcessDestinations","processResponse","injectProcessResponse","storedConsent","taskQueue","defaultConsent","sendSetConsentRequest","validateSetConsentOptions","consentHashStore","identityCookieExists","consentCookieExists","readCookieIfQueueEmpty","storedConsentObject","consentOptions","consentHashes","lookup","isNew","sortObjectKeysRecursively","getKey","standard","consentObjects","currentHashes","getCurrentHash","consentObject","computeConsentHash","previousHash","parseConsentCookie","consentCookieName","cookieValue","createConsentRequestPayload","createConsentRequest","categoryPairs","categoryPair","createStoredConsent","createTaskQueue","injectSendSetConsentRequest","createConsentHashStore","createEventMergeId","createEventMerge","PAUSE","PLAY","BUFFER_START","AD_START","Ad_BREAK_START","SESSION_END","SESSION_START","SESSION_COMPLETE","PING","AD_BREAK_COMPLETE","AD_COMPLETE","AD_SKIP","BITRATE_CHANGE","CHAPTER_COMPLETE","CHAPTER_SKIP","CHAPTER_START","ERROR","STATES_UPDATE","mediaRequestPayload","action","setTimestamp","createMediaEvent","MediaEvents","advertisingDetails","mediaCollection","playerName","streamingMedia","createMediaSession","channel","appVersion","sessionDetails","augmentMediaEvent","playerId","getPlayerDetails","sessionID","playhead","qoeDataDetails","trackMediaSession","mediaOptions","sendEventOptions","trackMediaEvent","createMediaRequest","MAIN","AD","COMPLETED","mediaSessionCache","getSession","savePing","pingId","playbackState","stopPing","PlaybackState","storeSession","getContentState","sessionContentState","mediaEventManager","mediaSessionCacheManager","sendMediaEvent","sessionPromise","sessionId","sessionPlaybackState","interval","adPingInterval","mainPingInterval","pingOptions","legacy","mediaPayload","isBlankString","MEDIA_TYPE","Video","Audio","STREAM_TYPE","VOD","Live","Linear","Podcast","Audiobook","AOD","PLAYER_STATE","FullScreen","ClosedCaption","Mute","PictureInPicture","InFocus","EVENT","AdBreakStart","AdBreakComplete","AdStart","AdComplete","AdSkip","ChapterStart","ChapterComplete","ChapterSkip","SeekStart","SeekComplete","BufferStart","BufferComplete","BitrateChange","StateStart","StateEnd","MEDIA_EVENTS_INTERNAL","SessionStart","SessionEnd","SessionComplete","Play","Pause","StateUpdate","MEDIA_OBJECT_KEYS","MediaResumed","GranularAdTracking","VIDEO_METADATA_KEYS","Show","Season","Episode","AssetId","Genre","FirstAirDate","FirstDigitalDate","Rating","Originator","Network","ShowType","AdLoad","MVPD","Authorized","DayPart","Feed","StreamFormat","AUDIO_METADATA_KEYS","Artist","Album","Label","Author","Station","Publisher","AD_METADATA_KEYS","Advertiser","CampaignId","CreativeId","PlacementId","SiteId","CreativeUrl","mediaResponseHandler","createMediaHelper","createGetInstance","getMediaAnalyticsTracker","mediaAnalyticsHelper","Event","MediaType","PlayerState","StreamType","MediaObjectKey","VideoMetadataKeys","AudioMetadataKeys","AdMetadataKeys","createMediaObject","friendlyName","contentType","streamType","mediaObject","validate","createAdBreakObject","position","startTime","adBreakObject","advertisingPodDetails","createAdObject","adObject","podPosition","createChapterObject","chapterDetailsObject","chapterDetails","createStateObject","stateName","STATE_NAME_REGEX","createQoEObject","bitrate","droppedFrames","fps","startupTime","qoeObject","framesPerSecond","timeToStart","mediaToXdmKeys","adsToXdmKeys","trackerState","instantiateTracker","qoe","lastPlayhead","getEventType","createXdmObject","mediaDetails","statesStart","statesEnd","customMetadata","trackSessionStart","trackPlay","trackPause","trackSessionEnd","trackComplete","trackError","errorId","errorDetails","trackEvent","updatePlayhead","time","updateQoEObject","destroy","createMediaAnalyticsBridge","createMediaSessionCacheManager","createMediaEventManager","createTrackMediaEvent","createTrackMediaSession","createMediaResponseHandler","createMediaAnalyticsBridgeComponent","WEB","WEBAPP","SURFACE_TYPE_DELIMITER","FRAGMENT_DELIMITER","SURFACE_REGEX","AUTHORITY_REGEX","PATH_REGEX","FRAGMENT_REGEX","normalizePath","end","charAt","getSurfaceType","surfaceTypeMatch","getAuthority","authorityMatch","getPath","pathMatch","parseSurface","surfaceString","matched","surfaceType","authority","stringifySurface","surface","buildPageSurface","getPageLocation","expandFragmentSurface","validateSurface","invalidateSurface","expanded","isPageWideSurface","normalizeSurfaces","DEFAULT_CONTENT_ITEM","DOM_ACTION","HTML_CONTENT_ITEM","JSON_CONTENT_ITEM","RULESET_ITEM","REDIRECT_ITEM","MESSAGE_IN_APP","MESSAGE_CONTENT_CARD","EVENT_HISTORY_OPERATION","addPageWideScope","scopes","addPageSurface","pageSurface","dedupe","pos","isCacheInitialized","isRenderDecisions","isSendDisplayEvent","shouldIncludeRenderedPropositions","hasScopes","hasSurfaces","hasViewName","createQueryDetails","eventSurfaces","shouldRequestDefaultPersonalization","schemas","shouldFetchData","shouldUseCachedData","AUTHORING_ENABLED","DISPLAY","INTERACT","TRIGGER","DISMISS","SUPPRESS","EVENT_TYPE_TRUE","PropositionEventType","eventTypeToPropositionEventTypeMapping","propositionEventTypeToEventTypeMapping","getPropositionEventType","propositionEventType","EMPTY_PROPOSITIONS","applyPropositionsOptionsValidator","scopeDetails","decisionProvider","items","metadata","fetchDataHandler","viewChangeHandler","onClickHandler","isAuthoringModeEnabled","viewCache","showContainers","applyPropositions","setTargetMigration","mergeDecisionsMeta","renderedPropositions","onDecisionHandler","handleConsentFlicker","onDecision","personalizationDetails","createPersonalizationDetails","isInitialized","decisionsMetaPromises","cacheUpdate","createCacheUpdate","cancel","decisionsMetas","decisionsMeta","dms","validateApplyPropositionsOptions","innerHTML","EQ_START","EQ_PATTERN","isNotEqSelector","splitWithEq","CSS_IDENTIFIER_PATTERN","replaceIdentifier","_","$1","$2","CSS","escapeIdentifiersInSelector","parseSelector","rawSelector","sel","eq","selectNodesWithEq","nodesCount","removeAttribute","priority","css","cssText","nextElementSibling","container","getParent","insertBefore","getNextSibling","firstElementChild","SRC","isImage","loadImage","loadImages","images","image","is","isInlineStyleElement","styleNodes","getPromise","isInlineScript","isRemoteScript","getInlineScripts","scripts","getRemoteScriptsUrls","executeInlineScripts","executeRemoteScripts","urls","html","decorateProposition","createFragment","addNonceToInlineStyleElements","elements","getChildNodes","scriptsUrls","removeNode","appendHtml","firstChild","getFirstChild","PREHIDING_ID","HIDING_STYLE_DEFINITION","hideElements","prehidingSelector","showElements","createHideContainers","prehidingStyle","styleNode","createShowContainers","insertHtmlBefore","insertionPoint","insertAfter","styles","setStyle","to","getChildren","elementFrom","elementTo","renderContent","containers","renderFunc","renderStatusHandler","alwaysRender","executions","shouldRender","markAsRendered","createAction","itemData","containerSelector","addPxIfMissing","hasPx","DOM_ACTION_SET_HTML","DOM_ACTION_CUSTOM_CODE","DOM_ACTION_SET_TEXT","DOM_ACTION_SET_ATTRIBUTE","DOM_ACTION_SET_IMAGE_SOURCE","DOM_ACTION_SET_STYLE","DOM_ACTION_MOVE","DOM_ACTION_RESIZE","DOM_ACTION_REARRANGE","DOM_ACTION_REMOVE","DOM_ACTION_INSERT_AFTER","DOM_ACTION_INSERT_BEFORE","DOM_ACTION_REPLACE_HTML","DOM_ACTION_PREPEND_HTML","DOM_ACTION_APPEND_HTML","DOM_ACTION_CLICK","DOM_ACTION_COLLECT_INTERACTIONS","setHtml","prependHtml","setText","setAttributes","swapImage","setStyles","move","resize","rearrangeChildren","insertHtmlAfter","replaceHtml","collectInteractions","propositionAction","propositionEventTypes","DECISIONS_HANDLE","hideContainers","processPropositions","createProposition","notificationHandler","handleNotifications","handles","pagePropositions","view","viewPropositions","proposition","nonRenderedPropositions","groupBy","p","getScopeType","currentViewPropositions","update","render","returnedPropositions","returnedDecisions","decisions","matchesSelector","VIEW_SCOPE_TYPE","PAGE_SCOPE_TYPE","PROPOSITION_SCOPE_TYPE","cleanMetas","metas","trackingLabel","scopeType","dedupeMetas","stringifiedMeta","innerMeta","getMetasIfMatches","getClickMetas","matchesSelectorWithEq","matchedMetas","returnValue","foundMetaWithLabel","label","weight","foundMetaWithScopeTypeView","selectors","resultLabel","resultLabelWeight","MAX_SAFE_INTEGER","resultViewName","resultViewNameWeight","propositionActionLabel","propositionActionToken","details","createPropositionAction","clickLabel","clickToken","tokens","collectClicks","getInteractionMetas","getClickSelectors","autoCollectPropositionInteractions","curDecisionsMeta","curPropositionActionLabel","curPropositionActionToken","curViewName","apply","cacheUpdateCreatedAtLeastOnce","viewStoragePromise","getViewPropositions","viewStorage","emptyViewProposition","characteristics","updateCacheDeferred","oldViewStorage","newViewStorage","viewPropositionsWithScope","getScope","getView","metasToArray","clickStorage","storeClickMeta","clickMetaStorage","clickItemStorage","storeInteractionMeta","propositionId","itemId","notification","interactId","Set","interactIds","metaMap","isInteractionTrackingItem","actionType","SUPPORTED_SCHEMAS","filterItemsPredicate","updatePropositionItems","metadataForScope","filterPropositionsPredicate","renderAttempted","preparePropositions","renderedPropositionsDeferred","propositionsToExecute","additionalPropositions","migration","TARGET_BODY_SELECTOR","HEAD_TAGS_SELECTOR","filterHeadContent","headNodes","outerHTML","preprocessors","processed","preprocess","createItem","schemaType","processedData","getSchema","getSchemaType","getData","getProposition","getTrackingLabel","getOriginalItem","visibleInReturnedItems","shouldSuppressDisplay","getItems","getNotification","addToReturnValues","includedItems","latest","existingPropositions","oldLatest","setRenderAttempted","includeInNotification","ALWAYS","NEVER","DECORATED_ELEMENTS_ONLY","PROPOSITION_INTERACTION_TYPES","INTERACT_ID_DATA_ATTRIBUTE","CLICK_LABEL_DATA_ATTRIBUTE","CLICK_TOKEN_DATA_ATTRIBUTE","lastInteractId","getInteractId","existingInteractId","interactionTrackingSupported","createDecorateProposition","propositionContainer","previouslyRendered","dataset","adobePropositionIds","modules","createRenderStatusHandler","REDIRECT_HIDING_ELEMENT","executeRedirect","collect","propositionDetails","redirect","onlyRenderThis","schemaProcessors","wrapRenderWithLogging","stack","renderItems","renderers","results","allSettled","renderer","successes","processItem","processor","processItems","existingRenderers","existingReturnedPropositions","existingReturnedDecisions","renderedItems","nonRenderedItems","itemRenderers","atLeastOneWithNotification","renderPropositions","nonRenderPropositions","prop","propsByScope","createShouldSuppressDisplay","count","propositionsById","tot","decisionsMetaDisplay","decisionsMetaSuppressed","TEXT_HTML","APPLICATION_JSON","DEFAULT_CONTENT","expectedProps","expectedContentProps","isValidInAppMessage","removeElementById","parseAnchor","nothing","hrefParts","interaction","queryParams","preserveHistory","MESSAGING_CONTAINER_ID","OVERLAY_CONTAINER_ID","IFRAME_ID","dismissMessage","createIframeClickHandler","interact","navigateToUrl","createRedirect","preventDefault","stopImmediatePropagation","closest","htmlContent","parser","DOMParser","htmlDocument","parseFromString","scriptTag","createObjectURL","contentDocument","renderMessage","webParameters","overlay","parentElement","insertionMethod","buildStyleFromMobileParameters","mobileParameters","verticalAlign","horizontalAlign","backdropColor","cornerRadius","horizontalInset","verticalInset","uiTakeover","backgroundColor","borderRadius","border","overflow","left","right","transform","top","bottom","alignItems","justifyContent","mobileOverlay","backdropOpacity","opacity","color","background","REQUIRED_PARAMS","isValidWebParameters","ids","valuesArray","j","generateWebParameters","displayHTMLContentInIframe","settings","defaultContent","displayIframeContent","reason","getInteractionDetail","ShadowRoot","extractViewName","createMetaFilter","metasMatchingConfigurationOptions","PERSONALIZATION_DECISIONS_HANDLE","ADOBE_JOURNEY_OPTIMIZER","ADOBE_TARGET","createPersonalization","createCollect","createInteractionStorage","createClickStorage","createGetPageLocation","domActionsModules","initDomActionsModules","createPreprocess","remapHeadOffers","remapCustomCodeOffers","injectCreateProposition","createViewCacheManager","processDefaultContent","createProcessDomAction","createProcessHtmlContent","createProcessRedirect","createProcessInAppMessage","initInAppMessageActionsModules","createProcessPropositions","createAsyncArray","createNotificationHandler","createFetchDataHandler","createOnClickHandler","createViewChangeHandler","createApplyPropositions","createSetTargetMigration","createOnDecisionHandler","createHandleConsentFlicker","interactionConfigOptions","propositionInteractionType","isPlainObject","getPrototypeOf","flattenObject","addPayloads","evaluate","ConditionType","MATCHER","GROUP","HISTORICAL","MatcherType","EQUALS","NOT_EQUALS","EXISTS","NOT_EXISTS","GREATER_THAN","GREATER_THAN_OR_EQUAL_TO","LESS_THAN","LESS_THAN_OR_EQUAL_TO","CONTAINS","NOT_CONTAINS","STARTS_WITH","ENDS_WITH","LogicType","AND","OR","SearchType","ORDERED","MOST_RECENT","o","structuredClone","objectString","retentionPeriod","expirationDate","setDate","EVENT_HISTORY_MAX_RECORDS","EVENT_HISTORY_RETENTION_PERIOD","EVENT_HISTORY_STORAGE_KEY","EVENT_HISTORY_MAX_LENGTH","CONTEXT_KEY","TYPE","SOURCE","CONTEXT_EVENT_TYPE","LIFECYCLE","RULES_ENGINE","CONTEXT_EVENT_SOURCE","LAUNCH","REQUEST","CJM_IN_APP_MESSAGE_TYPE","SCHEMA","INSERT_OPERATION","INSERT_IF_NOT_EXISTS_OPERATION","limit","eventsWithHash","timestamps","getExpirationDate","getActivityId","activity","getDecisionProvider","createRestoreStorage","storageKey","stored","s","createSaveStorage","createInMemoryStorage","inMemoryStorage","clearLocalStorage","flat","Infinity","detailId","adapters","inAppMessageConsequenceAdapter","schemaTypeConsequenceAdapter","consequence","isRulesetItem","eventRegistry","consequenceAdapter","createConsequenceAdapter","activityId","addItem","RulesEngine","generateEventHash","displayEvent","getEvent","displayedDate","qualifyingItems","flattenArray","eventId","qualifiedDate","rank","isEvaluable","payloadsBasedOnActivityId","addPayload","evaluableRulesetPayload","createEvaluableRulesetPayload","sortedPayloadsBasedOnActivityId","rankA","rankB","personalizationPayloads","propositionList","filteredItems","eventPayloads","extractPayloadsFromEventHistoryOperations","addEventPayloads","currentStorage","eventRegistrySize","setStorage","newStorage","restore","eventPruner","createEventPruner","eventHash","addExperienceEdgeEvent","hasExperienceData","h","pageLoadTimestamp","getBrowserContext","getPageContext","getReferrerContext","getTimeContext","currentTimestamp","currentDate","getDay","currentMinute","currentMonth","currentYear","pageVisitDuration","getWindowContext","scrollY","scrollX","coreGlobalContext","browser","referringPage","getGlobalContext","getContext","addedContext","defaultPreprocessor","defaultEmissionCondition","createSubscription","preprocessor","emissionCondition","counter","subscriptions","createUnsubscribe","unsubscribe","setEmissionPreprocessor","setEmissionCondition","emit","emitOne","subscriptionId","hasSubscriptions","validateOptions","callbackType","getAnalyticsDetail","emitPropositions","collectedEventsThisSession","shouldAlwaysCollect","shouldCollect","analyticsMetaId","collectedEventsThisRequest","has","collectEvent","analyticsMeta","emissionPreprocessor","surfacesFilter","schemasFilter","refresh","contextProvider","createRulesEngine","personalizationStorageEnabled","createEventRegistry","createDecisionProvider","createContextProvider","evaluateRulesetsCommand","createEvaluateRulesetsCommand","subscribeRulesetItems","createSubscribeRulesetItems","createApplyResponse","createOnResponseHandler","evaluateRulesets","sessionValidator","EventTypes","validateSessionOptions","validateMediaEventOptions","createStreamingMedia","createStreamingMediaComponent","ADVERTISING_COOKIE_KEY","LAST_CLICK_COOKIE_KEY","LAST_CONVERSION_TIME_KEY","DISPLAY_CLICK_COOKIE_KEY_EXPIRES","RAMP_ID_EXPIRES","LAST_CONVERSION_TIME_KEY_EXPIRES","SKWCID_PARAM","EFID_PARAM","SURFER_ID","RAMP_ID","ID5_ID","UNKNOWN_ADVERTISER","DEFAULT_THROTTLE_MINUTES","DEFAULT_COOKIE_EXPIRATION_MINUTES","AD_CONVERSION_CLICK_EVENT_TYPE","AD_CONVERSION_VIEW_EVENT_TYPE","TRACKING_CODE","TRACKING_IDENTITIES","ID5_SCRIPT_URL","SURFER_PIXEL_HOST","SURFER_USER_ID","SURFER_TIMEOUT_MS","SURFER_TRUSTED_ORIGIN","SURFER_PARAM_KEY","LOG_AD_CONVERSION_START","LOG_ERROR_RESOLVING_ID","LOG_ID_CONVERSION_SUCCESS","LOG_AD_CONVERSION_FAILED","DISPLAY_CLICK_COOKIE_KEY","handleClickThrough","cookieManager","adConversionHandler","skwcid","efid","clickData","click_time","setValue","adcloud","conversionDetails","trackAdConversion","surferId","displayClickCookie","inProgressSurferPromise","addToDom","getInvisibleIframeElement","frameBorder","addListener","removeListener","removeEventListener","initiateAdvertisingIdentityCall","scheme","nestedParams","google","gsurfer","imsId","is_fb_cookie_synced","optout","throttleCookie","ev_lcc","nestedUrl","mainParams","ev_gb","pixelDetailsUrl","iframeElement","pixelDetailsReceiver","origin","pixelRedirectUri","hashParams","resolvedSurferId","resolvedDisplayClickCookie","surferValue","displayClickValue","collectSurferId","resolveSurferIdIfNotAvailable","cookieSurferId","getValue","resolvedId","RETRY_CONFIG","MAX_COUNT","MAX_TIME_MS","DELAY_BASE_MS","MAX_DELAY_MS","SHORT_TIMEOUT_MS","rampIdEnv","rampIdCallInitiated","inProgressRampIdPromise","scriptLoadingInitiated","envelopeRetrievalInProgress","processEnvelope","envelope","parsedEnvelope","retrieveEnvelopeWithRetries","retryCount","timerMultiplier","totalElapsedTime","tryToRetrieve","delay","min","ats","retrieveEnvelope","rampIdResponse","initiateRampIDCall","rampIdScriptPath","useShortTimeout","timeoutMs","timedOut","mainPromise","envelopeResponse","envelopeResult","val","timeoutPromise","race","getRampId","resolveRampIdIfNotAvailable","rampIdFromCookie","rampIdExpires","id5Id","inProgressId5Promise","DEFAULT_TIMEOUT_MS","initiateID5Call","partnerId","iD5TimedOut","id5ResolutionPromise","handleId5","ID5","id5Instance","getUserId","safeResolve","onAvailable","firstRetry","retryStatus","secondRetry","secondRetryStatus","getID5Id","resolveId5IfNotAvailable","getUrlParams","parsedParams","normalizeAdvertiser","advertiserSettings","advertiserId","appendAdvertisingIdQueryToEvent","idsToInclude","componentConfig","addEventType","searchClickData","displayClickCookieExpires","lastSearchClick","lastDisplayClick","stitchIds","id5","ipAddress","advIds","isAnyIdUnused","availableIds","conversionCalled","idType","markIdsAsConverted","idTypes","isThrottled","THROTTLE_WINDOW","lastSuccessfulConversion","collectAllIdentities","promises","id5PartnerId","dspEnabled","rampIdJSPath","rampId","handleViewThrough","resolvedIds","usedIdTracker","triggerConversion","idTypesToUse","identityPromisesMap","identityPromises","idPromise","idValue","activeAdvertiserIds","isClickThru","isAdvertisingDisabled","waitForAdvertisingId","handleOnBeforeSendEvent","rampIdPromise","surferIdResult","id5IdResult","rampIdResult","sendAdConversionHandler","createSendAdConversion","getCookieName","useNamespace","getDefaultExpiration","minutes","safeJsonParse","safeJsonStringify","readCookie","writeCookie","storedValue","existing","updated","createAdvertising","createCookieManager","createAdConversionHandler","getPushSubscriptionDetails","vapidPublicKey","Notification","permission","serviceWorkerRegistration","serviceWorker","getRegistration","subscriptionOptions","userVisibleOnly","applicationServerKey","subscription","pushManager","subscribe","endpoint","p256dh","auth","getSubscription","unsubscribeResult","serializedPushSubscriptionDetails","pushNotificationDetails","appID","token","platform","denylisted","SUBSCRIPTION_DETAILS","pushSubscriptionDetails","cacheValue","createSendPushSubscriptionPayload","createSendPushSubscriptionRequest","isComponentConfigured","pushNotifications","createPushNotifications","sendPushSubscription","makeSendPushSubscriptionRequest","core"],"mappings":"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","x_google_ignoreList":[5,58,66,67,68,69,350]}