!function(){"use strict";if(document.documentMode&&document.documentMode<11)return void console.warn("The Adobe Experience Cloud Web SDK does not support IE 10 and below.");const e="Chrome",t="Edge",n="EdgeChromium",o="Unknown";var r=(e,t)=>-1!==e.indexOf(t);const s=[e,t,n,"IE",o];var i=e=>r(s,e),a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function c(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function d(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var o=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,o.get?o:{enumerable:!0,get:function(){return e[t]}})})),n}
/*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  */var l=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable;function g(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var m,f=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach((function(e){o[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,o,r=g(e),s=1;s<arguments.length;s++){for(var i in n=Object(arguments[s]))u.call(n,i)&&(r[i]=n[i]);if(l){o=l(n);for(var a=0;a<o.length;a++)p.call(n,o[a])&&(r[o[a]]=n[o[a]])}}return r},h=c(f),y={exports:{}};m=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(o){function r(){}function s(t,n,s){if("undefined"!=typeof document){"number"==typeof(s=e({path:"/"},r.defaults,s)).expires&&(s.expires=new Date(1*new Date+864e5*s.expires)),s.expires=s.expires?s.expires.toUTCString():"";try{var i=JSON.stringify(n);/^[\{\[]/.test(i)&&(n=i)}catch(e){}n=o.write?o.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in s)s[c]&&(a+="; "+c,!0!==s[c]&&(a+="="+s[c].split(";")[0]));return document.cookie=t+"="+n+a}}function i(e,n){if("undefined"!=typeof document){for(var r={},s=document.cookie?document.cookie.split("; "):[],i=0;i<s.length;i++){var a=s[i].split("="),c=a.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var d=t(a[0]);if(c=(o.read||o)(c,d)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(r[d]=c,e===d)break}catch(e){}}return e?r[e]:r}}return r.set=s,r.get=function(e){return i(e,!1)},r.getJSON=function(e){return i(e,!0)},r.remove=function(t,n){s(t,"",e(n,{expires:-1}))},r.defaults={},r.withConverter=n,r}((function(){}))},y.exports=m();var v=c(y.exports),w={get:v.get,set:v.set,remove:v.remove,withConverter:v.withConverter},b=e=>null==e,C=e=>!b(e)&&!Array.isArray(e)&&"object"==typeof e;const E=(e,t)=>{Object.keys(t).forEach((n=>{C(e[n])&&C(t[n])?E(e[n],t[n]):e[n]=t[n]}))};var I=(e,...t)=>{if(b(e))throw new TypeError('deepAssign "target" cannot be null or undefined');const n=Object(e);return t.forEach((e=>E(n,Object(e)))),n},R=(e,t)=>n=>{const o=t.split(".").reduce(((e,t)=>(e[t]=e[t]||{},e[t])),e);I(o,n)},k=()=>{const e=[];return{add(t){e.push(t)},call:(...t)=>Promise.all(e.map((e=>e(...t))))}},P=({logger:e,cookieJar:t})=>({...t,set(n,o,r){e.info("Setting cookie",{name:n,value:o,...r}),t.set(n,o,r)}});const O=(()=>{const e=[];for(let t=0;t<256;t++){let n=t;for(let e=0;e<8;e++)n=1&n?3988292384^n>>>1:n>>>1;e.push(n)}return function(t,n){t=unescape(encodeURIComponent(t)),n||(n=0),n^=-1;for(let o=0;o<t.length;o++){const r=255&(n^t.charCodeAt(o));n=n>>>8^e[r]}return(n^=-1)>>>0}})();var D=()=>{const e={};return e.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n})),e};const S=(e,t)=>e===t;var T=(e,t)=>{for(let n=0;n<e.length;n+=1){const o=e[n];if(t(o,n,e))return o}},x=(e,t)=>e.appendChild(t);var $=(e,t={},n={},o=[],r=document)=>{const s=r.createElement(e);return Object.keys(t).forEach((e=>{s.setAttribute(e,t[e])})),((e,t)=>{Object.keys(t).forEach((n=>{if("style"===n&&C(t[n])){const o=t[n];Object.keys(o).forEach((t=>{e.style[t]=o[t]}))}else e[n]=t[n]}))})(s,n),o.forEach((e=>x(s,e))),s};const N="IMG",M="STYLE",q="SCRIPT";var A=({src:e,currentDocument:t=document})=>new Promise(((n,o)=>{$(N,{src:e},{onload:n,onerror:o,onabort:o},[],t)})),j=e=>"function"==typeof e,U=e=>Array.isArray(e)&&e.length>0,L=e=>Array.isArray(e)?e:null==e?[]:[].slice.call(e);const _=/^\s*>/;var B=(e,t)=>{if(!_.test(t))return L(e.querySelectorAll(t));const n=`alloy-${Date.now()}`;try{return e.classList.add(n),L(e.querySelectorAll(`.${n} ${t}`))}finally{e.classList.remove(n)}},F=(e,t)=>e.substr(0,t.length)===t,H=":shadow";const V=(e,t)=>{const n=t;if(!F(n,">"))return n;if(window.document.documentMode)return n.substring(1).trim();return`${e instanceof Element||e instanceof HTMLDocument?":scope":":host"} ${n}`};var z=(e,t)=>{if(!window.document.documentElement.attachShadow)return B(e,t.replace(H,""));const n=(e=>e.split(H))(t);if(n.length<2)return B(e,t);let o=e;for(let e=0;e<n.length;e+=1){const t=n[e].trim();if(""===t&&o.shadowRoot){o=o.shadowRoot;continue}const r=V(o,t),s=B(o,r);if(0===s.length||!s[0]||!s[0].shadowRoot)return s;o=s[0].shadowRoot}},J=(e,t=document)=>-1===e.indexOf(H)?B(t,e):z(t,e);const Q={childList:!0,subtree:!0},X=e=>new Error(`Could not find: ${e}`),W=e=>new Promise(e);var G=(e,t=J,n=5e3,o=window,r=document)=>{const s=t(e);return U(s)?Promise.resolve(s):(e=>j(e.MutationObserver))(o)?((e,t,n,o,r)=>W(((s,i)=>{const a=new e.MutationObserver((()=>{const e=r(n);U(e)&&(a.disconnect(),s(e))}));setTimeout((()=>{a.disconnect(),i(X(n))}),o),a.observe(t,Q)})))(o,r,e,n,t):(e=>"visible"===e.visibilityState)(r)?((e,t,n,o)=>W(((r,s)=>{const i=()=>{const n=o(t);U(n)?r(n):e.requestAnimationFrame(i)};i(),setTimeout((()=>{s(X(t))}),n)})))(o,e,n,t):((e,t,n)=>W(((o,r)=>{const s=()=>{const t=n(e);U(t)?o(t):setTimeout(s,100)};s(),setTimeout((()=>{r(X(e))}),t)})))(e,n,t)},Y=e=>{const t=e.parentNode;return t?t.removeChild(e):null};const K={name:"Adobe Alloy"},Z={style:{display:"none",width:0,height:0}};var ee=e=>C(e)&&0===Object.keys(e).length;const te=(e,t)=>b(e)||!C(e)?e:Object.keys(e).reduce(((n,o)=>{const r=e[o];if(C(r)){const e=te(r,t);return ee(e)?n:{...n,[o]:e}}return t(r)?{...n,[o]:r}:n}),{});var ne=(e,t)=>Array.prototype.concat.apply([],e.map(t)),oe="com.adobe.alloy.";const re="com.adobe.alloy.getTld";var se=e=>e.replace("@","_"),ie=(e,t)=>`kndctr_${se(e)}_${t}`,ae=(e,t)=>{const n={};return e.forEach((e=>{const o=t(e);n[o]||(n[o]=[]),n[o].push(e)})),n};var ce=({orgId:e})=>{const t=ie(e,"identity");return()=>Boolean(w.get(t))};const de=(e,t,n)=>({getItem(o){try{return e[t].getItem(n+o)}catch(e){return null}},setItem(o,r){try{return e[t].setItem(n+o,r),!0}catch(e){return!1}},clear(){try{return Object.keys(e[t]).forEach((o=>{F(o,n)&&e[t].removeItem(o)})),!0}catch(e){return!1}}});var le=e=>"boolean"==typeof e,ue=e=>"number"==typeof e&&!isNaN(e),pe=e=>{const t=parseInt(e,10);return ue(t)&&e===t},ge=e=>"string"==typeof e,me=e=>ge(e)&&e.length>0,fe=()=>{},he=(e,t,n)=>{const o=String(e);let r=String(n);if(o.length>=t||0===r.length)return o;const s=t-o.length;for(;s>r.length;)r+=r;return r.slice(0,s)+o},ye={};function ve(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var we=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};ye.decode=ye.parse=function(e,t,n,o){t=t||"&",n=n||"=";var r={};if("string"!=typeof e||0===e.length)return r;var s=/\+/g;e=e.split(t);var i=1e3;o&&"number"==typeof o.maxKeys&&(i=o.maxKeys);var a=e.length;i>0&&a>i&&(a=i);for(var c=0;c<a;++c){var d,l,u,p,g=e[c].replace(s,"%20"),m=g.indexOf(n);m>=0?(d=g.substr(0,m),l=g.substr(m+1)):(d=g,l=""),u=decodeURIComponent(d),p=decodeURIComponent(l),ve(r,u)?Array.isArray(r[u])?r[u].push(p):r[u]=[r[u],p]:r[u]=p}return r},ye.encode=ye.stringify=function(e,t,n,o){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(o){var r=encodeURIComponent(we(o))+n;return Array.isArray(e[o])?e[o].map((function(e){return r+encodeURIComponent(we(e))})).join(t):r+encodeURIComponent(we(e[o]))})).join(t):o?encodeURIComponent(we(o))+n+encodeURIComponent(we(e)):""};var be=ye,Ce={parse:function(e){return"string"==typeof e&&(e=e.trim().replace(/^[?#&]/,"")),be.parse(e)},stringify:function(e){return be.stringify(e)}},Ee=c(Ce),Ie=e=>e instanceof Error?e:new Error(e),Re=({error:e,message:t})=>{try{e.message=t}catch(e){}},ke=({error:e,message:t})=>{const n=Ie(e),o=`${t}\nCaused by: ${n.message}`;return Re({error:n,message:o}),n},Pe=(e,t)=>{if(ue(e)||ge(e)){const t=Math.round(Number(e));if(!isNaN(t))return t}return t},Oe={exports:{}},De="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(De){var Se=new Uint8Array(16);Oe.exports=function(){return De(Se),Se}}else{var Te=new Array(16);Oe.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),Te[t]=e>>>((3&t)<<3)&255;return Te}}for(var xe=Oe.exports,$e=[],Ne=0;Ne<256;++Ne)$e[Ne]=(Ne+256).toString(16).substr(1);var Me=function(e,t){var n=t||0,o=$e;return[o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]]].join("")},qe=xe,Ae=Me;var je=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||qe)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var s=0;s<16;++s)t[o+s]=r[s];return t||Ae(r)},Ue=c(je);const Le=e=>function(t,n){return null==t?t:e.call(this,t,n)},_e=(e,t)=>function(n,o){return t.call(this,e.call(this,n,o),o)},Be=(e,t)=>function(n,o){const r=[],s=[e,t].reduce(((e,t)=>{try{return t.call(this,e,o)}catch(t){return r.push(t),e}}),n);if(r.length)throw new Error(r.join("\n"));return s},Fe=(e,t,n)=>h(_e(e,t),e,n),He=(e,t,n)=>h(_e(e,Le(t)),e,n),Ve=(e,t,n,o)=>{if(!e)throw new Error(`'${n}': Expected ${o}, but got ${JSON.stringify(t)}.`)};var ze=(e,t)=>(Ve(le(e),e,t,"true or false"),e),Je=(e,t)=>(Ve(j(e),e,t,"a function"),e),Qe=e=>function(t,n){Ve(Array.isArray(t),t,n,"an array");const o=[],r=t.map(((r,s)=>{try{return e.call(this,r,`${n}[${s}]`,t)}catch(e){return void o.push(e.message)}}));if(o.length)throw new Error(o.join("\n"));return r},Xe=(e,t,n)=>function(o,r){Ve(C(o),o,r,"an object");const{[e]:s,[n]:i,...a}=o,c=t(s,r);if(void 0!==c){let t=`The field '${e}' is deprecated. Use '${n}' instead.`;if(r&&(t=`'${r}': ${t}`),void 0!==i&&i!==c)throw new Error(t);this&&this.logger&&this.logger.warn(t)}return{[n]:i||c,...a}},We=e=>function(t,n){Ve(C(t),t,n,"an object");const o=[],r={};if(Object.keys(t).forEach((s=>{const i=t[s],a=n?`${n}.${s}`:s;try{const t=e.call(this,i,a);void 0!==t&&(r[s]=t)}catch(e){o.push(e.message)}})),o.length)throw new Error(o.join("\n"));return r},Ge=(e,t)=>(n,o)=>(Ve(n>=t,n,o,`${e} greater than or equal to ${t}`),n),Ye=e=>(t,n)=>(C(t)?Ve(!ee(t),t,n,e):Ve(t.length>0,t,n,e),t),Ke=e=>function(t,n){Ve(C(t),t,n,"an object");const o=[],r={};if(Object.keys(e).forEach((s=>{const i=t[s],a=e[s],c=n?`${n}.${s}`:s;try{const e=a.call(this,i,c);void 0!==e&&(r[s]=e)}catch(e){o.push(e.message)}})),Object.keys(t).forEach((e=>{Object.prototype.hasOwnProperty.call(r,e)||(r[e]=t[e])})),o.length)throw new Error(o.join("\n"));return r},Ze=(e,t)=>function(n,o){let r;const s=T(e,(e=>{try{return r=e.call(this,n,o),!0}catch(e){return!1}}));return Ve(s,n,o,t),r},et=()=>(e,t)=>{Ve((e=>{const t=Object.create(null);for(let n=0;n<e.length;n+=1){const o=e[n];if(o in t)return!1;t[o]=!0}return!0})(e),e,t,"array values to be unique")};const tt=/^[a-z0-9.-]{1,}$/i;var nt=(e,t)=>(Ve(tt.test(e),e,t,"a valid domain"),e),ot=(e,t)=>(Ve(pe(e),e,t,"an integer"),e),rt=(e,t)=>(Ve(ue(e),e,t,"a number"),e),st=(e,t)=>(Ve((e=>{try{return null!==new RegExp(e)}catch(e){return!1}})(e),e,t,"a regular expression"),e),it=(e,t)=>{if(null==e)throw new Error(`'${t}' is a required option`);return e},at=(e,t)=>(Ve(ge(e),e,t,"a string"),e);const ct=e=>e;ct.default=function(e){return Fe(this,(e=>t=>null==t?e:t)(e))},ct.required=function(){return Fe(this,it)};const dt=function(){return He(this,nt)},lt=function(e){return He(this,Ge("an integer",e))},ut=function(e){return He(this,Ge("a number",e))},pt=function(){return He(this,ot,{minimum:lt})},gt=function(){return He(this,Ye("a non-empty string"))},mt=function(){return He(this,Ye("a non-empty array"))},ft=function(){return He(this,Ye("a non-empty object"))},ht=function(){return He(this,st)},yt=function(){return He(this,(()=>{const e=[];return(t,n)=>(Ve(-1===e.indexOf(t),t,n,"a unique value across instances"),e.push(t),t)})())},vt=function(){return He(this,et())},wt=e=>({noUnknownFields:function(){return He(this,(e=>(t,n)=>{const o=[];if(Object.keys(t).forEach((t=>{if(!e[t]){const e=n?`${n}.${t}`:t;o.push(`'${e}': Unknown field.`)}})),o.length)throw new Error(o.join("\n"));return t})(e))},nonEmpty:ft,concat:function(t){const n={...e,...t.schema};return He(this,t,wt(n))},deprecated:function(e,t,n){return o=this,r=Xe(e,t,n),h(Be(Le(r),o),o,s);var o,r,s},schema:e}),bt=function(e,t){return Fe(this,Ze(e,t))}.bind(ct),Ct=function(){return this}.bind(ct),Et=function(e){return He(this,Qe(e),{nonEmpty:mt,uniqueItems:vt})}.bind(ct),It=function(){return He(this,ze)}.bind(ct),Rt=function(){return He(this,Je)}.bind(ct),kt=function(e){return He(this,(e=>(t,n)=>(Ve(t===e,t,n,`${e}`),t))(e))}.bind(ct);(function(){return He(this,rt,{minimum:ut,integer:pt,unique:yt})}).bind(ct);const Pt=function(e){return He(this,We(e),{nonEmpty:ft})}.bind(ct),Ot=function(e){return He(this,Ke(e),wt(e))}.bind(ct),Dt=function(){return He(this,at,{regexp:ht,domain:dt,nonEmpty:gt,unique:yt})}.bind(ct),St=function(...e){return bt(e.map(kt),`one of these values: [${JSON.stringify(e)}]`)};var Tt=Pt(Et(Ot({authenticatedState:St("ambiguous","authenticated","loggedOut"),id:Dt(),namespace:Ot({code:Dt()}).noUnknownFields(),primary:It(),xid:Dt()}).noUnknownFields()).required()),xt=Ot({}),$t=({console:e,locationSearch:t,createLogger:n,instanceName:o,createNamespacedStorage:r,getMonitors:s})=>{const i=Ee.parse(t),a=r(`instance.${o}.`),c=a.session.getItem("debug");let d="true"===c,l=null===c;const u=()=>d,p=(e,{fromConfig:t})=>{t&&!l||(d=e),t||(a.session.setItem("debug",e.toString()),l=!1)};var g;return void 0!==i.alloy_debug&&p((g=i.alloy_debug,ge(g)&&"true"===g.toLowerCase()),{fromConfig:!1}),{setDebugEnabled:p,logger:n({getDebugEnabled:u,context:{instanceName:o},getMonitors:s,console:e}),createComponentLogger:t=>n({getDebugEnabled:u,context:{instanceName:o,componentName:t},getMonitors:s,console:e})}};const Nt=["onComponentsRegistered","onBeforeEvent","onBeforeRequest","onResponse","onRequestFailure","onClick","onDecision"];var Mt=e=>Nt.reduce(((t,n)=>{var o;return t[n]=(o=((e,t)=>(...n)=>Promise.all(e.getLifecycleCallbacks(t).map((e=>new Promise((t=>{t(e(...n))}))))))(e,n),(...e)=>Promise.resolve().then((()=>o(...e)))),t}),{});const qt=(e,t)=>(...n)=>{let o;try{o=e(...n)}catch(e){throw ke({error:e,message:t})}return o instanceof Promise&&(o=o.catch((e=>{throw ke({error:e,message:t})}))),o};var At=()=>{const e={},t={},n=(t,n={})=>{const o=(s=Object.keys(e),i=Object.keys(n),s.filter((e=>r(i,e))));var s,i;if(o.length)throw new Error(`[ComponentRegistry] Could not register ${t} because it has existing command(s): ${o.join(",")}`);Object.keys(n).forEach((o=>{const r=n[o];r.commandName=o,r.run=qt(r.run,`[${t}] An error occurred while executing the ${o} command.`),e[o]=r}))};return{register(e,o){const{commands:r,lifecycle:s}=o;n(e,r),((e,n={})=>{Object.keys(n).forEach((o=>{t[o]=t[o]||[],t[o].push(qt(n[o],`[${e}] An error occurred while executing the ${o} lifecycle hook.`))}))})(e,s)},getCommand:t=>e[t],getCommandNames:()=>Object.keys(e),getLifecycleCallbacks:e=>t[e]||[]}};const jt="in",Ut="pending",Lt="general",_t="declinedConsent",Bt="default",Ft="initial",Ht="new",Vt=e=>{const t=new Error(e);return t.code=_t,t.message=e,t};var zt=({logger:e})=>{const t=[],n=()=>Promise.resolve(),o=()=>Promise.resolve(),r=()=>Promise.reject(Vt("No consent preferences have been set.")),s=()=>Promise.reject(Vt("The user declined consent.")),i=e=>{if(e)return Promise.reject(new Error("Consent is pending."));const n=D();return t.push(n),n.promise};return{in(r){r===Bt?this.awaitConsent=n:(r===Ft?e.info("Loaded user consent preferences. The user previously consented."):r===Ht&&this.awaitConsent!==o&&e.info("User consented."),(()=>{for(;t.length;)t.shift().resolve()})(),this.awaitConsent=o)},out(n){n===Bt?(e.warn("User consent preferences not found. Default consent of out will be used."),this.awaitConsent=r):(n===Ft?e.warn("Loaded user consent preferences. The user previously declined consent."):n===Ht&&this.awaitConsent!==s&&e.warn("User declined consent."),(()=>{for(;t.length;)t.shift().reject(Vt("The user declined consent."))})(),this.awaitConsent=s)},pending(t){t===Bt&&e.info("User consent preferences not found. Default consent of pending will be used. Some commands may be delayed."),this.awaitConsent=i},awaitConsent:()=>Promise.reject(new Error("Consent has not been initialized.")),withConsent(){return this.awaitConsent(!0)}}};const Jt=e=>e&&e._experience&&e._experience.decisioning&&U(e._experience.decisioning.propositions)?e._experience.decisioning.propositions:[];var Qt=()=>{const e={};let t,n,o=!1,r=!1,s=!0;const i=e=>{if(r)throw new Error(`${e} cannot be called after event is finalized.`)},a={hasQuery(){return Object.prototype.hasOwnProperty.call(this.getContent(),"query")},getContent(){const o=JSON.parse(JSON.stringify(e));return t&&I(o,{xdm:t}),n&&I(o,{data:n}),o},setUserXdm(e){i("setUserXdm"),t=e},setUserData(e){i("setUserData"),n=e},mergeXdm(t){i("mergeXdm"),t&&I(e,{xdm:t})},mergeData(t){i("mergeData"),t&&I(e,{data:t})},mergeMeta(t){i("mergeMeta"),t&&I(e,{meta:t})},mergeQuery(t){i("mergeQuery"),t&&I(e,{query:t})},documentMayUnload(){o=!0},finalize(o){if(r)return;const i=((e,t=S)=>e.filter(((n,o)=>((e,t,n)=>{for(let o=0;o<e.length;o+=1)if(n(e[o],t))return o;return-1})(e,n,t)===o)))([...Jt(t),...Jt(e.xdm)],((e,t)=>e===t||e.id&&t.id&&e.id===t.id&&e.scope&&t.scope&&e.scope===t.scope));if(t&&this.mergeXdm(t),i.length>0&&(e.xdm._experience.decisioning.propositions=i),n&&a.mergeData(n),r=!0,o){s=!1;const t={xdm:e.xdm||{},data:e.data||{}},n=o(t);s=!1!==n,e.xdm=t.xdm||{},e.data=t.data||{},ee(e.xdm)&&delete e.xdm,ee(e.data)&&delete e.data}},getDocumentMayUnload:()=>o,isEmpty:()=>ee(e)&&(!t||ee(t))&&(!n||ee(n)),shouldSend:()=>s,getViewName(){if(t&&t.web&&t.web.webPageDetails)return t.web.webPageDetails.viewName},toJSON(){if(!r)throw new Error("toJSON called before finalize");return e}};return a};const Xt="configure",Wt="setDebug";var Gt=({logger:e,configureCommand:t,setDebugCommand:n,handleError:o,validateCommandOptions:r})=>{let s;return(i,a={})=>new Promise((o=>{const c=((o,i)=>{let a;if(o===Xt){if(s)throw new Error("The library has already been configured and may only be configured once.");a=()=>(s=t(i),s.then((()=>{})))}else{if(!s)throw new Error("The library must be configured first. Please do so by executing the configure command.");a=o===Wt?()=>n(i):()=>s.then((e=>{const t=e.getCommand(o);if(!t||!j(t.run)){const t=[Xt,Wt].concat(e.getCommandNames()).join(", ");throw new Error(`The ${o} command does not exist. List of available commands: ${t}.`)}const n=r({command:t,options:i});return t.run(n)}),(()=>(e.warn(`An error during configuration is preventing the ${o} command from executing.`),new Promise((()=>{})))))}return a})(i,a);e.logOnBeforeCommand({commandName:i,options:a}),o(c())})).catch((e=>o(e,`${i} command`))).catch((t=>{throw e.logOnCommandRejected({commandName:i,options:a,error:t}),t})).then((t=>{const n=C(t)?t:{};return e.logOnCommandResolved({commandName:i,options:a,result:n}),n}))};const Yt="https://adobe.ly/3sHgQHb";var Kt=({command:e,options:t})=>{const{commandName:n,documentationUri:o=Yt,optionsValidator:r}=e;let s=t;if(r)try{s=r(t)}catch(e){throw new Error(`Invalid ${n} command options:\n\t - ${e} For command documentation see: ${o}`)}return s};const Zt=({eventManager:e,logger:t})=>({commands:{sendEvent:{documentationUri:"https://adobe.ly/3GQ3Q7t",optionsValidator:e=>(({options:e})=>Ot({type:Dt(),xdm:Ot({eventType:Dt(),identityMap:Tt}),data:Ot({}),documentUnloading:It(),renderDecisions:It(),decisionScopes:Et(Dt()).uniqueItems(),personalization:Ot({decisionScopes:Et(Dt()).uniqueItems(),surfaces:Et(Dt()).uniqueItems(),sendDisplayEvent:It().default(!0),includeRenderedPropositions:It().default(!1),defaultPersonalizationEnabled:It(),decisionContext:Ot({})}).default({sendDisplayEvent:!0}),datasetId:Dt(),mergeId:Dt(),edgeConfigOverrides:xt,initializePersonalization:It()}).required().noUnknownFields()(e))({options:e}),run:n=>{const{xdm:o,data:r,documentUnloading:s,type:i,mergeId:a,datasetId:c,edgeConfigOverrides:d,...l}=n,u=e.createEvent();return s&&u.documentMayUnload(),u.setUserXdm(o),u.setUserData(r),i&&u.mergeXdm({eventType:i}),a&&u.mergeXdm({eventMergeId:a}),d&&(l.edgeConfigOverrides=d),c&&(t.warn("The 'datasetId' option has been deprecated. Please use 'edgeConfigOverrides.com_adobe_experience_platform.datasets.event.datasetId' instead."),l.edgeConfigOverrides=d||{},I(l.edgeConfigOverrides,{com_adobe_experience_platform:{datasets:{event:{datasetId:c}}}})),e.sendEvent(u,l)}},applyResponse:{documentationUri:"",optionsValidator:e=>(({options:e})=>Ot({renderDecisions:It(),responseHeaders:Pt(Dt().required()),responseBody:Ot({handle:Et(Ot({type:Dt().required(),payload:Ct().required()})).required()}).required(),personalization:Ot({sendDisplayEvent:It().default(!0),decisionContext:Ot({})}).default({sendDisplayEvent:!0})}).noUnknownFields()(e))({options:e}),run:t=>{const{renderDecisions:n=!1,decisionContext:o={},responseHeaders:r={},responseBody:s={handle:[]},personalization:i}=t,a=e.createEvent();return e.applyResponse(a,{renderDecisions:n,decisionContext:o,responseHeaders:r,responseBody:s,personalization:i})}}}});Zt.namespace="DataCollector";var en=({eventManager:e,lifecycle:t,handleError:n})=>{const o=(({eventManager:e,lifecycle:t,handleError:n})=>o=>{const r=o.target,s=e.createEvent();return s.documentMayUnload(),t.onClick({event:s,clickedElement:r}).then((()=>s.isEmpty()?Promise.resolve():e.sendEvent(s))).then(fe).catch((e=>{n(e,"click collection")}))})({eventManager:e,lifecycle:t,handleError:n});document.addEventListener("click",o,!0)};const tn=Dt().regexp().default("\\.(exe|zip|wav|mp3|mov|mpg|avi|wmv|pdf|doc|docx|xls|xlsx|ppt|pptx)$");var nn=Ot({clickCollectionEnabled:It().default(!0),onBeforeLinkClickSend:Rt(),downloadLinkQualifier:tn});const on=e=>{const t=e.indexOf("?"),n=e.indexOf("#");return t>=0&&(t<n||n<0)?e.substring(0,t):n>=0?e.substring(0,n):e},rn=e=>e&&e.replace(/\s+/g," ").trim(),sn=/^(SCRIPT|STYLE|LINK|CANVAS|NOSCRIPT|#COMMENT)$/i,an=e=>{let t=[],n=!1;if((e=>!(e&&e.nodeName&&e.nodeName.match(sn)))(e)){if(t.push(e),e.childNodes){Array.prototype.slice.call(e.childNodes).forEach((e=>{const o=an(e);t=t.concat(o.supportedNodes),n=n||o.includesUnsupportedNodes}))}}else n=!0;return{supportedNodes:t,includesUnsupportedNodes:n}},cn=(e,t,n)=>{let o;return n&&n!==e.nodeName.toUpperCase()||(o=e.getAttribute(t)),o};const dn=/^(HEADER|MAIN|FOOTER|NAV)$/i,ln=e=>{let t;return"region"===e.role&&me(e["aria-label"])&&(t=e["aria-label"]),t},un=e=>{let t;return e&&e.nodeName&&e.nodeName.match(dn)&&(t=e.nodeName),t};const pn=(({window:e,getLinkName:t,getLinkRegion:n,getAbsoluteUrlFromAnchorElement:o,findSupportedAnchorElement:r,determineLinkType:s})=>({targetElement:i,config:a,logger:c})=>{const d=r(i);if(!d)return void c.info("This link click event is not triggered because the HTML element is not an anchor.");const l=o(e,d);if(!l)return void c.info("This link click event is not triggered because the HTML element doesn't have an URL.");const u=s(e,a,l,d),p=n(d),g=t(d),{onBeforeLinkClickSend:m}=a,f={xdm:{eventType:"web.webinteraction.linkClicks",web:{webInteraction:{name:g,region:p,type:u,URL:l,linkClicks:{value:1}}}},data:{},clickedElement:i};if(!m)return f;if(!1!==m(f))return f;c.info("This link click event is not triggered because it was canceled in onBeforeLinkClickSend.")})({window:window,getLinkName:e=>{let t=rn(e.innerText||e.textContent);const n=an(e);if(!t||n.includesUnsupportedNodes){const e=(e=>{const t={texts:[]};return e.supportedNodes.forEach((e=>{e.getAttribute&&(t.alt||(t.alt=rn(e.getAttribute("alt"))),t.title||(t.title=rn(e.getAttribute("title"))),t.inputValue||(t.inputValue=rn(cn(e,"value","INPUT"))),t.imgSrc||(t.imgSrc=rn(cn(e,"src","IMG")))),e.nodeValue&&t.texts.push(e.nodeValue)})),t})(n);t=rn(e.texts.join("")),t||(t=e.alt||e.title||e.inputValue||e.imgSrc)}return t||""},getLinkRegion:e=>{let t,n=e.parentNode;for(;n;){if(t=rn(n.id||ln(n)||un(n)),t)return t;n=n.parentNode}return"BODY"},getAbsoluteUrlFromAnchorElement:(e,t)=>{const n=e.location;let o=t.href?t.href:"",{protocol:r,host:s}=t;if(!(e=>e&&/^[a-z0-9]+:\/\//i.test(e))(o)){r||(r=n.protocol?n.protocol:""),r=r?`${r}//`:"",s||(s=n.host?n.host:"");let e="";if("/"!==o.substring(0,1)){let t=n.pathname.lastIndexOf("/");t=t<0?0:t,e=n.pathname.substring(0,t)}o=`${r}${s}${e}/${o}`}return o},findSupportedAnchorElement:e=>{let t=e;for(;t;){if((n=t).href&&("A"===n.tagName||"AREA"===n.tagName)&&(!n.onclick||!n.protocol||n.protocol.toLowerCase().indexOf("javascript")<0))return t;t=t.parentNode}var n;return null},determineLinkType:(e,t,n,o)=>{let r="other";return((e,t,n)=>{const o=new RegExp(e),r=on(t).toLowerCase();return!!n.download||o.test(r)})(t.downloadLinkQualifier,n,o)?r="download":((e,t)=>{const n=e.location.hostname.toLowerCase();return!(on(t).toLowerCase().indexOf(n)>=0)})(e,n)&&(r="exit"),r}}),gn=({config:e,eventManager:t,handleError:n,logger:o})=>{const r=(({getLinkDetails:e,config:t,logger:n})=>{const{clickCollectionEnabled:o}=t;return o?({targetElement:o,event:r})=>{const s=e({targetElement:o,config:t,logger:n});s&&(r.mergeXdm(s.xdm),r.setUserData(s.data))}:()=>{}})({getLinkDetails:pn,config:e,logger:o});return{lifecycle:{onComponentsRegistered(e){const{lifecycle:o}=e;en({eventManager:t,lifecycle:o,handleError:n})},onClick({event:e,clickedElement:t}){r({targetElement:t,event:e})}}}};gn.namespace="ActivityCollector",gn.configValidators=nn,gn.buildOnInstanceConfiguredExtraParams=({config:e,logger:t})=>({getLinkDetails:n=>pn({targetElement:n,config:e,logger:t})});const mn=(e,t)=>`ID sync ${t?"succeeded":"failed"}: ${e.spec.url}`;const fn=Ot({thirdPartyCookiesEnabled:It().default(!0),idMigrationEnabled:It().default(!0)});var hn=Ot({namespaces:Et(kt("ECID")).nonEmpty().uniqueItems().default(["ECID"]),edgeConfigOverrides:xt}).noUnknownFields().default({namespaces:["ECID"]}),yn=Ot({url:Dt().required().nonEmpty(),edgeConfigOverrides:xt}).required().noUnknownFields(),vn=({logger:e})=>new Promise(((t,n)=>{if(C(window.adobe)&&C(window.adobe.optIn)){const o=window.adobe.optIn;e.info("Delaying request while waiting for legacy opt-in to let Visitor retrieve ECID from server."),o.fetchPermissions((()=>{o.isApproved([o.Categories.ECID])?(e.info("Received legacy opt-in approval to let Visitor retrieve ECID from server."),t()):n(new Error("Legacy opt-in was declined."))}),!0)}else t()})),wn=({logger:e,orgId:t,awaitVisitorOptIn:n})=>()=>{const o=(e=>{const t=e.Visitor;return j(t)&&j(t.getInstance)&&t})(window);return o?n({logger:e}).then((()=>(e.info("Delaying request while using Visitor to retrieve ECID from server."),new Promise((n=>{o.getInstance(t,{}).getMarketingCloudVisitorID((t=>{e.info("Resuming previously delayed request that was waiting for ECID from Visitor."),n(t)}),!0)}))))).catch((t=>{t?e.info(`${t.message}, retrieving ECID from experience edge`):e.info("An error occurred while obtaining the ECID from Visitor.")})):Promise.resolve()},bn="ECID",Cn=e=>{e.mergeQuery({identity:{fetch:[bn]}})};var En=((e,t)=>{const n=new Map;return(...o)=>{const r=t?t(...o):o[0];if(n.has(r))return n.get(r);const s=e(...o);return n.set(r,s),s}})((r=>{return(s={[t]:/Edge\/([0-9\._]+)/,[n]:/Edg\/([0-9\.]+)/,[e]:/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/,Firefox:/Firefox\/([0-9\.]+)(?:\s|$)/,IE:/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/,Safari:/Version\/([0-9\._]+).*Safari/},e=>{const t=Object.keys(s);for(let n=0;n<t.length;n+=1){const o=t[n];if(s[o].test(e))return o}return o})(r.navigator.userAgent);var s}));var In=(e,t)=>{e.addIdentity(bn,{id:t})},Rn=e=>{const t=e.getPayloadsByType("identity:result"),n=T(t,(e=>e.namespace&&e.namespace.code===bn));return n?n.id:void 0},kn=e=>(t,n)=>{e.xdm=e.xdm||{},e.xdm.identityMap=e.xdm.identityMap||{},e.xdm.identityMap[t]=e.xdm.identityMap[t]||[],e.xdm.identityMap[t].push(n)},Pn=e=>{const{payload:t,getAction:n,getUseSendBeacon:o,datastreamIdOverride:r}=e,s=Ue();let i=!1,a=!1;return{getId:()=>s,getPayload:()=>t,getAction:()=>n({isIdentityEstablished:a}),getDatastreamIdOverride:()=>r,getUseSendBeacon:()=>o({isIdentityEstablished:a}),getUseIdThirdPartyDomain:()=>i,setUseIdThirdPartyDomain(){i=!0},setIsIdentityEstablished(){a=!0}}},On=({payload:e,datastreamIdOverride:t})=>{const n=({isIdentityEstablished:t})=>e.getDocumentMayUnload()&&t;return Pn({payload:e,getAction:({isIdentityEstablished:e})=>n({isIdentityEstablished:e})?"collect":"interact",getUseSendBeacon:n,datastreamIdOverride:t})},Dn=e=>{const{content:t,addIdentity:n,hasIdentity:o}=e,r=R(t,"meta.configOverrides");return{mergeMeta:R(t,"meta"),mergeState:R(t,"meta.state"),mergeQuery:R(t,"query"),mergeConfigOverride:e=>r((e=>{if(b(e)||"object"!=typeof e)return null;const t=te(e,(e=>!(b(e)||!le(e)&&!ue(e)&&!me(e)&&!U(e))));return ee(t)?null:t})(e)),addIdentity:n,hasIdentity:o,toJSON:()=>t}},Sn=e=>t=>void 0!==(e.xdm&&e.xdm.identityMap&&e.xdm.identityMap[t]),Tn=()=>{const e={},t=Dn({content:e,addIdentity:kn(e),hasIdentity:Sn(e)});return t.addEvent=t=>{e.events=e.events||[],e.events.push(t)},t.getDocumentMayUnload=()=>(e.events||[]).some((e=>e.getDocumentMayUnload())),t},xn=({localConfigOverrides:e,globalConfigOverrides:t,payload:n})=>{const o={payload:n},{datastreamId:r,...s}=e||{};return r&&(o.datastreamIdOverride=r),n.mergeConfigOverride(t),n.mergeConfigOverride(s),o};const $n="clientId";var Nn=({payload:e,datastreamIdOverride:t})=>Pn({payload:e,datastreamIdOverride:t,getAction:()=>"identity/acquire",getUseSendBeacon:()=>!1}),Mn=e=>{const t={query:{identity:{fetch:e}}};return Dn({content:t,addIdentity:kn(t),hasIdentity:Sn(t)})};const qn=/^([^?#]*)(\??[^#]*)(#?.*)$/;const An=({config:e,logger:t,consent:n,fireReferrerHideableImage:o,sendEdgeNetworkRequest:r,apexDomain:s})=>{const{orgId:a,thirdPartyCookiesEnabled:c,edgeConfigOverrides:d}=e,l=(({config:e,getEcidFromVisitor:t,apexDomain:n,isPageSsl:o,cookieJar:r})=>{const{idMigrationEnabled:s,orgId:i}=e,a=`AMCV_${i}`,c=()=>{let e=null;const t=r.get("s_ecid")||r.get(a);if(t){const n=/(^|\|)MCMID\|(\d+)($|\|)/,o=t.match(n);o&&(e=o[2])}return e};return{getEcid(){if(s){const e=c();return e?Promise.resolve(e):t()}return Promise.resolve()},setEcid(e){if(s&&c()!==e){const t=o?{sameSite:"none",secure:!0}:{};r.set(a,`MCMID|${e}`,{domain:n,expires:390,...t})}}}})({config:e,getEcidFromVisitor:wn({logger:t,orgId:a,awaitVisitorOptIn:vn}),apexDomain:s,cookieJar:P({logger:t,cookieJar:w}),isPageSsl:"https:"===window.location.protocol}),u=ce({orgId:a}),p=(({sendEdgeNetworkRequest:e,createIdentityRequestPayload:t,createIdentityRequest:n,globalConfigOverrides:o})=>({namespaces:r,edgeConfigOverrides:s}={})=>{const i=xn({payload:t(r),globalConfigOverrides:o,localConfigOverrides:s}),a=n(i);return e({request:a})})({sendEdgeNetworkRequest:r,createIdentityRequestPayload:Mn,createIdentityRequest:Nn,globalConfigOverrides:d}),g=(({thirdPartyCookiesEnabled:e,areThirdPartyCookiesSupportedByDefault:t})=>n=>{e&&t(En(window))&&n.setUseIdThirdPartyDomain()})({thirdPartyCookiesEnabled:c,areThirdPartyCookiesSupportedByDefault:i}),m=(({getLegacyEcid:e,addEcidToPayload:t})=>n=>n.hasIdentity(bn)?Promise.resolve():e().then((e=>{e&&t(n,e)})))({getLegacyEcid:l.getEcid,addEcidToPayload:In}),f=(({locationSearch:e,dateProvider:t,orgId:n,logger:o})=>r=>{if(r.hasIdentity(bn))return;const s=Ee.parse(e).adobe_mc;if(void 0===s)return;const i=s.split("|").reduce(((e,t)=>{const[n,o]=t.split("=");return e[n]=o,e}),{}),a=parseInt(i.TS,10),c=i.MCMID,d=decodeURIComponent(i.MCORGID);t().getTime()/1e3<=a+300&&d===n&&c?(o.info(`Found valid ECID identity ${c} from the adobe_mc query string parameter.`),r.addIdentity(bn,{id:c})):o.info("Detected invalid or expired adobe_mc query string parameter.")})({locationSearch:window.document.location.search,dateProvider:()=>new Date,orgId:a,logger:t}),y=(({doesIdentityCookieExist:e,orgId:t})=>({onResponse:n,onRequestFailure:o})=>new Promise(((r,s)=>{n((()=>{if(!e()){const e=new Error(`An identity was not set properly. Please verify that the org ID ${t} configured in Alloy matches the org ID specified in the edge configuration.`);throw s(e),e}r()})),o((()=>{e()?r():s(new Error("No identity was set on response."))}))})))({doesIdentityCookieExist:u,orgId:a}),v=(({doesIdentityCookieExist:e,setDomainForInitialIdentityPayload:t,addLegacyEcidToPayload:n,awaitIdentityCookie:o,logger:r})=>{let s;const i=e=>(t(e),n(e.getPayload()));return({request:t,onResponse:n,onRequestFailure:a})=>{if(e())return t.setIsIdentityEstablished(),Promise.resolve();if(s){r.info("Delaying request while retrieving ECID from server.");const e=s;return s=e.catch((()=>o({onResponse:n,onRequestFailure:a}))),e.then((()=>{r.info("Resuming previously delayed request."),t.setIsIdentityEstablished()})).catch((()=>i(t)))}return s=o({onResponse:n,onRequestFailure:a}),i(t)}})({doesIdentityCookieExist:u,setDomainForInitialIdentityPayload:g,addLegacyEcidToPayload:m,awaitIdentityCookie:y,logger:t}),b=(({fireReferrerHideableImage:e,logger:t})=>n=>{const o=n.filter((e=>"url"===e.type));return o.length?Promise.all(o.map((n=>e(n.spec).then((()=>{t.info(mn(n,!0))})).catch((()=>{t.error(mn(n,!1))}))))).then(fe):Promise.resolve()})({fireReferrerHideableImage:o,logger:t}),C=(({processIdSyncs:e})=>t=>e(t.getPayloadsByType("identity:exchange")))({processIdSyncs:b}),E=(({dateProvider:e,orgId:t})=>(n,o)=>{const r=Math.round(e().getTime()/1e3),s=encodeURIComponent(`TS=${r}|MCMID=${n}|MCORGID=${encodeURIComponent(t)}`),[,i,a,c]=o.match(qn),d=(e=>""===e?"?":"?"===e?"":"&")(a);return`${i}${a}${d}adobe_mc=${s}${c}`})({dateProvider:()=>new Date,orgId:a,globalConfigOverrides:d});return(({addEcidQueryToPayload:e,addQueryStringIdentityToPayload:t,ensureSingleIdentity:n,setLegacyEcid:o,handleResponseForIdSyncs:r,getEcidFromResponse:s,getIdentity:i,consent:a,appendIdentityToUrl:c,logger:d})=>{let l,u={};return{lifecycle:{onBeforeRequest:({request:o,onResponse:r,onRequestFailure:s})=>(e(o.getPayload()),t(o.getPayload()),n({request:o,onResponse:r,onRequestFailure:s})),onResponse:({response:e})=>(l||(l=s(e),l&&o(l)),u=h(u,e.getEdge()),r(e))},commands:{getIdentity:{optionsValidator:hn,run:e=>a.awaitConsent().then((()=>l?void 0:i(e))).then((()=>({identity:{ECID:l},edge:u})))},appendIdentityToUrl:{optionsValidator:yn,run:e=>a.withConsent().then((()=>l?void 0:i(e))).then((()=>({url:c(l,e.url)}))).catch((t=>(d.warn(`Unable to append identity to url. ${t.message}`),e)))}}}})({addEcidQueryToPayload:Cn,addQueryStringIdentityToPayload:f,ensureSingleIdentity:v,setLegacyEcid:l.setEcid,handleResponseForIdSyncs:C,getEcidFromResponse:Rn,getIdentity:p,consent:n,appendIdentityToUrl:E,logger:t,config:e})};An.namespace="Identity",An.configValidators=fn;var jn=({fireReferrerHideableImage:e,logger:t,cookieJar:n,isPageSsl:o})=>{const r=o?{sameSite:"none",secure:!0}:{};return o=>((e=>{e.filter((e=>"cookie"===e.type)).forEach((e=>{const{name:t,value:o,domain:s,ttlDays:i}=e.spec;n.set(t,o||"",{domain:s||"",expires:i||10,...r})}))})(o),(n=>{const o=n.filter((e=>"url"===e.type));return Promise.all(o.map((n=>e(n.spec).then((()=>{t.info(((e,t)=>`URL destination ${!0?"succeeded":"failed"}: ${e.spec.url}`)(n))})).catch((()=>{}))))).then(fe)})(o))},Un=({processDestinations:e})=>({response:t})=>(({response:t})=>{const n=t.getPayloadsByType("activation:push");return e(n)})({response:t}).then((()=>(({response:e})=>({destinations:e.getPayloadsByType("activation:pull")}))({response:t})));const Ln=({logger:e,fireReferrerHideableImage:t})=>{const n=w.withConverter({write:e=>encodeURIComponent(e)}),o=P({logger:e,cookieJar:n}),r=jn({fireReferrerHideableImage:t,logger:e,cookieJar:o,isPageSsl:"https:"===window.location.protocol});return{lifecycle:{onResponse:Un({processDestinations:r})},commands:{}}};Ln.namespace="Audiences";const _n="web",Bn=/^(\w+):\/\/([^/#]+)(\/[^#]*)?(#.*)?$/,Fn=/^(?:.*@)?(?:[a-z\d\u00a1-\uffff.-]+|\[[a-f\d:]+])(?::\d+)?$/,Hn=/^\/(?:[/\w\u00a1-\uffff-.~]|%[a-fA-F\d]{2})*$/,Vn=/^#(?:[/\w\u00a1-\uffff-.~]|%[a-fA-F\d]{2})+$/,zn=(e="/")=>{let t=e.length;for(;t>0&&-1!=="/".indexOf(e.charAt(t-1));)t-=1;return e.substring(0,t)||"/"},Jn=e=>`${e.surfaceType}://${e.authority}${e.path||""}${e.fragment||""}`,Qn=e=>{const t=e(),n=t.host.toLowerCase(),o=t.pathname;return"web://"+n+zn(o)},Xn=(e,t,n)=>{const o=e=>(n.warn(e),null);if(!me(e))return o(`Invalid surface: ${e}`);const s=((e,t)=>F(e,"#")?Qn(t)+e:e)(e,t),i=(e=>{const t=e.match(Bn);return t?{surfaceType:(r=t[1],me(r)?r.toLowerCase():""),authority:(o=t[2],me(o)?o.toLowerCase():""),path:(n=t[3],me(n)?zn(n):"/"),fragment:t[4]}:null;var n,o,r})(s);return null===i?o(`Invalid surface: ${e}`):r([_n,"webapp"],i.surfaceType)?i.authority&&Fn.test(i.authority)?i.path&&!Hn.test(i.path)?o(`Invalid path ${i.path} in surface: ${e}`):i.fragment&&!Vn.test(i.fragment)?o(`Invalid fragment ${i.fragment} in surface: ${e}`):i:o(`Invalid authority ${i.authority} in surface: ${e}`):o(`Unsupported surface type ${i.surfaceType} in surface: ${e}`)},Wn=e=>!!e&&0===e.indexOf("web://")&&-1===e.indexOf("#");var Gn="__view__";const Yn="https://ns.adobe.com/personalization/default-content-item",Kn="https://ns.adobe.com/personalization/dom-action",Zn="https://ns.adobe.com/personalization/html-content-item",eo="https://ns.adobe.com/personalization/redirect-item",to="https://ns.adobe.com/personalization/message/in-app",no=e=>e.filter(((t,n)=>e.indexOf(t)===n));var oo=({getPageLocation:e,renderDecisions:t,decisionScopes:n,personalization:o,event:s,isCacheInitialized:i,logger:a})=>{const c=s.getViewName();return{isRenderDecisions:()=>t,isSendDisplayEvent:()=>!!o.sendDisplayEvent,shouldIncludeRenderedPropositions:()=>!!o.includeRenderedPropositions,getViewName:()=>c,hasScopes:()=>n.length>0||U(o.decisionScopes),hasSurfaces:()=>U(o.surfaces),hasViewName:()=>me(c),createQueryDetails(){const t=[...n];U(o.decisionScopes)&&t.push(...o.decisionScopes);const s=((e=[],t,n)=>e.map((e=>Xn(e,t,n))).filter((e=>!b(e))).map(Jn))(o.surfaces,e,a);this.shouldRequestDefaultPersonalization()&&((e=>{r(e,Gn)||e.push(Gn)})(t),((e,t)=>{const n=Qn(t);r(e,n)||e.push(n)})(s,e));const i=[Yn,Zn,"https://ns.adobe.com/personalization/json-content-item",eo,"https://ns.adobe.com/personalization/ruleset-item",to,"https://ns.adobe.com/personalization/message/feed-item"];return r(t,Gn)&&i.push(Kn),{schemas:i,decisionScopes:no(t),surfaces:no(s)}},isCacheInitialized:()=>i,shouldFetchData(){return this.hasScopes()||this.hasSurfaces()||this.shouldRequestDefaultPersonalization()},shouldUseCachedData(){return this.hasViewName()&&!this.shouldFetchData()},shouldRequestDefaultPersonalization(){return o.defaultPersonalizationEnabled||!this.isCacheInitialized()&&!1!==o.defaultPersonalizationEnabled}}};const ro="decisioning.propositionDisplay",so="decisioning.propositionInteract",io="decisioning.propositionTrigger",ao="decisioning.propositionDismiss",co={DISPLAY:"display",INTERACT:"interact",TRIGGER:"trigger",DISMISS:"dismiss"},lo={[ro]:co.DISPLAY,[so]:co.INTERACT,[io]:co.TRIGGER,[ao]:co.DISMISS},uo=e=>lo[e],po={propositions:[]};var go=({getPageLocation:e,logger:t,fetchDataHandler:n,viewChangeHandler:o,onClickHandler:r,isAuthoringModeEnabled:s,mergeQuery:i,viewCache:a,showContainers:c,applyPropositions:d,setTargetMigration:l,mergeDecisionsMeta:u,renderedPropositions:p,onDecisionHandler:g})=>({lifecycle:{onDecision:g,onBeforeRequest:({request:e})=>(l(e),Promise.resolve()),onBeforeEvent({event:r,renderDecisions:d,decisionScopes:l=[],personalization:g={},onResponse:m=fe,onRequestFailure:f=fe}){if(m((()=>({propositions:[]}))),f((()=>c())),s())return t.warn("Rendering is disabled for authoring mode."),i(r,{enabled:!1}),Promise.resolve();const h=oo({getPageLocation:e,renderDecisions:d,decisionScopes:l,personalization:g,event:r,isCacheInitialized:a.isInitialized(),logger:t}),y=[];if(h.shouldIncludeRenderedPropositions()&&y.push(p.clear()),h.shouldFetchData()){const e=a.createCacheUpdate(h.getViewName());f((()=>e.cancel())),n({cacheUpdate:e,personalizationDetails:h,event:r,onResponse:m})}else h.shouldUseCachedData()&&y.push(o({personalizationDetails:h,event:r,onResponse:m,onRequestFailure:f}));return Promise.all(y).then((e=>{const t=ne(e,(e=>e));U(t)&&u(r,t,[co.DISPLAY])}))},onClick({event:e,clickedElement:t}){r({event:e,clickedElement:t})}},commands:{applyPropositions:{optionsValidator:e=>(({logger:e,options:t})=>{const n=Ot({propositions:Et(Ot(Ct())),metadata:Ot(Ct()),viewName:Dt()}).required();try{return n(t)}catch(t){return e.warn("Invalid options for applyPropositions. No propositions will be applied.",t),po}})({logger:t,options:e}),run:d}}}),mo=e=>$("DIV",{},{innerHTML:e}),fo={exports:{}};!function(e,t){var n;n=a,e.exports=function(e){if(e.CSS&&e.CSS.escape)return e.CSS.escape;var t=function(e){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var t,n=String(e),o=n.length,r=-1,s="",i=n.charCodeAt(0);++r<o;)0!=(t=n.charCodeAt(r))?s+=t>=1&&t<=31||127==t||0==r&&t>=48&&t<=57||1==r&&t>=48&&t<=57&&45==i?"\\"+t.toString(16)+" ":0==r&&1==o&&45==t||!(t>=128||45==t||95==t||t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122)?"\\"+n.charAt(r):n.charAt(r):s+="�";return s};return e.CSS||(e.CSS={}),e.CSS.escape=t,t}(n)}(fo);var ho=c(fo.exports);const yo=/:eq\((\d+)\)/g,vo=e=>-1===e.indexOf(":eq("),wo=/(#|\.)(-?\w+)/g,bo=(e,t,n)=>`${t}${ho(n)}`,Co=e=>{const t=[],n=(e=>e.split(yo).filter(me))((e=>e.replace(wo,bo))(e.trim())),{length:o}=n;let r=0;for(;r<o;){const e=n[r],o=n[r+1];o?t.push({sel:e,eq:Number(o)}):t.push({sel:e}),r+=2}return t},Eo=e=>{const t=document;if(vo(e))return J(e,t);const n=Co(e),{length:o}=n;let r=[],s=t,i=0;for(;i<o;){const{sel:e,eq:t}=n[i],a=J(e,s),{length:c}=a;if(0===c)break;if(null!=t&&t>c-1)break;i<o-1&&(null==t?[s]=a:s=a[t]),i===o-1&&(r=null==t?a:[a[t]]),i+=1}return r};var Io=(e,t=document)=>t.getElementById(e),Ro=(e,t,n)=>{e.setAttribute(t,n)},ko=(e,t)=>e.getAttribute(t),Po=e=>e.parentNode,Oo=(e,t)=>{if(!e)return;const n=Po(e);n&&n.insertBefore(t,(e=>e.nextElementSibling)(e))},Do=(e,t)=>{if(!e)return;const n=Po(e);n&&n.insertBefore(t,e)},So=e=>{const{childNodes:t}=e;return t?L(t):[]},To=e=>e.firstElementChild;let xo;var $o=(e=document)=>{if(void 0===xo){const t=e.querySelector("[nonce]");xo=t&&(t.nonce||t.getAttribute("nonce"))}return xo};const No="alloy-prehiding",Mo={},qo=e=>{const t=Mo[e];t&&(Y(t),delete Mo[e])},Ao=e=>{if(!e)return;if(Io(No))return;const t=$o(),n={id:No,...t&&{nonce:t}},o=$(M,n,{textContent:e});x(document.head,o)},jo=()=>{const e=Io(No);e&&Y(e)};var Uo=(e,t)=>{e.textContent=t};const Lo="src",_o=e=>$(N,{src:e}),Bo=e=>{J(N,e).forEach((e=>{const t=ko(e,Lo);t&&_o(t)}))},Fo=e=>((e,t)=>e.tagName===t)(e,M)&&!ko(e,Lo);var Ho=e=>{const t=J(M,e),{length:n}=t,o=$o();if(o)for(let e=0;e<n;e+=1){const n=t[e];Fo(n)&&(n.nonce=o)}};var Vo=setTimeout;function zo(e){return Boolean(e&&void 0!==e.length)}function Jo(){}function Qo(e){if(!(this instanceof Qo))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],Zo(e,this)}function Xo(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,Qo._immediateFn((function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var o;try{o=n(e._value)}catch(e){return void Go(t.promise,e)}Wo(t.promise,o)}else(1===e._state?Wo:Go)(t.promise,e._value)}))):e._deferreds.push(t)}function Wo(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof Qo)return e._state=3,e._value=t,void Yo(e);if("function"==typeof n)return void Zo((o=n,r=t,function(){o.apply(r,arguments)}),e)}e._state=1,e._value=t,Yo(e)}catch(t){Go(e,t)}var o,r}function Go(e,t){e._state=2,e._value=t,Yo(e)}function Yo(e){2===e._state&&0===e._deferreds.length&&Qo._immediateFn((function(){e._handled||Qo._unhandledRejectionFn(e._value)}));for(var t=0,n=e._deferreds.length;t<n;t++)Xo(e,e._deferreds[t]);e._deferreds=null}function Ko(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function Zo(e,t){var n=!1;try{e((function(e){n||(n=!0,Wo(t,e))}),(function(e){n||(n=!0,Go(t,e))}))}catch(e){if(n)return;n=!0,Go(t,e)}}Qo.prototype.catch=function(e){return this.then(null,e)},Qo.prototype.then=function(e,t){var n=new this.constructor(Jo);return Xo(this,new Ko(e,t,n)),n},Qo.prototype.finally=function(e){var t=this.constructor;return this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){return t.reject(n)}))}))},Qo.all=function(e){return new Qo((function(t,n){if(!zo(e))return n(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(e);if(0===o.length)return t([]);var r=o.length;function s(e,i){try{if(i&&("object"==typeof i||"function"==typeof i)){var a=i.then;if("function"==typeof a)return void a.call(i,(function(t){s(e,t)}),n)}o[e]=i,0==--r&&t(o)}catch(e){n(e)}}for(var i=0;i<o.length;i++)s(i,o[i])}))},Qo.resolve=function(e){return e&&"object"==typeof e&&e.constructor===Qo?e:new Qo((function(t){t(e)}))},Qo.reject=function(e){return new Qo((function(t,n){n(e)}))},Qo.race=function(e){return new Qo((function(t,n){if(!zo(e))return n(new TypeError("Promise.race accepts an array"));for(var o=0,r=e.length;o<r;o++)Qo.resolve(e[o]).then(t,n)}))},Qo._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){Vo(e,0)},Qo._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var er=d(Object.freeze({__proto__:null,default:Qo})),tr="undefined"!=typeof window&&window.Promise||void 0!==a&&a.Promise||er.default||er,nr=function(e){var t=document.createElement("script");t.src=e,t.async=!0;var n=function(e,t){return new tr((function(n,o){t.onload=function(){n(t)},t.onerror=function(){o(new Error("Failed to load script "+e))}}))}(e,t);return document.getElementsByTagName("head")[0].appendChild(t),n},or=c(nr);const rr=(e,t)=>!!e&&e.tagName===t,sr=e=>rr(e,q)&&!ko(e,Lo),ir=e=>rr(e,q)&&ko(e,Lo),ar=e=>{const t=J(q,e),n=[],{length:o}=t,r=$o(),s={...r&&{nonce:r}};for(let e=0;e<o;e+=1){const o=t[e];if(!sr(o))continue;const{textContent:r}=o;r&&n.push($(q,s,{textContent:r}))}return n},cr=e=>{const t=J(q,e),n=[],{length:o}=t;for(let e=0;e<o;e+=1){const o=t[e];if(!ir(o))continue;const r=ko(o,Lo);r&&n.push(r)}return n},dr=(e,t)=>{t.forEach((t=>{e.appendChild(t),e.removeChild(t)}))},lr=e=>Promise.all(e.map(or));var ur=(e,t)=>{const n=mo(t);Ho(n);const o=So(n),r=ar(n),s=cr(n);return Bo(n),o.forEach((t=>{x(e,t)})),dr(e,r),lr(s)};var pr=(e,t)=>{(e=>{So(e).forEach(Y)})(e),ur(e,t)},gr=(e,t)=>{const n=mo(t);Ho(n);const o=So(n),r=ar(n),s=cr(n),{length:i}=o;let a=i-1;for(Bo(n);a>=0;){const t=o[a],n=To(e);n?Do(n,t):x(e,t),a-=1}return dr(e,r),lr(s)},mr=(e,t)=>{const n=mo(t);Ho(n);const o=So(n),r=ar(n),s=cr(n);return Bo(n),o.forEach((t=>{Do(e,t)})),dr(e,r),lr(s)},fr=(e,t)=>{mr(e,t),Y(e)},hr=(e,t)=>{const n=mo(t);Ho(n);const o=So(n),r=ar(n),s=cr(n);return Bo(n),o.forEach((t=>{Oo(e,t)})),dr(e,r),lr(s)},yr=(e,t)=>{const{priority:n,...o}=t;Object.keys(o).forEach((t=>{((e,t,n,o)=>{let r;r=o?`${t}:${n} !${o};`:`${t}:${n};`,e.style.cssText+=`;${r}`})(e,t,o[t],n)}))},vr=(e,t)=>{Object.keys(t).forEach((n=>{Ro(e,n,t[n])}))},wr=(e,t)=>{e.tagName===N&&(_o(t),((e,t)=>{e.removeAttribute(t)})(e,Lo),Ro(e,Lo,t))},br=(e,{from:t,to:n})=>{const o=(e=>{const{children:t}=e;return t?L(t):[]})(e),r=o[t],s=o[n];r&&s&&(t<n?Oo(s,r):Do(s,r))};const Cr=e=>t=>{const{selector:n,prehidingSelector:o,content:r}=t;return(e=>{if(Mo[e])return;const t=$o(),n={...t&&{nonce:t}},o=$(M,n,{textContent:`${e} { visibility: hidden }`});x(document.head,o),Mo[e]=o})(o),G(n,Eo).then((t=>((e,t,n)=>{const o=e.map((e=>n(e,t)));return Promise.all(o)})(t,r,e))).then((()=>{qo(o)}),(e=>{throw qo(o),e}))};var Er=(e,t)=>{if(vo(e))return((e,t)=>t.matches?t.matches(e):t.msMatchesSelector(e))(e,t);const n=Eo(e);let o=!1;for(let e=0;e<n.length;e+=1)if(n[e]===t){o=!0;break}return o};const Ir="view",Rr=(e,t,n)=>{const{documentElement:o}=document;let r=e,s=0;for(;r&&r!==o;){if(Er(t,r)){const e=n(t),o={metas:e},r=e.find((e=>e.trackingLabel));r&&(o.label=r.trackingLabel,o.weight=s);const i=e.find((e=>e.scopeType===Ir));return i&&(o.viewName=i.scope,o.weight=s),o}r=r.parentNode,s+=1}return{metas:null}},kr=e=>e.map((e=>{const{trackingLabel:t,scopeType:n,...o}=e;return o}));var Pr=(e,t,n)=>{const o=[];let r,s="",i=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER;for(let c=0;c<t.length;c+=1){const{metas:d,label:l,weight:u,viewName:p}=Rr(e,t[c],n);d&&(l&&u<=i&&(s=l,i=u),p&&u<=a&&(r=p,a=u),o.push(...kr(d)))}return{decisionsMeta:(c=o,c.filter(((e,t)=>{const n=JSON.stringify(e);return t===c.findIndex((e=>JSON.stringify(e)===n))}))),eventLabel:s,viewName:r};var c},Or=(e=document)=>-1!==e.location.href.indexOf("adobe_authoring_enabled");const Dr=(e,t,n,o)=>{if(0===t.length)return;const r={};n.forEach((e=>{r[e]=1}));const s={_experience:{decisioning:{propositions:t,propositionEventType:r}}};o&&(s._experience.decisioning.propositionAction=o),e.mergeXdm(s)},Sr=(e,t)=>{e.mergeQuery({personalization:{...t}})};var Tr=()=>{const e={};return{storeClickMetrics:({selector:t,meta:{id:n,scope:o,scopeDetails:r,trackingLabel:s,scopeType:i}})=>{e[t]||(e[t]={}),e[t][n]={scope:o,scopeDetails:r,trackingLabel:s,scopeType:i}},getClickSelectors:()=>Object.keys(e),getClickMetasBySelector:t=>e[t]?(e=>Object.keys(e).map((t=>({id:t,...e[t]}))))(e[t]):{}}};const xr=[Kn,Zn,to];var $r=({processPropositions:e,createProposition:t,renderedPropositions:n,viewCache:o})=>{const r=e=>xr.indexOf(e.schema)>-1,s=({items:e,metadataForScope:t})=>e.filter(r).map((e=>e.schema!==Zn?{...e}:C(t)?{...e,data:{...e.data,selector:t.selector,type:t.actionType}}:void 0)).filter((e=>e)),i=e=>!(e.scope===Gn&&e.renderAttempted);return({propositions:r=[],metadata:a={},viewName:c})=>{const d=D();n.concat(d.promise);const l=(({propositions:e,metadata:t})=>e.filter(i).map((e=>{if(U(e.items)){const{id:n,scope:o,scopeDetails:r}=e;return{id:n,scope:o,scopeDetails:r,items:s({items:e.items,metadataForScope:t[e.scope]})}}return e})).filter((e=>U(e.items))))({propositions:r,metadata:a}).map((e=>t(e)));return Promise.resolve().then((()=>c?o.getView(c):[])).then((t=>{const{render:n,returnedPropositions:o}=e([...l,...t]);return n().then(d.resolve),{propositions:o}}))}};var Nr=e=>{const{selector:t,type:n}=e;return"customCode"!==n||"BODY > *:eq(0)"!==t?e:h({},e,{selector:"BODY"})};var Mr=e=>{const t=h({},e),{content:n,selector:o}=t;if(!ge(r=n)||!r.trim())return t;var r;if(null==o)return t;const s=Eo(o);return rr(s[0],"HEAD")?(t.type="appendHtml",t.content=(e=>{const t=mo(e);return J("SCRIPT,LINK,STYLE",t).map((e=>e.outerHTML)).join("")})(n),t):t},qr=({preprocess:e,isPageWideSurface:t})=>(n,o=!0)=>{const{id:r,scope:s,scopeDetails:i,items:a=[]}=n,{characteristics:{scopeType:c}={}}=i||{};return{getScope:()=>s||s,getScopeType:()=>s===Gn||t(s)?"page":c===Ir?Ir:"proposition",getItems(){return a.map((t=>((t,n)=>{const{schema:o,data:r,characteristics:{trackingLabel:s}={}}=t,i=e(r);return{getSchema:()=>o,getData:()=>i,getProposition:()=>n,getTrackingLabel:()=>s,getOriginalItem:()=>t,toString:()=>JSON.stringify(t),toJSON:()=>t}})(t,this)))},getNotification:()=>({id:r,scope:s,scopeDetails:i}),toJSON:()=>n,addToReturnValues(e,t,r,s){o&&(e.push({...n,items:r.map((e=>e.getOriginalItem())),renderAttempted:s}),s||t.push({...n,items:r.map((e=>e.getOriginalItem()))}))}}},Ar=()=>({setRenderAttempted:!0,includeInNotification:!0}),jr=({modules:e,logger:t,storeClickMetrics:n})=>o=>{const{type:r,selector:s}=o.getData()||{};return r?"click"===r?s?(n({selector:s,meta:{...o.getProposition().getNotification(),trackingLabel:o.getTrackingLabel(),scopeType:o.getProposition().getScopeType()}}),{setRenderAttempted:!0,includeInNotification:!1}):(t.warn("Invalid DOM action data: missing selector.",o.getData()),{setRenderAttempted:!1,includeInNotification:!1}):e[r]?{render:()=>e[r](o.getData()),setRenderAttempted:!0,includeInNotification:!0}:(t.warn("Invalid DOM action data: unknown type.",o.getData()),{setRenderAttempted:!1,includeInNotification:!1}):(t.warn("Invalid DOM action data: missing type.",o.getData()),{setRenderAttempted:!1,includeInNotification:!1})},Ur=({modules:e,logger:t})=>n=>{const{type:o,selector:r}=n.getData()||{};return r&&o?e[o]?{render:()=>{e[o](n.getData())},setRenderAttempted:!0,includeInNotification:!0}:(t.warn("Invalid HTML content data",n.getData()),{setRenderAttempted:!1,includeInNotification:!1}):{setRenderAttempted:!1,includeInNotification:!1}},Lr=({logger:e,executeRedirect:t,collect:n})=>o=>{const{content:r}=o.getData()||{};if(!r)return e.warn("Invalid Redirect data",o.getData()),{};return{render:()=>n({decisionsMeta:[o.getProposition().getNotification()],documentMayUnload:!0}).then((()=>t(r))),setRenderAttempted:!0,onlyRenderThis:!0}},_r=({schemaProcessors:e,logger:t})=>{const n=(e,n)=>()=>Promise.resolve().then(e).then((()=>(t.enabled&&t.info(`Action ${n.toString()} executed.`),!0))).catch((e=>{if(t.enabled){const{message:o,stack:r}=e,s=`Failed to execute action ${n.toString()}. ${o} ${r}`;t.warn(s)}return!1})),o=t=>{const n=e[t.getSchema()];return n?n(t):{}},r=({renderers:e,returnedPropositions:t,returnedDecisions:r,items:s,proposition:i})=>{let a,c,d,l,u=[...e],p=[...t],g=[...r],m=[],f=[],h=[],y=!1,v=!1,w=0;for(;s.length>w;){if(l=s[w],({render:a,setRenderAttempted:c,includeInNotification:d,onlyRenderThis:v}=o(l)),v){p=[],g=[],c?(m=[l],f=[]):(m=[],f=[l]),u=[],h=[a],y=d;break}a&&h.push(n(a,l)),d&&(y=!0),c?m.push(l):f.push(l),w+=1}if(h.length>0){const e=y?i.getNotification():void 0;u.push((()=>((e,t)=>Promise.all(e.map((e=>e()))).then((e=>{if(e.includes(!0))return t})))(h,e)))}else y&&u.push((()=>i.getNotification()));return m.length>0&&i.addToReturnValues(p,g,m,!0),f.length>0&&i.addToReturnValues(p,g,f,!1),{renderers:u,returnedPropositions:p,returnedDecisions:g,onlyRenderThis:v}};return(e,t=[])=>{let n,o,s,i=[],a=[],c=[],d=0;for(;e.length>d&&(o=e[d],s=o.getItems(),({renderers:i,returnedPropositions:a,returnedDecisions:c,onlyRenderThis:n}=r({renderers:i,returnedPropositions:a,returnedDecisions:c,items:s,proposition:o})),!n);)d+=1;n&&e.forEach(((e,t)=>{t!==d&&e.addToReturnValues(a,c,e.getItems(),!1)})),t.forEach((e=>{e.addToReturnValues(a,c,e.getItems(),!1)}));return{returnedPropositions:a,returnedDecisions:c,render:()=>Promise.all(i.map((e=>e()))).then((e=>e.filter((e=>e))))}}};const Br="text/html",Fr="defaultContent",Hr=["content","contentType"],Vr=["mobileParameters","webParameters","html"];var zr=({modules:e,logger:t})=>n=>{const o=n.getData(),r={...n.getProposition().getNotification()};if(!o)return t.warn("Invalid in-app message data: undefined.",o),{};const{type:s=Fr}=o;return e[s]?((e,t)=>{for(let n=0;n<Hr.length;n+=1){const o=Hr[n];if(!Object.prototype.hasOwnProperty.call(e,o))return t.warn(`Invalid in-app message data: missing property '${o}'.`,e),!1}const{content:n,contentType:o}=e;if("application/json"===o)for(let o=0;o<Vr.length;o+=1){const r=Vr[o];if(!Object.prototype.hasOwnProperty.call(n,r))return t.warn(`Invalid in-app message data.content: missing property '${r}'.`,e),!1}return!0})(o,t)?r?{render:()=>e[s]({...o,meta:r}),setRenderAttempted:!0,includeInNotification:!0}:(t.warn("Invalid in-app message meta: undefined.",r),{}):{}:(t.warn("Invalid in-app message data: unknown type.",o),{})};const Jr=e=>{const t=J(`#${e}`,document);t&&t.length>0&&Y(t[0])};var Qr=e=>t=>(e.location.replace(t),new Promise((()=>{})));const Xr="alloy-messaging-container",Wr="alloy-overlay-container",Gr="alloy-content-iframe",Yr=()=>[Xr,Wr].forEach(Jr),Kr=(e,t=Qr(window))=>n=>{n.preventDefault(),n.stopImmediatePropagation();const{target:o}=n,r="a"===o.tagName.toLowerCase()?o:o.closest("a");if(!r)return;const{action:s,interaction:i,link:a,label:c,uuid:d}=(e=>{const t={};if(!e||"a"!==e.tagName.toLowerCase())return t;const{href:n}=e;if(!n||!F(n,"adbinapp://"))return t;const o=n.split("?"),r=o[0].split("://")[1],s=e.innerText,i=e.getAttribute("data-uuid")||"";let a,c;if(U(o)){const e=Ee.parse(o[1]);a=e.interaction||"",c=decodeURIComponent(e.link||"")}return{action:r,interaction:a,link:c,label:s,uuid:i}})(r);e(s,{label:c,id:i,uuid:d,link:a}),"dismiss"===s&&Yr(),me(a)&&a.length>0&&t(a)},Zr=e=>{const{verticalAlign:t,width:n,horizontalAlign:o,backdropColor:r,height:s,cornerRadius:i,horizontalInset:a,verticalInset:c,uiTakeover:d=!1}=e,l={width:n?`${n}%`:"100%",backgroundColor:r||"rgba(0, 0, 0, 0.5)",borderRadius:i?`${i}px`:"0px",border:"none",position:d?"fixed":"relative",overflow:"hidden"};return"left"===o?l.left=a?`${a}%`:"0":"right"===o?l.right=a?`${a}%`:"0":"center"===o&&(l.left="50%",l.transform="translateX(-50%)"),"top"===t?l.top=c?`${c}%`:"0":"bottom"===t?(l.position="fixed",l.bottom=c?`${c}%`:"0"):"center"===t&&(l.top="50%",l.transform=("center"===o?`${l.transform} `:"")+"translateY(-50%)",l.display="flex",l.alignItems="center",l.justifyContent="center"),l.height=s?`${s}vh`:"100%",l},es=e=>{const{backdropOpacity:t,backdropColor:n}=e;return{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"transparent",opacity:t||.5,backgroundColor:n||"#FFFFFF"}},ts=["enabled","parentElement","insertionMethod"],ns=e=>{if(!e)return!1;const t=Object.keys(e);if(!r(t,Xr))return!1;if(!r(t,Wr))return!1;const n=(o=e,Object.keys(o).map((e=>o[e])));var o;for(let e=0;e<n.length;e+=1){if(!Ot(n[e],"style"))return!1;if(!Ot(n[e],"params"))return!1;for(let t=0;t<ts.length;t+=1)if(!Ot(n[e].params,ts[t]))return!1}return!0},os=(e={},t)=>{Yr();const{content:n,contentType:o,mobileParameters:r}=e;let{webParameters:s}=e;if(o!==Br)return;const i=$("div",{id:Xr}),a=((e,t)=>{const n=(new DOMParser).parseFromString(e,Br),o=n.querySelector("script");o&&o.setAttribute("nonce",$o());const r=$("iframe",{src:URL.createObjectURL(new Blob([n.documentElement.outerHTML],{type:"text/html"})),id:Gr});return r.addEventListener("load",(()=>{const{addEventListener:e}=r.contentDocument||r.contentWindow.document;e("click",t)})),r})(n,Kr(t)),c=$("div",{id:Wr});ns(s)||(s=(e=>{if(!e)return;const{uiTakeover:t=!1}=e;return{[Gr]:{style:{border:"none",width:"100%",height:"100%"},params:{enabled:!0,parentElement:"#alloy-messaging-container",insertionMethod:"appendChild"}},[Xr]:{style:Zr(e),params:{enabled:!0,parentElement:"body",insertionMethod:"appendChild"}},[Wr]:{style:es(e),params:{enabled:!0===t,parentElement:"body",insertionMethod:"appendChild"}}}})(r)),s&&((e,t,n,o)=>{[{id:Wr,element:o},{id:Xr,element:n},{id:Gr,element:e}].forEach((({id:e,element:n})=>{const{style:o={},params:r={}}=t[e];h(n.style,o);const{parentElement:s="body",insertionMethod:i="appendChild",enabled:a=!0}=r,c=document.querySelector(s);a&&c&&"function"==typeof c[i]&&c[i](n)}))})(a,s,i,c)};var rs=e=>({defaultContent:t=>((e,t)=>new Promise((n=>{const{meta:o}=e;os(e,((e,n)=>{const r={};r[co.INTERACT]=1,-1!==Object.values(co).indexOf(e)&&(r[e]=1),t({decisionsMeta:[o],propositionAction:n,eventType:so,propositionEventTypes:Object.keys(r)})})),n({meta:o})})))(t,e)});const ss=({config:e,logger:t,eventManager:n})=>{const{targetMigrationEnabled:o,prehidingStyle:r}=e,s=(({eventManager:e,mergeDecisionsMeta:t})=>({decisionsMeta:n=[],propositionAction:o,documentMayUnload:r=!1,eventType:s=ro,propositionEventTypes:i=[uo(s)],viewName:a})=>{const c=e.createEvent(),d={eventType:s};return a&&(d.web={webPageDetails:{viewName:a}}),U(n)&&t(c,n,i,o),c.mergeXdm(d),r&&c.documentMayUnload(),e.sendEvent(c)})({eventManager:n,mergeDecisionsMeta:Dr}),{getClickMetasBySelector:i,getClickSelectors:a,storeClickMetrics:c}=Tr(),d=(({window:e})=>()=>e.location)({window:window}),l={setHtml:Cr(pr),customCode:Cr(gr),setText:Cr(Uo),setAttribute:Cr(vr),setImageSource:Cr(wr),setStyle:Cr(yr),move:Cr(yr),resize:Cr(yr),rearrange:Cr(br),remove:Cr(Y),insertAfter:Cr(hr),insertBefore:Cr(mr),replaceHtml:Cr(fr),prependHtml:Cr(gr),appendHtml:Cr(ur)},u=(p=[Mr,Nr],e=>e?p.reduce(((e,t)=>h(e,t(e))),e):e);var p;const g=qr({preprocess:u,isPageWideSurface:Wn}),m=(({createProposition:e})=>{let t=!1,n=Promise.resolve({});const o=(t,n)=>{const o=t[n.toLowerCase()];return o&&o.length>0?o:[e({scope:n,scopeDetails:{characteristics:{scopeType:Ir}},items:[{schema:Yn}]},!1)]};return{createCacheUpdate:e=>{const r=D();return t=!0,n=n.then((e=>r.promise.then((t=>h({},e,t))).catch((()=>e)))),{update(t){const n=t.filter((e=>e.getScope())),s=ae(n,(e=>e.getScope().toLowerCase()));return r.resolve(s),e?o(s,e):[]},cancel(){r.reject()}}},getView:e=>n.then((t=>o(t,e))),isInitialized:()=>t}})({createProposition:g}),f=Qr(window),y={[Yn]:Ar,[Kn]:jr({modules:l,logger:t,storeClickMetrics:c}),[Zn]:Ur({modules:l,logger:t}),[eo]:Lr({logger:t,executeRedirect:f,collect:s}),[to]:zr({modules:rs(s),logger:t})},v=_r({schemaProcessors:y,logger:t}),w=(()=>{let e=Promise.resolve([]);return{concat(t){e=e.then((e=>t.then((t=>e.concat(t))).catch((()=>e))))},clear(){const t=e;return e=Promise.resolve([]),t}}})(),b=(({prehidingStyle:e,showContainers:t,hideContainers:n,mergeQuery:o,collect:r,processPropositions:s,createProposition:i,renderedPropositions:a})=>({cacheUpdate:c,personalizationDetails:d,event:l,onResponse:u})=>{let p;if(d.isRenderDecisions()?n(e):t(),o(l,d.createQueryDetails()),d.isSendDisplayEvent())p=e=>{e.length>0&&r({decisionsMeta:e,viewName:d.getViewName()})};else{const e=D();a.concat(e.promise),p=e.resolve}u((({response:e})=>{const n=e.getPayloadsByType("personalization:decisions").map((e=>i(e))),{page:o=[],view:r=[],proposition:a=[]}=ae(n,(e=>e.getScopeType())),l=c.update(r);let u,g,m;return d.isRenderDecisions()?(({render:u,returnedPropositions:g,returnedDecisions:m}=s([...o,...l],a)),u().then(p),t()):({returnedPropositions:g,returnedDecisions:m}=s([],[...o,...l,...a])),{propositions:g,decisions:m}}))})({prehidingStyle:r,showContainers:jo,hideContainers:Ao,mergeQuery:Sr,collect:s,processPropositions:v,createProposition:g,renderedPropositions:w}),C=(({mergeDecisionsMeta:e,collectClicks:t,getClickSelectors:n,getClickMetasBySelector:o})=>({event:r,clickedElement:s})=>{const i=n();if(U(i)){const{decisionsMeta:n,eventLabel:a,viewName:c}=t(s,i,o);if(U(n)){const t={eventType:so};c&&(t.web={webPageDetails:{viewName:c}}),r.mergeXdm(t),e(r,n,[co.INTERACT],a?{label:a}:void 0)}}})({mergeDecisionsMeta:Dr,collectClicks:Pr,getClickSelectors:a,getClickMetasBySelector:i}),E=(({processPropositions:e,viewCache:t})=>({personalizationDetails:n,onResponse:o})=>{let r,s;const i=n.getViewName();return o((()=>({propositions:r,decisions:s}))),t.getView(i).then((t=>{let o;return n.isRenderDecisions()?(({render:o,returnedPropositions:r,returnedDecisions:s}=e(t)),o()):(({returnedPropositions:r,returnedDecisions:s}=e([],t)),[])}))})({processPropositions:v,viewCache:m}),I=$r({processPropositions:v,createProposition:g,renderedPropositions:w,viewCache:m}),R=(({targetMigrationEnabled:e})=>e?e=>{e.getPayload().mergeMeta({target:{migration:!0}})}:fe)({targetMigrationEnabled:o}),k=(({processPropositions:e,createProposition:t,collect:n})=>({viewName:o,renderDecisions:r,propositions:s})=>{if(!r)return Promise.resolve();const i=s.map((e=>t(e,!0))),{render:a,returnedPropositions:c}=e(i);return a().then((e=>{e.length>0&&n({decisionsMeta:e,viewName:o})})),Promise.resolve({propositions:c})})({processPropositions:v,createProposition:g,collect:s});return go({getPageLocation:d,logger:t,fetchDataHandler:b,viewChangeHandler:E,onClickHandler:C,isAuthoringModeEnabled:Or,mergeQuery:Sr,viewCache:m,showContainers:jo,applyPropositions:I,setTargetMigration:R,mergeDecisionsMeta:Dr,renderedPropositions:w,onDecisionHandler:k})};ss.namespace="Personalization",ss.configValidators=Ot({prehidingStyle:Dt().nonEmpty(),targetMigrationEnabled:It().default(!1)});var is="__VERSION__",as=[["architecture","string"],["bitness","string"],["model","string"],["platformVersion","string"],["wow64","boolean"]];const cs=(e=>t=>{const n={webPageDetails:{URL:e.location.href||e.location},webReferrer:{URL:e.document.referrer}};I(t,{web:n})})(window),ds=(e=>t=>{const{screen:{width:n,height:o}}=e,r={},s=Pe(o);s>=0&&(r.screenHeight=s);const i=Pe(n);i>=0&&(r.screenWidth=i);const a=(e=>{const{screen:{orientation:t}}=e;if(null==t||null==t.type)return null;const n=t.type.split("-");return 0===n.length||"portrait"!==n[0]&&"landscape"!==n[0]?null:n[0]})(e)||(e=>{if(j(e.matchMedia)){if(e.matchMedia("(orientation: portrait)").matches)return"portrait";if(e.matchMedia("(orientation: landscape)").matches)return"landscape"}return null})(e);a&&(r.screenOrientation=a),Object.keys(r).length>0&&I(t,{device:r})})(window),ls=(e=>t=>{const{document:{documentElement:{clientWidth:n,clientHeight:o}={}}}=e,r={type:"browser"},s=Pe(n);s>=0&&(r.browserDetails={viewportWidth:s});const i=Pe(o);i>=0&&(r.browserDetails=r.browserDetails||{},r.browserDetails.viewportHeight=i),I(t,{environment:r})})(window),us=(ps=()=>new Date,e=>{const t=ps(),n={},o=Pe(t.getTimezoneOffset());void 0!==o&&(n.localTimezoneOffset=o),(void 0===o||Math.abs(o)<6e3)&&(n.localTime=(e=>{const t=e.getFullYear(),n=he(e.getMonth()+1,2,"0"),o=he(e.getDate(),2,"0"),r=he(e.getHours(),2,"0"),s=he(e.getMinutes(),2,"0"),i=he(e.getSeconds(),2,"0"),a=he(e.getMilliseconds(),3,"0"),c=Pe(e.getTimezoneOffset(),0);return`${t}-${n}-${o}T${r}:${s}:${i}.${a}${c>0?"-":"+"}${he(Math.floor(Math.abs(c)/60),2,"0")}:${he(Math.abs(c)%60,2,"0")}`})(t)),I(e,{placeContext:n})});var ps;const gs=(e=>t=>{const n=e().toISOString();I(t,{timestamp:n})})((()=>new Date)),ms={web:cs,device:ds,environment:ls,placeContext:us},fs={highEntropyUserAgentHints:(e=>(e=>void 0!==e.userAgentData)(e)?(t,n)=>{try{return e.userAgentData.getHighEntropyValues(as.map((e=>e[0]))).then((e=>{const n={};as.forEach((([t,o])=>{Object.prototype.hasOwnProperty.call(e,t)&&typeof e[t]===o&&(n[t]=e[t])})),I(t,{environment:{browserDetails:{userAgentClientHints:n}}})}))}catch(e){return n.warn(`Unable to collect user-agent client hints. ${e.message}`),fe}}:fe)(navigator)},hs={...ms,...fs},ys=[gs,e=>{I(e,{implementationDetails:{name:"https://ns.adobe.com/experience/alloy",version:is,environment:"browser"}})}],vs=({config:e,logger:t})=>((e,t,n,o)=>{const r=e.context,s=ne(r,((e,o)=>n[e]?[n[e]]:(t.warn(`Invalid context[${o}]: '${e}' is not available.`),[]))).concat(o);return{namespace:"Context",lifecycle:{onBeforeEvent({event:e}){const n={};return Promise.all(s.map((e=>Promise.resolve(e(n,t))))).then((()=>e.mergeXdm(n)))}}}})(e,t,hs,ys);vs.namespace="Context",vs.configValidators=Ot({context:Et(Dt()).default(Object.keys(ms))});const ws=e=>Array.isArray(e)?e.map((e=>ws(e))):"object"==typeof e&&null!==e?Object.keys(e).sort().reduce(((t,n)=>(t[n]=ws(e[n]),t)),{}):e;const bs=({standard:e,version:t})=>`${e}.${t}`;var Cs=({storage:e})=>({clear(){e.clear()},lookup(t){const n={},o=e=>{const t=bs(e),{standard:o,version:r,...s}=e;var i;return n[t]||(n[t]=(i=s,O(JSON.stringify(ws(i)))).toString()),n[t]};return{isNew:()=>t.some((t=>{const n=bs(t),r=e.getItem(n);return null===r||r!==o(t)})),save(){t.forEach((t=>{const n=bs(t);e.setItem(n,o(t))}))}}}}),Es=()=>{const e={},t=Dn({content:e,addIdentity:(t,n)=>{e.identityMap=e.identityMap||{},e.identityMap[t]=e.identityMap[t]||[],e.identityMap[t].push(n)},hasIdentity:t=>void 0!==(e.identityMap&&e.identityMap[t])});return t.setConsent=t=>{e.consent=t},t},Is=({payload:e,datastreamIdOverride:t})=>Pn({payload:e,datastreamIdOverride:t,getAction:()=>"privacy/set-consent",getUseSendBeacon:()=>!1}),Rs=e=>e.split(";").reduce(((e,t)=>{const[n,o]=t.split("=");return e[n]=o,e}),{}),ks=Ot({consent:Et(Ct()).required().nonEmpty(),identityMap:Tt,edgeConfigOverrides:xt}).noUnknownFields().required();const Ps=({config:e,consent:t,sendEdgeNetworkRequest:n,createNamespacedStorage:o})=>{const{orgId:r,defaultConsent:s}=e,i=(({parseConsentCookie:e,orgId:t,cookieJar:n})=>{const o=ie(t,"consent");return{read(){const t=n.get(o);return t?e(t):{}},clear(){n.remove(o)}}})({parseConsentCookie:Rs,orgId:r,cookieJar:w}),a=(()=>{let e=0,t=Promise.resolve();return{addTask(n){e+=1;const o=()=>n().finally((()=>{e-=1}));return t=t.then(o,o),t},get length(){return e}}})(),c=(({createConsentRequestPayload:e,createConsentRequest:t,sendEdgeNetworkRequest:n,edgeConfigOverrides:o})=>({consentOptions:r,identityMap:s,edgeConfigOverrides:i})=>{const a=xn({payload:e(),globalConfigOverrides:o,localConfigOverrides:i});a.payload.setConsent(r),C(s)&&Object.keys(s).forEach((e=>{s[e].forEach((t=>{a.payload.addIdentity(e,t)}))}));const c=t(a);return n({request:c}).then((()=>{}))})({createConsentRequestPayload:Es,createConsentRequest:Is,sendEdgeNetworkRequest:n,edgeConfigOverrides:e.edgeConfigOverrides}),d=o(`${se(r)}.consentHashes.`),l=Cs({storage:d.persistent}),u=ce({orgId:r});return(({storedConsent:e,taskQueue:t,defaultConsent:n,consent:o,sendSetConsentRequest:r,validateSetConsentOptions:s,consentHashStore:i,doesIdentityCookieExist:a})=>{const c={[Lt]:n};let d=e.read();const l=a(),u=void 0!==d.general;l&&u||i.clear(),l||(e.clear(),d={}),o.initializeConsent(c,d);const p=()=>{if(0===t.length){const t=e.read();void 0!==t.general&&o.setConsent(t)}};return{commands:{setConsent:{optionsValidator:s,run:({consent:e,identityMap:n,edgeConfigOverrides:s})=>{o.suspend();const a=i.lookup(e);return t.addTask((()=>a.isNew()?r({consentOptions:e,identityMap:n,edgeConfigOverrides:s}):Promise.resolve())).then((()=>a.save())).finally(p)}}},lifecycle:{onResponse:p,onRequestFailure:p}}})({storedConsent:i,taskQueue:a,defaultConsent:s,consent:t,sendSetConsentRequest:c,validateSetConsentOptions:ks,consentHashStore:l,doesIdentityCookieExist:u})};Ps.namespace="Privacy";var Os=()=>({eventMergeId:Ue()});const Ds=()=>(({createEventMergeId:e})=>({commands:{createEventMergeId:{run:e}}}))({createEventMergeId:Os});Ds.namespace="EventMerge";const Ss=({config:e,componentRegistry:t})=>{const n=(({config:e,componentRegistry:t})=>{const n=[...t.getCommandNames(),Xt,Wt].sort(),o={...e};return Object.keys(e).forEach((t=>{const n=e[t];"function"==typeof n&&(o[t]=n.toString())})),{version:is,configs:o,commands:n}})({config:e,componentRegistry:t});return{commands:{getLibraryInfo:{run:()=>({libraryInfo:n})}}}};Ss.namespace="LibraryInfo";var Ts=({response:e})=>({inferences:e.getPayloadsByType("rtml:inferences")});const xs=()=>({lifecycle:{onResponse:Ts},commands:{}});xs.namespace="MachineLearning";var $s=[Zt,gn,An,Ln,ss,vs,Ps,Ds,Ss,xs].filter((e=>void 0!==e));var Ns=({options:e,componentCreators:t,coreConfigValidators:n,createConfig:o,logger:r,setDebugEnabled:s})=>{const i=(e=>{const t=[],n={get enabled(){return e.enabled},flush(){t.forEach((({method:t,args:n})=>e[t](...n)))}};return Object.keys(e).filter((t=>"function"==typeof e[t])).forEach((e=>{n[e]=(...n)=>{t.push({method:e,args:n})}})),n})(r),a=t.map((({configValidators:e})=>e)).filter((e=>e)).reduce(((e,t)=>e.concat(t)),n),c=o((({combinedConfigValidator:e,options:t,logger:n})=>{try{return e.noUnknownFields().required().call({logger:n},t)}catch(e){throw new Error(`Resolve these configuration problems:\n\t - ${e.message.split("\n").join("\n\t - ")}\nFor configuration documentation see: https://adobe.ly/3sHh553`)}})({combinedConfigValidator:a,options:e,logger:i}));s(c.debugEnabled,{fromConfig:!0}),i.flush();const d=((e,t,n)=>n.reduce(((n,{buildOnInstanceConfiguredExtraParams:o})=>(o&&h(n,o({config:e,logger:t})),n)),{}))(c,r,t);return r.logOnInstanceConfigured({...d,config:c}),c};const Ms=e=>h({},e);var qs=({errorPrefix:e,logger:t})=>(n,o)=>{const r=Ie(n);if(r.code===_t)return t.warn(`The ${o} could not fully complete. ${r.message}`),{};throw Re({error:r,message:`${e} ${r.message}`}),r},As=({getDebugEnabled:e,console:t,getMonitors:n,context:o})=>{let r=`[${o.instanceName}]`;o.componentName&&(r+=` [${o.componentName}]`);const s=(e,t)=>{const r=n();if(r.length>0){const n=h({},o,t);r.forEach((t=>{t[e]&&t[e](n)}))}},i=(n,...o)=>{s("onBeforeLog",{level:n,arguments:o}),e()&&t[n](r,...o)};return{get enabled(){return n().length>0||e()},logOnInstanceCreated(e){s("onInstanceCreated",e),i("info","Instance initialized.")},logOnInstanceConfigured(e){s("onInstanceConfigured",e),i("info","Instance configured. Computed configuration:",e.config)},logOnBeforeCommand(e){s("onBeforeCommand",e),i("info",`Executing ${e.commandName} command. Options:`,e.options)},logOnCommandResolved(e){s("onCommandResolved",e),i("info",`${e.commandName} command resolved. Result:`,e.result)},logOnCommandRejected(e){s("onCommandRejected",e),i("error",`${e.commandName} command was rejected. Error:`,e.error)},logOnBeforeNetworkRequest(e){s("onBeforeNetworkRequest",e),i("info",`Request ${e.requestId}: Sending request.`,e.payload)},logOnNetworkResponse(e){s("onNetworkResponse",e);const t=e.parsedBody||e.body?"response body:":"no response body.";i("info",`Request ${e.requestId}: Received response with status code ${e.statusCode} and ${t}`,e.parsedBody||e.body)},logOnNetworkError(e){s("onNetworkError",e),i("error",`Request ${e.requestId}: Network request failed.`,e.error)},info:i.bind(null,"info"),warn:i.bind(null,"warn"),error:i.bind(null,"error")}};const js="Event was canceled because the onBeforeEventSend callback returned false.";var Us=({orgId:e,targetMigrationEnabled:t})=>n=>((e,t)=>0===t.indexOf(`kndctr_${se(e)}_`))(e,n)||"at_qa_mode"===n||t&&"mbox"===n,Ls=e=>{const t=e.shift()||[],n=e.shift()||[];return h({},...t,...n,...e)},_s=e=>t=>{const n=()=>{throw t};return e.call({error:t}).then(n,n)};const Bs="The server responded with a";var Fs=({orgId:e,cookieJar:t})=>{const n=ie(e,"cluster");return()=>t.get(n)||(()=>{const e=t.get("mboxEdgeCluster");if(e)return`t${e}`})()};const Hs=[429,503,502,504];var Vs=({response:e,retriesAttempted:t})=>t<3&&r(Hs,e.statusCode);var zs=({response:e,retriesAttempted:t})=>{let n=(e=>{const t=e.getHeader("Retry-After");let n;if(t){const e=parseInt(t,10);n=pe(e)?1e3*e:Math.max(0,new Date(t).getTime()-(new Date).getTime())}return n})(e);return void 0===n&&(n=(e=>{const t=1e3+1e3*e,n=.3*t,o=t-n,r=t+n;return Math.round(o+Math.random()*(r-o))})(t)),n};const Js=(Qs=window,e=>{const t=oe+e;return{session:de(Qs,"sessionStorage",t),persistent:de(Qs,"localStorage",t)}});var Qs;const{console:Xs,fetch:Ws,navigator:Gs,XMLHttpRequest:Ys}=window,Ks=()=>window.__alloyMonitors||[],Zs=Ot({debugEnabled:It().default(!1),defaultConsent:St(jt,"out",Ut).default(jt),datastreamId:Dt().unique().required(),edgeDomain:Dt().domain().default("edge.adobedc.net"),edgeBasePath:Dt().nonEmpty().default("ee"),orgId:Dt().unique().required(),personalizationStorageEnabled:It().default(!0),onBeforeEventSend:Rt().default(fe),edgeConfigOverrides:xt}).deprecated("edgeConfigId",Dt().unique(),"datastreamId"),ei=((e,t)=>{let n="";const o=e.location.hostname.toLowerCase().split(".");let r=1;for(;r<o.length&&!t.get(re);)r+=1,n=(s=o,i=r,s.slice(-i)).join("."),t.set(re,re,{domain:n});var s,i;return t.remove(re,{domain:n}),n})(window,w),ti=j(Ws)?(({fetch:e})=>(t,n)=>e(t,{method:"POST",cache:"no-cache",credentials:"include",headers:{"Content-Type":"text/plain; charset=UTF-8"},referrerPolicy:"no-referrer-when-downgrade",body:n}).then((e=>e.text().then((t=>({statusCode:e.status,getHeader:t=>e.headers.get(t),body:t}))))))({fetch:Ws}):(({XMLHttpRequest:e})=>(t,n)=>new Promise(((o,r)=>{const s=new e;s.onreadystatechange=()=>{4===s.readyState&&(0===s.status?r(new Error("Request aborted.")):o({statusCode:s.status,getHeader:e=>s.getResponseHeader(e),body:s.responseText}))},s.onloadstart=()=>{s.responseType="text"},s.open("POST",t,!0),s.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),s.withCredentials=!0,s.onerror=r,s.onabort=r,s.send(n)})))({XMLHttpRequest:Ys}),ni=(({appendNode:e=x,awaitSelector:t=G,createNode:n=$,fireImage:o=A}={})=>{const r=o;let s;const i=({src:r})=>t("BODY").then((([t])=>s||(s=n("IFRAME",K,Z),e(t,s)))).then((e=>{const t=e.contentWindow.document;return o({src:r,currentDocument:t})}));return e=>{const{hideReferrer:t,url:n}=e;return t?i({src:n}):r({src:n})}})(),oi=(({window:e,createNamespacedStorage:t})=>{const n=t("validation.");return()=>{const t=Ee.parse(e.location.search).adb_validation_sessionid;if(!t)return"";const o=(e=>{let t=e.persistent.getItem($n);return t||(t=Ue(),e.persistent.setItem($n,t)),t})(n),r=`${t}|${o}`;return`&${Ee.stringify({adobeAepValidationToken:r})}`}})({window:window,createNamespacedStorage:Js}),ri=({instanceName:e,logController:{setDebugEnabled:t,logger:n,createComponentLogger:o}})=>{const r=At(),s=Mt(r),i=P({logger:n,cookieJar:w}),a=qs({errorPrefix:`[${e}]`,logger:n}),c=Gt({logger:n,configureCommand:a=>{const c=Ns({options:a,componentCreators:$s,coreConfigValidators:Zs,createConfig:Ms,logger:n,setDebugEnabled:t}),{orgId:d,targetMigrationEnabled:l}=c,u=Us({orgId:d,targetMigrationEnabled:l}),p=(({cookieJar:e,shouldTransferCookie:t,apexDomain:n,dateProvider:o})=>({cookiesToPayload(o,r){const s=(i=n,r.substr(-i.length)===i);var i;const a={domain:n,cookiesEnabled:!0};if(!s){const n=e.get(),o=Object.keys(n).filter(t).map((e=>({key:e,value:n[e]})));o.length&&(a.entries=o)}o.mergeState(a)},responseToCookies(t){t.getPayloadsByType("state:store").forEach((t=>{const r={domain:n},s=t.attrs&&t.attrs.SameSite&&t.attrs.SameSite.toLowerCase();void 0!==t.maxAge&&(r.expires=new Date(o().getTime()+1e3*t.maxAge)),void 0!==s&&(r.sameSite=s),"none"===s&&(r.secure=!0),e.set(t.key,t.value,r)}))}}))({cookieJar:i,shouldTransferCookie:u,apexDomain:ei,dateProvider:()=>new Date}),g=j(Gs.sendBeacon)?(({sendBeacon:e,sendFetchRequest:t,logger:n})=>(o,r)=>{const s=new Blob([r],{type:"text/plain; charset=UTF-8"});return e(o,s)?Promise.resolve({statusCode:204,getHeader:()=>null,body:""}):(n.info("Unable to use `sendBeacon`; falling back to `fetch`."),t(o,r))})({sendBeacon:Gs.sendBeacon.bind(Gs),sendFetchRequest:ti,logger:n}):ti,m=(({logger:e,sendFetchRequest:t,sendBeaconRequest:n,isRequestRetryable:o,getRequestRetryDelay:r})=>({requestId:s,url:i,payload:a,useSendBeacon:c})=>{const d=JSON.stringify(a),l=JSON.parse(d);e.logOnBeforeNetworkRequest({url:i,requestId:s,payload:l});const u=(a=0)=>(c?n:t)(i,d).then((t=>{if(o({response:t,retriesAttempted:a})){const e=r({response:t,retriesAttempted:a});return new Promise((t=>{setTimeout((()=>{t(u(a+1))}),e)}))}let n;try{n=JSON.parse(t.body)}catch(e){}return e.logOnNetworkResponse({requestId:s,url:i,payload:l,...t,parsedBody:n,retriesAttempted:a}),{statusCode:t.statusCode,body:t.body,parsedBody:n,getHeader:t.getHeader}}));return u().catch((t=>{throw e.logOnNetworkError({requestId:s,url:i,payload:l,error:t}),ke({error:t,message:"Network request failed."})}))})({logger:n,sendFetchRequest:ti,sendBeaconRequest:g,isRequestRetryable:Vs,getRequestRetryDelay:zs}),f=(({logger:e})=>t=>{const{statusCode:n,body:o,parsedBody:r}=t;if(n<200||n>=300||!r&&204!==n||r&&!Array.isArray(r.handle)){const e=r?JSON.stringify(r,null,2):o;throw new Error(`${Bs} status code ${n} and ${e?`response body:\n${e}`:"no response body."}`)}if(r){const{warnings:t=[],errors:n=[]}=r;t.forEach((t=>{e.warn(`${Bs} warning:`,t)})),n.forEach((t=>{e.error(`${Bs} non-fatal error:`,t)}))}})({logger:n}),h=(({logger:e})=>t=>{if(t){const n=t.split(";");if(n.length>=2&&n[1].length>0)try{const e=parseInt(n[1],10);if(!isNaN(e))return{regionId:e}}catch(e){}e.warn(`Invalid adobe edge: "${t}"`)}return{}})({logger:n}),y=(({extractEdgeInfo:e})=>({content:t={},getHeader:n})=>{const{handle:o=[],errors:r=[],warnings:s=[]}=t;return{getPayloadsByType:e=>ne(o.filter((t=>t.type===e)),(e=>e.payload)),getErrors:()=>r,getWarnings:()=>s,getEdge:()=>e(n("x-adobe-edge")),toJSON:()=>t}})({extractEdgeInfo:h}),v=Fs({orgId:d,cookieJar:w}),b=(({config:e,lifecycle:t,cookieTransfer:n,sendNetworkRequest:o,createResponse:r,processWarningsAndErrors:s,getLocationHint:i,getAssuranceValidationTokenParams:a})=>{const{edgeDomain:c,edgeBasePath:d,datastreamId:l}=e;return({request:e,runOnResponseCallbacks:u=fe,runOnRequestFailureCallbacks:p=fe})=>{const g=k();g.add(t.onResponse),g.add(u);const m=k();return m.add(t.onRequestFailure),m.add(p),t.onBeforeRequest({request:e,onResponse:g.add,onRequestFailure:m.add}).then((()=>{const t=e.getUseIdThirdPartyDomain()?"adobedc.demdex.net":c,r=i(),s=r?`${d}/${r}`:d,u=e.getDatastreamIdOverride()||l,p=e.getPayload();u!==l&&p.mergeMeta({sdkConfig:{datastream:{original:l}}});const g=`https://${t}/${s}/v1/${e.getAction()}?configId=${u}&requestId=${e.getId()}${a()}`;return n.cookiesToPayload(p,t),o({requestId:e.getId(),url:g,payload:p,useSendBeacon:e.getUseSendBeacon()})})).then((e=>(s(e),e))).catch(_s(m)).then((({parsedBody:e,getHeader:t})=>{const o=r({content:e,getHeader:t});return n.responseToCookies(o),g.call({response:o}).then(Ls)}))}})({config:c,lifecycle:s,cookieTransfer:p,sendNetworkRequest:m,createResponse:y,processWarningsAndErrors:f,getLocationHint:v,getAssuranceValidationTokenParams:oi}),C=(({cookieTransfer:e,lifecycle:t,createResponse:n,processWarningsAndErrors:o})=>({request:r,responseHeaders:s,responseBody:i,runOnResponseCallbacks:a=fe,runOnRequestFailureCallbacks:c=fe})=>{const d=k();d.add(t.onResponse),d.add(a);const l=k();l.add(t.onRequestFailure),l.add(c);const u=e=>s[e];return t.onBeforeRequest({request:r,onResponse:d.add,onRequestFailure:l.add}).then((()=>o({statusCode:200,getHeader:u,body:JSON.stringify(i),parsedBody:i}))).catch(_s(l)).then((()=>{const t=n({content:i,getHeader:u});return e.responseToCookies(t),d.call({response:t}).then(Ls)}))})({lifecycle:s,cookieTransfer:p,createResponse:y,processWarningsAndErrors:f}),E=(({generalConsentState:e,logger:t})=>{const n=(n,o)=>{switch(n.general){case jt:e.in(o);break;case"out":e.out(o);break;case Ut:e.pending(o);break;default:t.warn(`Unknown consent value: ${n.general}`)}};return{initializeConsent(e,t){t.general?n(t,Ft):n(e,Bt)},setConsent(e){n(e,Ht)},suspend(){e.pending()},awaitConsent:()=>e.awaitConsent(),withConsent:()=>e.withConsent()}})({generalConsentState:zt({logger:n}),logger:n}),I=(({config:e,logger:t,lifecycle:n,consent:o,createEvent:r,createDataCollectionRequestPayload:s,createDataCollectionRequest:i,sendEdgeNetworkRequest:a,applyResponse:c})=>{const{onBeforeEventSend:d,edgeConfigOverrides:l}=e;return{createEvent:r,sendEvent(e,r={}){const{edgeConfigOverrides:c,...u}=r,p=xn({payload:s(),localConfigOverrides:c,globalConfigOverrides:l}),g=i(p),m=k(),f=k();return n.onBeforeEvent({...u,event:e,onResponse:m.add,onRequestFailure:f.add}).then((()=>(p.payload.addEvent(e),o.awaitConsent()))).then((()=>{try{e.finalize(d)}catch(e){const t=()=>{throw e};return f.add(n.onRequestFailure),f.call({error:e}).then(t,t)}if(!e.shouldSend()){f.add(n.onRequestFailure),t.info(js);const e=new Error(js);return f.call({error:e}).then((()=>{}))}return a({request:g,runOnResponseCallbacks:m.call,runOnRequestFailureCallbacks:f.call})}))},applyResponse(e,t={}){const{renderDecisions:o=!1,decisionContext:r={},responseHeaders:a={},responseBody:d={handle:[]},personalization:l}=t,u=s(),p=i({payload:u}),g=k();return n.onBeforeEvent({event:e,renderDecisions:o,decisionContext:r,decisionScopes:[Gn],personalization:l,onResponse:g.add,onRequestFailure:fe}).then((()=>(u.addEvent(e),c({request:p,responseHeaders:a,responseBody:d,runOnResponseCallbacks:g.call}))))}}})({config:c,logger:n,lifecycle:s,consent:E,createEvent:Qt,createDataCollectionRequestPayload:Tn,createDataCollectionRequest:On,sendEdgeNetworkRequest:b,applyResponse:C});return(({componentCreators:e,lifecycle:t,componentRegistry:n,getImmediatelyAvailableTools:o})=>(e.forEach((e=>{const{namespace:t}=e,r=o(t);let s;try{s=e(r)}catch(e){throw ke({error:e,message:`[${t}] An error occurred during component creation.`})}n.register(t,s)})),t.onComponentsRegistered({lifecycle:t}).then((()=>n))))({componentCreators:$s,lifecycle:s,componentRegistry:r,getImmediatelyAvailableTools(t){const n=o(t);return{config:c,componentRegistry:r,consent:E,eventManager:I,fireReferrerHideableImage:ni,logger:n,lifecycle:s,sendEdgeNetworkRequest:b,handleError:qs({errorPrefix:`[${e}] [${t}]`,logger:n}),createNamespacedStorage:Js,apexDomain:ei}}})},setDebugCommand:e=>{t(e.enabled,{fromConfig:!1})},handleError:a,validateCommandOptions:Kt});return c};(()=>{const e=window.__alloyNS;e&&e.forEach((e=>{const t=$t({console:Xs,locationSearch:window.location.search,createLogger:As,instanceName:e,createNamespacedStorage:Js,getMonitors:Ks}),n=(e=>t=>{const n=t[0],o=t[1],r=t[2],s=r[0],i=r[1];e(s,i).then(n,o)})(ri({instanceName:e,logController:t})),o=window[e].q;o.push=n,t.logger.logOnInstanceCreated({instance:n}),o.forEach(n)}))})()}();
