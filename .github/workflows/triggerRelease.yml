name: Trigger Release
on:
  project_card:
    types: [moved]
  push:
    branches:
      - main
      - "v[0-9]+"
      - "v[0-9]+.[0-9]+"
  workflow_dispatch:

jobs:
  createTestBranch:
    name: Create test branch from release tag
    runs-on: ubuntu-latest
    steps:
      - uses: gagle/package-version@v1
        id: package-version
      - uses: peterjgrainger/action-create-branch@v2.0.1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          branch: ${{ steps.package-version.outputs.version }}
  triggerReleaseIfNeeded:
    name: "Trigger Release If Needed"
    runs-on: ubuntu-latest
    steps:
      - uses: adobe/project-card-release-automation/trigger-release@v1
        with:
          token: ${{ secrets.ALLOY_BOT_GITHUB_TOKEN }}
          workflowId: "deployRelease.yml"
          projectNumber: 7
