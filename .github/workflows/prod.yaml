name: Prod
on:
  schedule:
    - cron: "0 */24 * * *"
  workflow_dispatch:
env:
  SAUCE_USERNAME: ${{ secrets.SAUCE_USERNAME }}
  SAUCE_ACCESS_KEY: ${{ secrets.SAUCE_ACCESS_KEY }}
  SAUCE_JOB: "Alloy Prod Workflow"
  SAUCE_CAPABILITIES_OVERRIDES_PATH: 'sauceLabsCapabilities.json'
  ALLOY_ENV: prod

jobs:
  get_testing_tags:
    name: Fetch releases
    runs-on: macos-latest
    outputs:
      tagsToTest: ${{ steps.list_tags_working.outputs.tagsToTest }}
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - run: npm install @octokit/rest semver
      - name: Retrieve tags
        id: list_tags_working
        uses: actions/github-script@v3
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const tagsToTest = fromJson($(./scripts/getTestingTags.js));
            core.setOutput("tagsToTest", tagsToTest);
            console.log("tagsToTest: ", tagsToTest);
