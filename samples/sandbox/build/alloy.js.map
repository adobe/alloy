{"version":3,"file":"alloy.js","sources":["../../src/core/createInstanceFunction.js","../../src/constants/browser.js","../../src/utils/includes.js","../../src/utils/areThirdPartyCookiesSupportedByDefault.js","../../node_modules/object-assign/index.js","../../node_modules/@adobe/reactor-object-assign/index.js","../../node_modules/js-cookie/src/js.cookie.js","../../node_modules/@adobe/reactor-cookie/index.js","../../src/utils/isNil.js","../../src/utils/isObject.js","../../src/utils/deepAssign.js","../../src/utils/createMerger.js","../../src/utils/createCallbackAggregator.js","../../src/utils/createLoggingCookieJar.js","../../src/utils/createTaskQueue.js","../../src/utils/crc32.js","../../src/utils/defer.js","../../src/utils/endsWith.js","../../src/utils/find.js","../../src/utils/dom/appendNode.js","../../src/utils/dom/createNode.js","../../src/constants/tagName.js","../../src/utils/fireImage.js","../../src/utils/isFunction.js","../../src/utils/isNonEmptyArray.js","../../src/utils/toArray.js","../../src/utils/dom/querySelectorAll.js","../../src/utils/startsWith.js","../../src/constants/shadowSeparator.js","../../src/utils/dom/selectNodesWithShadow.js","../../src/utils/dom/isShadowSelector.js","../../src/utils/dom/selectNodes.js","../../src/utils/dom/awaitSelector.js","../../src/utils/dom/matchesSelector.js","../../src/utils/dom/removeNode.js","../../src/utils/injectFireReferrerHideableImage.js","../../src/utils/flatMap.js","../../src/constants/namespace.js","../../src/utils/getLastArrayItems.js","../../src/utils/getApexDomain.js","../../src/constants/cookieNamePrefix.js","../../src/utils/sanitizeOrgIdForCookieName.js","../../src/utils/getNamespacedCookieName.js","../../src/constants/cookieNameKey.js","../../src/utils/injectDoesIdentityCookieExist.js","../../src/utils/injectStorage.js","../../src/utils/intersection.js","../../src/utils/isBoolean.js","../../src/utils/isEmptyObject.js","../../src/utils/isNumber.js","../../src/utils/isInteger.js","../../src/utils/isNamespacedCookieName.js","../../src/utils/isString.js","../../src/utils/isNonEmptyString.js","../../src/utils/memoize.js","../../src/utils/noop.js","../../src/utils/padStart.js","../../node_modules/querystring/decode.js","../../node_modules/querystring/encode.js","../../node_modules/querystring/index.js","../../node_modules/@adobe/reactor-query-string/index.js","../../src/utils/toError.js","../../src/utils/updateErrorMessage.js","../../src/utils/stackError.js","../../src/utils/stringToBoolean.js","../../src/utils/toInteger.js","../../src/utils/toISOStringLocal.js","../../node_modules/uuid/lib/rng-browser.js","../../node_modules/uuid/lib/bytesToUuid.js","../../node_modules/uuid/v4.js","../../src/utils/validation/chain.js","../../src/utils/validation/nullSafeChain.js","../../src/utils/validation/assertValid.js","../../src/utils/validation/booleanValidator.js","../../src/utils/validation/callbackValidator.js","../../src/utils/validation/createArrayOfValidator.js","../../src/utils/validation/createDefaultValidator.js","../../src/utils/validation/createLiteralValidator.js","../../src/utils/validation/createMapOfValuesValidator.js","../../src/utils/validation/createMinimumValidator.js","../../src/utils/validation/createNoUnknownFieldsValidator.js","../../src/utils/validation/createNonEmptyValidator.js","../../src/utils/validation/createObjectOfValidator.js","../../src/utils/validation/createAnyOfValidator.js","../../src/utils/validation/createUniqueValidator.js","../../src/utils/validation/domainValidator.js","../../src/utils/validation/integerValidator.js","../../src/utils/validation/numberValidator.js","../../src/utils/isValidRegExp.js","../../src/utils/validation/regexpValidator.js","../../src/utils/validation/requiredValidator.js","../../src/utils/validation/stringValidator.js","../../src/utils/validation/index.js","../../src/constants/identityMapAuthenticatedState.js","../../src/utils/validateIdentityMap.js","../../src/constants/debugQueryParam.js","../../src/core/createLogController.js","../../src/core/createLifecycle.js","../../src/core/createComponentRegistry.js","../../src/core/network/injectSendNetworkRequest.js","../../src/core/edgeNetwork/injectExtractEdgeInfo.js","../../src/constants/consentStatus.js","../../src/constants/consentPurpose.js","../../src/core/consent/createConsentStateMachine.js","../../src/core/consent/createConsent.js","../../src/core/createEvent.js","../../src/constants/httpHeaderNames.js","../../src/core/injectCreateResponse.js","../../src/constants/coreCommands.js","../../src/core/injectExecuteCommand.js","../../src/core/validateCommandOptions.js","../../src/components/DataCollector/validateUserEventOptions.js","../../src/components/DataCollector/index.js","../../src/components/ActivityCollector/attachClickActivityCollector.js","../../src/components/ActivityCollector/configValidators.js","../../src/components/ActivityCollector/utils.js","../../src/components/ActivityCollector/createLinkClick.js","../../src/components/ActivityCollector/index.js","../../src/components/Identity/injectProcessIdSyncs.js","../../src/components/Identity/configValidators.js","../../src/components/Identity/getIdentity/getIdentityOptionsValidator.js","../../src/components/Identity/appendIdentityToUrl/appendIdentityToUrlOptionsValidator.js","../../src/components/Identity/createComponent.js","../../src/components/Identity/createLegacyIdentity.js","../../src/components/Identity/visitorService/awaitVisitorOptIn.js","../../src/components/Identity/visitorService/getVisitor.js","../../src/components/Identity/visitorService/injectGetEcidFromVisitor.js","../../src/components/Identity/injectHandleResponseForIdSyncs.js","../../src/components/Identity/injectEnsureSingleIdentity.js","../../src/constants/ecidNamespace.js","../../src/components/Identity/addEcidQueryToPayload.js","../../src/utils/getBrowser.js","../../src/components/Identity/injectSetDomainForInitialIdentityPayload.js","../../src/components/Identity/injectAddLegacyEcidToPayload.js","../../src/constants/queryStringIdentityParam.js","../../src/components/Identity/injectAddQueryStringIdentityToPayload.js","../../src/components/Identity/addEcidToPayload.js","../../src/components/Identity/injectAwaitIdentityCookie.js","../../src/components/Identity/getEcidFromResponse.js","../../src/components/Identity/getIdentity/createGetIdentity.js","../../src/utils/request/createAddIdentity.js","../../src/utils/request/createRequest.js","../../src/utils/request/createDataCollectionRequest.js","../../src/utils/request/createRequestPayload.js","../../src/utils/request/createHasIdentity.js","../../src/utils/request/createDataCollectionRequestPayload.js","../../src/components/Identity/getIdentity/createIdentityRequest.js","../../src/components/Identity/getIdentity/createIdentityRequestPayload.js","../../src/components/Identity/appendIdentityToUrl/injectAppendIdentityToUrl.js","../../src/components/Identity/index.js","../../src/components/Audiences/injectProcessDestinations.js","../../src/components/Audiences/injectProcessResponse.js","../../src/components/Audiences/index.js","../../src/components/Personalization/constants/scope.js","../../src/components/Personalization/constants/schema.js","../../src/components/Personalization/createPersonalizationDetails.js","../../src/components/Personalization/constants/loggerMessage.js","../../src/components/Personalization/validateApplyPropositionsOptions.js","../../src/components/Personalization/createComponent.js","../../src/components/Personalization/dom-actions/dom/createFragment.js","../../node_modules/css.escape/css.escape.js","../../src/components/Personalization/dom-actions/dom/helperForEq.js","../../src/components/Personalization/dom-actions/dom/selectNodesWithEq.js","../../src/components/Personalization/dom-actions/dom/getElementById.js","../../src/components/Personalization/dom-actions/dom/setAttribute.js","../../src/components/Personalization/dom-actions/dom/getAttribute.js","../../src/components/Personalization/dom-actions/dom/removeAttribute.js","../../src/components/Personalization/dom-actions/dom/setStyle.js","../../src/components/Personalization/dom-actions/dom/getParent.js","../../src/components/Personalization/dom-actions/dom/getNextSibling.js","../../src/components/Personalization/dom-actions/dom/insertAfter.js","../../src/components/Personalization/dom-actions/dom/insertBefore.js","../../src/components/Personalization/dom-actions/dom/getChildren.js","../../src/components/Personalization/dom-actions/dom/getChildNodes.js","../../src/components/Personalization/dom-actions/dom/getFirstChild.js","../../src/components/Personalization/dom-actions/dom/getNonce.js","../../src/components/Personalization/flicker/index.js","../../src/components/Personalization/dom-actions/setText.js","../../src/constants/elementAttribute.js","../../src/components/Personalization/dom-actions/images.js","../../src/components/Personalization/dom-actions/addNonceToInlineStyleElements.js","../../node_modules/@adobe/reactor-promise/node_modules/promise-polyfill/src/finally.js","../../node_modules/@adobe/reactor-promise/node_modules/promise-polyfill/src/index.js","../../node_modules/@adobe/reactor-promise/index.js","../../node_modules/@adobe/reactor-load-script/index.js","../../src/components/Personalization/dom-actions/scripts.js","../../src/components/Personalization/dom-actions/appendHtml.js","../../src/components/Personalization/dom-actions/setHtml.js","../../src/components/Personalization/dom-actions/prependHtml.js","../../src/components/Personalization/dom-actions/insertHtmlBefore.js","../../src/components/Personalization/dom-actions/replaceHtml.js","../../src/components/Personalization/dom-actions/insertHtmlAfter.js","../../src/components/Personalization/dom-actions/setStyles.js","../../src/components/Personalization/dom-actions/setAttributes.js","../../src/components/Personalization/dom-actions/swapImage.js","../../src/components/Personalization/dom-actions/rearrangeChildren.js","../../src/components/Personalization/dom-actions/click.js","../../src/components/Personalization/dom-actions/action.js","../../src/components/Personalization/dom-actions/initDomActionsModules.js","../../src/utils/isBlankString.js","../../src/components/Personalization/dom-actions/remapHeadOffers.js","../../src/components/Personalization/dom-actions/executeActions.js","../../src/components/Personalization/constants/eventType.js","../../src/components/Personalization/createCollect.js","../../src/components/Personalization/createExecuteDecisions.js","../../src/components/Personalization/createFetchDataHandler.js","../../src/components/Personalization/dom-actions/dom/matchesSelectorWithEq.js","../../src/components/Personalization/dom-actions/clicks/collectClicks.js","../../src/components/Personalization/utils/isAuthoringModeEnabled.js","../../src/components/Personalization/event.js","../../src/components/Personalization/createOnClickHandler.js","../../src/components/Personalization/createViewCacheManager.js","../../src/components/Personalization/utils/addRenderAttemptedToDecisions.js","../../src/components/Personalization/utils/composePersonalizationResultingObject.js","../../src/components/Personalization/createViewChangeHandler.js","../../src/components/Personalization/constants/scopeType.js","../../src/components/Personalization/groupDecisions.js","../../src/components/Personalization/createOnResponseHandler.js","../../src/components/Personalization/createClickStorage.js","../../src/components/Personalization/createRedirectHandler.js","../../src/components/Personalization/createAutoRenderingHandler.js","../../src/components/Personalization/createNonRenderingHandler.js","../../src/components/Personalization/createApplyPropositions.js","../../src/components/Personalization/index.js","../../src/components/Context/injectWeb.js","../../src/components/Context/injectDevice.js","../../src/components/Context/injectEnvironment.js","../../src/components/Context/injectPlaceContext.js","../../src/components/Context/injectTimestamp.js","../../src/constants/libraryName.js","../../src/constants/libraryVersion.js","../../src/components/Context/implementationDetails.js","../../src/components/Context/createComponent.js","../../src/components/Context/index.js","../../src/components/Privacy/createComponent.js","../../src/components/Privacy/computeConsentHash.js","../../src/components/Privacy/createConsentHashStore.js","../../src/components/Privacy/createConsentRequestPayload.js","../../src/components/Privacy/createConsentRequest.js","../../src/components/Privacy/createStoredConsent.js","../../src/components/Privacy/injectSendSetConsentRequest.js","../../src/components/Privacy/parseConsentCookie.js","../../src/components/Privacy/validateSetConsentOptions.js","../../src/components/Privacy/index.js","../../src/components/EventMerge/createEventMergeId.js","../../src/components/EventMerge/createComponent.js","../../src/components/EventMerge/index.js","../../src/components/LibraryInfo/index.js","../../src/components/MachineLearning/processResponse.js","../../src/components/MachineLearning/index.js","../../src/core/componentCreators.js","../../src/core/buildAndValidateConfig.js","../../src/core/initializeComponents.js","../../src/core/config/createConfig.js","../../src/constants/domain.js","../../src/constants/edgeBasePath.js","../../src/core/config/createCoreConfigs.js","../../src/core/injectHandleError.js","../../src/core/network/requestMethods/injectSendFetchRequest.js","../../src/core/network/requestMethods/injectSendXhrRequest.js","../../src/core/network/requestMethods/injectSendBeaconRequest.js","../../src/core/createLogger.js","../../src/core/createEventManager.js","../../src/core/createCookieTransfer.js","../../src/constants/apiVersion.js","../../src/core/edgeNetwork/injectSendEdgeNetworkRequest.js","../../src/constants/httpStatusCode.js","../../src/core/edgeNetwork/injectProcessWarningsAndErrors.js","../../src/core/edgeNetwork/injectGetLocationHint.js","../../src/core/network/isRequestRetryable.js","../../src/core/network/getRequestRetryDelay.js","../../src/core/index.js","../../src/standalone.js"],"sourcesContent":["/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default executeCommand => {\n  return args => {\n    // Would use destructuring, but destructuring doesn't work on IE\n    // without polyfilling Symbol.\n    // https://github.com/babel/babel/issues/7597\n    const resolve = args[0];\n    const reject = args[1];\n    const userProvidedArgs = args[2];\n    const commandName = userProvidedArgs[0];\n    const options = userProvidedArgs[1];\n\n    executeCommand(commandName, options).then(resolve, reject);\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const CHROME = \"Chrome\";\nexport const EDGE = \"Edge\";\nexport const EDGE_CHROMIUM = \"EdgeChromium\";\nexport const FIREFOX = \"Firefox\";\nexport const IE = \"IE\";\nexport const SAFARI = \"Safari\";\nexport const UNKNOWN = \"Unknown\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Determines whether an array includes a certain value.\n * @param {Array} arr Array to search.\n * @param {*} item The item for which to search.\n * @returns {boolean}\n */\nexport default (arr, item) => {\n  return arr.indexOf(item) !== -1;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { CHROME, EDGE, EDGE_CHROMIUM, IE, UNKNOWN } from \"../constants/browser\";\nimport includes from \"./includes\";\n\n// Users could have also disabled third-party cookies within these browsers, but\n// we don't know. We also assume \"unknown\" browsers support third-party cookies,\n// though we don't really know that either. We're making best guesses.\nconst browsersSupportingThirdPartyCookie = [\n  CHROME,\n  EDGE,\n  EDGE_CHROMIUM,\n  IE,\n  UNKNOWN\n];\n\nexport default browser => includes(browsersSupportingThirdPartyCookie, browser);\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","'use strict';\n\nmodule.exports = require('object-assign');\n","/*!\n * JavaScript Cookie v2.2.1\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n;(function (factory) {\n\tvar registeredInModuleLoader;\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (!registeredInModuleLoader) {\n\t\tvar OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction decode (s) {\n\t\treturn s.replace(/(%[0-9A-Z]{2})+/g, decodeURIComponent);\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api() {}\n\n\t\tfunction set (key, value, attributes) {\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tattributes = extend({\n\t\t\t\tpath: '/'\n\t\t\t}, api.defaults, attributes);\n\n\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\tattributes.expires = new Date(new Date() * 1 + attributes.expires * 864e+5);\n\t\t\t}\n\n\t\t\t// We're using \"expires\" because \"max-age\" is not supported by IE\n\t\t\tattributes.expires = attributes.expires ? attributes.expires.toUTCString() : '';\n\n\t\t\ttry {\n\t\t\t\tvar result = JSON.stringify(value);\n\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\tvalue = result;\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\n\t\t\tvalue = converter.write ?\n\t\t\t\tconverter.write(value, key) :\n\t\t\t\tencodeURIComponent(String(value))\n\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\n\t\t\tkey = encodeURIComponent(String(key))\n\t\t\t\t.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent)\n\t\t\t\t.replace(/[\\(\\)]/g, escape);\n\n\t\t\tvar stringifiedAttributes = '';\n\t\t\tfor (var attributeName in attributes) {\n\t\t\t\tif (!attributes[attributeName]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tstringifiedAttributes += '; ' + attributeName;\n\t\t\t\tif (attributes[attributeName] === true) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Considers RFC 6265 section 5.2:\n\t\t\t\t// ...\n\t\t\t\t// 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n\t\t\t\t//     character:\n\t\t\t\t// Consume the characters of the unparsed-attributes up to,\n\t\t\t\t// not including, the first %x3B (\";\") character.\n\t\t\t\t// ...\n\t\t\t\tstringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n\t\t\t}\n\n\t\t\treturn (document.cookie = key + '=' + value + stringifiedAttributes);\n\t\t}\n\n\t\tfunction get (key, json) {\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar jar = {};\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all.\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (!json && cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tvar name = decode(parts[0]);\n\t\t\t\t\tcookie = (converter.read || converter)(cookie, name) ||\n\t\t\t\t\t\tdecode(cookie);\n\n\t\t\t\t\tif (json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tjar[name] = cookie;\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn key ? jar[key] : jar;\n\t\t}\n\n\t\tapi.set = set;\n\t\tapi.get = function (key) {\n\t\t\treturn get(key, false /* read as raw */);\n\t\t};\n\t\tapi.getJSON = function (key) {\n\t\t\treturn get(key, true /* read as json */);\n\t\t};\n\t\tapi.remove = function (key, attributes) {\n\t\t\tset(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.defaults = {};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n","/***************************************************************************************\n * (c) 2017 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n ****************************************************************************************/\n'use strict';\n\nvar cookie = require('js-cookie');\n\n// js-cookie has other methods that we haven't exposed here. By limiting the exposed API,\n// we have a little more flexibility to change the underlying implementation later. If clear\n// use cases come up for needing the other methods js-cookie exposes, we can re-evaluate whether\n// we want to expose them here.\nmodule.exports = {\n  get: cookie.get,\n  set: cookie.set,\n  remove: cookie.remove\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns true whether the value is null or undefined.\n * @param {*} value\n * @returns {boolean}\n */\nexport default value => value == null;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isNil from \"./isNil\";\n\n/**\n * Returns whether the value is an object.\n * @param {*} value\n * @returns {boolean}\n */\nexport default value =>\n  !isNil(value) && !Array.isArray(value) && typeof value === \"object\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isNil from \"./isNil\";\nimport isObject from \"./isObject\";\n\nconst deepAssignObject = (target, source) => {\n  Object.keys(source).forEach(key => {\n    if (isObject(target[key]) && isObject(source[key])) {\n      deepAssignObject(target[key], source[key]);\n      return;\n    }\n\n    target[key] = source[key];\n  });\n};\n\n/**\n * Recursively copy the values of all enumerable own properties from a source item to a target item if the both items are objects\n * @param {Object} target - a target object\n * @param {...Object} source - an array of source objects\n * @example\n * deepAssign({ a: 'a', b: 'b' }, { b: 'B', c: 'c' });\n * // { a: 'a', b: 'B', c: 'c' }\n */\nexport default (target, ...sources) => {\n  if (isNil(target)) {\n    throw new TypeError('deepAssign \"target\" cannot be null or undefined');\n  }\n\n  const result = Object(target);\n\n  sources.forEach(source => deepAssignObject(result, Object(source)));\n\n  return result;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport deepAssign from \"./deepAssign\";\n\n/**\n * Creates a function that, when passed an object of updates, will merge\n * the updates onto the current value of a payload property.\n * @param {Object} content The base object to modify\n * @param {String } key The property to merge updates into. This\n * can be a dot-notation property path.\n * @returns {Function}\n */\nexport default (content, key) => updates => {\n  const propertyPath = key.split(\".\");\n  const hostObjectForUpdates = propertyPath.reduce((obj, propertyName) => {\n    obj[propertyName] = obj[propertyName] || {};\n    return obj[propertyName];\n  }, content);\n  deepAssign(hostObjectForUpdates, updates);\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Allows callbacks to be registered and then later called. When the\n * callbacks are called, their responses are combined into a single promise.\n */\nexport default () => {\n  const callbacks = [];\n  return {\n    add(callback) {\n      callbacks.push(callback);\n    },\n    call(...args) {\n      // While this utility doesn't necessarily need to be doing the\n      // Promise.all, it's currently useful everywhere this is used and\n      // reduces repetitive code. We can factor it out later if we want\n      // to make this utility more \"pure\".\n      return Promise.all(callbacks.map(callback => callback(...args)));\n    }\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ logger, cookieJar }) => {\n  return {\n    ...cookieJar,\n    set(key, value, options) {\n      logger.info(\"Setting cookie\", { name: key, value, ...options });\n      cookieJar.set(key, value, options);\n    }\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Sequences tasks.\n */\nexport default () => {\n  let queueLength = 0;\n  let lastPromiseInQueue = Promise.resolve();\n  return {\n    /**\n     * Add a task to the queue. If no task is currenty running,\n     * the task will begin immediately.\n     * @param {Function} task A function that will be called when\n     * the task should be run. If the task it asynchronous, it should\n     * return a promise.\n     * @returns {Promise} A promise that will be resolved or rejected\n     * with whatever value the task resolved or rejects its promise.\n     */\n    addTask(task) {\n      queueLength += 1;\n\n      const lastPromiseFulfilledHandler = () => {\n        return task().finally(() => {\n          queueLength -= 1;\n        });\n      };\n\n      lastPromiseInQueue = lastPromiseInQueue.then(\n        lastPromiseFulfilledHandler,\n        lastPromiseFulfilledHandler\n      );\n      return lastPromiseInQueue;\n    },\n    /**\n     * How many tasks are in the queue. This includes the task\n     * that's currently running.\n     * @returns {number}\n     */\n    get length() {\n      return queueLength;\n    }\n  };\n};\n","/* eslint-disable */\n\n/*\ncrc32 · JavaScript Function to Calculate CRC32 of a String\nDescription\n  Below is a JavaScript function to calculate CRC32 of a string. \n  The string can be either ASCII or Unicode. \n  Unicode strings will be encoded in UTF-8. \n  The polynomial used in calculation is 0xedb88320. \n  This polynomial is used in Ethernet, Gzip, PNG, SATA and many other technologies.\n*/\nconst crc32 = (() => {\n  const table = [];\n  for (let i = 0; i < 256; i++) {\n    let c = i;\n    for (let j = 0; j < 8; j++) {\n      c = c & 1 ? 0xedb88320 ^ (c >>> 1) : c >>> 1;\n    }\n    table.push(c);\n  }\n\n  return function(str, crc) {\n    str = unescape(encodeURIComponent(str));\n    if (!crc) crc = 0;\n    crc = crc ^ -1;\n    for (let i = 0; i < str.length; i++) {\n      const y = (crc ^ str.charCodeAt(i)) & 0xff;\n      crc = (crc >>> 8) ^ table[y];\n    }\n    crc = crc ^ -1;\n    return crc >>> 0;\n  };\n})();\n\nexport default crc32;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * A simple utility for managing a promise's state outside of\n * the promise's \"executor\" (the function passed into the constructor).\n */\nexport default () => {\n  const deferred = {};\n\n  deferred.promise = new Promise((resolve, reject) => {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n\n  return deferred;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Whether a string ends with the characters of a specified string\n * @param {String} str The string to search within.\n * @param {String} suffix The string to search for.\n * @returns {boolean}\n */\nexport default (str, suffix) => str.substr(-suffix.length) === suffix;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns the first item in the array that satisfies the provided testing function.\n * @param {Array} arr The array to search.\n * @param {Function} predicate Function that will be called for each item. Arguments\n * will be the item, the item index, then the array itself.\n * @returns {*}\n */\nexport default (arr, predicate) => {\n  for (let i = 0; i < arr.length; i += 1) {\n    const item = arr[i];\n    if (predicate(item, i, arr)) {\n      return item;\n    }\n  }\n  return undefined;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (parent, node) => {\n  return parent.appendChild(node);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport appendNode from \"./appendNode\";\nimport isObject from \"../isObject\";\n\nconst populateElementProperties = (element, props) => {\n  Object.keys(props).forEach(key => {\n    // The following is to support setting style properties to avoid CSP errors.\n    if (key === \"style\" && isObject(props[key])) {\n      const styleProps = props[key];\n      Object.keys(styleProps).forEach(styleKey => {\n        element.style[styleKey] = styleProps[styleKey];\n      });\n    } else {\n      element[key] = props[key];\n    }\n  });\n};\n\nexport default (tag, attrs = {}, props = {}, children = [], doc = document) => {\n  const result = doc.createElement(tag);\n  Object.keys(attrs).forEach(key => {\n    // TODO: To highlight CSP problems consider throwing a descriptive error\n    //       if nonce is available and key is style.\n    result.setAttribute(key, attrs[key]);\n  });\n  populateElementProperties(result, props);\n  children.forEach(child => appendNode(result, child));\n  return result;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const BODY = \"BODY\";\nexport const IFRAME = \"IFRAME\";\nexport const IMG = \"IMG\";\nexport const DIV = \"DIV\";\nexport const STYLE = \"STYLE\";\nexport const SCRIPT = \"SCRIPT\";\nexport const HEAD = \"HEAD\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createNode from \"./dom/createNode\";\nimport { IMG } from \"../constants/tagName\";\n\n/**\n * Fires an image pixel from the current document's window.\n * @param {object} currentDocument\n * @param {string} src\n * @returns {Promise}\n */\nexport default ({ src, currentDocument = document }) => {\n  return new Promise((resolve, reject) => {\n    const attrs = { src };\n    const props = {\n      onload: resolve,\n      onerror: reject,\n      onabort: reject\n    };\n\n    createNode(IMG, attrs, props, [], currentDocument);\n  });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns whether the value is a function.\n * @param {*} value\n * @returns {boolean}\n */\nexport default value => typeof value === \"function\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns whether the value is a non-empty array.\n * @param {*} value\n * @returns {boolean}\n */\nexport default value => Array.isArray(value) && value.length > 0;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default value => {\n  if (Array.isArray(value)) {\n    return value;\n  }\n\n  if (value == null) {\n    return [];\n  }\n\n  return [].slice.call(value);\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport toArray from \"../toArray\";\n\nconst SIBLING_PATTERN = /^\\s*>/;\n\nexport default (context, selector) => {\n  if (!SIBLING_PATTERN.test(selector)) {\n    return toArray(context.querySelectorAll(selector));\n  }\n\n  const tag = `alloy-${Date.now()}`;\n\n  // We could use a :scope selector here, but we want to be IE compliant\n  // so we add a dummy css class to be able to select the children\n  try {\n    context.classList.add(tag);\n\n    return toArray(context.querySelectorAll(`.${tag} ${selector}`));\n  } finally {\n    context.classList.remove(tag);\n  }\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Whether a string starts with the characters of a specified string\n * @param {String} str The string to search within.\n * @param {String} prefix The string to search for.\n * @returns {boolean}\n */\nexport default (str, prefix) => str.substr(0, prefix.length) === prefix;\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \":shadow\";\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport querySelectorAll from \"./querySelectorAll\";\nimport startsWith from \"../startsWith\";\nimport SHADOW_SEPARATOR from \"../../constants/shadowSeparator\";\n\nconst splitWithShadow = selector => {\n  return selector.split(SHADOW_SEPARATOR);\n};\n\nconst transformPrefix = (parent, selector) => {\n  const result = selector.trim();\n  const hasChildCombinatorPrefix = startsWith(result, \">\");\n  if (!hasChildCombinatorPrefix) {\n    return result;\n  }\n\n  // IE doesn't support :scope\n  if (window.document.documentMode) {\n    return result.substring(1).trim();\n  }\n\n  const prefix =\n    parent instanceof Element || parent instanceof HTMLDocument\n      ? \":scope\"\n      : \":host\"; // see https://bugs.webkit.org/show_bug.cgi?id=233380\n\n  return `${prefix} ${result}`;\n};\n\nexport default (context, selector) => {\n  // Shadow DOM should be supported\n  if (!window.document.documentElement.attachShadow) {\n    return querySelectorAll(context, selector.replace(SHADOW_SEPARATOR, \"\"));\n  }\n\n  const parts = splitWithShadow(selector);\n\n  if (parts.length < 2) {\n    return querySelectorAll(context, selector);\n  }\n\n  // split the selector into parts separated by :shadow pseudo-selectors\n  // find each subselector element based on the previously selected node's shadowRoot\n  let parent = context;\n  for (let i = 0; i < parts.length; i += 1) {\n    const part = transformPrefix(parent, parts[i]);\n    const partNode = querySelectorAll(parent, part);\n\n    if (partNode.length === 0 || !partNode[0] || !partNode[0].shadowRoot) {\n      return partNode;\n    }\n\n    parent = partNode[0].shadowRoot;\n  }\n  return undefined;\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport SHADOW_SEPARATOR from \"../../constants/shadowSeparator\";\n\nexport default str => str.indexOf(SHADOW_SEPARATOR) !== -1;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport querySelectorAll from \"./querySelectorAll\";\nimport selectNodesWithShadow from \"./selectNodesWithShadow\";\nimport isShadowSelector from \"./isShadowSelector\";\n\n/**\n * Returns an array of matched DOM nodes.\n * @param {String} selector\n * @param {Node} [context=document] defaults to document\n * @returns {Array} an array of DOM nodes\n */\nexport default (selector, context = document) => {\n  if (!isShadowSelector(selector)) {\n    return querySelectorAll(context, selector);\n  }\n\n  return selectNodesWithShadow(context, selector);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isFunction from \"../isFunction\";\nimport isNonEmptyArray from \"../isNonEmptyArray\";\nimport selectNodes from \"./selectNodes\";\n\nconst MUTATION_OBSERVER = \"MutationObserver\";\nconst RAF = \"requestAnimationFrame\";\nconst MUTATION_OBSERVER_CONFIG = { childList: true, subtree: true };\nconst VISIBILITY_STATE = \"visibilityState\";\nconst VISIBLE = \"visible\";\nconst DELAY = 100;\nconst MAX_POLLING_TIMEOUT = 5000;\n\nconst createError = selector => {\n  return new Error(`Could not find: ${selector}`);\n};\n\nconst createPromise = executor => {\n  return new Promise(executor);\n};\n\nexport const canUseMutationObserver = win => {\n  return isFunction(win[MUTATION_OBSERVER]);\n};\n\nexport const awaitUsingMutationObserver = (\n  win,\n  doc,\n  selector,\n  timeout,\n  selectFunc\n) => {\n  return createPromise((resolve, reject) => {\n    const mutationObserver = new win[MUTATION_OBSERVER](() => {\n      const nodes = selectFunc(selector);\n\n      if (isNonEmptyArray(nodes)) {\n        mutationObserver.disconnect();\n        resolve(nodes);\n      }\n    });\n\n    setTimeout(() => {\n      mutationObserver.disconnect();\n      reject(createError(selector));\n    }, timeout);\n\n    mutationObserver.observe(doc, MUTATION_OBSERVER_CONFIG);\n  });\n};\n\nexport const canUseRequestAnimationFrame = doc => {\n  return doc[VISIBILITY_STATE] === VISIBLE;\n};\n\nexport const awaitUsingRequestAnimation = (\n  win,\n  selector,\n  timeout,\n  selectFunc\n) => {\n  return createPromise((resolve, reject) => {\n    const execute = () => {\n      const nodes = selectFunc(selector);\n\n      if (isNonEmptyArray(nodes)) {\n        resolve(nodes);\n        return;\n      }\n\n      win[RAF](execute);\n    };\n\n    execute();\n\n    setTimeout(() => {\n      reject(createError(selector));\n    }, timeout);\n  });\n};\n\nexport const awaitUsingTimer = (selector, timeout, selectFunc) => {\n  return createPromise((resolve, reject) => {\n    const execute = () => {\n      const nodes = selectFunc(selector);\n\n      if (isNonEmptyArray(nodes)) {\n        resolve(nodes);\n        return;\n      }\n\n      setTimeout(execute, DELAY);\n    };\n\n    execute();\n\n    setTimeout(() => {\n      reject(createError(selector));\n    }, timeout);\n  });\n};\n\nexport default (\n  selector,\n  selectFunc = selectNodes,\n  timeout = MAX_POLLING_TIMEOUT,\n  win = window,\n  doc = document\n) => {\n  const nodes = selectFunc(selector);\n\n  if (isNonEmptyArray(nodes)) {\n    return Promise.resolve(nodes);\n  }\n\n  if (canUseMutationObserver(win)) {\n    return awaitUsingMutationObserver(win, doc, selector, timeout, selectFunc);\n  }\n\n  if (canUseRequestAnimationFrame(doc)) {\n    return awaitUsingRequestAnimation(win, selector, timeout, selectFunc);\n  }\n\n  return awaitUsingTimer(selector, timeout, selectFunc);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns true if element matches the selector.\n * @param {String} selector\n * @param {Node} [element]\n * @returns {Boolean}\n */\nexport default (selector, element) => {\n  if (element.matches) {\n    return element.matches(selector);\n  }\n\n  // Making IE 11 happy\n  return element.msMatchesSelector(selector);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default node => {\n  const parent = node.parentNode;\n\n  if (parent) {\n    return parent.removeChild(node);\n  }\n\n  return null;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport fireImageInDocument from \"./fireImage\";\nimport {\n  appendNode as appendNodeToDocument,\n  awaitSelector as awaitSelectorInDocument,\n  createNode as createNodeInDocument\n} from \"./dom\";\nimport { BODY, IFRAME } from \"../constants/tagName\";\n\nconst IFRAME_ATTRS = {\n  name: \"Adobe Alloy\"\n};\n\nconst IFRAME_PROPS = {\n  style: {\n    display: \"none\",\n    width: 0,\n    height: 0\n  }\n};\n\nexport default ({\n  appendNode = appendNodeToDocument,\n  awaitSelector = awaitSelectorInDocument,\n  createNode = createNodeInDocument,\n  fireImage = fireImageInDocument\n} = {}) => {\n  const fireOnPage = fireImage;\n\n  let hiddenIframe;\n\n  const createIframe = () => {\n    return awaitSelector(BODY).then(([body]) => {\n      if (hiddenIframe) {\n        return hiddenIframe;\n      }\n      hiddenIframe = createNode(IFRAME, IFRAME_ATTRS, IFRAME_PROPS);\n      return appendNode(body, hiddenIframe);\n    });\n  };\n\n  const fireInIframe = ({ src }) => {\n    return createIframe().then(iframe => {\n      const currentDocument = iframe.contentWindow.document;\n      return fireImage({ src, currentDocument });\n    });\n  };\n\n  return request => {\n    const { hideReferrer, url } = request;\n    return hideReferrer ? fireInIframe({ src: url }) : fireOnPage({ src: url });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default (array, mapFunction) => {\n  return Array.prototype.concat.apply([], array.map(mapFunction));\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"com.adobe.alloy.\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns the last N number of items from an array.\n * @param {Array} arr\n * @param {number} itemCount\n * @returns {Array}\n */\nexport default (arr, itemCount) => arr.slice(-itemCount);\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport namespace from \"../constants/namespace\";\nimport getLastArrayItems from \"./getLastArrayItems\";\n\nconst cookieName = `${namespace}getTld`;\n\n/**\n * Of the current web page's hostname, this is the top-most domain that is\n * not a \"public suffix\" as outlined in https://publicsuffix.org/. In other\n * words, this is top-most domain that is able to accept cookies.\n * @param {Object} window\n * @param {Object} cookieJar\n * @returns {string}\n */\nexport default (window, cookieJar) => {\n  let topLevelCookieDomain = \"\";\n\n  // If hostParts.length === 1, we may be on localhost.\n  const hostParts = window.location.hostname.toLowerCase().split(\".\");\n  let i = 1;\n\n  while (i < hostParts.length && !cookieJar.get(cookieName)) {\n    i += 1;\n    topLevelCookieDomain = getLastArrayItems(hostParts, i).join(\".\");\n    cookieJar.set(cookieName, cookieName, { domain: topLevelCookieDomain });\n  }\n\n  cookieJar.remove(cookieName, { domain: topLevelCookieDomain });\n\n  return topLevelCookieDomain;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// Remember to also incorporate the org ID wherever cookies are read or written.\nexport default \"kndctr\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default orgId => orgId.replace(\"@\", \"_\");\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport COOKIE_NAME_PREFIX from \"../constants/cookieNamePrefix\";\nimport sanitizeOrgIdForCookieName from \"./sanitizeOrgIdForCookieName\";\n\nexport default (orgId, key) =>\n  `${COOKIE_NAME_PREFIX}_${sanitizeOrgIdForCookieName(orgId)}_${key}`;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const IDENTITY = \"identity\";\nexport const CONSENT = \"consent\";\nexport const CLUSTER = \"cluster\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport cookieJar from \"./cookieJar\";\nimport getNamespacedCookieName from \"./getNamespacedCookieName\";\nimport { IDENTITY } from \"../constants/cookieNameKey\";\n\nexport default ({ orgId }) => {\n  const identityCookieName = getNamespacedCookieName(orgId, IDENTITY);\n  /**\n   * Returns whether the identity cookie exists.\n   */\n  return () => Boolean(cookieJar.get(identityCookieName));\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport baseNamespace from \"../constants/namespace\";\nimport startsWith from \"./startsWith\";\n\nconst getStorageByType = (context, storageType, namespace) => {\n  // When storage is disabled on Safari, the mere act of referencing\n  // window.localStorage or window.sessionStorage throws an error.\n  // For this reason, we wrap in a try-catch.\n  return {\n    /**\n     * Reads a value from storage.\n     * @param {string} name The name of the item to be read.\n     * @returns {string}\n     */\n    getItem(name) {\n      try {\n        return context[storageType].getItem(namespace + name);\n      } catch (e) {\n        return null;\n      }\n    },\n    /**\n     * Saves a value to storage.\n     * @param {string} name The name of the item to be saved.\n     * @param {string} value The value of the item to be saved.\n     * @returns {boolean} Whether the item was successfully saved to storage.\n     */\n    setItem(name, value) {\n      try {\n        context[storageType].setItem(namespace + name, value);\n        return true;\n      } catch (e) {\n        return false;\n      }\n    },\n    /**\n     * Clear all values in storage that match the namespace.\n     */\n    clear() {\n      try {\n        Object.keys(context[storageType]).forEach(key => {\n          if (startsWith(key, namespace)) {\n            context[storageType].removeItem(key);\n          }\n        });\n        return true;\n      } catch (e) {\n        return false;\n      }\n    }\n  };\n};\n\nexport default context => additionalNamespace => {\n  const finalNamespace = baseNamespace + additionalNamespace;\n  return {\n    session: getStorageByType(context, \"sessionStorage\", finalNamespace),\n    persistent: getStorageByType(context, \"localStorage\", finalNamespace)\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport includes from \"./includes\";\n\n/**\n * Returns items that are found within both arrays.\n * @param {Array} a\n * @param {Array} b\n * @returns {Array}\n */\nexport default (a, b) => a.filter(x => includes(b, x));\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns whether the value is a boolean.\n * @param {*} value\n * @returns {boolean}\n */\nexport default value => typeof value === \"boolean\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isObject from \"./isObject\";\n\n/**\n * Returns whether the value is an empty object.\n * @param {*} value\n * @returns {boolean}\n */\nexport default value => isObject(value) && Object.keys(value).length === 0;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns whether the value is a number.\n * @param {*} value\n * @returns {boolean}\n */\n// eslint-disable-next-line no-restricted-globals\nexport default value => typeof value === \"number\" && !isNaN(value);\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isNumber from \"./isNumber\";\n\n/**\n * Returns whether the value is an integer.\n * @param {*} value\n * @returns {boolean}\n */\nexport default value => {\n  const parsed = parseInt(value, 10);\n\n  return isNumber(parsed) && value === parsed;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport COOKIE_NAME_PREFIX from \"../constants/cookieNamePrefix\";\nimport sanitizeOrgIdForCookieName from \"./sanitizeOrgIdForCookieName\";\n\n/**\n * Determines whether a cookie name is namespaced according to the contract\n * defined by the server.\n * @param {String} orgId The org ID configured for the Alloy instance.\n * @param {String} name The cookie name.\n * @returns {boolean}\n */\nexport default (orgId, name) =>\n  name.indexOf(\n    `${COOKIE_NAME_PREFIX}_${sanitizeOrgIdForCookieName(orgId)}_`\n  ) === 0;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns whether the value is a string.\n * @param {*} value\n * @returns {boolean}\n */\nexport default value => typeof value === \"string\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isString from \"./isString\";\n\n/**\n * Returns whether the value is a populated string.\n * @param {*} value\n * @returns {boolean}\n */\nexport default value => isString(value) && value.length > 0;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Creates a function that memoizes the result of `fn`. If `keyResolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key.\n *\n * @param {Function} fn The function to have its output memoized.\n * @param {Function} [keyResolver] The function to resolve the cache key.\n * @returns {Function} The new memoized function.\n */\nexport default (fn, keyResolver) => {\n  const map = new Map();\n\n  return (...args) => {\n    const key = keyResolver ? keyResolver(...args) : args[0];\n\n    if (map.has(key)) {\n      return map.get(key);\n    }\n\n    const result = fn(...args);\n    map.set(key, result);\n    return result;\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * A function that performs no operations.\n */\nexport default () => {};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// adapted from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/padStart\nexport default (string, targetLength, padString) => {\n  const originalString = String(string);\n  let repeatedPadString = String(padString);\n  if (originalString.length >= targetLength || repeatedPadString.length === 0) {\n    return originalString;\n  }\n  const lengthToAdd = targetLength - originalString.length;\n  while (lengthToAdd > repeatedPadString.length) {\n    repeatedPadString += repeatedPadString;\n  }\n  return repeatedPadString.slice(0, lengthToAdd) + originalString;\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (Array.isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return Object.keys(obj).map(function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (Array.isArray(obj[k])) {\n        return obj[k].map(function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","/***************************************************************************************\n * (c) 2017 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n ****************************************************************************************/\n'use strict';\n\nvar querystring = require('querystring');\n\n// We proxy the underlying querystring module so we can limit the API we expose.\n// This allows us to more easily make changes to the underlying implementation later without\n// having to worry about breaking extensions. If extensions demand additional functionality, we\n// can make adjustments as needed.\nmodule.exports = {\n  parse: function(string) {\n    //\n    if (typeof string === 'string') {\n      // Remove leading ?, #, & for some leniency so you can pass in location.search or\n      // location.hash directly.\n      string = string.trim().replace(/^[?#&]/, '');\n    }\n    return querystring.parse(string);\n  },\n  stringify: function(object) {\n    return querystring.stringify(object);\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Creates and returns a new error using the provided value as a message.\n * If the provided value is already an Error, it will be returned unmodified.\n * @param {*} value\n * @returns {Error}\n */\nexport default value => {\n  return value instanceof Error ? value : new Error(value);\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ error, message }) => {\n  try {\n    error.message = message;\n  } catch (e) {\n    // We'll set a new message when we can, but some errors, like DOMException,\n    // have a read-only message property, which limits our options.\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport toError from \"./toError\";\nimport updateErrorMessage from \"./updateErrorMessage\";\n\n/**\n * Augments an error's message with additional context as it bubbles up the call stack.\n * @param {String} message The message to be added to the error.\n * @param {*} error Optimally, this is an instance of Error. If it is not,\n * this is used as the basis for the message of a newly created Error instance.\n * @returns {*}\n */\nexport default ({ error, message }) => {\n  const errorToStack = toError(error);\n  const newMessage = `${message}\\nCaused by: ${errorToStack.message}`;\n  updateErrorMessage({\n    error: errorToStack,\n    message: newMessage\n  });\n  return errorToStack;\n};\n","import isString from \"./isString\";\n\nexport default str => {\n  return isString(str) && str.toLowerCase() === \"true\";\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/*\n * coerce `value` to a number or return `defaultValue` if it cannot be.\n */\nexport default (value, defaultValue) => {\n  const n = Math.round(Number(value));\n  // eslint-disable-next-line no-restricted-globals\n  return isNaN(n) ? defaultValue : n;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport padStart from \"./padStart\";\nimport toInteger from \"./toInteger\";\n\n/**\n * Formats the date into an ISO date-time string in the local timezone\n * @param {Date} date\n * @returns {string}\n */\nexport default date => {\n  const YYYY = date.getFullYear();\n  const MM = padStart(date.getMonth() + 1, 2, \"0\");\n  const DD = padStart(date.getDate(), 2, \"0\");\n\n  const hh = padStart(date.getHours(), 2, \"0\");\n  const mm = padStart(date.getMinutes(), 2, \"0\");\n  const ss = padStart(date.getSeconds(), 2, \"0\");\n  const mmm = padStart(date.getMilliseconds(), 3, \"0\");\n\n  // The time-zone offset is the difference, in minutes, from local time to UTC. Note that this\n  // means that the offset is positive if the local timezone is behind UTC and negative if it is\n  // ahead. For example, for time zone UTC+10:00, -600 will be returned.\n  const timezoneOffset = toInteger(date.getTimezoneOffset(), 0);\n  const ts = timezoneOffset > 0 ? \"-\" : \"+\";\n  const th = padStart(Math.floor(Math.abs(timezoneOffset) / 60), 2, \"0\");\n  const tm = padStart(Math.abs(timezoneOffset) % 60, 2, \"0\");\n\n  return `${YYYY}-${MM}-${DD}T${hh}:${mm}:${ss}.${mmm}${ts}${th}:${tm}`;\n};\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]]\n  ]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport assign from \"../assign\";\n\n/**\n * Chains two validators together.\n *\n * Validators are functions of two parameters (value and path) that return the computed value if\n * the input is valid, or throw an exception if the input is invalid. In most cases the returned\n * value is the same as the input value; however, reference createDefaultValidator.js\n * to see an example where the computed value is different from the input. Additionally, if we ever\n * wanted to coerce types (i.e. parse string values into integers) as part of the validation process\n * we could use the computed value to accomplish that.\n *\n * The path parameter is used to generate informative error messages. It is created by the objectOf, and\n * arrayOf validators so that any error message can describe which key within the object or array is\n * invalid.\n *\n * The validators also have methods to chain additional validation logic. For example, when you call\n * `string()` to start a validator chain, it returns a validator function but it also has methods\n * like `required` and `nonEmpty`. In index.js you can see that these methods are actually calling `chain`.\n * Specifically in this function, the leftValidator is called first and then the return value of that is\n * sent to the rightValidator. For example, when calling `string().nonEmpty().required()` the following\n * chain is built up:\n * ```\n *              *\n *            /   \\\n *          *     required\n *        /   \\\n *      *     nonEmpty\n *    /   \\\n * base   string\n * ```\n * Where every * is a call to chain where the two are combined. The individual validators are called from\n * left to right in the above tree. The base validator is simply the identity function `value => value`,\n * representing an optional value.\n *\n * After combining the validators, the new validator function is then augmented with the methods from the\n * leftValidator and from the additionalMethods parameter. For example, when the string() function is called\n * it chains to the base validator, but also adds additional methods like (`regexp`, `domain`, `nonEmpty`,\n * and `unique`). When `nonEmpty` is called, which calls chain again, the additional methods are carried\n * forward because they are already defined on the leftValidator.\n *\n * The base validator also contains the two methods `required` and `default`, so these can be used anywhere\n * after any of the exposed validator functions are called.\n */\nexport default (leftValidator, rightValidator, additionalMethods = {}) => {\n  // combine the two validators, calling left first and then right.\n  // pass the return value from left into right.\n  const combinedValidator = (value, path) => {\n    return rightValidator(leftValidator(value, path), path);\n  };\n  // add the methods already defined on the left validator, and the additionalMethods\n  // to the new combined validator function.\n  assign(combinedValidator, leftValidator, additionalMethods);\n  return combinedValidator;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport chain from \"./chain\";\n\n/**\n * This augments `chain` with a null check done before running the rightValidator.\n * See chain for more info.\n *\n * For most validators, we want the validation to be optional (i.e. allow null or\n * undefined values). To accomplish this, the validator needs to have a check\n * at the begining of the function, short circuiting the validation logic and\n * returning value if value is null or undefined. `default` and `required` do not\n * want this null check though. Indeed, `default` should return the default value\n * if value is null, and `required` should throw an error if value is null.\n *\n * So to keep from having to have a null check in front of most validators, this\n * function allows you to chain a rightValidator that needs to have a null check.\n */\nexport default (leftValidator, rightValidator, additionalMethods) => {\n  const rightValidatorWithNullCheck = (value, path) =>\n    value == null ? value : rightValidator(value, path);\n  return chain(leftValidator, rightValidatorWithNullCheck, additionalMethods);\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (isValid, value, path, message) => {\n  if (!isValid) {\n    throw new Error(\n      `'${path}': Expected ${message}, but got ${JSON.stringify(value)}.`\n    );\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isBoolean from \"../isBoolean\";\nimport assertValid from \"./assertValid\";\n\nexport default (value, path) => {\n  assertValid(isBoolean(value), value, path, \"true or false\");\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport isFunction from \"../isFunction\";\nimport assertValid from \"./assertValid\";\n\nexport default (value, path) => {\n  assertValid(isFunction(value), value, path, \"a function\");\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport assertValid from \"./assertValid\";\n\nexport default elementValidator => (value, path) => {\n  assertValid(Array.isArray(value), value, path, \"an array\");\n  const errors = [];\n  const validatedArray = value.map((subValue, i) => {\n    try {\n      return elementValidator(subValue, `${path}[${i}]`);\n    } catch (e) {\n      errors.push(e.message);\n      return undefined;\n    }\n  });\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"));\n  }\n  return validatedArray;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default defaultValue => value => {\n  if (value == null) {\n    return defaultValue;\n  }\n  return value;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport assertValid from \"./assertValid\";\n\nexport default literalValue => (value, path) => {\n  assertValid(value === literalValue, value, path, `${literalValue}`);\n  return value;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isObject from \"../isObject\";\nimport assertValid from \"./assertValid\";\n\nexport default valueValidator => (value, path) => {\n  assertValid(isObject(value), value, path, \"an object\");\n\n  const errors = [];\n  const validatedObject = {};\n  Object.keys(value).forEach(subKey => {\n    const subValue = value[subKey];\n    const subPath = path ? `${path}.${subKey}` : subKey;\n    try {\n      const validatedValue = valueValidator(subValue, subPath);\n      if (validatedValue !== undefined) {\n        validatedObject[subKey] = validatedValue;\n      }\n    } catch (e) {\n      errors.push(e.message);\n    }\n  });\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"));\n  }\n\n  return validatedObject;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport assertValid from \"./assertValid\";\n\nexport default (typeName, minimum) => (value, path) => {\n  assertValid(\n    value >= minimum,\n    value,\n    path,\n    `${typeName} greater than or equal to ${minimum}`\n  );\n  return value;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default schema => (value, path) => {\n  const errors = [];\n  Object.keys(value).forEach(subKey => {\n    if (!schema[subKey]) {\n      const subPath = path ? `${path}.${subKey}` : subKey;\n      errors.push(`'${subPath}': Unknown field.`);\n    }\n  });\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"));\n  }\n\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport assertValid from \"./assertValid\";\nimport isObject from \"../isObject\";\nimport isEmptyObject from \"../isEmptyObject\";\n\nexport default message => (value, path) => {\n  if (isObject(value)) {\n    assertValid(!isEmptyObject(value), value, path, message);\n  } else {\n    assertValid(value.length > 0, value, path, message);\n  }\n  return value;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isObject from \"../isObject\";\nimport assertValid from \"./assertValid\";\n\nexport default schema => (value, path) => {\n  assertValid(isObject(value), value, path, \"an object\");\n\n  const errors = [];\n  const validatedObject = {};\n  Object.keys(schema).forEach(subKey => {\n    const subValue = value[subKey];\n    const subSchema = schema[subKey];\n    const subPath = path ? `${path}.${subKey}` : subKey;\n    try {\n      const validatedValue = subSchema(subValue, subPath);\n      if (validatedValue !== undefined) {\n        validatedObject[subKey] = validatedValue;\n      }\n    } catch (e) {\n      errors.push(e.message);\n    }\n  });\n\n  // copy over unknown properties\n  Object.keys(value).forEach(subKey => {\n    if (!Object.prototype.hasOwnProperty.call(validatedObject, subKey)) {\n      validatedObject[subKey] = value[subKey];\n    }\n  });\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"));\n  }\n  return validatedObject;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport assertValid from \"./assertValid\";\nimport find from \"../find\";\n\nexport default (validators, message) => (value, path) => {\n  const valid = find(validators, validator => {\n    try {\n      validator(value, path);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  });\n  assertValid(valid, value, path, message);\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport assertValid from \"./assertValid\";\n\nexport default () => {\n  const values = [];\n  return (value, path) => {\n    assertValid(\n      values.indexOf(value) === -1,\n      value,\n      path,\n      \"a unique value across instances\"\n    );\n    values.push(value);\n    return value;\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport assertValid from \"./assertValid\";\n\nconst DOMAIN_REGEX = /^[a-z0-9.-]{1,}$/i;\n\nexport default (value, path) => {\n  assertValid(DOMAIN_REGEX.test(value), value, path, \"a valid domain\");\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isInteger from \"../isInteger\";\nimport assertValid from \"./assertValid\";\n\nexport default (value, path) => {\n  assertValid(isInteger(value), value, path, \"an integer\");\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isNumber from \"../isNumber\";\nimport assertValid from \"./assertValid\";\n\nexport default (value, path) => {\n  assertValid(isNumber(value), value, path, \"a number\");\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Determines whether the value is a valid regular expression.\n * @param {*} value\n * @returns {boolean}\n */\nexport default value => {\n  try {\n    return new RegExp(value) !== null;\n  } catch (e) {\n    return false;\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport assertValid from \"./assertValid\";\nimport isValidRegExp from \"../isValidRegExp\";\n\nexport default (value, path) => {\n  assertValid(isValidRegExp(value), value, path, \"a regular expression\");\n  return value;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (value, path) => {\n  if (value == null) {\n    throw new Error(`'${path}' is a required option`);\n  }\n  return value;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport isString from \"../isString\";\nimport assertValid from \"./assertValid\";\n\nexport default (value, path) => {\n  assertValid(isString(value), value, path, \"a string\");\n  return value;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// See comments on chain and nullSafeChain to understand what is going on here.\nimport chain from \"./chain\";\nimport nullSafeChain from \"./nullSafeChain\";\n\nimport booleanValidator from \"./booleanValidator\";\nimport callbackValidator from \"./callbackValidator\";\nimport createArrayOfValidator from \"./createArrayOfValidator\";\nimport createDefaultValidator from \"./createDefaultValidator\";\nimport createLiteralValidator from \"./createLiteralValidator\";\nimport createMapOfValuesValidator from \"./createMapOfValuesValidator\";\nimport createMinimumValidator from \"./createMinimumValidator\";\nimport createNoUnknownFieldsValidator from \"./createNoUnknownFieldsValidator\";\nimport createNonEmptyValidator from \"./createNonEmptyValidator\";\nimport createObjectOfValidator from \"./createObjectOfValidator\";\nimport createAnyOfValidator from \"./createAnyOfValidator\";\nimport createUniqueValidator from \"./createUniqueValidator\";\nimport domainValidator from \"./domainValidator\";\nimport integerValidator from \"./integerValidator\";\nimport numberValidator from \"./numberValidator\";\nimport regexpValidator from \"./regexpValidator\";\nimport requiredValidator from \"./requiredValidator\";\nimport stringValidator from \"./stringValidator\";\n\n// The base validator does no validation and just returns the value unchanged\nconst base = value => value;\n\n// The 'default' and 'required' methods are available after any data-type method\n// Don't use the nullSafeChain because they need to handle the null or undefined case\nbase.default = function _default(defaultValue) {\n  return chain(this, createDefaultValidator(defaultValue));\n};\nbase.required = function required() {\n  return chain(this, requiredValidator);\n};\n\n// helper validators\nconst domain = function domain() {\n  return nullSafeChain(this, domainValidator);\n};\nconst minimumInteger = function minimumInteger(minValue) {\n  return nullSafeChain(this, createMinimumValidator(\"an integer\", minValue));\n};\nconst minimumNumber = function minimumNumber(minValue) {\n  return nullSafeChain(this, createMinimumValidator(\"a number\", minValue));\n};\nconst integer = function integer() {\n  return nullSafeChain(this, integerValidator, { minimum: minimumInteger });\n};\nconst nonEmptyString = function nonEmptyString() {\n  return nullSafeChain(this, createNonEmptyValidator(\"a non-empty string\"));\n};\nconst nonEmptyArray = function nonEmptyArray() {\n  return nullSafeChain(this, createNonEmptyValidator(\"a non-empty array\"));\n};\nconst nonEmptyObject = function nonEmptyObject() {\n  return nullSafeChain(this, createNonEmptyValidator(\"a non-empty object\"));\n};\nconst regexp = function regexp() {\n  return nullSafeChain(this, regexpValidator);\n};\nconst unique = function createUnique() {\n  return nullSafeChain(this, createUniqueValidator());\n};\n\n// top-level validators.  These are the first functions that are called to create a validator.\nconst anyOf = function anyOf(validators, message) {\n  // use chain here because we don't want to accept null or undefined unless at least\n  // one of the validators accept null or undefined.\n  return chain(this, createAnyOfValidator(validators, message));\n};\nconst anything = function anything() {\n  return nullSafeChain(this, base);\n};\nconst arrayOf = function arrayOf(elementValidator) {\n  return nullSafeChain(this, createArrayOfValidator(elementValidator), {\n    nonEmpty: nonEmptyArray\n  });\n};\nconst boolean = function boolean() {\n  return nullSafeChain(this, booleanValidator);\n};\nconst callback = function callback() {\n  return nullSafeChain(this, callbackValidator);\n};\nconst literal = function literal(literalValue) {\n  return nullSafeChain(this, createLiteralValidator(literalValue));\n};\nconst number = function number() {\n  return nullSafeChain(this, numberValidator, {\n    minimum: minimumNumber,\n    integer,\n    unique\n  });\n};\nconst mapOfValues = function mapOfValues(valuesValidator) {\n  return nullSafeChain(this, createMapOfValuesValidator(valuesValidator), {\n    nonEmpty: nonEmptyObject\n  });\n};\nconst objectOf = function objectOf(schema) {\n  const noUnknownFields = function noUnknownFields() {\n    return nullSafeChain(this, createNoUnknownFieldsValidator(schema));\n  };\n  return nullSafeChain(this, createObjectOfValidator(schema), {\n    noUnknownFields,\n    nonEmpty: nonEmptyObject\n  });\n};\nconst string = function string() {\n  return nullSafeChain(this, stringValidator, {\n    regexp,\n    domain,\n    nonEmpty: nonEmptyString,\n    unique\n  });\n};\n\nconst boundAnyOf = anyOf.bind(base);\nconst boundAnything = anything.bind(base);\nconst boundArrayOf = arrayOf.bind(base);\nconst boundBoolean = boolean.bind(base);\nconst boundCallback = callback.bind(base);\nconst boundLiteral = literal.bind(base);\nconst boundNumber = number.bind(base);\nconst boundMapOfValues = mapOfValues.bind(base);\nconst boundObjectOf = objectOf.bind(base);\nconst boundString = string.bind(base);\n\n// compound validators\nconst boundEnumOf = function boundEnumOf(...values) {\n  return boundAnyOf(\n    values.map(boundLiteral),\n    `one of these values: [${JSON.stringify(values)}]`\n  );\n};\n\nexport {\n  boundAnyOf as anyOf,\n  boundAnything as anything,\n  boundArrayOf as arrayOf,\n  boundBoolean as boolean,\n  boundCallback as callback,\n  boundLiteral as literal,\n  boundNumber as number,\n  boundMapOfValues as mapOfValues,\n  boundObjectOf as objectOf,\n  boundString as string,\n  boundEnumOf as enumOf\n};\n","export const AMBIGUOUS = \"ambiguous\";\nexport const AUTHENTICATED = \"authenticated\";\nexport const LOGGED_OUT = \"loggedOut\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  string,\n  objectOf,\n  boolean,\n  arrayOf,\n  enumOf,\n  mapOfValues\n} from \"./validation/index\";\nimport {\n  AMBIGUOUS,\n  AUTHENTICATED,\n  LOGGED_OUT\n} from \"../constants/identityMapAuthenticatedState\";\n\nexport default mapOfValues(\n  arrayOf(\n    objectOf({\n      authenticatedState: enumOf(AMBIGUOUS, AUTHENTICATED, LOGGED_OUT),\n      id: string(),\n      namespace: objectOf({\n        code: string()\n      }).noUnknownFields(),\n      primary: boolean(),\n      xid: string()\n    })\n  ).required()\n);\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"alloy_debug\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { queryString, stringToBoolean } from \"../utils\";\nimport debugQueryParam from \"../constants/debugQueryParam\";\n\nexport default ({\n  console,\n  locationSearch,\n  createLogger,\n  instanceName,\n  createNamespacedStorage,\n  getMonitors\n}) => {\n  const parsedQueryString = queryString.parse(locationSearch);\n  const storage = createNamespacedStorage(`instance.${instanceName}.`);\n\n  const debugSessionValue = storage.session.getItem(\"debug\");\n  let debugEnabled = debugSessionValue === \"true\";\n  let debugEnabledWritableFromConfig = debugSessionValue === null;\n\n  const getDebugEnabled = () => debugEnabled;\n  const setDebugEnabled = (value, { fromConfig }) => {\n    if (!fromConfig || debugEnabledWritableFromConfig) {\n      debugEnabled = value;\n    }\n\n    if (!fromConfig) {\n      // Web storage only allows strings, so we explicitly convert to string.\n      storage.session.setItem(\"debug\", value.toString());\n      debugEnabledWritableFromConfig = false;\n    }\n  };\n\n  if (parsedQueryString[debugQueryParam] !== undefined) {\n    setDebugEnabled(stringToBoolean(parsedQueryString[debugQueryParam]), {\n      fromConfig: false\n    });\n  }\n\n  return {\n    setDebugEnabled,\n    logger: createLogger({\n      getDebugEnabled,\n      context: { instanceName },\n      getMonitors,\n      console\n    }),\n    createComponentLogger(componentName) {\n      return createLogger({\n        getDebugEnabled,\n        context: { instanceName, componentName },\n        getMonitors,\n        console\n      });\n    }\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// TO-DOCUMENT: Lifecycle hooks and their params.\nconst hookNames = [\n  // Called after all components have been registered.\n  \"onComponentsRegistered\",\n  // Called before an event is sent on a data collection request\n  \"onBeforeEvent\",\n  // Called before each request is made to the edge.\n  \"onBeforeRequest\",\n  // Called after each response is returned from the edge with a successful\n  // status code\n  \"onResponse\",\n  // Called after a network request to the edge fails. Either the request\n  // didn't make it to the edge, didn't make it to Konductor, or Konductor\n  // failed to return a regularly-structured response. (In this case { error }\n  // is passed as the parameter)\n  // Also called when the respone returns a 400 or 500 error. (In this case\n  // { response } is passed as the parameter)\n  \"onRequestFailure\",\n  // A user clicked on an element.\n  \"onClick\"\n];\n\nconst createHook = (componentRegistry, hookName) => {\n  return (...args) => {\n    return Promise.all(\n      componentRegistry.getLifecycleCallbacks(hookName).map(callback => {\n        return new Promise(resolve => {\n          resolve(callback(...args));\n        });\n      })\n    );\n  };\n};\n\n/**\n * This ensures that if a component's lifecycle method X\n * attempts to execute lifecycle method Y, that all X methods on all components\n * will have been called before any of their Y methods are called. It does\n * this by kicking the call to the Y method to the next JavaScript tick.\n * @returns {function}\n */\nconst guardHook = fn => {\n  return (...args) => {\n    return Promise.resolve().then(() => {\n      return fn(...args);\n    });\n  };\n};\n\nexport default componentRegistry => {\n  return hookNames.reduce((memo, hookName) => {\n    memo[hookName] = guardHook(createHook(componentRegistry, hookName));\n    return memo;\n  }, {});\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { intersection, stackError } from \"../utils\";\n\nconst wrapForErrorHandling = (fn, stackMessage) => {\n  return (...args) => {\n    let result;\n\n    try {\n      result = fn(...args);\n    } catch (error) {\n      throw stackError({ error, message: stackMessage });\n    }\n\n    if (result instanceof Promise) {\n      result = result.catch(error => {\n        throw stackError({ error, message: stackMessage });\n      });\n    }\n\n    return result;\n  };\n};\n\n// TO-DOCUMENT: All public commands and their signatures.\nexport default () => {\n  const componentsByNamespace = {};\n  const commandsByName = {};\n  const lifecycleCallbacksByName = {};\n\n  const registerComponentCommands = (\n    namespace,\n    componentCommandsByName = {}\n  ) => {\n    const conflictingCommandNames = intersection(\n      Object.keys(commandsByName),\n      Object.keys(componentCommandsByName)\n    );\n\n    if (conflictingCommandNames.length) {\n      throw new Error(\n        `[ComponentRegistry] Could not register ${namespace} ` +\n          `because it has existing command(s): ${conflictingCommandNames.join(\n            \",\"\n          )}`\n      );\n    }\n\n    Object.keys(componentCommandsByName).forEach(commandName => {\n      const command = componentCommandsByName[commandName];\n      command.commandName = commandName;\n      command.run = wrapForErrorHandling(\n        command.run,\n        `[${namespace}] An error occurred while executing the ${commandName} command.`\n      );\n      commandsByName[commandName] = command;\n    });\n  };\n\n  const registerLifecycleCallbacks = (\n    namespace,\n    componentLifecycleCallbacksByName = {}\n  ) => {\n    Object.keys(componentLifecycleCallbacksByName).forEach(hookName => {\n      lifecycleCallbacksByName[hookName] =\n        lifecycleCallbacksByName[hookName] || [];\n\n      lifecycleCallbacksByName[hookName].push(\n        wrapForErrorHandling(\n          componentLifecycleCallbacksByName[hookName],\n          `[${namespace}] An error occurred while executing the ${hookName} lifecycle hook.`\n        )\n      );\n    });\n  };\n\n  return {\n    register(namespace, component) {\n      const { commands, lifecycle } = component;\n      registerComponentCommands(namespace, commands);\n      registerLifecycleCallbacks(namespace, lifecycle);\n      componentsByNamespace[namespace] = component;\n    },\n    getCommand(commandName) {\n      return commandsByName[commandName];\n    },\n    getCommandNames() {\n      return Object.keys(commandsByName);\n    },\n    getLifecycleCallbacks(hookName) {\n      return lifecycleCallbacksByName[hookName] || [];\n    }\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { stackError } from \"../../utils\";\n\nexport default ({\n  logger,\n  sendFetchRequest,\n  sendBeaconRequest,\n  isRequestRetryable,\n  getRequestRetryDelay\n}) => {\n  /**\n   * Send a network request and returns details about the response.\n   */\n  return ({ requestId, url, payload, useSendBeacon }) => {\n    // We want to log raw payload and event data rather than\n    // our fancy wrapper objects. Calling payload.toJSON() is\n    // insufficient to get all the nested raw data, because it's\n    // not recursive (it doesn't call toJSON() on the event objects).\n    // Parsing the result of JSON.stringify(), however, gives the\n    // fully recursive raw data.\n    const stringifiedPayload = JSON.stringify(payload);\n    const parsedPayload = JSON.parse(stringifiedPayload);\n\n    logger.logOnBeforeNetworkRequest({\n      url,\n      requestId,\n      payload: parsedPayload\n    });\n\n    const executeRequest = (retriesAttempted = 0) => {\n      const requestMethod = useSendBeacon\n        ? sendBeaconRequest\n        : sendFetchRequest;\n\n      return requestMethod(url, stringifiedPayload).then(response => {\n        const requestIsRetryable = isRequestRetryable({\n          response,\n          retriesAttempted\n        });\n\n        if (requestIsRetryable) {\n          const requestRetryDelay = getRequestRetryDelay({\n            response,\n            retriesAttempted\n          });\n          return new Promise(resolve => {\n            setTimeout(() => {\n              resolve(executeRequest(retriesAttempted + 1));\n            }, requestRetryDelay);\n          });\n        }\n\n        let parsedBody;\n\n        try {\n          parsedBody = JSON.parse(response.body);\n        } catch (e) {\n          // Non-JSON. Something went wrong.\n        }\n\n        logger.logOnNetworkResponse({\n          requestId,\n          url,\n          payload: parsedPayload,\n          ...response,\n          parsedBody,\n          retriesAttempted\n        });\n\n        return {\n          statusCode: response.statusCode,\n          body: response.body,\n          parsedBody,\n          getHeader: response.getHeader\n        };\n      });\n    };\n\n    return executeRequest().catch(error => {\n      logger.logOnNetworkError({\n        requestId,\n        url,\n        payload: parsedPayload,\n        error\n      });\n      throw stackError({ error, message: \"Network request failed.\" });\n    });\n  };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ logger }) => adobeEdgeHeader => {\n  if (adobeEdgeHeader) {\n    const headerParts = adobeEdgeHeader.split(\";\");\n    if (headerParts.length >= 2 && headerParts[1].length > 0) {\n      try {\n        const regionId = parseInt(headerParts[1], 10);\n        // eslint recommends using Number.isNaN instead, but this function is\n        // not available in Internet Explorer. Number.isNaN is more robust to\n        // non-numeric parameters. Since we already know regionId will be an\n        // integer, using isNaN is okay.\n        // https://github.com/airbnb/javascript#standard-library--isnan\n        // eslint-disable-next-line no-restricted-globals\n        if (!isNaN(regionId)) {\n          return { regionId };\n        }\n      } catch (e) {\n        // No need to do anything. The log statement below will log an error\n      }\n    }\n    logger.warn(`Invalid adobe edge: \"${adobeEdgeHeader}\"`);\n  }\n  return {};\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const IN = \"in\";\nexport const OUT = \"out\";\nexport const PENDING = \"pending\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const GENERAL = \"general\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { defer } from \"../../utils\";\n\nexport const DECLINED_CONSENT = \"The user declined consent.\";\nexport const DECLINED_CONSENT_ERROR_CODE = \"declinedConsent\";\nexport const CONSENT_SOURCE_DEFAULT = \"default\";\nexport const CONSENT_SOURCE_INITIAL = \"initial\";\nexport const CONSENT_SOURCE_NEW = \"new\";\n\nconst createDeclinedConsentError = errorMessage => {\n  const error = new Error(errorMessage);\n  error.code = DECLINED_CONSENT_ERROR_CODE;\n  error.message = errorMessage;\n  return error;\n};\n\nexport default ({ logger }) => {\n  const deferreds = [];\n\n  const runAll = () => {\n    while (deferreds.length) {\n      deferreds.shift().resolve();\n    }\n  };\n  const discardAll = () => {\n    while (deferreds.length) {\n      deferreds\n        .shift()\n        .reject(createDeclinedConsentError(\"The user declined consent.\"));\n    }\n  };\n\n  const awaitInitial = () =>\n    Promise.reject(new Error(\"Consent has not been initialized.\"));\n  const awaitInDefault = () => Promise.resolve();\n  const awaitIn = () => Promise.resolve();\n  const awaitOutDefault = () =>\n    Promise.reject(\n      createDeclinedConsentError(\"No consent preferences have been set.\")\n    );\n  const awaitOut = () =>\n    Promise.reject(createDeclinedConsentError(\"The user declined consent.\"));\n  const awaitPending = returnImmediately => {\n    if (returnImmediately) {\n      return Promise.reject(new Error(\"Consent is pending.\"));\n    }\n    const deferred = defer();\n    deferreds.push(deferred);\n    return deferred.promise;\n  };\n\n  return {\n    in(source) {\n      if (source === CONSENT_SOURCE_DEFAULT) {\n        this.awaitConsent = awaitInDefault;\n      } else {\n        if (source === CONSENT_SOURCE_INITIAL) {\n          logger.info(\n            \"Loaded user consent preferences. The user previously consented.\"\n          );\n        } else if (\n          source === CONSENT_SOURCE_NEW &&\n          this.awaitConsent !== awaitIn\n        ) {\n          logger.info(\"User consented.\");\n        }\n        runAll();\n        this.awaitConsent = awaitIn;\n      }\n    },\n    out(source) {\n      if (source === CONSENT_SOURCE_DEFAULT) {\n        logger.warn(\n          \"User consent preferences not found. Default consent of out will be used.\"\n        );\n        this.awaitConsent = awaitOutDefault;\n      } else {\n        if (source === CONSENT_SOURCE_INITIAL) {\n          logger.warn(\n            \"Loaded user consent preferences. The user previously declined consent.\"\n          );\n        } else if (\n          source === CONSENT_SOURCE_NEW &&\n          this.awaitConsent !== awaitOut\n        ) {\n          logger.warn(\"User declined consent.\");\n        }\n        discardAll();\n        this.awaitConsent = awaitOut;\n      }\n    },\n    pending(source) {\n      if (source === CONSENT_SOURCE_DEFAULT) {\n        logger.info(\n          \"User consent preferences not found. Default consent of pending will be used. Some commands may be delayed.\"\n        );\n      }\n      this.awaitConsent = awaitPending;\n    },\n    awaitConsent: awaitInitial,\n    withConsent() {\n      return this.awaitConsent(true);\n    }\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { IN, OUT, PENDING } from \"../../constants/consentStatus\";\nimport { GENERAL } from \"../../constants/consentPurpose\";\nimport {\n  CONSENT_SOURCE_DEFAULT,\n  CONSENT_SOURCE_INITIAL,\n  CONSENT_SOURCE_NEW\n} from \"./createConsentStateMachine\";\n\nexport default ({ generalConsentState, logger }) => {\n  const setConsent = (consentByPurpose, source) => {\n    switch (consentByPurpose[GENERAL]) {\n      case IN:\n        generalConsentState.in(source);\n        break;\n      case OUT:\n        generalConsentState.out(source);\n        break;\n      case PENDING:\n        generalConsentState.pending(source);\n        break;\n      default:\n        logger.warn(`Unknown consent value: ${consentByPurpose[GENERAL]}`);\n        break;\n    }\n  };\n  return {\n    initializeConsent(defaultConsentByPurpose, storedConsentByPurpose) {\n      if (storedConsentByPurpose[GENERAL]) {\n        setConsent(storedConsentByPurpose, CONSENT_SOURCE_INITIAL);\n      } else {\n        setConsent(defaultConsentByPurpose, CONSENT_SOURCE_DEFAULT);\n      }\n    },\n    setConsent(consentByPurpose) {\n      setConsent(consentByPurpose, CONSENT_SOURCE_NEW);\n    },\n    suspend() {\n      generalConsentState.pending();\n    },\n    awaitConsent() {\n      return generalConsentState.awaitConsent();\n    },\n    withConsent() {\n      return generalConsentState.withConsent();\n    }\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isEmptyObject, deepAssign } from \"../utils\";\n\nexport default () => {\n  const content = {};\n  let userXdm;\n  let userData;\n  let documentMayUnload = false;\n  let isFinalized = false;\n  let shouldSendEvent = true;\n\n  const throwIfEventFinalized = methodName => {\n    if (isFinalized) {\n      throw new Error(\n        `${methodName} cannot be called after event is finalized.`\n      );\n    }\n  };\n\n  const event = {\n    setUserXdm(value) {\n      throwIfEventFinalized(\"setUserXdm\");\n      userXdm = value;\n    },\n    setUserData(value) {\n      throwIfEventFinalized(\"setUserData\");\n      userData = value;\n    },\n    mergeXdm(xdm) {\n      throwIfEventFinalized(\"mergeXdm\");\n      if (xdm) {\n        deepAssign(content, { xdm });\n      }\n    },\n    mergeMeta(meta) {\n      throwIfEventFinalized(\"mergeMeta\");\n      if (meta) {\n        deepAssign(content, { meta });\n      }\n    },\n    mergeQuery(query) {\n      throwIfEventFinalized(\"mergeQuery\");\n      if (query) {\n        deepAssign(content, { query });\n      }\n    },\n    documentMayUnload() {\n      documentMayUnload = true;\n    },\n    finalize(onBeforeEventSend) {\n      if (isFinalized) {\n        return;\n      }\n\n      if (userXdm) {\n        event.mergeXdm(userXdm);\n      }\n\n      if (userData) {\n        content.data = userData;\n      }\n\n      // the event should already be considered finalized in case onBeforeEventSend throws an error\n      isFinalized = true;\n\n      if (onBeforeEventSend) {\n        // assume that the onBeforeEventSend callback will fail (in-case of an error)\n        shouldSendEvent = false;\n\n        // this allows the user to replace the xdm and data properties\n        // on the object passed to the callback\n        const tempContent = {\n          xdm: content.xdm || {},\n          data: content.data || {}\n        };\n\n        const result = onBeforeEventSend(tempContent);\n\n        shouldSendEvent = result !== false;\n\n        content.xdm = tempContent.xdm || {};\n        content.data = tempContent.data || {};\n\n        if (isEmptyObject(content.xdm)) {\n          delete content.xdm;\n        }\n\n        if (isEmptyObject(content.data)) {\n          delete content.data;\n        }\n      }\n    },\n    getDocumentMayUnload() {\n      return documentMayUnload;\n    },\n    isEmpty() {\n      return (\n        isEmptyObject(content) &&\n        (!userXdm || isEmptyObject(userXdm)) &&\n        (!userData || isEmptyObject(userData))\n      );\n    },\n    shouldSend() {\n      return shouldSendEvent;\n    },\n    getViewName() {\n      if (!userXdm || !userXdm.web || !userXdm.web.webPageDetails) {\n        return undefined;\n      }\n\n      return userXdm.web.webPageDetails.viewName;\n    },\n    toJSON() {\n      if (!isFinalized) {\n        throw new Error(\"toJSON called before finalize\");\n      }\n\n      return content;\n    }\n  };\n\n  return event;\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const RETRY_AFTER = \"Retry-After\";\nexport const ADOBE_EDGE = \"x-adobe-edge\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { flatMap } from \"../utils\";\nimport { ADOBE_EDGE } from \"../constants/httpHeaderNames\";\n\n/**\n * Creates a representation of a gateway response with the addition of\n * helper methods.\n * @returns Response\n */\nexport default ({ extractEdgeInfo }) => ({ content = {}, getHeader }) => {\n  const { handle = [], errors = [], warnings = [] } = content;\n\n  /**\n   * Response object.\n   * @typedef {Object} Response\n   */\n  return {\n    /**\n     * Returns matching fragments of the response by type.\n     * @param {String} type A string with the current format: <namespace:action>\n     *\n     * @example\n     * getPayloadsByType(\"identity:persist\")\n     */\n    getPayloadsByType(type) {\n      return flatMap(\n        handle.filter(fragment => fragment.type === type),\n        fragment => fragment.payload\n      );\n    },\n    /**\n     * Returns all errors.\n     */\n    getErrors() {\n      return errors;\n    },\n    /**\n     * Returns all warnings.\n     */\n    getWarnings() {\n      return warnings;\n    },\n    /**\n     * Returns an object containing the regionId from the x-adobe-edge header\n     */\n    getEdge() {\n      return extractEdgeInfo(getHeader(ADOBE_EDGE));\n    },\n    toJSON() {\n      return content;\n    }\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const CONFIGURE = \"configure\";\nexport const SET_DEBUG = \"setDebug\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isFunction, isObject } from \"../utils\";\nimport { CONFIGURE, SET_DEBUG } from \"../constants/coreCommands\";\n\nexport default ({\n  logger,\n  configureCommand,\n  setDebugCommand,\n  handleError,\n  validateCommandOptions\n}) => {\n  let configurePromise;\n\n  const getExecutor = (commandName, options) => {\n    let executor;\n\n    if (commandName === CONFIGURE) {\n      if (configurePromise) {\n        throw new Error(\n          \"The library has already been configured and may only be configured once.\"\n        );\n      }\n      executor = () => {\n        configurePromise = configureCommand(options);\n        return configurePromise.then(() => {\n          // Don't expose internals to the user.\n        });\n      };\n    } else {\n      if (!configurePromise) {\n        throw new Error(\n          `The library must be configured first. Please do so by executing the configure command.`\n        );\n      }\n      if (commandName === SET_DEBUG) {\n        executor = () => setDebugCommand(options);\n      } else {\n        executor = () => {\n          return configurePromise.then(\n            componentRegistry => {\n              const command = componentRegistry.getCommand(commandName);\n              if (!command || !isFunction(command.run)) {\n                const commandNames = [CONFIGURE, SET_DEBUG]\n                  .concat(componentRegistry.getCommandNames())\n                  .join(\", \");\n                throw new Error(\n                  `The ${commandName} command does not exist. List of available commands: ${commandNames}.`\n                );\n              }\n              const validatedOptions = validateCommandOptions({\n                command,\n                options\n              });\n              return command.run(validatedOptions);\n            },\n            () => {\n              logger.warn(\n                `An error during configuration is preventing the ${commandName} command from executing.`\n              );\n              // If configuration failed, we prevent the configuration\n              // error from bubbling here because we don't want the\n              // configuration error to be reported in the console every\n              // time any command is executed. Only having it bubble\n              // once when the configure command runs is sufficient.\n              // Instead, for this command, we'll just return a promise\n              // that never gets resolved.\n              return new Promise(() => {});\n            }\n          );\n        };\n      }\n    }\n\n    return executor;\n  };\n\n  return (commandName, options = {}) => {\n    return new Promise(resolve => {\n      // We have to wrap the getExecutor() call in the promise so the promise\n      // will be rejected if getExecutor() throws errors.\n      const executor = getExecutor(commandName, options);\n      logger.logOnBeforeCommand({ commandName, options });\n      resolve(executor());\n    })\n      .catch(error => {\n        return handleError(error, `${commandName} command`);\n      })\n      .catch(error => {\n        logger.logOnCommandRejected({ commandName, options, error });\n        throw error;\n      })\n      .then(rawResult => {\n        // We should always be returning an object from every command.\n        const result = isObject(rawResult) ? rawResult : {};\n        logger.logOnCommandResolved({ commandName, options, result });\n        return result;\n      });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nconst COMMAND_DOC_URI = \"https://adobe.ly/3sHgQHb\";\n\nexport default ({ command, options }) => {\n  const {\n    commandName,\n    documentationUri = COMMAND_DOC_URI,\n    optionsValidator\n  } = command;\n  let validatedOptions = options;\n  if (optionsValidator) {\n    try {\n      validatedOptions = optionsValidator(options);\n    } catch (validationError) {\n      const invalidOptionsMessage = `Invalid ${commandName} command options:\\n\\t - ${validationError} For command documentation see: ${documentationUri}`;\n      throw new Error(invalidOptionsMessage);\n    }\n  }\n  return validatedOptions;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { string, objectOf, boolean, arrayOf } from \"../../utils/validation\";\nimport { validateIdentityMap } from \"../../utils\";\n/**\n * Verifies user provided event options.\n * @param {*} options The user event options to validate\n * @returns {*} Validated options\n */\nexport default ({ options }) => {\n  const eventOptionsValidator = objectOf({\n    type: string(),\n    xdm: objectOf({\n      eventType: string(),\n      identityMap: validateIdentityMap\n    }),\n    data: objectOf({}),\n    renderDecisions: boolean(),\n    decisionScopes: arrayOf(string()),\n    datasetId: string()\n  }).required();\n  return eventOptionsValidator(options);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport validateUserEventOptions from \"./validateUserEventOptions\";\n\nconst createDataCollector = ({ eventManager }) => {\n  return {\n    commands: {\n      sendEvent: {\n        documentationUri: \"https://adobe.ly/3GQ3Q7t\",\n        optionsValidator: options => {\n          return validateUserEventOptions({ options });\n        },\n        run: options => {\n          const {\n            xdm,\n            data,\n            documentUnloading = false,\n            type,\n            mergeId,\n            renderDecisions = false,\n            decisionScopes = [],\n            datasetId\n          } = options;\n          const event = eventManager.createEvent();\n\n          if (documentUnloading) {\n            event.documentMayUnload();\n          }\n\n          event.setUserXdm(xdm);\n          event.setUserData(data);\n\n          if (type) {\n            event.mergeXdm({\n              eventType: type\n            });\n          }\n\n          if (mergeId) {\n            event.mergeXdm({\n              eventMergeId: mergeId\n            });\n          }\n\n          if (datasetId) {\n            event.mergeMeta({\n              collect: {\n                datasetId\n              }\n            });\n          }\n\n          return eventManager.sendEvent(event, {\n            renderDecisions,\n            decisionScopes\n          });\n        }\n      }\n    }\n  };\n};\n\ncreateDataCollector.namespace = \"DataCollector\";\ncreateDataCollector.configValidators = {};\n\nexport default createDataCollector;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { noop } from \"../../utils\";\n\nconst createClickHandler = ({ eventManager, lifecycle, handleError }) => {\n  return clickEvent => {\n    // TODO: Consider safeguarding from the same object being clicked multiple times in rapid succession?\n    const clickedElement = clickEvent.target;\n    const event = eventManager.createEvent();\n    return (\n      lifecycle\n        .onClick({ event, clickedElement })\n        .then(() => {\n          if (event.isEmpty()) {\n            return Promise.resolve();\n          }\n          return eventManager.sendEvent(event);\n        })\n        // eventManager.sendEvent() will return a promise resolved to an\n        // object and we want to avoid returning any value to the customer\n        .then(noop)\n        .catch(error => {\n          handleError(error, \"click collection\");\n        })\n    );\n  };\n};\n\nexport default ({ config, eventManager, lifecycle, handleError }) => {\n  const enabled = config.clickCollectionEnabled;\n\n  if (!enabled) {\n    return;\n  }\n\n  const clickHandler = createClickHandler({\n    eventManager,\n    lifecycle,\n    handleError\n  });\n\n  document.addEventListener(\"click\", clickHandler, true);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { string, boolean } from \"../../utils/validation\";\n\nexport default {\n  clickCollectionEnabled: boolean().default(true),\n  downloadLinkQualifier: string()\n    .regexp()\n    .default(\n      \"\\\\.(exe|zip|wav|mp3|mov|mpg|avi|wmv|pdf|doc|docx|xls|xlsx|ppt|pptx)$\"\n    )\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nconst urlStartsWithScheme = url => {\n  return url && /^[a-z0-9]+:\\/\\//i.test(url);\n};\n\nconst getAbsoluteUrlFromAnchorElement = (window, element) => {\n  const loc = window.location;\n  let url = element.href ? element.href : \"\";\n  let { protocol, host } = element;\n  if (!urlStartsWithScheme(url)) {\n    if (!protocol) {\n      protocol = loc.protocol ? loc.protocol : \"\";\n    }\n    protocol = protocol ? `${protocol}//` : \"\";\n    if (!host) {\n      host = loc.host ? loc.host : \"\";\n    }\n    let path = \"\";\n    if (url.substring(0, 1) !== \"/\") {\n      let indx = loc.pathname.lastIndexOf(\"/\");\n      indx = indx < 0 ? 0 : indx;\n      path = loc.pathname.substring(0, indx);\n    }\n    url = `${protocol}${host}${path}/${url}`;\n  }\n  return url;\n};\n\nconst isSupportedAnchorElement = element => {\n  if (\n    element.href &&\n    (element.tagName === \"A\" || element.tagName === \"AREA\") &&\n    (!element.onclick ||\n      !element.protocol ||\n      element.protocol.toLowerCase().indexOf(\"javascript\") < 0)\n  ) {\n    return true;\n  }\n  return false;\n};\n\nconst isDownloadLink = (downloadLinkQualifier, linkUrl, clickedObj) => {\n  const re = new RegExp(downloadLinkQualifier);\n  return clickedObj.download ? true : re.test(linkUrl.toLowerCase());\n};\n\nconst isExitLink = (window, linkUrl) => {\n  const currentHostname = window.location.hostname.toLowerCase();\n  if (linkUrl.toLowerCase().indexOf(currentHostname) >= 0) {\n    return false;\n  }\n  return true;\n};\n\nexport {\n  urlStartsWithScheme,\n  getAbsoluteUrlFromAnchorElement,\n  isSupportedAnchorElement,\n  isDownloadLink,\n  isExitLink\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  getAbsoluteUrlFromAnchorElement,\n  isSupportedAnchorElement,\n  isDownloadLink,\n  isExitLink\n} from \"./utils\";\n\nconst determineLinkType = (window, config, linkUrl, clickedObj) => {\n  let linkType = \"other\";\n  if (isDownloadLink(config.downloadLinkQualifier, linkUrl, clickedObj)) {\n    linkType = \"download\";\n  } else if (isExitLink(window, linkUrl)) {\n    linkType = \"exit\";\n  }\n  return linkType;\n};\n\nconst findSupportedAnchorElement = targetElement => {\n  let node = targetElement;\n  while (node) {\n    if (isSupportedAnchorElement(node)) {\n      return node;\n    }\n    node = node.parentNode;\n  }\n  return null;\n};\n\nexport default (window, config) => {\n  return (event, targetElement) => {\n    // Search parent elements for an anchor element\n    // TODO: Replace with generic DOM tool that can fetch configured properties\n    const anchorElement = findSupportedAnchorElement(targetElement);\n    if (!anchorElement) {\n      return;\n    }\n\n    const linkUrl = getAbsoluteUrlFromAnchorElement(window, anchorElement);\n    if (!linkUrl) {\n      return;\n    }\n\n    const linkType = determineLinkType(window, config, linkUrl, anchorElement);\n    // TODO: Update link name from the clicked element context\n    const linkName = \"Link Click\";\n\n    event.documentMayUnload();\n    event.mergeXdm({\n      eventType: \"web.webinteraction.linkClicks\",\n      web: {\n        webInteraction: {\n          name: linkName,\n          type: linkType,\n          URL: linkUrl,\n          linkClicks: {\n            value: 1\n          }\n        }\n      }\n    });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport attachClickActivityCollector from \"./attachClickActivityCollector\";\nimport configValidators from \"./configValidators\";\nimport createLinkClick from \"./createLinkClick\";\n\nconst createActivityCollector = ({ config, eventManager, handleError }) => {\n  const linkClick = createLinkClick(window, config);\n\n  return {\n    lifecycle: {\n      onComponentsRegistered(tools) {\n        const { lifecycle } = tools;\n        attachClickActivityCollector({\n          config,\n          eventManager,\n          lifecycle,\n          handleError\n        });\n        // TODO: createScrollActivityCollector ...\n      },\n      onClick({ event, clickedElement }) {\n        linkClick(event, clickedElement);\n      }\n    }\n  };\n};\n\ncreateActivityCollector.namespace = \"ActivityCollector\";\ncreateActivityCollector.configValidators = configValidators;\n\nexport default createActivityCollector;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { noop } from \"../../utils\";\n\nconst createResultLogMessage = (idSync, success) => {\n  return `ID sync ${success ? \"succeeded\" : \"failed\"}: ${idSync.spec.url}`;\n};\n\nexport default ({ fireReferrerHideableImage, logger }) => idSyncs => {\n  const urlIdSyncs = idSyncs.filter(idSync => idSync.type === \"url\");\n\n  if (!urlIdSyncs.length) {\n    return Promise.resolve();\n  }\n  return Promise.all(\n    urlIdSyncs.map(idSync => {\n      return fireReferrerHideableImage(idSync.spec)\n        .then(() => {\n          logger.info(createResultLogMessage(idSync, true));\n        })\n        .catch(() => {\n          // We intentionally do not throw an error if id syncs fail. We\n          // consider it a non-critical failure and therefore do not want it to\n          // reject the promise handed back to the customer.\n          logger.error(createResultLogMessage(idSync, false));\n        });\n    })\n  ).then(noop);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { boolean } from \"../../utils/validation\";\n\nconst configValidators = {\n  thirdPartyCookiesEnabled: boolean().default(true),\n  idMigrationEnabled: boolean().default(true)\n};\n\nexport default configValidators;\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { objectOf, literal, arrayOf } from \"../../../utils/validation\";\n/**\n * Verifies user provided event options.\n * @param {*} options The user event options to validate\n * @returns {*} Validated options\n */\nexport default options => {\n  const getIdentityOptionsValidator = objectOf({\n    namespaces: arrayOf(literal(\"ECID\")).nonEmpty()\n  }).noUnknownFields();\n  getIdentityOptionsValidator(options);\n  // Return default options for now\n  // To-Do: Accept namespace from given options\n  return {\n    namespaces: [\"ECID\"]\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { objectOf, string } from \"../../../utils/validation\";\n/**\n * Verifies user provided event options.\n * @param {*} options The user event options to validate\n * @returns {*} Validated options\n */\nexport default objectOf({\n  url: string()\n    .required()\n    .nonEmpty()\n})\n  .required()\n  .noUnknownFields();\n","import { assign } from \"../../utils\";\nimport getIdentityOptionsValidator from \"./getIdentity/getIdentityOptionsValidator\";\nimport appendIdentityToUrlOptionsValidator from \"./appendIdentityToUrl/appendIdentityToUrlOptionsValidator\";\n\nexport default ({\n  addEcidQueryToPayload,\n  addQueryStringIdentityToPayload,\n  ensureSingleIdentity,\n  setLegacyEcid,\n  handleResponseForIdSyncs,\n  getEcidFromResponse,\n  getIdentity,\n  consent,\n  appendIdentityToUrl,\n  logger\n}) => {\n  let ecid;\n  let edge = {};\n  return {\n    lifecycle: {\n      onBeforeRequest({ request, onResponse, onRequestFailure }) {\n        // Querying the ECID on every request to be able to set the legacy cookie, and make it\n        // available for the `getIdentity` command.\n        addEcidQueryToPayload(request.getPayload());\n        addQueryStringIdentityToPayload(request.getPayload());\n        return ensureSingleIdentity({ request, onResponse, onRequestFailure });\n      },\n      onResponse({ response }) {\n        if (!ecid) {\n          ecid = getEcidFromResponse(response);\n\n          // Only data collection calls will have an ECID in the response.\n          // https://jira.corp.adobe.com/browse/EXEG-1234\n          if (ecid) {\n            setLegacyEcid(ecid);\n          }\n        }\n        // For sendBeacon requests, getEdge() will return {}, so we are using assign here\n        // so that sendBeacon requests don't override the edge info from before.\n        edge = assign(edge, response.getEdge());\n\n        return handleResponseForIdSyncs(response);\n      }\n    },\n    commands: {\n      getIdentity: {\n        optionsValidator: getIdentityOptionsValidator,\n        run: options => {\n          return consent\n            .awaitConsent()\n            .then(() => {\n              return ecid ? undefined : getIdentity(options.namespaces);\n            })\n            .then(() => {\n              return {\n                identity: {\n                  ECID: ecid\n                },\n                edge\n              };\n            });\n        }\n      },\n      appendIdentityToUrl: {\n        optionsValidator: appendIdentityToUrlOptionsValidator,\n        run: options => {\n          return consent\n            .withConsent()\n            .then(() => {\n              return ecid ? undefined : getIdentity(options.namespaces);\n            })\n            .then(() => {\n              return { url: appendIdentityToUrl(ecid, options.url) };\n            })\n            .catch(error => {\n              logger.warn(`Unable to append identity to url. ${error.message}`);\n              return options;\n            });\n        }\n      }\n    }\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Handles migration of ECID to and from Visitor.js.\n */\nexport default ({\n  config,\n  getEcidFromVisitor,\n  apexDomain,\n  isPageSsl,\n  cookieJar\n}) => {\n  const { idMigrationEnabled, orgId } = config;\n  const amcvCookieName = `AMCV_${orgId}`;\n\n  const getEcidFromLegacyCookies = () => {\n    let ecid = null;\n    const secidCookieName = \"s_ecid\";\n\n    const legacyEcidCookieValue =\n      cookieJar.get(secidCookieName) || cookieJar.get(amcvCookieName);\n\n    if (legacyEcidCookieValue) {\n      const reg = /(^|\\|)MCMID\\|(\\d+)($|\\|)/;\n      const matches = legacyEcidCookieValue.match(reg);\n\n      if (matches) {\n        // Destructuring arrays breaks in IE\n        ecid = matches[2];\n      }\n    }\n\n    return ecid;\n  };\n\n  return {\n    getEcid() {\n      if (idMigrationEnabled) {\n        const ecid = getEcidFromLegacyCookies();\n        if (ecid) {\n          return Promise.resolve(ecid);\n        }\n        return getEcidFromVisitor();\n      }\n      return Promise.resolve();\n    },\n    setEcid(ecid) {\n      if (idMigrationEnabled && getEcidFromLegacyCookies() !== ecid) {\n        const extraOptions = isPageSsl\n          ? { sameSite: \"none\", secure: true }\n          : {};\n\n        cookieJar.set(amcvCookieName, `MCMID|${ecid}`, {\n          domain: apexDomain,\n          // Without `expires` this will be a session cookie.\n          expires: 390, // days, or 13 months.\n          ...extraOptions\n        });\n      }\n    }\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isObject } from \"../../../utils\";\n\nexport default ({ logger }) => {\n  return new Promise((resolve, reject) => {\n    if (isObject(window.adobe) && isObject(window.adobe.optIn)) {\n      const optInOld = window.adobe.optIn;\n      logger.info(\n        \"Delaying request while waiting for legacy opt-in to let Visitor retrieve ECID from server.\"\n      );\n      optInOld.fetchPermissions(() => {\n        if (optInOld.isApproved([optInOld.Categories.ECID])) {\n          logger.info(\n            \"Received legacy opt-in approval to let Visitor retrieve ECID from server.\"\n          );\n          resolve();\n        } else {\n          reject(new Error(\"Legacy opt-in was declined.\"));\n        }\n      }, true);\n    } else {\n      resolve();\n    }\n  });\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isFunction } from \"../../../utils\";\n\nexport default window => {\n  const Visitor = window.Visitor;\n  return isFunction(Visitor) && isFunction(Visitor.getInstance) && Visitor;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport getVisitor from \"./getVisitor\";\n\nexport default ({ logger, orgId, awaitVisitorOptIn }) => {\n  const Visitor = getVisitor(window);\n  return () => {\n    if (Visitor) {\n      // Need to explicitly wait for optIn because visitor will call callback\n      // with invalid values prior to optIn being approved\n      return awaitVisitorOptIn({ logger })\n        .then(() => {\n          logger.info(\n            \"Delaying request while using Visitor to retrieve ECID from server.\"\n          );\n\n          return new Promise(resolve => {\n            const visitor = Visitor.getInstance(orgId, {});\n            visitor.getMarketingCloudVisitorID(ecid => {\n              logger.info(\n                \"Resuming previously delayed request that was waiting for ECID from Visitor.\"\n              );\n              resolve(ecid);\n            }, true);\n          });\n        })\n        .catch(error => {\n          // If consent was denied, get the ECID from experience edge. OptIn and AEP Web SDK\n          // consent should operate independently, but during id migration AEP Web SDK needs\n          // to wait for optIn object consent resolution so that only one ECID is generated.\n          if (error) {\n            logger.info(\n              `${error.message}, retrieving ECID from experience edge`\n            );\n          } else {\n            logger.info(\n              \"An error occurred while obtaining the ECID from Visitor.\"\n            );\n          }\n        });\n    }\n    return Promise.resolve();\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ processIdSyncs }) => {\n  return response => {\n    return processIdSyncs(response.getPayloadsByType(\"identity:exchange\"));\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// TO-DOCUMENT: We queue subsequent requests until we have an identity cookie.\nexport default ({\n  doesIdentityCookieExist,\n  setDomainForInitialIdentityPayload,\n  addLegacyEcidToPayload,\n  awaitIdentityCookie,\n  logger\n}) => {\n  let obtainedIdentityPromise;\n\n  const allowRequestToGoWithoutIdentity = request => {\n    setDomainForInitialIdentityPayload(request);\n    return addLegacyEcidToPayload(request.getPayload());\n  };\n\n  /**\n   * Ensures that if no identity cookie exists, we only let one request at a\n   * time without an identity until its response returns. In the meantime,\n   * we queue all other requests, otherwise the requests could result in\n   * multiple ECIDs being minted for the user. Once we get an identity\n   * cookie, we can let the queued requests be sent all at once, since they\n   * will have the newly minted ECID.\n   *\n   * Konductor should make every effort to return an identity, but in\n   * certain scenarios it may not. For example, in cases where the\n   * request does not match what Konductor is expecting (ie 400s).\n   * In cases where Konductor does not set an identity, there should be\n   * no events recorded so we don't need to worry about multiple ECIDs\n   * being minted for each user.\n   *\n   * The reason we allow for multiple sequential requests to be sent without\n   * an identity is to prevent a single malformed request causing all other\n   * requests to never send.\n   */\n  return ({ request, onResponse, onRequestFailure }) => {\n    if (doesIdentityCookieExist()) {\n      request.setIsIdentityEstablished();\n      return Promise.resolve();\n    }\n\n    if (obtainedIdentityPromise) {\n      // We don't have an identity cookie, but at least one request has\n      // been sent to get it. Konductor may set the identity cookie in the\n      // response. We will hold up this request until the last request\n      // requiring identity returns and awaitIdentityCookie confirms the\n      // identity was set.\n      logger.info(\"Delaying request while retrieving ECID from server.\");\n      const previousObtainedIdentityPromise = obtainedIdentityPromise;\n\n      // This promise resolves when we have an identity cookie. Additional\n      // requests are chained together so that only one is sent at a time\n      // until we have the identity cookie.\n      obtainedIdentityPromise = previousObtainedIdentityPromise.catch(() => {\n        return awaitIdentityCookie({ onResponse, onRequestFailure });\n      });\n\n      // When this returned promise resolves, the request will go out.\n      return (\n        previousObtainedIdentityPromise\n          .then(() => {\n            logger.info(\"Resuming previously delayed request.\");\n            request.setIsIdentityEstablished();\n          })\n          // If Konductor did not set the identity cookie on the previous\n          // request, then awaitIdentityCookie will reject its promise.\n          // Catch the rejection here and allow this request to go out.\n          .catch(() => {\n            return allowRequestToGoWithoutIdentity(request);\n          })\n      );\n    }\n\n    // For Alloy+Konductor communication to be as robust as possible and\n    // to ensure we don't mint new ECIDs for requests that would otherwise\n    // be sent in parallel, we'll let this request go out to fetch the\n    // cookie\n    obtainedIdentityPromise = awaitIdentityCookie({\n      onResponse,\n      onRequestFailure\n    });\n    return allowRequestToGoWithoutIdentity(request);\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"ECID\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport ecidNamespace from \"../../constants/ecidNamespace\";\n\nexport default payload => {\n  payload.mergeQuery({\n    identity: {\n      fetch: [ecidNamespace]\n    }\n  });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport memoize from \"./memoize\";\n\nimport {\n  EDGE,\n  EDGE_CHROMIUM,\n  CHROME,\n  FIREFOX,\n  IE,\n  SAFARI,\n  UNKNOWN\n} from \"../constants/browser\";\n\nconst matchUserAgent = regexs => {\n  return userAgent => {\n    const keys = Object.keys(regexs);\n    for (let i = 0; i < keys.length; i += 1) {\n      const key = keys[i];\n      const regex = regexs[key];\n      if (regex.test(userAgent)) {\n        return key;\n      }\n    }\n    return UNKNOWN;\n  };\n};\n\nexport default memoize(window => {\n  return matchUserAgent({\n    /*\n    The MIT License (MIT)\n\n    Copyright (c) 2019 Damon Oehlman damon.oehlman@gmail.com\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to\n    deal in the Software without restriction, including without limitation the\n    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n    sell copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in\n    all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n    DEALINGS IN THE SOFTWARE.\n    */\n    // Regular expression patterns were copied from\n    // https://github.com/DamonOehlman/detect-browser\n    // These are only the browsers that Alloy officially supports.\n    /* eslint-disable */\n    [EDGE]: /Edge\\/([0-9\\._]+)/,\n    // Edge Chromium can dynamically change its user agent string based\n    // on the host site:\n    // https://winaero.com/blog/microsoft-edge-chromium-dynamically-changes-its-user-agent/\n    [EDGE_CHROMIUM]: /Edg\\/([0-9\\.]+)/,\n    [CHROME]: /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/,\n    [FIREFOX]: /Firefox\\/([0-9\\.]+)(?:\\s|$)/,\n    // This only covers version 11 of IE, but that's all we support.\n    [IE]: /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/,\n    [SAFARI]: /Version\\/([0-9\\._]+).*Safari/\n    /* eslint-enable */\n  })(window.navigator.userAgent);\n});\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport getBrowser from \"../../utils/getBrowser\";\n\nexport default ({\n  thirdPartyCookiesEnabled,\n  areThirdPartyCookiesSupportedByDefault\n}) => {\n  return request => {\n    if (\n      thirdPartyCookiesEnabled &&\n      areThirdPartyCookiesSupportedByDefault(getBrowser(window))\n    ) {\n      // If third-party cookies are enabled by the customer and\n      // supported by the browser, we will send the request to a\n      // a third-party identification domain that allows for more accurate\n      // identification of the user through use of a third-party cookie.\n      // If we have an identity to migrate, we still want to hit the\n      // third-party identification domain because the third-party identification\n      // domain will use our ECID to set the third-party cookie if the third-party\n      // cookie isn't already set, which provides for better cross-domain\n      // identification for future requests.\n      request.setUseIdThirdPartyDomain();\n    }\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport ecidNamespace from \"../../constants/ecidNamespace\";\n\nexport default ({ getLegacyEcid, addEcidToPayload }) => {\n  return payload => {\n    if (payload.hasIdentity(ecidNamespace)) {\n      // don't get the legacy identity if we already have the query string identity or if\n      // the user specified it in the identity map\n      return Promise.resolve();\n    }\n    return getLegacyEcid().then(ecidToMigrate => {\n      if (ecidToMigrate) {\n        addEcidToPayload(payload, ecidToMigrate);\n      }\n    });\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"adobe_mc\";\n","// Example: adobe_mc=TS%3D1641432103%7CMCMID%3D77094828402023918047117570965393734545%7CMCORGID%3DFAF554945B90342F0A495E2C%40AdobeOrg\n// Decoded: adobe_mc=TS=1641432103|MCMID=77094828402023918047117570965393734545|MCORGID=FAF554945B90342F0A495E2C@AdobeOrg\n\nimport { queryString } from \"../../utils\";\nimport queryStringIdentityParam from \"../../constants/queryStringIdentityParam\";\nimport ecidNamespace from \"../../constants/ecidNamespace\";\n\nconst LINK_TTL_SECONDS = 300; // 5 minute link time to live\n\nexport default ({ locationSearch, dateProvider, orgId, logger }) => payload => {\n  if (payload.hasIdentity(ecidNamespace)) {\n    // don't overwrite a user provided ecid identity\n    return;\n  }\n\n  const parsedQueryString = queryString.parse(locationSearch);\n  const queryStringValue = parsedQueryString[queryStringIdentityParam];\n  if (queryStringValue === undefined) {\n    return;\n  }\n\n  const properties = queryStringValue.split(\"|\").reduce((memo, keyValue) => {\n    const [key, value] = keyValue.split(\"=\");\n    memo[key] = value;\n    return memo;\n  }, {});\n  // We are using MCMID and MCORGID to be compatible with Visitor.\n  const ts = parseInt(properties.TS, 10);\n  const mcmid = properties.MCMID;\n  const mcorgid = decodeURIComponent(properties.MCORGID);\n\n  if (\n    // When TS is not specified or not a number, the following inequality returns false.\n    // All inequalities with NaN variables are false.\n    dateProvider().getTime() / 1000 <= ts + LINK_TTL_SECONDS &&\n    mcorgid === orgId &&\n    mcmid\n  ) {\n    logger.info(\n      `Found valid ECID identity ${mcmid} from the adobe_mc query string parameter.`\n    );\n    payload.addIdentity(ecidNamespace, {\n      id: mcmid\n    });\n  } else {\n    logger.info(\"Detected invalid or expired adobe_mc query string parameter.\");\n  }\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport ecidNamespace from \"../../constants/ecidNamespace\";\n\nexport default (payload, ecid) => {\n  payload.addIdentity(ecidNamespace, {\n    id: ecid\n  });\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ doesIdentityCookieExist, orgId }) => {\n  /**\n   * Returns a promise that will be resolved once an identity cookie exists.\n   * If an identity cookie doesn't already exist, it should always exist after\n   * the first response.\n   */\n  return ({ onResponse, onRequestFailure }) => {\n    return new Promise((resolve, reject) => {\n      onResponse(() => {\n        if (doesIdentityCookieExist()) {\n          resolve();\n        } else {\n          // This logic assumes that the code setting the cookie is working as expected and that\n          // the cookie was missing from the response.\n          const noIdentityCookieError = new Error(\n            `An identity was not set properly. Please verify that the org ID ${orgId} configured in Alloy matches the org ID specified in the edge configuration.`\n          );\n\n          // Rejecting the promise will reject commands that were queued\n          // by the Identity component while waiting on the response to\n          // the initial request.\n          reject(noIdentityCookieError);\n\n          // Throwing an error will reject the event command that initiated\n          // the request.\n          throw noIdentityCookieError;\n        }\n      });\n      onRequestFailure(() => {\n        if (doesIdentityCookieExist()) {\n          resolve();\n        } else {\n          // The error from the request failure will be logged separately. Rejecting this here\n          // will tell ensureSingleIdentity to send the next request without identity\n          reject(new Error(\"No identity was set on response.\"));\n        }\n      });\n    });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { find } from \"../../utils\";\nimport ecidNamespace from \"../../constants/ecidNamespace\";\n\nexport default response => {\n  const identityResultPayloads = response.getPayloadsByType(\"identity:result\");\n  const ecidPayload = find(\n    identityResultPayloads,\n    payload => payload.namespace && payload.namespace.code === ecidNamespace\n  );\n  return ecidPayload ? ecidPayload.id : undefined;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({\n  sendEdgeNetworkRequest,\n  createIdentityRequestPayload,\n  createIdentityRequest\n}) => {\n  return namespaces => {\n    const payload = createIdentityRequestPayload(namespaces);\n    const request = createIdentityRequest(payload);\n    return sendEdgeNetworkRequest({\n      request\n    });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nexport default content => {\n  return (namespaceCode, identity) => {\n    content.xdm = content.xdm || {};\n    content.xdm.identityMap = content.xdm.identityMap || {};\n    content.xdm.identityMap[namespaceCode] =\n      content.xdm.identityMap[namespaceCode] || [];\n    content.xdm.identityMap[namespaceCode].push(identity);\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { uuid } from \"..\";\n\n// This provides the base functionality that all types of requests share.\nexport default options => {\n  const { payload, getAction, getUseSendBeacon } = options;\n  const id = uuid();\n  let shouldUseThirdPartyDomain = false;\n  let isIdentityEstablished = false;\n\n  return {\n    getId() {\n      return id;\n    },\n    getPayload() {\n      return payload;\n    },\n    getAction() {\n      return getAction({ isIdentityEstablished });\n    },\n    getUseSendBeacon() {\n      return getUseSendBeacon({ isIdentityEstablished });\n    },\n    getUseIdThirdPartyDomain() {\n      return shouldUseThirdPartyDomain;\n    },\n    setUseIdThirdPartyDomain() {\n      shouldUseThirdPartyDomain = true;\n    },\n    setIsIdentityEstablished() {\n      isIdentityEstablished = true;\n    }\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createRequest from \"./createRequest\";\n\nexport default dataCollectionRequestPayload => {\n  const getUseSendBeacon = ({ isIdentityEstablished }) => {\n    // When the document may be unloading, we still hit the interact endpoint\n    // using fetch if an identity has not been established. If we were instead\n    // to hit the collect endpoint using sendBeacon in this case, one of three\n    // things would occur:\n    //\n    // 1. The document ultimately isn't unloaded and Alloy receives an empty\n    // response back from the collect endpoint, resulting in an error being\n    // thrown by Alloy because we weren't able to establish an identity.\n    // This is bad.\n    // 2. The document is unloaded, but Alloy receives the empty\n    // response back from the collect endpoint before navigation is completed,\n    // resulting in an error being thrown by Alloy because we weren't able to\n    // establish an identity. This is bad.\n    // 3. The document is unloaded and Alloy does not receive the empty response\n    // back from the collect endpoint before navigation is completed. No error\n    // will be thrown, but no identity was established either. This is okay,\n    // though no identity was established.\n    //\n    // By hitting the interact endpoint using fetch, one of the three things\n    // would occur:\n    //\n    // 1. The document ultimately isn't unloaded and Alloy receives a\n    // response with an identity back from the interact endpoint. No\n    // error will be thrown and an identity is established. This is good.\n    // 2. The document is unloaded and Alloy receives a response with an\n    // identity back from the interact endpoint before navigation is completed.\n    // No error will be thrown and an identity is established. This is good.\n    // 3. The document is unloaded and Alloy does not receive the empty response\n    // back from the collect endpoint before navigation is completed. In this\n    // case, no error is thrown, but no identity was established and it's\n    // more likely that the request never makes it to the server because we're\n    // using fetch instead of sendBeacon.\n    //\n    // The second approach seemed preferable.\n    return (\n      dataCollectionRequestPayload.getDocumentMayUnload() &&\n      isIdentityEstablished\n    );\n  };\n\n  return createRequest({\n    payload: dataCollectionRequestPayload,\n    getAction({ isIdentityEstablished }) {\n      return getUseSendBeacon({ isIdentityEstablished })\n        ? \"collect\"\n        : \"interact\";\n    },\n    getUseSendBeacon\n  });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createMerger } from \"..\";\n\n// This provides the base functionality that all types of\n// request payloads share.\nexport default options => {\n  const { content, addIdentity, hasIdentity } = options;\n  return {\n    mergeState: createMerger(content, \"meta.state\"),\n    mergeQuery: createMerger(content, \"query\"),\n    addIdentity,\n    hasIdentity,\n    toJSON() {\n      return content;\n    }\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default content => namespaceCode => {\n  return (\n    (content.xdm &&\n      content.xdm.identityMap &&\n      content.xdm.identityMap[namespaceCode]) !== undefined\n  );\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport createRequestPayload from \"./createRequestPayload\";\nimport createAddIdentity from \"./createAddIdentity\";\nimport createHasIdentity from \"./createHasIdentity\";\n\nexport default () => {\n  const content = {};\n  const payload = createRequestPayload({\n    content,\n    addIdentity: createAddIdentity(content),\n    hasIdentity: createHasIdentity(content)\n  });\n\n  payload.addEvent = event => {\n    content.events = content.events || [];\n    content.events.push(event);\n  };\n\n  payload.getDocumentMayUnload = () => {\n    return (content.events || []).some(event => event.getDocumentMayUnload());\n  };\n\n  return payload;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createRequest } from \"../../../utils/request\";\n\nexport default identityRequestPayload => {\n  return createRequest({\n    payload: identityRequestPayload,\n    getAction() {\n      return \"identity/acquire\";\n    },\n    getUseSendBeacon() {\n      return false;\n    }\n  });\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  createAddIdentity,\n  createHasIdentity,\n  createRequestPayload\n} from \"../../../utils/request\";\n\nexport default namespaces => {\n  const content = {\n    query: {\n      identity: {\n        fetch: namespaces\n      }\n    }\n  };\n  return createRequestPayload({\n    content,\n    addIdentity: createAddIdentity(content),\n    hasIdentity: createHasIdentity(content)\n  });\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nconst URL_REGEX = /^([^?#]*)(\\??[^#]*)(#?.*)$/;\n\nconst getSeparator = queryString => {\n  if (queryString === \"\") {\n    return \"?\";\n  }\n  if (queryString === \"?\") {\n    return \"\";\n  }\n  return \"&\";\n};\n\nexport default ({ dateProvider, orgId }) => (ecid, url) => {\n  const ts = Math.round(dateProvider().getTime() / 1000);\n  const adobemc = encodeURIComponent(\n    `TS=${ts}|MCMID=${ecid}|MCORGID=${encodeURIComponent(orgId)}`\n  );\n  const [, location, queryString, fragment] = url.match(URL_REGEX);\n  const separator = getSeparator(queryString);\n  return `${location}${queryString}${separator}adobe_mc=${adobemc}${fragment}`;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  areThirdPartyCookiesSupportedByDefault,\n  injectDoesIdentityCookieExist,\n  createLoggingCookieJar,\n  cookieJar\n} from \"../../utils\";\nimport injectProcessIdSyncs from \"./injectProcessIdSyncs\";\nimport configValidators from \"./configValidators\";\n\nimport createComponent from \"./createComponent\";\nimport createLegacyIdentity from \"./createLegacyIdentity\";\nimport awaitVisitorOptIn from \"./visitorService/awaitVisitorOptIn\";\nimport injectGetEcidFromVisitor from \"./visitorService/injectGetEcidFromVisitor\";\nimport injectHandleResponseForIdSyncs from \"./injectHandleResponseForIdSyncs\";\nimport injectEnsureSingleIdentity from \"./injectEnsureSingleIdentity\";\nimport addEcidQueryToPayload from \"./addEcidQueryToPayload\";\nimport injectSetDomainForInitialIdentityPayload from \"./injectSetDomainForInitialIdentityPayload\";\nimport injectAddLegacyEcidToPayload from \"./injectAddLegacyEcidToPayload\";\nimport injectAddQueryStringIdentityToPayload from \"./injectAddQueryStringIdentityToPayload\";\nimport addEcidToPayload from \"./addEcidToPayload\";\nimport injectAwaitIdentityCookie from \"./injectAwaitIdentityCookie\";\nimport getEcidFromResponse from \"./getEcidFromResponse\";\nimport createGetIdentity from \"./getIdentity/createGetIdentity\";\nimport createIdentityRequest from \"./getIdentity/createIdentityRequest\";\nimport createIdentityRequestPayload from \"./getIdentity/createIdentityRequestPayload\";\nimport injectAppendIdentityToUrl from \"./appendIdentityToUrl/injectAppendIdentityToUrl\";\n\nconst createIdentity = ({\n  config,\n  logger,\n  consent,\n  fireReferrerHideableImage,\n  sendEdgeNetworkRequest,\n  apexDomain\n}) => {\n  const { orgId, thirdPartyCookiesEnabled } = config;\n\n  const getEcidFromVisitor = injectGetEcidFromVisitor({\n    logger,\n    orgId,\n    awaitVisitorOptIn\n  });\n  const loggingCookieJar = createLoggingCookieJar({ logger, cookieJar });\n  const legacyIdentity = createLegacyIdentity({\n    config,\n    getEcidFromVisitor,\n    apexDomain,\n    cookieJar: loggingCookieJar,\n    isPageSsl: window.location.protocol === \"https:\"\n  });\n  const doesIdentityCookieExist = injectDoesIdentityCookieExist({ orgId });\n  const getIdentity = createGetIdentity({\n    sendEdgeNetworkRequest,\n    createIdentityRequestPayload,\n    createIdentityRequest\n  });\n  const setDomainForInitialIdentityPayload = injectSetDomainForInitialIdentityPayload(\n    {\n      thirdPartyCookiesEnabled,\n      areThirdPartyCookiesSupportedByDefault\n    }\n  );\n  const addLegacyEcidToPayload = injectAddLegacyEcidToPayload({\n    getLegacyEcid: legacyIdentity.getEcid,\n    addEcidToPayload\n  });\n  const addQueryStringIdentityToPayload = injectAddQueryStringIdentityToPayload(\n    {\n      locationSearch: window.document.location.search,\n      dateProvider: () => new Date(),\n      orgId,\n      logger\n    }\n  );\n  const awaitIdentityCookie = injectAwaitIdentityCookie({\n    doesIdentityCookieExist,\n    orgId\n  });\n  const ensureSingleIdentity = injectEnsureSingleIdentity({\n    doesIdentityCookieExist,\n    setDomainForInitialIdentityPayload,\n    addLegacyEcidToPayload,\n    awaitIdentityCookie,\n    logger\n  });\n  const processIdSyncs = injectProcessIdSyncs({\n    fireReferrerHideableImage,\n    logger\n  });\n  const handleResponseForIdSyncs = injectHandleResponseForIdSyncs({\n    processIdSyncs\n  });\n  const appendIdentityToUrl = injectAppendIdentityToUrl({\n    dateProvider: () => new Date(),\n    orgId\n  });\n  return createComponent({\n    addEcidQueryToPayload,\n    addQueryStringIdentityToPayload,\n    ensureSingleIdentity,\n    setLegacyEcid: legacyIdentity.setEcid,\n    handleResponseForIdSyncs,\n    getEcidFromResponse,\n    getIdentity,\n    consent,\n    appendIdentityToUrl,\n    logger\n  });\n};\n\ncreateIdentity.namespace = \"Identity\";\ncreateIdentity.configValidators = configValidators;\n\nexport default createIdentity;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { noop } from \"../../utils\";\n\nconst createResultLogMessage = (urlDestination, success) => {\n  return `URL destination ${success ? \"succeeded\" : \"failed\"}: ${\n    urlDestination.spec.url\n  }`;\n};\n\nexport default ({\n  fireReferrerHideableImage,\n  logger,\n  cookieJar,\n  isPageSsl\n}) => {\n  const extraCookieOptions = isPageSsl\n    ? { sameSite: \"none\", secure: true }\n    : {};\n  const processCookies = destinations => {\n    const cookieDestinations = destinations.filter(\n      dest => dest.type === \"cookie\"\n    );\n\n    cookieDestinations.forEach(dest => {\n      const { name, value, domain, ttlDays } = dest.spec;\n      cookieJar.set(name, value || \"\", {\n        domain: domain || \"\",\n        expires: ttlDays || 10, // days\n        ...extraCookieOptions\n      });\n    });\n  };\n\n  const processUrls = destinations => {\n    const urlDestinations = destinations.filter(dest => dest.type === \"url\");\n\n    return Promise.all(\n      urlDestinations.map(urlDestination => {\n        return fireReferrerHideableImage(urlDestination.spec)\n          .then(() => {\n            logger.info(createResultLogMessage(urlDestination, true));\n          })\n          .catch(() => {\n            // We intentionally do not throw an error if destinations fail. We\n            // consider it a non-critical failure and therefore do not want it to\n            // reject the promise handed back to the customer.\n            logger.error(createResultLogMessage(urlDestination, false));\n          });\n      })\n    ).then(noop);\n  };\n\n  return destinations => {\n    processCookies(destinations);\n    return processUrls(destinations);\n  };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ processDestinations }) => {\n  const processPushDestinations = ({ response }) => {\n    const destinations = response.getPayloadsByType(\"activation:push\");\n    return processDestinations(destinations);\n  };\n\n  const retrievePullDestinations = ({ response }) => {\n    return {\n      destinations: response.getPayloadsByType(\"activation:pull\")\n    };\n  };\n\n  return ({ response }) => {\n    return processPushDestinations({ response }).then(() =>\n      retrievePullDestinations({ response })\n    );\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createLoggingCookieJar, cookieJar } from \"../../utils\";\nimport injectProcessDestinations from \"./injectProcessDestinations\";\nimport injectProcessResponse from \"./injectProcessResponse\";\n\nconst createAudiences = ({ logger, fireReferrerHideableImage }) => {\n  const loggingCookieJar = createLoggingCookieJar({ logger, cookieJar });\n\n  const processDestinations = injectProcessDestinations({\n    fireReferrerHideableImage,\n    logger,\n    cookieJar: loggingCookieJar,\n    isPageSsl: window.location.protocol === \"https:\"\n  });\n\n  const processResponse = injectProcessResponse({ processDestinations });\n\n  return {\n    lifecycle: {\n      onResponse: processResponse\n    },\n    commands: {}\n  };\n};\n\ncreateAudiences.namespace = \"Audiences\";\ncreateAudiences.configValidators = {};\n\nexport default createAudiences;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"__view__\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const DEFAULT_CONTENT_ITEM =\n  \"https://ns.adobe.com/personalization/default-content-item\";\nexport const DOM_ACTION = \"https://ns.adobe.com/personalization/dom-action\";\nexport const HTML_CONTENT_ITEM =\n  \"https://ns.adobe.com/personalization/html-content-item\";\nexport const JSON_CONTENT_ITEM =\n  \"https://ns.adobe.com/personalization/json-content-item\";\nexport const REDIRECT_ITEM =\n  \"https://ns.adobe.com/personalization/redirect-item\";\nexport const MEASUREMENT_SCHEMA =\n  \"https://ns.adobe.com/personalization/measurement\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { includes } from \"../../utils\";\nimport PAGE_WIDE_SCOPE from \"./constants/scope\";\nimport {\n  DEFAULT_CONTENT_ITEM,\n  DOM_ACTION,\n  HTML_CONTENT_ITEM,\n  JSON_CONTENT_ITEM,\n  REDIRECT_ITEM\n} from \"./constants/schema\";\nimport isNonEmptyString from \"../../utils/isNonEmptyString\";\n\nexport default ({ renderDecisions, decisionScopes, event, viewCache }) => {\n  const viewName = event.getViewName();\n  return {\n    isRenderDecisions() {\n      return renderDecisions;\n    },\n    getViewName() {\n      return viewName;\n    },\n    hasScopes() {\n      return decisionScopes.length > 0;\n    },\n    hasViewName() {\n      return isNonEmptyString(viewName);\n    },\n    createQueryDetails() {\n      const scopes = [...decisionScopes];\n      if (!this.isCacheInitialized() && !includes(scopes, PAGE_WIDE_SCOPE)) {\n        scopes.push(PAGE_WIDE_SCOPE);\n      }\n\n      const schemas = [\n        DEFAULT_CONTENT_ITEM,\n        HTML_CONTENT_ITEM,\n        JSON_CONTENT_ITEM,\n        REDIRECT_ITEM\n      ];\n\n      if (includes(scopes, PAGE_WIDE_SCOPE)) {\n        schemas.push(DOM_ACTION);\n      }\n\n      return {\n        schemas,\n        decisionScopes: scopes\n      };\n    },\n    isCacheInitialized() {\n      return viewCache.isInitialized();\n    },\n    shouldFetchData() {\n      return this.hasScopes() || !this.isCacheInitialized();\n    },\n    shouldUseCachedData() {\n      return this.hasViewName() && this.isCacheInitialized();\n    }\n  };\n};\n","export const AUTHORING_ENABLED = \"Rendering is disabled for authoring mode.\";\nexport const REDIRECT_EXECUTION_ERROR =\n  \"An error occurred while executing the redirect offer.\";\n","import { anything, objectOf, arrayOf } from \"../../utils/validation\";\n\nexport const EMPTY_PROPOSITIONS = { propositions: [] };\n\nexport default ({ logger, options }) => {\n  const applyPropositionsOptionsValidator = objectOf({\n    propositions: arrayOf(objectOf(anything())).nonEmpty(),\n    metadata: objectOf(anything())\n  }).required();\n\n  try {\n    return applyPropositionsOptionsValidator(options);\n  } catch (e) {\n    logger.warn(\n      \"Invalid options for applyPropositions. No propositions will be applied.\",\n      e\n    );\n    return EMPTY_PROPOSITIONS;\n  }\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { noop, defer } from \"../../utils\";\nimport createPersonalizationDetails from \"./createPersonalizationDetails\";\nimport { AUTHORING_ENABLED } from \"./constants/loggerMessage\";\nimport validateApplyPropositionsOptions from \"./validateApplyPropositionsOptions\";\n\nexport default ({\n  logger,\n  fetchDataHandler,\n  viewChangeHandler,\n  onClickHandler,\n  isAuthoringModeEnabled,\n  mergeQuery,\n  viewCache,\n  showContainers,\n  applyPropositions\n}) => {\n  return {\n    lifecycle: {\n      onBeforeEvent({\n        event,\n        renderDecisions,\n        decisionScopes = [],\n        onResponse = noop,\n        onRequestFailure = noop\n      }) {\n        // Include propositions on all responses, overridden with data as needed\n        onResponse(() => ({ propositions: [] }));\n        onRequestFailure(() => showContainers());\n\n        if (isAuthoringModeEnabled()) {\n          logger.warn(AUTHORING_ENABLED);\n\n          // If we are in authoring mode we disable personalization\n          mergeQuery(event, { enabled: false });\n          return;\n        }\n\n        const personalizationDetails = createPersonalizationDetails({\n          renderDecisions,\n          decisionScopes,\n          event,\n          viewCache\n        });\n\n        if (personalizationDetails.shouldFetchData()) {\n          const decisionsDeferred = defer();\n\n          viewCache.storeViews(decisionsDeferred.promise);\n          onRequestFailure(() => decisionsDeferred.reject());\n          fetchDataHandler({\n            decisionsDeferred,\n            personalizationDetails,\n            event,\n            onResponse\n          });\n          return;\n        }\n\n        if (personalizationDetails.shouldUseCachedData()) {\n          // eslint-disable-next-line consistent-return\n          return viewChangeHandler({\n            personalizationDetails,\n            event,\n            onResponse,\n            onRequestFailure\n          });\n        }\n      },\n      onClick({ event, clickedElement }) {\n        onClickHandler({ event, clickedElement });\n      }\n    },\n    commands: {\n      applyPropositions: {\n        optionsValidator: options =>\n          validateApplyPropositionsOptions({ logger, options }),\n        run: applyPropositions\n      }\n    }\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createNode } from \"../../../../utils/dom\";\nimport { DIV } from \"../../../../constants/tagName\";\n\nexport default content => {\n  return createNode(DIV, {}, { innerHTML: content });\n};\n","/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */\n;(function(root, factory) {\n\t// https://github.com/umdjs/umd/blob/master/returnExports.js\n\tif (typeof exports == 'object') {\n\t\t// For Node.js.\n\t\tmodule.exports = factory(root);\n\t} else if (typeof define == 'function' && define.amd) {\n\t\t// For AMD. Register as an anonymous module.\n\t\tdefine([], factory.bind(root, root));\n\t} else {\n\t\t// For browser globals (not exposing the function separately).\n\t\tfactory(root);\n\t}\n}(typeof global != 'undefined' ? global : this, function(root) {\n\n\tif (root.CSS && root.CSS.escape) {\n\t\treturn root.CSS.escape;\n\t}\n\n\t// https://drafts.csswg.org/cssom/#serialize-an-identifier\n\tvar cssEscape = function(value) {\n\t\tif (arguments.length == 0) {\n\t\t\tthrow new TypeError('`CSS.escape` requires an argument.');\n\t\t}\n\t\tvar string = String(value);\n\t\tvar length = string.length;\n\t\tvar index = -1;\n\t\tvar codeUnit;\n\t\tvar result = '';\n\t\tvar firstCodeUnit = string.charCodeAt(0);\n\t\twhile (++index < length) {\n\t\t\tcodeUnit = string.charCodeAt(index);\n\t\t\t// Note: there’s no need to special-case astral symbols, surrogate\n\t\t\t// pairs, or lone surrogates.\n\n\t\t\t// If the character is NULL (U+0000), then the REPLACEMENT CHARACTER\n\t\t\t// (U+FFFD).\n\t\t\tif (codeUnit == 0x0000) {\n\t\t\t\tresult += '\\uFFFD';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is in the range [\\1-\\1F] (U+0001 to U+001F) or is\n\t\t\t\t// U+007F, […]\n\t\t\t\t(codeUnit >= 0x0001 && codeUnit <= 0x001F) || codeUnit == 0x007F ||\n\t\t\t\t// If the character is the first character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039), […]\n\t\t\t\t(index == 0 && codeUnit >= 0x0030 && codeUnit <= 0x0039) ||\n\t\t\t\t// If the character is the second character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039) and the first character is a `-` (U+002D), […]\n\t\t\t\t(\n\t\t\t\t\tindex == 1 &&\n\t\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 &&\n\t\t\t\t\tfirstCodeUnit == 0x002D\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character-as-code-point\n\t\t\t\tresult += '\\\\' + codeUnit.toString(16) + ' ';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is the first character and is a `-` (U+002D), and\n\t\t\t\t// there is no second character, […]\n\t\t\t\tindex == 0 &&\n\t\t\t\tlength == 1 &&\n\t\t\t\tcodeUnit == 0x002D\n\t\t\t) {\n\t\t\t\tresult += '\\\\' + string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If the character is not handled by one of the above rules and is\n\t\t\t// greater than or equal to U+0080, is `-` (U+002D) or `_` (U+005F), or\n\t\t\t// is in one of the ranges [0-9] (U+0030 to U+0039), [A-Z] (U+0041 to\n\t\t\t// U+005A), or [a-z] (U+0061 to U+007A), […]\n\t\t\tif (\n\t\t\t\tcodeUnit >= 0x0080 ||\n\t\t\t\tcodeUnit == 0x002D ||\n\t\t\t\tcodeUnit == 0x005F ||\n\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 ||\n\t\t\t\tcodeUnit >= 0x0041 && codeUnit <= 0x005A ||\n\t\t\t\tcodeUnit >= 0x0061 && codeUnit <= 0x007A\n\t\t\t) {\n\t\t\t\t// the character itself\n\t\t\t\tresult += string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Otherwise, the escaped character.\n\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character\n\t\t\tresult += '\\\\' + string.charAt(index);\n\n\t\t}\n\t\treturn result;\n\t};\n\n\tif (!root.CSS) {\n\t\troot.CSS = {};\n\t}\n\n\troot.CSS.escape = cssEscape;\n\treturn cssEscape;\n\n}));\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isNonEmptyString } from \"../../../../utils\";\n\nconst EQ_START = \":eq(\";\nconst EQ_PATTERN = /:eq\\((\\d+)\\)/g;\n\nexport const isNotEqSelector = str => str.indexOf(EQ_START) === -1;\n\nexport const splitWithEq = selector => {\n  return selector.split(EQ_PATTERN).filter(isNonEmptyString);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport escape from \"css.escape\";\nimport { selectNodes } from \"../../../../utils/dom\";\nimport { isNotEqSelector, splitWithEq } from \"./helperForEq\";\n\n// Trying to match ID or CSS class\nconst CSS_IDENTIFIER_PATTERN = /(#|\\.)(-?\\w+)/g;\n// Here we use CSS.escape() to make sure we get\n// correct values for ID and CSS class\n// Please check:  https://www.w3.org/TR/css-syntax-3/#escaping\n// CSS.escape() polyfill can be found here: https://github.com/mathiasbynens/CSS.escape\nconst replaceIdentifier = (_, $1, $2) => `${$1}${escape($2)}`;\n\nexport const escapeIdentifiersInSelector = selector => {\n  return selector.replace(CSS_IDENTIFIER_PATTERN, replaceIdentifier);\n};\n\nexport const parseSelector = rawSelector => {\n  const result = [];\n  const selector = escapeIdentifiersInSelector(rawSelector.trim());\n  const parts = splitWithEq(selector);\n  const { length } = parts;\n  let i = 0;\n\n  while (i < length) {\n    const sel = parts[i];\n    const eq = parts[i + 1];\n\n    if (eq) {\n      result.push({ sel, eq: Number(eq) });\n    } else {\n      result.push({ sel });\n    }\n\n    i += 2;\n  }\n\n  return result;\n};\n\n/**\n * Returns an array of matched DOM nodes.\n * @param {String} selector that contains Sizzle \"eq(...)\" pseudo selector\n * @returns {Array} an array of DOM nodes\n */\nexport const selectNodesWithEq = selector => {\n  const doc = document;\n\n  if (isNotEqSelector(selector)) {\n    return selectNodes(selector, doc);\n  }\n\n  const parts = parseSelector(selector);\n  const { length } = parts;\n  let result = [];\n  let context = doc;\n  let i = 0;\n\n  while (i < length) {\n    const { sel, eq } = parts[i];\n    const nodes = selectNodes(sel, context);\n    const { length: nodesCount } = nodes;\n\n    if (nodesCount === 0) {\n      break;\n    }\n\n    if (eq != null && eq > nodesCount - 1) {\n      break;\n    }\n\n    if (i < length - 1) {\n      if (eq == null) {\n        [context] = nodes;\n      } else {\n        context = nodes[eq];\n      }\n    }\n\n    if (i === length - 1) {\n      if (eq == null) {\n        result = nodes;\n      } else {\n        result = [nodes[eq]];\n      }\n    }\n\n    i += 1;\n  }\n\n  return result;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Returns an array of matched DOM nodes.\n * @param {String} id\n * @param {Node} [context=document] defaults to document\n * @returns {HTMLElement} an element of null\n */\nexport default (id, context = document) => {\n  return context.getElementById(id);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element, name, value) => {\n  element.setAttribute(name, value);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element, name) => {\n  return element.getAttribute(name);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element, name) => {\n  element.removeAttribute(name);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (element, name, value, priority) => {\n  let css;\n\n  if (priority) {\n    css = `${name}:${value} !${priority};`;\n  } else {\n    css = `${name}:${value};`;\n  }\n\n  element.style.cssText += `;${css}`;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default element => {\n  return element.parentNode;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default element => {\n  return element.nextElementSibling;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport getParent from \"./getParent\";\nimport getNextSibling from \"./getNextSibling\";\n\nexport default (container, element) => {\n  if (!container) {\n    return;\n  }\n\n  const parent = getParent(container);\n\n  if (parent) {\n    parent.insertBefore(element, getNextSibling(container));\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport getParent from \"./getParent\";\n\nexport default (container, element) => {\n  if (!container) {\n    return;\n  }\n\n  const parent = getParent(container);\n\n  if (parent) {\n    parent.insertBefore(element, container);\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { toArray } from \"../../../../utils\";\n\nexport default element => {\n  const { children } = element;\n\n  if (children) {\n    return toArray(children);\n  }\n\n  return [];\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { toArray } from \"../../../../utils\";\n\nexport default element => {\n  const { childNodes } = element;\n\n  if (childNodes) {\n    return toArray(childNodes);\n  }\n\n  return [];\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default element => {\n  return element.firstElementChild;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nlet nonce;\n\n/**\n * Returns the nonce if available.\n * @param {Node} [context=document] defaults to document\n * @returns {(String|undefined)} the nonce or undefined if not available\n */\nexport default (context = document) => {\n  if (nonce === undefined) {\n    const n = context.querySelector(\"[nonce]\");\n    // NOTE: We're keeping n.getAttribute(\"nonce\") until it is safe to remove:\n    //   ref: https://github.com/whatwg/html/issues/2369#issuecomment-280853946\n    nonce = n && (n.nonce || n.getAttribute(\"nonce\"));\n  }\n  return nonce;\n};\n\n// This function is only used for testing and removed when library is built (tree-shaking)\nexport const testResetCachedNonce = () => {\n  nonce = undefined;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createNode, appendNode, removeNode } from \"../../../utils/dom\";\nimport { STYLE } from \"../../../constants/tagName\";\nimport { getElementById, getNonce } from \"../dom-actions/dom\";\n\nconst PREHIDING_ID = \"alloy-prehiding\";\nconst HIDING_STYLE_DEFINITION = \"{ visibility: hidden }\";\n\n// Using global is OK since we have a single DOM\n// so storing nodes even for multiple Alloy instances is fine\nconst styleNodes = {};\n\nexport const hideElements = prehidingSelector => {\n  // if we have different events with the same\n  // prehiding selector we don't want to recreate\n  // the style tag\n  if (styleNodes[prehidingSelector]) {\n    return;\n  }\n\n  const nonce = getNonce();\n  const attrs = {\n    ...(nonce && { nonce })\n  };\n  const props = {\n    textContent: `${prehidingSelector} ${HIDING_STYLE_DEFINITION}`\n  };\n  const node = createNode(STYLE, attrs, props);\n\n  appendNode(document.head, node);\n\n  styleNodes[prehidingSelector] = node;\n};\n\nexport const showElements = prehidingSelector => {\n  const node = styleNodes[prehidingSelector];\n\n  if (node) {\n    removeNode(node);\n    delete styleNodes[prehidingSelector];\n  }\n};\n\nexport const hideContainers = prehidingStyle => {\n  if (!prehidingStyle) {\n    return;\n  }\n\n  // If containers prehiding style has been added\n  // by customer's prehiding snippet we don't\n  // want to add the same node\n  const node = getElementById(PREHIDING_ID);\n\n  if (node) {\n    return;\n  }\n\n  const nonce = getNonce();\n  const attrs = { id: PREHIDING_ID, ...(nonce && { nonce }) };\n  const props = { textContent: prehidingStyle };\n  const styleNode = createNode(STYLE, attrs, props);\n\n  appendNode(document.head, styleNode);\n};\n\nexport const showContainers = () => {\n  // If containers prehiding style exists\n  // we will remove it\n  const node = getElementById(PREHIDING_ID);\n\n  if (!node) {\n    return;\n  }\n\n  removeNode(node);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (container, text) => {\n  container.textContent = text;\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const SRC = \"src\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createNode, selectNodes } from \"../../../utils/dom\";\nimport { IMG } from \"../../../constants/tagName\";\nimport { SRC } from \"../../../constants/elementAttribute\";\nimport { getAttribute } from \"./dom\";\n\nexport const isImage = element => element.tagName === IMG;\n\nexport const loadImage = url => {\n  return createNode(IMG, { src: url });\n};\n\nexport const loadImages = fragment => {\n  const images = selectNodes(IMG, fragment);\n\n  images.forEach(image => {\n    const url = getAttribute(image, SRC);\n\n    if (url) {\n      loadImage(url);\n    }\n  });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { selectNodes } from \"../../../utils/dom\";\nimport { STYLE } from \"../../../constants/tagName\";\nimport { SRC } from \"../../../constants/elementAttribute\";\nimport { getAttribute, getNonce } from \"./dom\";\n\nconst is = (element, tagName) => element.tagName === tagName;\nconst isInlineStyleElement = element =>\n  is(element, STYLE) && !getAttribute(element, SRC);\n\nexport default fragment => {\n  const styleNodes = selectNodes(STYLE, fragment);\n  const { length } = styleNodes;\n  const nonce = getNonce();\n  if (!nonce) {\n    return;\n  }\n  /* eslint-disable no-continue */\n  for (let i = 0; i < length; i += 1) {\n    const element = styleNodes[i];\n    if (!isInlineStyleElement(element)) {\n      continue;\n    }\n    element.nonce = nonce;\n  }\n};\n","/**\n * @this {Promise}\n */\nfunction finallyConstructor(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        // @ts-ignore\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\nexport default finallyConstructor;\n","import promiseFinally from './finally';\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction isArray(x) {\n  return Boolean(x && typeof x.length !== 'undefined');\n}\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.all accepts an array'));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.race accepts an array'));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  // @ts-ignore\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      // @ts-ignore\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nexport default Promise;\n","/***************************************************************************************\n * (c) 2017 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n ****************************************************************************************/\n'use strict';\n\n// For building Turbine we are using Rollup. For running the turbine tests we are using\n// Karma + Webpack. You need to specify the default import when using promise-polyfill`\n// with Webpack 2+. We need `require('promise-polyfill').default` for running the tests\n// and `require('promise-polyfill')` for building Turbine.\nmodule.exports =\n  (typeof window !== 'undefined' && window.Promise) ||\n  (typeof global !== 'undefined' && global.Promise) ||\n  require('promise-polyfill').default ||\n  require('promise-polyfill');\n","/***************************************************************************************\n * (c) 2017 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n ****************************************************************************************/\n'use strict';\n\nvar Promise = require('@adobe/reactor-promise');\n\nvar getPromise = function(url, script) {\n  return new Promise(function(resolve, reject) {\n    script.onload = function() {\n      resolve(script);\n    };\n\n    script.onerror = function() {\n      reject(new Error('Failed to load script ' + url));\n    };\n  });\n};\n\nmodule.exports = function(url) {\n  var script = document.createElement('script');\n  script.src = url;\n  script.async = true;\n\n  var promise = getPromise(url, script);\n\n  document.getElementsByTagName('head')[0].appendChild(script);\n  return promise;\n};\n\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport loadScript from \"@adobe/reactor-load-script\";\nimport { selectNodes, createNode } from \"../../../utils/dom\";\nimport { SCRIPT } from \"../../../constants/tagName\";\nimport { SRC } from \"../../../constants/elementAttribute\";\nimport { getAttribute, getNonce } from \"./dom\";\n\nexport const is = (element, tagName) =>\n  !!element && element.tagName === tagName;\n\nconst isInlineScript = element =>\n  is(element, SCRIPT) && !getAttribute(element, SRC);\n\nconst isRemoteScript = element =>\n  is(element, SCRIPT) && getAttribute(element, SRC);\n\nexport const getInlineScripts = fragment => {\n  const scripts = selectNodes(SCRIPT, fragment);\n  const result = [];\n  const { length } = scripts;\n  const nonce = getNonce();\n  const attributes = {\n    ...(nonce && { nonce })\n  };\n\n  /* eslint-disable no-continue */\n  for (let i = 0; i < length; i += 1) {\n    const element = scripts[i];\n\n    if (!isInlineScript(element)) {\n      continue;\n    }\n\n    const { textContent } = element;\n\n    if (!textContent) {\n      continue;\n    }\n\n    result.push(createNode(SCRIPT, attributes, { textContent }));\n  }\n  /* eslint-enable no-continue */\n\n  return result;\n};\n\nexport const getRemoteScriptsUrls = fragment => {\n  const scripts = selectNodes(SCRIPT, fragment);\n  const result = [];\n  const { length } = scripts;\n\n  /* eslint-disable no-continue */\n  for (let i = 0; i < length; i += 1) {\n    const element = scripts[i];\n\n    if (!isRemoteScript(element)) {\n      continue;\n    }\n\n    const url = getAttribute(element, SRC);\n\n    if (!url) {\n      continue;\n    }\n\n    result.push(url);\n  }\n  /* eslint-enable no-continue */\n\n  return result;\n};\n\nexport const executeInlineScripts = (parent, scripts) => {\n  scripts.forEach(script => {\n    parent.appendChild(script);\n    parent.removeChild(script);\n  });\n};\n\nexport const executeRemoteScripts = urls => {\n  return Promise.all(urls.map(loadScript));\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { appendNode } from \"../../../utils/dom\";\nimport { createFragment, getChildNodes } from \"./dom\";\nimport { loadImages } from \"./images\";\nimport addNonceToInlineStyleElements from \"./addNonceToInlineStyleElements\";\nimport {\n  getInlineScripts,\n  getRemoteScriptsUrls,\n  executeInlineScripts,\n  executeRemoteScripts\n} from \"./scripts\";\n\nexport default (container, html) => {\n  const fragment = createFragment(html);\n  addNonceToInlineStyleElements(fragment);\n  const elements = getChildNodes(fragment);\n  const scripts = getInlineScripts(fragment);\n  const scriptsUrls = getRemoteScriptsUrls(fragment);\n\n  loadImages(fragment);\n\n  elements.forEach(element => {\n    appendNode(container, element);\n  });\n\n  executeInlineScripts(container, scripts);\n\n  return executeRemoteScripts(scriptsUrls);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { removeNode } from \"../../../utils/dom\";\nimport { getChildNodes } from \"./dom\";\nimport appendHtml from \"./appendHtml\";\n\nconst clear = container => {\n  // We want to remove ALL nodes, text, comments etc\n  const childNodes = getChildNodes(container);\n\n  childNodes.forEach(removeNode);\n};\n\nexport default (container, html) => {\n  clear(container);\n  appendHtml(container, html);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { appendNode } from \"../../../utils/dom\";\nimport {\n  createFragment,\n  getChildNodes,\n  getFirstChild,\n  insertBefore\n} from \"./dom\";\nimport { loadImages } from \"./images\";\nimport addNonceToInlineStyleElements from \"./addNonceToInlineStyleElements\";\nimport {\n  getInlineScripts,\n  getRemoteScriptsUrls,\n  executeInlineScripts,\n  executeRemoteScripts\n} from \"./scripts\";\n\nexport default (container, html) => {\n  const fragment = createFragment(html);\n  addNonceToInlineStyleElements(fragment);\n  const elements = getChildNodes(fragment);\n  const scripts = getInlineScripts(fragment);\n  const scriptsUrls = getRemoteScriptsUrls(fragment);\n  const { length } = elements;\n  let i = length - 1;\n\n  // We have to proactively load images to avoid flicker\n  loadImages(fragment);\n\n  // We are inserting elements in reverse order\n  while (i >= 0) {\n    const element = elements[i];\n    const firstChild = getFirstChild(container);\n\n    if (firstChild) {\n      insertBefore(firstChild, element);\n    } else {\n      appendNode(container, element);\n    }\n\n    i -= 1;\n  }\n\n  executeInlineScripts(container, scripts);\n\n  return executeRemoteScripts(scriptsUrls);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createFragment, getChildNodes, insertBefore } from \"./dom\";\nimport { loadImages } from \"./images\";\nimport addNonceToInlineStyleElements from \"./addNonceToInlineStyleElements\";\nimport {\n  getInlineScripts,\n  getRemoteScriptsUrls,\n  executeInlineScripts,\n  executeRemoteScripts\n} from \"./scripts\";\n\nexport default (container, html) => {\n  const fragment = createFragment(html);\n  addNonceToInlineStyleElements(fragment);\n  const elements = getChildNodes(fragment);\n  const scripts = getInlineScripts(fragment);\n  const scriptsUrls = getRemoteScriptsUrls(fragment);\n\n  loadImages(fragment);\n\n  elements.forEach(element => {\n    insertBefore(container, element);\n  });\n\n  executeInlineScripts(container, scripts);\n\n  return executeRemoteScripts(scriptsUrls);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { removeNode } from \"../../../utils/dom\";\nimport insertHtmlBefore from \"./insertHtmlBefore\";\n\nexport default (container, html) => {\n  insertHtmlBefore(container, html);\n  removeNode(container);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createFragment, getChildNodes, insertAfter } from \"./dom\";\nimport { loadImages } from \"./images\";\nimport addNonceToInlineStyleElements from \"./addNonceToInlineStyleElements\";\nimport {\n  getInlineScripts,\n  getRemoteScriptsUrls,\n  executeInlineScripts,\n  executeRemoteScripts\n} from \"./scripts\";\n\nexport default (container, html) => {\n  const fragment = createFragment(html);\n  addNonceToInlineStyleElements(fragment);\n  const elements = getChildNodes(fragment);\n  const scripts = getInlineScripts(fragment);\n  const scriptsUrls = getRemoteScriptsUrls(fragment);\n\n  loadImages(fragment);\n\n  elements.forEach(element => {\n    insertAfter(container, element);\n  });\n\n  executeInlineScripts(container, scripts);\n\n  return executeRemoteScripts(scriptsUrls);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { setStyle } from \"./dom\";\n\nexport default (container, styles) => {\n  const { priority, ...style } = styles;\n\n  Object.keys(style).forEach(key => {\n    setStyle(container, key, style[key], priority);\n  });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { setAttribute } from \"./dom\";\n\nexport default (container, attributes) => {\n  Object.keys(attributes).forEach(key => {\n    setAttribute(container, key, attributes[key]);\n  });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { SRC } from \"../../../constants/elementAttribute\";\nimport { setAttribute, removeAttribute } from \"./dom\";\nimport { isImage, loadImage } from \"./images\";\n\nexport default (container, url) => {\n  if (!isImage(container)) {\n    return;\n  }\n\n  // Start downloading the image\n  loadImage(url);\n\n  // Remove \"src\" so there is no flicker\n  removeAttribute(container, SRC);\n\n  // Replace the image \"src\"\n  setAttribute(container, SRC, url);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { getChildren, insertAfter, insertBefore } from \"./dom\";\n\nexport default (container, { from, to }) => {\n  const children = getChildren(container);\n  const elementFrom = children[from];\n  const elementTo = children[to];\n\n  if (!elementFrom || !elementTo) {\n    // TODO: We will need to add logging\n    // to ease troubleshooting\n    return;\n  }\n\n  if (from < to) {\n    insertAfter(elementTo, elementFrom);\n  } else {\n    insertBefore(elementTo, elementFrom);\n  }\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (settings, store) => {\n  const { selector, meta } = settings;\n\n  store({ selector, meta });\n  return Promise.resolve();\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { awaitSelector } from \"../../../utils/dom\";\nimport { hideElements, showElements } from \"../flicker\";\nimport { selectNodesWithEq } from \"./dom\";\n\nexport { default as setText } from \"./setText\";\nexport { default as setHtml } from \"./setHtml\";\nexport { default as appendHtml } from \"./appendHtml\";\nexport { default as prependHtml } from \"./prependHtml\";\nexport { default as replaceHtml } from \"./replaceHtml\";\nexport { default as insertHtmlBefore } from \"./insertHtmlBefore\";\nexport { default as insertHtmlAfter } from \"./insertHtmlAfter\";\nexport { default as setStyles } from \"./setStyles\";\nexport { default as setAttributes } from \"./setAttributes\";\nexport { default as swapImage } from \"./swapImage\";\nexport { default as rearrangeChildren } from \"./rearrangeChildren\";\nexport { default as click } from \"./click\";\n\nconst renderContent = (elements, content, renderFunc) => {\n  const executions = elements.map(element => renderFunc(element, content));\n\n  return Promise.all(executions);\n};\n\nexport const createAction = renderFunc => {\n  return settings => {\n    const { selector, prehidingSelector, content, meta } = settings;\n\n    hideElements(prehidingSelector);\n\n    return awaitSelector(selector, selectNodesWithEq)\n      .then(elements => renderContent(elements, content, renderFunc))\n      .then(\n        () => {\n          // if everything is OK, show elements\n          showElements(prehidingSelector);\n          return { meta };\n        },\n        error => {\n          // in case of awaiting timing or error, we need to remove the style tag\n          // hence showing the pre-hidden elements\n          showElements(prehidingSelector);\n          return { meta, error };\n        }\n      );\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { removeNode } from \"../../../utils/dom\";\nimport {\n  createAction,\n  setHtml,\n  setText,\n  setAttributes,\n  swapImage,\n  setStyles,\n  rearrangeChildren,\n  replaceHtml,\n  appendHtml,\n  prependHtml,\n  insertHtmlAfter,\n  insertHtmlBefore,\n  click\n} from \"./action\";\n\nexport default store => {\n  return {\n    setHtml: createAction(setHtml),\n    customCode: createAction(prependHtml),\n    setText: createAction(setText),\n    setAttribute: createAction(setAttributes),\n    setImageSource: createAction(swapImage),\n    setStyle: createAction(setStyles),\n    move: createAction(setStyles),\n    resize: createAction(setStyles),\n    rearrange: createAction(rearrangeChildren),\n    remove: createAction(removeNode),\n    insertAfter: createAction(insertHtmlAfter),\n    insertBefore: createAction(insertHtmlBefore),\n    replaceHtml: createAction(replaceHtml),\n    prependHtml: createAction(prependHtml),\n    appendHtml: createAction(appendHtml),\n    click: settings => click(settings, store),\n    defaultContent: settings => Promise.resolve({ meta: settings.meta })\n  };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport isString from \"./isString\";\n\n/**\n * Returns whether a string value is blank. Also returns true if the value is not a string.\n * @param {*} value\n * @returns {boolean}\n */\nexport default value => (isString(value) ? !value.trim() : true);\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/*\n * Preprocess actions before rendering, so that offers are remapped to appendHtml when these are\n * to be applied to page HEAD, to align with the way it works in at.js.\n * Offer content should also be filtered, so that only tags allowed in HEAD are preserved.\n */\n\nimport { selectNodes } from \"../../../utils/dom\";\nimport { is } from \"./scripts\";\nimport { createFragment, selectNodesWithEq } from \"./dom\";\nimport { assign } from \"../../../utils\";\nimport isBlankString from \"../../../utils/isBlankString\";\nimport { HEAD } from \"../../../constants/tagName\";\n\nconst APPEND_HTML = \"appendHtml\";\nconst HEAD_TAGS_SELECTOR = \"SCRIPT,LINK,STYLE\";\n\nconst filterHeadContent = content => {\n  const container = createFragment(content);\n  const headNodes = selectNodes(HEAD_TAGS_SELECTOR, container);\n  return headNodes.map(node => node.outerHTML).join(\"\");\n};\n\nexport default action => {\n  const result = assign({}, action);\n  const { content, selector } = result;\n\n  if (isBlankString(content)) {\n    return result;\n  }\n\n  const container = selectNodesWithEq(selector);\n  if (!is(container[0], HEAD)) {\n    return result;\n  }\n\n  result.type = APPEND_HTML;\n  result.content = filterHeadContent(content);\n\n  return result;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport preprocess from \"./remapHeadOffers\";\n\nconst logActionError = (logger, action, error) => {\n  if (logger.enabled) {\n    const details = JSON.stringify(action);\n    const { message, stack } = error;\n    const errorMessage = `Failed to execute action ${details}. ${message} ${\n      stack ? `\\n ${stack}` : \"\"\n    }`;\n\n    logger.error(errorMessage);\n  }\n};\n\nconst logActionCompleted = (logger, action) => {\n  if (logger.enabled) {\n    const details = JSON.stringify(action);\n\n    logger.info(`Action ${details} executed.`);\n  }\n};\n\nconst executeAction = (logger, modules, type, args) => {\n  const execute = modules[type];\n\n  if (!execute) {\n    const error = new Error(`DOM action \"${type}\" not found`);\n    logActionError(logger, args[0], error);\n    throw error;\n  }\n  return execute(...args);\n};\n\nexport default (actions, modules, logger) => {\n  const actionPromises = actions.map(action => {\n    const processedAction = preprocess(action);\n    const { type } = processedAction;\n\n    return executeAction(logger, modules, type, [processedAction])\n      .then(result => {\n        logActionCompleted(logger, processedAction);\n        return result;\n      })\n      .catch(error => {\n        logActionError(logger, processedAction, error);\n        throw error;\n      });\n  });\n  return Promise.all(actionPromises);\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const DISPLAY = \"decisioning.propositionDisplay\";\nexport const INTERACT = \"decisioning.propositionInteract\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { DISPLAY } from \"./constants/eventType\";\nimport { isNonEmptyArray } from \"../../utils\";\n\nexport default ({ eventManager, mergeDecisionsMeta }) => {\n  // Called when a decision is auto-rendered for the __view__ scope or a SPA view(display and empty display notification)\n  return ({ decisionsMeta = [], documentMayUnload = false, viewName }) => {\n    const event = eventManager.createEvent();\n    const data = { eventType: DISPLAY };\n\n    if (viewName) {\n      data.web = {\n        webPageDetails: { viewName }\n      };\n    }\n    if (isNonEmptyArray(decisionsMeta)) {\n      mergeDecisionsMeta(event, decisionsMeta);\n    }\n\n    event.mergeXdm(data);\n\n    if (documentMayUnload) {\n      event.documentMayUnload();\n    }\n\n    return eventManager.sendEvent(event);\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { assign, flatMap } from \"../../utils\";\n\nconst DEFAULT_ACTION_TYPE = \"defaultContent\";\n\nconst identity = item => item;\n\nconst buildActions = decision => {\n  const meta = {\n    id: decision.id,\n    scope: decision.scope,\n    scopeDetails: decision.scopeDetails\n  };\n\n  return decision.items.map(item =>\n    assign({ type: DEFAULT_ACTION_TYPE }, item.data, { meta })\n  );\n};\n\nconst processMetas = (logger, actionResults) => {\n  const results = flatMap(actionResults, identity);\n  const finalMetas = [];\n  const set = new Set();\n\n  results.forEach(item => {\n    // for click actions we don't return an item\n    if (!item) {\n      return;\n    }\n    if (item.error) {\n      logger.warn(item);\n      return;\n    }\n\n    const { meta } = item;\n\n    if (set.has(meta.id)) {\n      return;\n    }\n\n    set.add(meta.id);\n    finalMetas.push(meta);\n  });\n\n  return finalMetas;\n};\n\nexport default ({ modules, logger, executeActions }) => {\n  return decisions => {\n    const actionResultsPromises = decisions.map(decision => {\n      const actions = buildActions(decision);\n\n      return executeActions(actions, modules, logger);\n    });\n    return Promise.all(actionResultsPromises)\n      .then(results => processMetas(logger, results))\n      .catch(error => {\n        logger.error(error);\n      });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ config, responseHandler, hideContainers, mergeQuery }) => {\n  return ({ decisionsDeferred, personalizationDetails, event, onResponse }) => {\n    const { prehidingStyle } = config;\n\n    if (personalizationDetails.isRenderDecisions()) {\n      hideContainers(prehidingStyle);\n    }\n    mergeQuery(event, personalizationDetails.createQueryDetails());\n\n    onResponse(({ response }) =>\n      responseHandler({ decisionsDeferred, personalizationDetails, response })\n    );\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { matchesSelector } from \"../../../../utils/dom\";\nimport { isNotEqSelector } from \"./helperForEq\";\nimport { selectNodesWithEq } from \"./selectNodesWithEq\";\n\nexport default (selector, element) => {\n  if (isNotEqSelector(selector)) {\n    return matchesSelector(selector, element);\n  }\n\n  // Using node selection vs matches selector, because of :eq()\n  // Find all nodes using document as context\n  const nodes = selectNodesWithEq(selector);\n  let result = false;\n\n  // Iterate through all the identified elements\n  // and reference compare with element\n  for (let i = 0; i < nodes.length; i += 1) {\n    if (nodes[i] === element) {\n      result = true;\n      break;\n    }\n  }\n\n  return result;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport matchesSelectorWithEq from \"../dom/matchesSelectorWithEq\";\n\nconst getMetasIfMatches = (\n  clickedElement,\n  selector,\n  getClickMetasBySelector\n) => {\n  const { documentElement } = document;\n  let element = clickedElement;\n\n  while (element && element !== documentElement) {\n    if (matchesSelectorWithEq(selector, element)) {\n      return getClickMetasBySelector(selector);\n    }\n\n    element = element.parentNode;\n  }\n\n  return null;\n};\n\nexport default (clickedElement, selectors, getClickMetasBySelector) => {\n  const result = [];\n  for (let i = 0; i < selectors.length; i += 1) {\n    const metas = getMetasIfMatches(\n      clickedElement,\n      selectors[i],\n      getClickMetasBySelector\n    );\n\n    if (metas) {\n      result.push(...metas);\n    }\n  }\n\n  return result;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default (doc = document) => {\n  return doc.location.href.indexOf(\"adobe_authoring_enabled\") !== -1;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const mergeDecisionsMeta = (event, decisionsMeta) => {\n  event.mergeXdm({\n    _experience: {\n      decisioning: {\n        propositions: decisionsMeta\n      }\n    }\n  });\n};\n\nexport const mergeQuery = (event, details) => {\n  event.mergeQuery({ personalization: { ...details } });\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isNonEmptyArray } from \"../../utils\";\nimport { INTERACT } from \"./constants/eventType\";\nimport PAGE_WIDE_SCOPE from \"./constants/scope\";\n\nexport default ({\n  mergeDecisionsMeta,\n  collectClicks,\n  getClickSelectors,\n  getClickMetasBySelector\n}) => {\n  // Called when an element qualifying for conversion within an offer is clicked.\n  return ({ event, clickedElement }) => {\n    const selectors = getClickSelectors();\n    if (isNonEmptyArray(selectors)) {\n      const decisionsMeta = collectClicks(\n        clickedElement,\n        selectors,\n        getClickMetasBySelector\n      );\n\n      if (isNonEmptyArray(decisionsMeta)) {\n        const xdm = { eventType: INTERACT };\n        const scope = decisionsMeta[0].scope;\n\n        if (scope !== PAGE_WIDE_SCOPE) {\n          xdm.web = {\n            webPageDetails: {\n              viewName: scope\n            }\n          };\n        }\n\n        event.mergeXdm(xdm);\n        mergeDecisionsMeta(event, decisionsMeta);\n      }\n    }\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { assign } from \"../../utils\";\nimport defer from \"../../utils/defer\";\n\nexport default () => {\n  let viewStorage;\n  const viewStorageDeferred = defer();\n\n  const storeViews = decisionsPromise => {\n    decisionsPromise\n      .then(decisions => {\n        if (viewStorage === undefined) {\n          viewStorage = {};\n        }\n        assign(viewStorage, decisions);\n        viewStorageDeferred.resolve();\n      })\n      .catch(() => {\n        if (viewStorage === undefined) {\n          viewStorage = {};\n        }\n        viewStorageDeferred.resolve();\n      });\n  };\n\n  const getView = viewName => {\n    return viewStorageDeferred.promise.then(() => viewStorage[viewName] || []);\n  };\n\n  const isInitialized = () => {\n    return !(viewStorage === undefined);\n  };\n  return {\n    storeViews,\n    getView,\n    isInitialized\n  };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { assign } from \"../../../utils\";\n\nexport default ({ decisions, renderAttempted }) => {\n  return decisions.map(decision => assign({ renderAttempted }, decision));\n};\n","import addRenderAttemptedToDecisions from \"./addRenderAttemptedToDecisions\";\n\nexport default (decisions = [], renderDecisions) => {\n  const resultingObject = {\n    propositions: addRenderAttemptedToDecisions({\n      decisions,\n      renderAttempted: renderDecisions\n    })\n  };\n  if (!renderDecisions) {\n    resultingObject.decisions = decisions;\n  }\n  return resultingObject;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport composePersonalizationResultingObject from \"./utils/composePersonalizationResultingObject\";\nimport { isNonEmptyArray } from \"../../utils\";\n\nexport default ({\n  mergeDecisionsMeta,\n  collect,\n  executeDecisions,\n  viewCache\n}) => {\n  return ({ personalizationDetails, event, onResponse }) => {\n    const viewName = personalizationDetails.getViewName();\n\n    return viewCache.getView(viewName).then(viewDecisions => {\n      if (personalizationDetails.isRenderDecisions()) {\n        return executeDecisions(viewDecisions).then(decisionsMeta => {\n          // if there are decisions to be rendered we render them and attach the result in experience.decisions.propositions\n          if (isNonEmptyArray(decisionsMeta)) {\n            mergeDecisionsMeta(event, decisionsMeta);\n            onResponse(() => {\n              return composePersonalizationResultingObject(viewDecisions, true);\n            });\n            return;\n          }\n          // if there are no decisions in cache for this view, we will send a empty notification\n          onResponse(() => {\n            collect({ decisionsMeta: [], viewName });\n            return composePersonalizationResultingObject(viewDecisions, true);\n          });\n        });\n      }\n\n      onResponse(() => {\n        return composePersonalizationResultingObject(viewDecisions, false);\n      });\n      return {};\n    });\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const VIEW_SCOPE_TYPE = \"view\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isNonEmptyArray, includes } from \"../../utils\";\nimport {\n  DOM_ACTION,\n  REDIRECT_ITEM,\n  DEFAULT_CONTENT_ITEM,\n  MEASUREMENT_SCHEMA\n} from \"./constants/schema\";\nimport { VIEW_SCOPE_TYPE } from \"./constants/scopeType\";\nimport PAGE_WIDE_SCOPE from \"./constants/scope\";\n\nconst splitItems = (items, schemas) => {\n  const matched = [];\n  const nonMatched = [];\n\n  items.forEach(item => {\n    if (includes(schemas, item.schema)) {\n      matched.push(item);\n    } else {\n      nonMatched.push(item);\n    }\n  });\n\n  return [matched, nonMatched];\n};\n\nconst createDecision = (decision, items) => {\n  return {\n    id: decision.id,\n    scope: decision.scope,\n    items,\n    scopeDetails: decision.scopeDetails\n  };\n};\n\nconst splitMergedMetricDecisions = decisions => {\n  const matchedDecisions = decisions.filter(decision => {\n    const { items = [] } = decision;\n    return items.some(item => item.schema === MEASUREMENT_SCHEMA);\n  });\n  const unmatchedDecisions = decisions.filter(\n    decision => !includes(matchedDecisions, decision)\n  );\n  return { matchedDecisions, unmatchedDecisions };\n};\n\nconst splitDecisions = (decisions, ...schemas) => {\n  const matchedDecisions = [];\n  const unmatchedDecisions = [];\n\n  decisions.forEach(decision => {\n    const { items = [] } = decision;\n    const [matchedItems, nonMatchedItems] = splitItems(items, schemas);\n\n    if (isNonEmptyArray(matchedItems)) {\n      matchedDecisions.push(createDecision(decision, matchedItems));\n    }\n\n    if (isNonEmptyArray(nonMatchedItems)) {\n      unmatchedDecisions.push(createDecision(decision, nonMatchedItems));\n    }\n  });\n  return { matchedDecisions, unmatchedDecisions };\n};\n\nconst appendScopeDecision = (scopeDecisions, decision) => {\n  if (!scopeDecisions[decision.scope]) {\n    scopeDecisions[decision.scope] = [];\n  }\n  scopeDecisions[decision.scope].push(decision);\n};\n\nconst isViewScope = scopeDetails =>\n  scopeDetails.characteristics &&\n  scopeDetails.characteristics.scopeType &&\n  scopeDetails.characteristics.scopeType === VIEW_SCOPE_TYPE;\n\nconst extractDecisionsByScope = decisions => {\n  const pageWideScopeDecisions = [];\n  const nonPageWideScopeDecisions = [];\n  const viewScopeDecisions = {};\n\n  if (isNonEmptyArray(decisions)) {\n    decisions.forEach(decision => {\n      if (decision.scope === PAGE_WIDE_SCOPE) {\n        pageWideScopeDecisions.push(decision);\n      } else if (isViewScope(decision.scopeDetails)) {\n        appendScopeDecision(viewScopeDecisions, decision);\n      } else {\n        nonPageWideScopeDecisions.push(decision);\n      }\n    });\n  }\n\n  return {\n    pageWideScopeDecisions,\n    nonPageWideScopeDecisions,\n    viewScopeDecisions\n  };\n};\n\nconst groupDecisions = unprocessedDecisions => {\n  // split redirect decisions\n  const decisionsGroupedByRedirectItemSchema = splitDecisions(\n    unprocessedDecisions,\n    REDIRECT_ITEM\n  );\n  // split merged measurement decisions\n  const mergedMetricDecisions = splitMergedMetricDecisions(\n    decisionsGroupedByRedirectItemSchema.unmatchedDecisions\n  );\n  // split renderable decisions\n  const decisionsGroupedByRenderableSchemas = splitDecisions(\n    mergedMetricDecisions.unmatchedDecisions,\n    DOM_ACTION,\n    DEFAULT_CONTENT_ITEM\n  );\n  // group renderable decisions by scope\n  const {\n    pageWideScopeDecisions,\n    nonPageWideScopeDecisions,\n    viewScopeDecisions\n  } = extractDecisionsByScope(\n    decisionsGroupedByRenderableSchemas.matchedDecisions\n  );\n\n  return {\n    redirectDecisions: decisionsGroupedByRedirectItemSchema.matchedDecisions,\n    pageWideScopeDecisions,\n    viewDecisions: viewScopeDecisions,\n    nonAutoRenderableDecisions: [\n      ...mergedMetricDecisions.matchedDecisions,\n      ...decisionsGroupedByRenderableSchemas.unmatchedDecisions,\n      ...nonPageWideScopeDecisions\n    ]\n  };\n};\nexport default groupDecisions;\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport isNonEmptyArray from \"../../utils/isNonEmptyArray\";\n\nconst DECISIONS_HANDLE = \"personalization:decisions\";\n\nexport default ({\n  autoRenderingHandler,\n  nonRenderingHandler,\n  groupDecisions,\n  handleRedirectDecisions,\n  showContainers\n}) => {\n  return ({ decisionsDeferred, personalizationDetails, response }) => {\n    const unprocessedDecisions = response.getPayloadsByType(DECISIONS_HANDLE);\n    const viewName = personalizationDetails.getViewName();\n\n    // if personalization payload is empty return empty decisions array\n    if (unprocessedDecisions.length === 0) {\n      showContainers();\n      decisionsDeferred.resolve({});\n      return {\n        decisions: [],\n        propositions: []\n      };\n    }\n\n    const {\n      redirectDecisions,\n      pageWideScopeDecisions,\n      viewDecisions,\n      nonAutoRenderableDecisions\n    } = groupDecisions(unprocessedDecisions);\n\n    if (\n      personalizationDetails.isRenderDecisions() &&\n      isNonEmptyArray(redirectDecisions)\n    ) {\n      decisionsDeferred.resolve({});\n      return handleRedirectDecisions(redirectDecisions);\n    }\n    // save decisions for views in local cache\n    decisionsDeferred.resolve(viewDecisions);\n\n    if (personalizationDetails.isRenderDecisions()) {\n      return autoRenderingHandler({\n        viewName,\n        pageWideScopeDecisions,\n        nonAutoRenderableDecisions\n      });\n    }\n    return nonRenderingHandler({\n      viewName,\n      redirectDecisions,\n      pageWideScopeDecisions,\n      nonAutoRenderableDecisions\n    });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nconst metasToArray = metas => {\n  return Object.keys(metas).map(key => {\n    return {\n      id: key,\n      scope: metas[key].scope,\n      scopeDetails: metas[key].scopeDetails\n    };\n  });\n};\n\nexport default () => {\n  const clickStorage = {};\n\n  const storeClickMetrics = value => {\n    if (!clickStorage[value.selector]) {\n      clickStorage[value.selector] = {};\n    }\n    clickStorage[value.selector][value.meta.id] = {\n      scope: value.meta.scope,\n      scopeDetails: value.meta.scopeDetails\n    };\n  };\n\n  const getClickSelectors = () => {\n    return Object.keys(clickStorage);\n  };\n\n  const getClickMetasBySelector = selector => {\n    const metas = clickStorage[selector];\n    if (!metas) {\n      return {};\n    }\n    return metasToArray(clickStorage[selector]);\n  };\n  return {\n    storeClickMetrics,\n    getClickSelectors,\n    getClickMetasBySelector\n  };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { REDIRECT_EXECUTION_ERROR } from \"./constants/loggerMessage\";\n\nconst getRedirectDetails = redirectDecisions => {\n  const decision = redirectDecisions[0];\n  const { items, id, scope, scopeDetails } = decision;\n  const { content } = items[0].data;\n\n  return { content, decisions: [{ id, scope, scopeDetails }] };\n};\n\nexport default ({ collect, window, logger, showContainers }) => {\n  return redirectDecisions => {\n    const { content, decisions } = getRedirectDetails(redirectDecisions);\n    const documentMayUnload = true;\n\n    return collect({ decisionsMeta: decisions, documentMayUnload })\n      .then(() => {\n        window.location.replace(content);\n      })\n      .catch(() => {\n        showContainers();\n        logger.warn(REDIRECT_EXECUTION_ERROR);\n      });\n  };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport addRenderAttemptedToDecisions from \"./utils/addRenderAttemptedToDecisions\";\nimport isNonEmptyArray from \"../../utils/isNonEmptyArray\";\n\nconst getPropositions = ({ viewCache, viewName, pageWideScopeDecisions }) => {\n  if (!viewName) {\n    return { pageWideScopeDecisions, viewPropositions: [] };\n  }\n\n  return viewCache.getView(viewName).then(viewPropositions => {\n    return { pageWideScopeDecisions, viewPropositions };\n  });\n};\n\nexport default ({ viewCache, executeDecisions, showContainers, collect }) => {\n  return ({ viewName, pageWideScopeDecisions, nonAutoRenderableDecisions }) => {\n    return Promise.resolve(pageWideScopeDecisions)\n      .then(propositions =>\n        getPropositions({\n          viewCache,\n          viewName,\n          executeDecisions,\n          pageWideScopeDecisions: propositions\n        })\n      )\n      .then(propositions => {\n        executeDecisions(propositions.pageWideScopeDecisions).then(\n          decisionsMeta => {\n            if (isNonEmptyArray(decisionsMeta)) {\n              collect({ decisionsMeta });\n            }\n          }\n        );\n\n        if (viewName) {\n          executeDecisions(propositions.viewPropositions).then(\n            decisionsMeta => {\n              collect({ decisionsMeta, viewName });\n            }\n          );\n        }\n\n        showContainers();\n\n        return [\n          ...propositions.pageWideScopeDecisions,\n          ...propositions.viewPropositions\n        ];\n      })\n      .then(renderablePropositions => {\n        return {\n          decisions: [...nonAutoRenderableDecisions],\n          propositions: [\n            ...addRenderAttemptedToDecisions({\n              decisions: renderablePropositions,\n              renderAttempted: true\n            }),\n            ...addRenderAttemptedToDecisions({\n              decisions: nonAutoRenderableDecisions,\n              renderAttempted: false\n            })\n          ]\n        };\n      });\n  };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport addRenderAttemptedToDecisions from \"./utils/addRenderAttemptedToDecisions\";\n\nconst getViewPropositions = ({ viewCache, viewName, propositions }) => {\n  if (!viewName) {\n    return propositions;\n  }\n\n  return viewCache\n    .getView(viewName)\n    .then(viewPropositions => [...viewPropositions, ...propositions]);\n};\n\nconst buildFinalResult = ({ propositions }) => {\n  return {\n    decisions: propositions,\n    propositions: addRenderAttemptedToDecisions({\n      decisions: propositions,\n      renderAttempted: false\n    })\n  };\n};\n\nexport default ({ viewCache }) => {\n  return ({\n    viewName,\n    redirectDecisions,\n    pageWideScopeDecisions,\n    nonAutoRenderableDecisions\n  }) => {\n    const propositions = [\n      ...redirectDecisions,\n      ...pageWideScopeDecisions,\n      ...nonAutoRenderableDecisions\n    ];\n\n    return Promise.resolve(propositions)\n      .then(items =>\n        getViewPropositions({ viewCache, viewName, propositions: items })\n      )\n      .then(items => buildFinalResult({ propositions: items }));\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport composePersonalizationResultingObject from \"./utils/composePersonalizationResultingObject\";\nimport { isNonEmptyArray, isObject } from \"../../utils\";\nimport { DOM_ACTION, HTML_CONTENT_ITEM } from \"./constants/schema\";\nimport PAGE_WIDE_SCOPE from \"./constants/scope\";\nimport { EMPTY_PROPOSITIONS } from \"./validateApplyPropositionsOptions\";\n\nexport const SUPPORTED_SCHEMAS = [DOM_ACTION, HTML_CONTENT_ITEM];\n\nexport default ({ executeDecisions }) => {\n  const filterItemsPredicate = item =>\n    SUPPORTED_SCHEMAS.indexOf(item.schema) > -1;\n\n  const updatePropositionItems = ({ items, metadataForScope }) => {\n    return items\n      .filter(filterItemsPredicate)\n      .map(item => {\n        if (item.schema !== HTML_CONTENT_ITEM) {\n          return { ...item };\n        }\n        if (isObject(metadataForScope)) {\n          return {\n            ...item,\n            data: {\n              ...item.data,\n              selector: metadataForScope.selector,\n              type: metadataForScope.actionType\n            }\n          };\n        }\n        return undefined;\n      })\n      .filter(item => item);\n  };\n\n  const filterPropositionsPredicate = proposition => {\n    return !(\n      proposition.scope === PAGE_WIDE_SCOPE && proposition.renderAttempted\n    );\n  };\n\n  const preparePropositions = ({ propositions, metadata }) => {\n    return propositions\n      .filter(filterPropositionsPredicate)\n      .map(proposition => {\n        if (isNonEmptyArray(proposition.items)) {\n          const { id, scope, scopeDetails } = proposition;\n          return {\n            id,\n            scope,\n            scopeDetails,\n            items: updatePropositionItems({\n              items: proposition.items,\n              metadataForScope: metadata[proposition.scope]\n            })\n          };\n        }\n        return proposition;\n      })\n      .filter(proposition => isNonEmptyArray(proposition.items));\n  };\n\n  const applyPropositions = ({ propositions, metadata }) => {\n    const propositionsToExecute = preparePropositions({\n      propositions,\n      metadata\n    });\n    return executeDecisions(propositionsToExecute).then(() => {\n      return composePersonalizationResultingObject(propositionsToExecute, true);\n    });\n  };\n\n  return ({ propositions, metadata = {} }) => {\n    if (isNonEmptyArray(propositions)) {\n      return applyPropositions({ propositions, metadata });\n    }\n    return Promise.resolve(EMPTY_PROPOSITIONS);\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { string } from \"../../utils/validation\";\nimport createComponent from \"./createComponent\";\nimport { initDomActionsModules, executeActions } from \"./dom-actions\";\nimport createCollect from \"./createCollect\";\nimport createExecuteDecisions from \"./createExecuteDecisions\";\nimport { hideContainers, showContainers } from \"./flicker\";\nimport createFetchDataHandler from \"./createFetchDataHandler\";\nimport collectClicks from \"./dom-actions/clicks/collectClicks\";\nimport isAuthoringModeEnabled from \"./utils/isAuthoringModeEnabled\";\nimport { mergeDecisionsMeta, mergeQuery } from \"./event\";\nimport createOnClickHandler from \"./createOnClickHandler\";\nimport createViewCacheManager from \"./createViewCacheManager\";\nimport createViewChangeHandler from \"./createViewChangeHandler\";\nimport groupDecisions from \"./groupDecisions\";\nimport createOnResponseHandler from \"./createOnResponseHandler\";\nimport createClickStorage from \"./createClickStorage\";\nimport createRedirectHandler from \"./createRedirectHandler\";\nimport createAutorenderingHandler from \"./createAutoRenderingHandler\";\nimport createNonRenderingHandler from \"./createNonRenderingHandler\";\nimport createApplyPropositions from \"./createApplyPropositions\";\n\nconst createPersonalization = ({ config, logger, eventManager }) => {\n  const collect = createCollect({ eventManager, mergeDecisionsMeta });\n\n  const {\n    getClickMetasBySelector,\n    getClickSelectors,\n    storeClickMetrics\n  } = createClickStorage();\n  const viewCache = createViewCacheManager();\n  const modules = initDomActionsModules(storeClickMetrics);\n  const executeDecisions = createExecuteDecisions({\n    modules,\n    logger,\n    executeActions\n  });\n  const handleRedirectDecisions = createRedirectHandler({\n    collect,\n    window,\n    logger,\n    showContainers\n  });\n\n  const autoRenderingHandler = createAutorenderingHandler({\n    viewCache,\n    executeDecisions,\n    showContainers,\n    collect\n  });\n  const applyPropositions = createApplyPropositions({\n    executeDecisions\n  });\n  const nonRenderingHandler = createNonRenderingHandler({ viewCache });\n  const responseHandler = createOnResponseHandler({\n    autoRenderingHandler,\n    nonRenderingHandler,\n    groupDecisions,\n    handleRedirectDecisions,\n    showContainers\n  });\n  const fetchDataHandler = createFetchDataHandler({\n    config,\n    responseHandler,\n    hideContainers,\n    mergeQuery\n  });\n  const onClickHandler = createOnClickHandler({\n    mergeDecisionsMeta,\n    collectClicks,\n    getClickSelectors,\n    getClickMetasBySelector\n  });\n  const viewChangeHandler = createViewChangeHandler({\n    mergeDecisionsMeta,\n    collect,\n    executeDecisions,\n    viewCache\n  });\n  return createComponent({\n    logger,\n    fetchDataHandler,\n    viewChangeHandler,\n    onClickHandler,\n    isAuthoringModeEnabled,\n    mergeQuery,\n    viewCache,\n    showContainers,\n    applyPropositions\n  });\n};\n\ncreatePersonalization.namespace = \"Personalization\";\n\ncreatePersonalization.configValidators = {\n  prehidingStyle: string().nonEmpty()\n};\n\nexport default createPersonalization;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { deepAssign } from \"../../utils\";\n\nexport default window => {\n  return xdm => {\n    const web = {\n      webPageDetails: {\n        URL: window.location.href || window.location\n      },\n      webReferrer: {\n        URL: window.document.referrer\n      }\n    };\n    deepAssign(xdm, { web });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { deepAssign } from \"../../utils\";\n\nconst getScreenOrientationViaProperty = window => {\n  const {\n    screen: { orientation }\n  } = window;\n\n  if (orientation == null || orientation.type == null) {\n    return null;\n  }\n\n  const parts = orientation.type.split(\"-\");\n\n  if (parts.length === 0) {\n    return null;\n  }\n\n  if (parts[0] !== \"portrait\" && parts[0] !== \"landscape\") {\n    return null;\n  }\n\n  return parts[0];\n};\n\nconst getScreenOrientationViaMediaQuery = window => {\n  if (window.matchMedia(\"(orientation: portrait)\").matches) {\n    return \"portrait\";\n  }\n  if (window.matchMedia(\"(orientation: landscape)\").matches) {\n    return \"landscape\";\n  }\n\n  return null;\n};\n\nexport default window => {\n  return xdm => {\n    const {\n      screen: { width, height }\n    } = window;\n    const device = {\n      screenHeight: height,\n      screenWidth: width\n    };\n\n    const orientation =\n      getScreenOrientationViaProperty(window) ||\n      getScreenOrientationViaMediaQuery(window);\n    if (orientation) {\n      device.screenOrientation = orientation;\n    }\n    deepAssign(xdm, { device });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { deepAssign, isNumber } from \"../../utils\";\n\nexport default window => {\n  return xdm => {\n    const {\n      document: { documentElement: { clientWidth, clientHeight } = {} }\n    } = window;\n\n    const environment = {\n      type: \"browser\"\n    };\n    if (\n      isNumber(clientWidth) &&\n      clientWidth >= 0 &&\n      isNumber(clientHeight) &&\n      clientHeight >= 0\n    ) {\n      environment.browserDetails = {\n        viewportWidth: Math.round(clientWidth),\n        viewportHeight: Math.round(clientHeight)\n      };\n    }\n\n    deepAssign(xdm, { environment });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { deepAssign, toISOStringLocal, toInteger } from \"../../utils\";\n\nexport default dateProvider => {\n  return xdm => {\n    const date = dateProvider();\n\n    const placeContext = {\n      localTime: toISOStringLocal(date)\n    };\n\n    const localTimezoneOffset = toInteger(date.getTimezoneOffset());\n    if (localTimezoneOffset !== undefined) {\n      placeContext.localTimezoneOffset = localTimezoneOffset;\n    }\n    deepAssign(xdm, { placeContext });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { deepAssign } from \"../../utils\";\n\nexport default dateProvider => {\n  return xdm => {\n    const timestamp = dateProvider().toISOString();\n    deepAssign(xdm, { timestamp });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default \"https://ns.adobe.com/experience/alloy\";\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// The __VERSION__ keyword will be replace at alloy build time with the package.json version.\n// see babel-plugin-version\n\nexport default \"__VERSION__\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { deepAssign } from \"../../utils\";\nimport libraryName from \"../../constants/libraryName\";\nimport libraryVersion from \"../../constants/libraryVersion\";\n\nexport default xdm => {\n  const implementationDetails = {\n    name: libraryName,\n    version: libraryVersion,\n    environment: \"browser\"\n  };\n  deepAssign(xdm, { implementationDetails });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { flatMap } from \"../../utils\";\n\nexport default (config, logger, availableContexts, requiredContexts) => {\n  const configuredContexts = config.context;\n\n  const contexts = flatMap(configuredContexts, (context, i) => {\n    if (availableContexts[context]) {\n      return [availableContexts[context]];\n    }\n    logger.warn(`Invalid context[${i}]: '${context}' is not available.`);\n    return [];\n  }).concat(requiredContexts);\n\n  return {\n    namespace: \"Context\",\n    lifecycle: {\n      onBeforeEvent({ event }) {\n        const xdm = {};\n        contexts.forEach(context => context(xdm));\n        event.mergeXdm(xdm);\n      }\n    }\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport injectWeb from \"./injectWeb\";\nimport injectDevice from \"./injectDevice\";\nimport injectEnvironment from \"./injectEnvironment\";\nimport injectPlaceContext from \"./injectPlaceContext\";\nimport injectTimestamp from \"./injectTimestamp\";\nimport implementationDetails from \"./implementationDetails\";\nimport createComponent from \"./createComponent\";\nimport { arrayOf, string } from \"../../utils/validation\";\n\nconst web = injectWeb(window);\nconst device = injectDevice(window);\nconst environment = injectEnvironment(window);\nconst placeContext = injectPlaceContext(() => new Date());\nconst timestamp = injectTimestamp(() => new Date());\n\nconst optionalContexts = {\n  web,\n  device,\n  environment,\n  placeContext\n};\nconst requiredContexts = [timestamp, implementationDetails];\nconst createContext = ({ config, logger }) => {\n  return createComponent(config, logger, optionalContexts, requiredContexts);\n};\n\ncreateContext.namespace = \"Context\";\ncreateContext.configValidators = {\n  context: arrayOf(string()).default(Object.keys(optionalContexts))\n};\n\nexport default createContext;\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { GENERAL } from \"../../constants/consentPurpose\";\n\nexport default ({\n  storedConsent,\n  taskQueue,\n  defaultConsent,\n  consent,\n  sendSetConsentRequest,\n  validateSetConsentOptions,\n  consentHashStore,\n  doesIdentityCookieExist\n}) => {\n  const defaultConsentByPurpose = { [GENERAL]: defaultConsent };\n  let storedConsentByPurpose = storedConsent.read();\n\n  const identityCookieExists = doesIdentityCookieExist();\n  const consentCookieExists = storedConsentByPurpose[GENERAL] !== undefined;\n  if (!identityCookieExists || !consentCookieExists) {\n    consentHashStore.clear();\n  }\n  // If the identity cookie is gone, remove the consent cookie because the\n  // consent info is tied to the identity.\n  if (!identityCookieExists) {\n    storedConsent.clear();\n    storedConsentByPurpose = {};\n  }\n\n  consent.initializeConsent(defaultConsentByPurpose, storedConsentByPurpose);\n\n  const readCookieIfQueueEmpty = () => {\n    if (taskQueue.length === 0) {\n      const storedConsentObject = storedConsent.read();\n      // Only read cookies when there are no outstanding setConsent\n      // requests. This helps with race conditions.\n      if (storedConsentObject[GENERAL] !== undefined) {\n        consent.setConsent(storedConsentObject);\n      }\n    }\n  };\n\n  return {\n    commands: {\n      setConsent: {\n        optionsValidator: validateSetConsentOptions,\n        run: ({ consent: consentOptions, identityMap }) => {\n          consent.suspend();\n          const consentHashes = consentHashStore.lookup(consentOptions);\n          return taskQueue\n            .addTask(() => {\n              if (consentHashes.isNew()) {\n                return sendSetConsentRequest({\n                  consentOptions,\n                  identityMap\n                });\n              }\n              return Promise.resolve();\n            })\n            .then(() => consentHashes.save())\n            .finally(readCookieIfQueueEmpty);\n        }\n      }\n    },\n    lifecycle: {\n      // Read the cookie here too because the consent cookie may change on any request\n      onResponse: readCookieIfQueueEmpty,\n      // Even when we get a failure HTTP status code, the consent cookie can\n      // still get updated. This could happen, for example, if the user is\n      // opted out in AudienceManager, but no consent cookie exists on the\n      // client. The request will be sent and the server will respond with a\n      // 403 Forbidden and a consent cookie.\n      onRequestFailure: readCookieIfQueueEmpty\n    }\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { crc32 } from \"../../utils\";\n\n// serialize an object with a consistent ordering\nconst serialize = obj => {\n  if (Array.isArray(obj)) {\n    return obj.map(i => serialize(i));\n  }\n  if (typeof obj === \"object\" && obj !== null) {\n    return Object.keys(obj)\n      .sort()\n      .reduce((memo, key) => {\n        memo[key] = serialize(obj[key]);\n        return memo;\n      }, {});\n  }\n  return obj;\n};\n\nexport default obj => {\n  return crc32(JSON.stringify(serialize(obj)));\n};\n","import computeConsentHash from \"./computeConsentHash\";\n\nconst getKey = ({ standard, version }) => {\n  return `${standard}.${version}`;\n};\n\nexport default ({ storage }) => {\n  return {\n    clear() {\n      storage.clear();\n    },\n    lookup(consentObjects) {\n      const currentHashes = {};\n      const getCurrentHash = consentObject => {\n        const key = getKey(consentObject);\n        const { standard, version, ...rest } = consentObject;\n        if (!currentHashes[key]) {\n          currentHashes[key] = computeConsentHash(rest).toString();\n        }\n        return currentHashes[key];\n      };\n\n      return {\n        isNew() {\n          return consentObjects.some(consentObject => {\n            const key = getKey(consentObject);\n            const previousHash = storage.getItem(key);\n            return (\n              previousHash === null ||\n              previousHash !== getCurrentHash(consentObject)\n            );\n          });\n        },\n        save() {\n          consentObjects.forEach(consentObject => {\n            const key = getKey(consentObject);\n            storage.setItem(key, getCurrentHash(consentObject));\n          });\n        }\n      };\n    }\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createRequestPayload } from \"../../utils/request\";\n\nexport default () => {\n  const content = {};\n  const payload = createRequestPayload({\n    content,\n    addIdentity: (namespaceCode, identity) => {\n      content.identityMap = content.identityMap || {};\n      content.identityMap[namespaceCode] =\n        content.identityMap[namespaceCode] || [];\n      content.identityMap[namespaceCode].push(identity);\n    },\n    hasIdentity: namespaceCode => {\n      return (\n        (content.identityMap && content.identityMap[namespaceCode]) !==\n        undefined\n      );\n    }\n  });\n\n  payload.setConsent = consent => {\n    content.consent = consent;\n  };\n\n  return payload;\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createRequest } from \"../../utils/request\";\n\nexport default consentRequestPayload => {\n  return createRequest({\n    payload: consentRequestPayload,\n    getAction() {\n      return \"privacy/set-consent\";\n    },\n    getUseSendBeacon() {\n      return false;\n    }\n  });\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { getNamespacedCookieName } from \"../../utils\";\nimport { CONSENT } from \"../../constants/cookieNameKey\";\n\nexport default ({ parseConsentCookie, orgId, cookieJar }) => {\n  const consentCookieName = getNamespacedCookieName(orgId, CONSENT);\n\n  return {\n    read() {\n      const cookieValue = cookieJar.get(consentCookieName);\n      return cookieValue ? parseConsentCookie(cookieValue) : {};\n    },\n    clear() {\n      cookieJar.remove(consentCookieName);\n    }\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { isObject } from \"../../utils\";\n\nexport default ({\n  createConsentRequestPayload,\n  createConsentRequest,\n  sendEdgeNetworkRequest\n}) => ({ consentOptions, identityMap }) => {\n  const payload = createConsentRequestPayload();\n  payload.setConsent(consentOptions);\n  if (isObject(identityMap)) {\n    Object.keys(identityMap).forEach(key => {\n      identityMap[key].forEach(identity => {\n        payload.addIdentity(key, identity);\n      });\n    });\n  }\n  const request = createConsentRequest(payload);\n  return sendEdgeNetworkRequest({\n    request\n  }).then(() => {\n    // Don't let response data disseminate beyond this\n    // point unless necessary.\n  });\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n/**\n * Parses a consent cookie.\n * @param {string} cookieValue Must be in the format a=b;c=d\n * @returns {Object} An object where the keys are purpose names and the values\n * are the consent status for the purpose.\n */\nexport default cookieValue => {\n  const categoryPairs = cookieValue.split(\";\");\n  return categoryPairs.reduce((consentByPurpose, categoryPair) => {\n    const [name, value] = categoryPair.split(\"=\");\n    consentByPurpose[name] = value;\n    return consentByPurpose;\n  }, {});\n};\n","import { objectOf, anything, arrayOf } from \"../../utils/validation\";\nimport { validateIdentityMap } from \"../../utils\";\n\nexport default objectOf({\n  consent: arrayOf(anything())\n    .required()\n    .nonEmpty(),\n  identityMap: validateIdentityMap\n})\n  .noUnknownFields()\n  .required();\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  createTaskQueue,\n  cookieJar,\n  injectDoesIdentityCookieExist,\n  sanitizeOrgIdForCookieName\n} from \"../../utils\";\nimport createComponent from \"./createComponent\";\nimport createConsentHashStore from \"./createConsentHashStore\";\nimport createConsentRequestPayload from \"./createConsentRequestPayload\";\nimport createConsentRequest from \"./createConsentRequest\";\nimport createStoredConsent from \"./createStoredConsent\";\nimport injectSendSetConsentRequest from \"./injectSendSetConsentRequest\";\nimport parseConsentCookie from \"./parseConsentCookie\";\nimport validateSetConsentOptions from \"./validateSetConsentOptions\";\n\nconst createPrivacy = ({\n  config,\n  consent,\n  sendEdgeNetworkRequest,\n  createNamespacedStorage\n}) => {\n  const { orgId, defaultConsent } = config;\n  const storedConsent = createStoredConsent({\n    parseConsentCookie,\n    orgId,\n    cookieJar\n  });\n  const taskQueue = createTaskQueue();\n  const sendSetConsentRequest = injectSendSetConsentRequest({\n    createConsentRequestPayload,\n    createConsentRequest,\n    sendEdgeNetworkRequest\n  });\n  const storage = createNamespacedStorage(\n    `${sanitizeOrgIdForCookieName(orgId)}.consentHashes.`\n  );\n  const consentHashStore = createConsentHashStore({\n    storage: storage.persistent\n  });\n\n  const doesIdentityCookieExist = injectDoesIdentityCookieExist({ orgId });\n\n  return createComponent({\n    storedConsent,\n    taskQueue,\n    defaultConsent,\n    consent,\n    sendSetConsentRequest,\n    validateSetConsentOptions,\n    consentHashStore,\n    doesIdentityCookieExist\n  });\n};\n\ncreatePrivacy.namespace = \"Privacy\";\n\nexport default createPrivacy;\n","/*\nCopyright 20219 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { uuid } from \"../../utils\";\n\nexport default () => {\n  return {\n    eventMergeId: uuid()\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ createEventMergeId }) => {\n  return {\n    commands: {\n      createEventMergeId: {\n        run: createEventMergeId\n      }\n    }\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createEventMergeId from \"./createEventMergeId\";\nimport createComponent from \"./createComponent\";\n\nconst createEventMerge = () => {\n  return createComponent({ createEventMergeId });\n};\n\ncreateEventMerge.namespace = \"EventMerge\";\ncreateEventMerge.configValidators = {};\n\nexport default createEventMerge;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport libraryVersion from \"../../constants/libraryVersion\";\nimport { CONFIGURE, SET_DEBUG } from \"../../constants/coreCommands\";\n\nconst prepareLibraryInfo = ({ config, componentRegistry }) => {\n  const allCommands = [\n    ...componentRegistry.getCommandNames(),\n    CONFIGURE,\n    SET_DEBUG\n  ].sort();\n  const resultConfig = { ...config };\n  Object.keys(config).forEach(key => {\n    const value = config[key];\n    if (typeof value !== \"function\") {\n      return;\n    }\n    resultConfig[key] = value.toString();\n  });\n  return {\n    version: libraryVersion,\n    configs: resultConfig,\n    commands: allCommands\n  };\n};\n\nconst createLibraryInfo = ({ config, componentRegistry }) => {\n  const libraryInfo = prepareLibraryInfo({ config, componentRegistry });\n  return {\n    commands: {\n      getLibraryInfo: {\n        run: () => {\n          return {\n            libraryInfo\n          };\n        }\n      }\n    }\n  };\n};\n\ncreateLibraryInfo.namespace = \"LibraryInfo\";\nexport default createLibraryInfo;\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ response }) => {\n  return {\n    inferences: response.getPayloadsByType(\"rtml:inferences\")\n  };\n};\n","/*\nCopyright 2021 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport processResponse from \"./processResponse\";\n\nconst createMachineLearning = () => {\n  return {\n    lifecycle: {\n      onResponse: processResponse\n    },\n    commands: {}\n  };\n};\n\ncreateMachineLearning.namespace = \"MachineLearning\";\ncreateMachineLearning.configValidators = {};\n\nexport default createMachineLearning;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createDataCollector from \"../components/DataCollector\";\nimport createActivityCollector from \"../components/ActivityCollector\";\nimport createIdentity from \"../components/Identity\";\nimport createAudiences from \"../components/Audiences\";\nimport createPersonalization from \"../components/Personalization\";\nimport createContext from \"../components/Context\";\nimport createPrivacy from \"../components/Privacy\";\nimport createEventMerge from \"../components/EventMerge\";\nimport createLibraryInfo from \"../components/LibraryInfo\";\nimport createMachineLearning from \"../components/MachineLearning\";\n\n// TODO: Register the Components here statically for now. They might be registered differently.\n// TODO: Figure out how sub-components will be made available/registered\nexport default [\n  createDataCollector,\n  createActivityCollector,\n  createIdentity,\n  createAudiences,\n  createPersonalization,\n  createContext,\n  createPrivacy,\n  createEventMerge,\n  createLibraryInfo,\n  createMachineLearning\n];\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport { assign } from \"../utils\";\nimport { objectOf } from \"../utils/validation\";\n\nconst CONFIG_DOC_URI = \"https://adobe.ly/3sHh553\";\n\nconst buildSchema = (coreConfigValidators, componentCreators) => {\n  const schema = {};\n  assign(schema, coreConfigValidators);\n  componentCreators.forEach(createComponent => {\n    const { configValidators } = createComponent;\n    assign(schema, configValidators);\n  });\n  return schema;\n};\n\nconst transformOptions = (schema, options) => {\n  try {\n    const validator = objectOf(schema)\n      .noUnknownFields()\n      .required();\n    return validator(options);\n  } catch (e) {\n    throw new Error(\n      `Resolve these configuration problems:\\n\\t - ${e.message\n        .split(\"\\n\")\n        .join(\n          \"\\n\\t - \"\n        )}\\nFor configuration documentation see: ${CONFIG_DOC_URI}`\n    );\n  }\n};\n\nexport default ({\n  options,\n  componentCreators,\n  coreConfigValidators,\n  createConfig,\n  logger,\n  setDebugEnabled\n}) => {\n  const schema = buildSchema(coreConfigValidators, componentCreators);\n  const config = createConfig(transformOptions(schema, options));\n  setDebugEnabled(config.debugEnabled, { fromConfig: true });\n  logger.logOnInstanceConfigured({ config });\n  return config;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { stackError } from \"../utils\";\n\nexport default ({\n  componentCreators,\n  lifecycle,\n  componentRegistry,\n  getImmediatelyAvailableTools\n}) => {\n  componentCreators.forEach(createComponent => {\n    const { namespace } = createComponent;\n    // TO-DOCUMENT: Helpers that we inject into factories.\n    const tools = getImmediatelyAvailableTools(namespace);\n    let component;\n    try {\n      component = createComponent(tools);\n    } catch (error) {\n      throw stackError({\n        error,\n        message: `[${namespace}] An error occurred during component creation.`\n      });\n    }\n    componentRegistry.register(namespace, component);\n  });\n\n  return lifecycle\n    .onComponentsRegistered({\n      lifecycle\n    })\n    .then(() => componentRegistry);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { assign } from \"../../utils\";\n\nconst createConfig = options => {\n  return assign({}, options);\n};\n\nexport default createConfig;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const EDGE = \"edge.adobedc.net\";\nexport const ID_THIRD_PARTY = \"adobedc.demdex.net\";\n","export default \"ee\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { boolean, string, callback, enumOf } from \"../../utils/validation\";\nimport { noop } from \"../../utils\";\nimport { EDGE as EDGE_DOMAIN } from \"../../constants/domain\";\nimport EDGE_BASE_PATH from \"../../constants/edgeBasePath\";\nimport { IN, OUT, PENDING } from \"../../constants/consentStatus\";\n\nexport default () => ({\n  debugEnabled: boolean().default(false),\n  defaultConsent: enumOf(IN, OUT, PENDING).default(IN),\n  edgeConfigId: string()\n    .unique()\n    .required(),\n  edgeDomain: string()\n    .domain()\n    .default(EDGE_DOMAIN),\n  edgeBasePath: string()\n    .nonEmpty()\n    .default(EDGE_BASE_PATH),\n  orgId: string()\n    .unique()\n    .required(),\n  onBeforeEventSend: callback().default(noop)\n});\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { toError, updateErrorMessage } from \"../utils\";\nimport { DECLINED_CONSENT_ERROR_CODE } from \"./consent/createConsentStateMachine\";\n\nexport default ({ errorPrefix, logger }) => (error, operation) => {\n  const err = toError(error);\n\n  // In the case of declined consent, we've opted to not reject the promise\n  // returned to the customer, but instead resolve the promise with an\n  // empty result object.\n  if (err.code === DECLINED_CONSENT_ERROR_CODE) {\n    logger.warn(`The ${operation} could not fully complete. ${err.message}`);\n    return {};\n  }\n\n  updateErrorMessage({\n    error: err,\n    message: `${errorPrefix} ${err.message}`\n  });\n  throw err;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ fetch }) => {\n  return (url, body) => {\n    return fetch(url, {\n      method: \"POST\",\n      cache: \"no-cache\",\n      credentials: \"include\", // To set the cookie header in the request.\n      headers: {\n        \"Content-Type\": \"text/plain; charset=UTF-8\"\n      },\n      referrer: \"client\",\n      body\n    }).then(response => {\n      return response.text().then(responseBody => ({\n        statusCode: response.status,\n        // We expose headers through a function instead of creating an object\n        // with all the headers up front largely because the native\n        // request.getResponseHeader method is case-insensitive but also because it prevents\n        // us from having to add header parsing logic when using XHR to make requests.\n        getHeader(name) {\n          return response.headers.get(name);\n        },\n        body: responseBody\n      }));\n    });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ XMLHttpRequest }) => {\n  return (url, body) => {\n    return new Promise((resolve, reject) => {\n      const request = new XMLHttpRequest();\n      request.onreadystatechange = () => {\n        if (request.readyState === 4) {\n          if (request.status === 0) {\n            reject(new Error(\"Request aborted.\"));\n          } else {\n            resolve({\n              statusCode: request.status,\n              // We expose headers through a function instead of creating an object\n              // with all the headers up front because:\n              // 1. It avoids having to add header parsing code to get all headers.\n              // 2. The native request.getResponseHeader method is case-insensitive.\n              getHeader(name) {\n                return request.getResponseHeader(name);\n              },\n              body: request.responseText\n            });\n          }\n        }\n      };\n      request.onloadstart = () => {\n        request.responseType = \"text\";\n      };\n      request.open(\"POST\", url, true);\n      request.setRequestHeader(\"Content-Type\", \"text/plain; charset=UTF-8\");\n      request.withCredentials = true;\n      request.onerror = reject;\n      request.onabort = reject;\n      request.send(body);\n    });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport default ({ sendBeacon, sendFetchRequest, logger }) => {\n  return (url, body) => {\n    const blob = new Blob([body], { type: \"text/plain; charset=UTF-8\" });\n    if (!sendBeacon(url, blob)) {\n      logger.info(\"Unable to use `sendBeacon`; falling back to `fetch`.\");\n      return sendFetchRequest(url, body);\n    }\n\n    // Using sendBeacon, we technically don't get a response back from\n    // the server, but we'll resolve the promise with an object to maintain\n    // consistency with other network strategies.\n    return Promise.resolve({\n      statusCode: 204,\n      getHeader() {\n        return null;\n      },\n      body: \"\"\n    });\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { assign } from \"../utils\";\n\nexport default ({ getDebugEnabled, console, getMonitors, context }) => {\n  let prefix = `[${context.instanceName}]`;\n  if (context.componentName) {\n    prefix += ` [${context.componentName}]`;\n  }\n\n  const notifyMonitors = (method, data) => {\n    const monitors = getMonitors();\n    if (monitors.length > 0) {\n      const dataWithContext = assign({}, context, data);\n      monitors.forEach(monitor => {\n        if (monitor[method]) {\n          monitor[method](dataWithContext);\n        }\n      });\n    }\n  };\n\n  const log = (level, ...rest) => {\n    notifyMonitors(\"onBeforeLog\", { level, arguments: rest });\n    if (getDebugEnabled()) {\n      console[level](prefix, ...rest);\n    }\n  };\n\n  return {\n    get enabled() {\n      return getMonitors().length > 0 || getDebugEnabled();\n    },\n    logOnInstanceCreated(data) {\n      notifyMonitors(\"onInstanceCreated\", data);\n      log(\"info\", \"Instance initialized.\");\n    },\n    logOnInstanceConfigured(data) {\n      notifyMonitors(\"onInstanceConfigured\", data);\n      log(\"info\", \"Instance configured. Computed configuration:\", data.config);\n    },\n    logOnBeforeCommand(data) {\n      notifyMonitors(\"onBeforeCommand\", data);\n      log(\n        \"info\",\n        `Executing ${data.commandName} command. Options:`,\n        data.options\n      );\n    },\n    logOnCommandResolved(data) {\n      notifyMonitors(\"onCommandResolved\", data);\n      log(\"info\", `${data.commandName} command resolved. Result:`, data.result);\n    },\n    logOnCommandRejected(data) {\n      notifyMonitors(\"onCommandRejected\", data);\n      log(\n        \"error\",\n        `${data.commandName} command was rejected. Error:`,\n        data.error\n      );\n    },\n    logOnBeforeNetworkRequest(data) {\n      notifyMonitors(\"onBeforeNetworkRequest\", data);\n      log(\"info\", `Request ${data.requestId}: Sending request.`, data.payload);\n    },\n    logOnNetworkResponse(data) {\n      notifyMonitors(\"onNetworkResponse\", data);\n      const messagesSuffix =\n        data.parsedBody || data.body ? `response body:` : `no response body.`;\n      log(\n        \"info\",\n        `Request ${data.requestId}: Received response with status code ${data.statusCode} and ${messagesSuffix}`,\n        data.parsedBody || data.body\n      );\n    },\n    logOnNetworkError(data) {\n      notifyMonitors(\"onNetworkError\", data);\n      log(\n        \"error\",\n        `Request ${data.requestId}: Network request failed.`,\n        data.error\n      );\n    },\n    /**\n     * Outputs informational message to the web console. In some\n     * browsers a small \"i\" icon is displayed next to these items\n     * in the web console's log.\n     * @param {...*} arg Any argument to be logged.\n     */\n    info: log.bind(null, \"info\"),\n    /**\n     * Outputs a warning message to the web console.\n     * @param {...*} arg Any argument to be logged.\n     */\n    warn: log.bind(null, \"warn\"),\n    /**\n     * Outputs an error message to the web console.\n     * @param {...*} arg Any argument to be logged.\n     */\n    error: log.bind(null, \"error\")\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { createCallbackAggregator } from \"../utils\";\n\nconst EVENT_CANCELLATION_MESSAGE =\n  \"Event was canceled because the onBeforeEventSend callback returned false.\";\n\nexport default ({\n  config,\n  logger,\n  lifecycle,\n  consent,\n  createEvent,\n  createDataCollectionRequestPayload,\n  createDataCollectionRequest,\n  sendEdgeNetworkRequest\n}) => {\n  const { onBeforeEventSend } = config;\n\n  return {\n    createEvent,\n    /**\n     * Sends an event. This includes running the event and payload through\n     * the appropriate lifecycle hooks, sending the request to the server,\n     * and handling the response.\n     * @param {Object} event This will be JSON stringified and used inside\n     * the request payload.\n     * @param {Object} [options]\n     * @param {boolean} [options.renderDecisions=false]\n     * @param {Array} [options.decisionScopes]\n     * This will be passed to components\n     * so they can take appropriate action.\n     * @returns {*}\n     */\n    sendEvent(event, options = {}) {\n      const { renderDecisions = false, decisionScopes } = options;\n      const payload = createDataCollectionRequestPayload();\n      const request = createDataCollectionRequest(payload);\n      const onResponseCallbackAggregator = createCallbackAggregator();\n      const onRequestFailureCallbackAggregator = createCallbackAggregator();\n\n      return lifecycle\n        .onBeforeEvent({\n          event,\n          renderDecisions,\n          decisionScopes,\n          onResponse: onResponseCallbackAggregator.add,\n          onRequestFailure: onRequestFailureCallbackAggregator.add\n        })\n        .then(() => {\n          payload.addEvent(event);\n          return consent.awaitConsent();\n        })\n        .then(() => {\n          try {\n            // NOTE: this calls onBeforeEventSend callback (if configured)\n            event.finalize(onBeforeEventSend);\n          } catch (error) {\n            const throwError = () => {\n              throw error;\n            };\n            onRequestFailureCallbackAggregator.add(lifecycle.onRequestFailure);\n            return onRequestFailureCallbackAggregator\n              .call({ error })\n              .then(throwError, throwError);\n          }\n\n          // if the callback returns false, the event should not be sent\n          if (!event.shouldSend()) {\n            onRequestFailureCallbackAggregator.add(lifecycle.onRequestFailure);\n            logger.info(EVENT_CANCELLATION_MESSAGE);\n            const error = new Error(EVENT_CANCELLATION_MESSAGE);\n            return onRequestFailureCallbackAggregator\n              .call({ error })\n              .then(() => {\n                // Ensure the promise gets resolved with undefined instead\n                // of an array of return values from the callbacks.\n              });\n          }\n\n          return sendEdgeNetworkRequest({\n            request,\n            runOnResponseCallbacks: onResponseCallbackAggregator.call,\n            runOnRequestFailureCallbacks:\n              onRequestFailureCallbackAggregator.call\n          });\n        });\n    }\n  };\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { endsWith, isNamespacedCookieName } from \"../utils\";\n\nconst STATE_STORE_HANDLE_TYPE = \"state:store\";\n\nexport default ({ cookieJar, orgId, apexDomain, dateProvider }) => {\n  return {\n    /**\n     * When sending to a third-party endpoint, the endpoint won't be able to\n     * access first-party cookies, therefore we transfer cookies into\n     * the request body so they can be read by the server.\n     */\n    cookiesToPayload(payload, endpointDomain) {\n      const isEndpointFirstParty = endsWith(endpointDomain, apexDomain);\n\n      const state = {\n        domain: apexDomain,\n        cookiesEnabled: true\n      };\n\n      // If the endpoint is first-party, there's no need to transfer cookies\n      // to the payload since they'll be automatically passed through cookie\n      // headers.\n      if (!isEndpointFirstParty) {\n        const cookies = cookieJar.get();\n\n        const entries = Object.keys(cookies)\n          .filter(name => {\n            // We have a contract with the server that we will pass\n            // all cookies whose names are namespaced according to the\n            // logic in isNamespacedCookieName as well as any legacy\n            // cookie names (so that the server can handle migrating\n            // identities on websites previously using Visitor.js)\n            return isNamespacedCookieName(orgId, name);\n          })\n          .map(qualifyingCookieName => {\n            return {\n              key: qualifyingCookieName,\n              value: cookies[qualifyingCookieName]\n            };\n          });\n\n        if (entries.length) {\n          state.entries = entries;\n        }\n      }\n\n      payload.mergeState(state);\n    },\n    /**\n     * When receiving from a third-party endpoint, the endpoint won't be able to\n     * write first-party cookies, therefore we write first-party cookies\n     * as directed in the response body.\n     */\n    responseToCookies(response) {\n      response.getPayloadsByType(STATE_STORE_HANDLE_TYPE).forEach(stateItem => {\n        const options = { domain: apexDomain };\n\n        const sameSite =\n          stateItem.attrs &&\n          stateItem.attrs.SameSite &&\n          stateItem.attrs.SameSite.toLowerCase();\n\n        if (stateItem.maxAge !== undefined) {\n          // cookieJar expects \"expires\" as a date object\n          options.expires = new Date(\n            dateProvider().getTime() + stateItem.maxAge * 1000\n          );\n        }\n        if (sameSite !== undefined) {\n          options.sameSite = sameSite;\n        }\n        // When sameSite is set to none, the secure flag must be set.\n        // Experience edge will not set the secure flag in these cases.\n        if (sameSite === \"none\") {\n          options.secure = true;\n        }\n\n        cookieJar.set(stateItem.key, stateItem.value, options);\n      });\n    }\n  };\n};\n","export default \"v1\";\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { ID_THIRD_PARTY as ID_THIRD_PARTY_DOMAIN } from \"../../constants/domain\";\nimport apiVersion from \"../../constants/apiVersion\";\nimport { createCallbackAggregator, noop, assign } from \"../../utils\";\n\nexport default ({\n  config,\n  lifecycle,\n  cookieTransfer,\n  sendNetworkRequest,\n  createResponse,\n  processWarningsAndErrors,\n  getLocationHint\n}) => {\n  const { edgeDomain, edgeBasePath, edgeConfigId } = config;\n\n  /**\n   * Sends a network request that is aware of payload interfaces,\n   * lifecycle methods, configured edge domains, response structures, etc.\n   */\n  return ({\n    request,\n    runOnResponseCallbacks = noop,\n    runOnRequestFailureCallbacks = noop\n  }) => {\n    const onResponseCallbackAggregator = createCallbackAggregator();\n    onResponseCallbackAggregator.add(lifecycle.onResponse);\n    onResponseCallbackAggregator.add(runOnResponseCallbacks);\n\n    const onRequestFailureCallbackAggregator = createCallbackAggregator();\n    onRequestFailureCallbackAggregator.add(lifecycle.onRequestFailure);\n    onRequestFailureCallbackAggregator.add(runOnRequestFailureCallbacks);\n\n    return lifecycle\n      .onBeforeRequest({\n        request,\n        onResponse: onResponseCallbackAggregator.add,\n        onRequestFailure: onRequestFailureCallbackAggregator.add\n      })\n      .then(() => {\n        const endpointDomain = request.getUseIdThirdPartyDomain()\n          ? ID_THIRD_PARTY_DOMAIN\n          : edgeDomain;\n        const locationHint = getLocationHint();\n        const edgeBasePathWithLocationHint = locationHint\n          ? `${edgeBasePath}/${locationHint}`\n          : edgeBasePath;\n        const url = `https://${endpointDomain}/${edgeBasePathWithLocationHint}/${apiVersion}/${request.getAction()}?configId=${edgeConfigId}&requestId=${request.getId()}`;\n        cookieTransfer.cookiesToPayload(request.getPayload(), endpointDomain);\n        return sendNetworkRequest({\n          requestId: request.getId(),\n          url,\n          payload: request.getPayload(),\n          useSendBeacon: request.getUseSendBeacon()\n        });\n      })\n      .then(networkResponse => {\n        processWarningsAndErrors(networkResponse);\n        return networkResponse;\n      })\n      .catch(error => {\n        // Regardless of whether the network call failed, an unexpected status\n        // code was returned, or the response body was malformed, we want to call\n        // the onRequestFailure callbacks, but still throw the exception.\n        const throwError = () => {\n          throw error;\n        };\n        return onRequestFailureCallbackAggregator\n          .call({ error })\n          .then(throwError, throwError);\n      })\n      .then(({ parsedBody, getHeader }) => {\n        // Note that networkResponse.parsedBody may be undefined if it was a\n        // 204 No Content response. That's fine.\n        const response = createResponse({ content: parsedBody, getHeader });\n        cookieTransfer.responseToCookies(response);\n\n        // Notice we're calling the onResponse lifecycle method even if there are errors\n        // inside the response body. This is because the full request didn't actually fail--\n        // only portions of it that are considered non-fatal (a specific, non-critical\n        // Konductor plugin, for example).\n        return onResponseCallbackAggregator\n          .call({\n            response\n          })\n          .then(returnValues => {\n            // Merges all returned objects from all `onResponse` callbacks into\n            // a single object that can later be returned to the customer.\n            const lifecycleOnResponseReturnValues = returnValues.shift() || [];\n            const consumerOnResponseReturnValues = returnValues.shift() || [];\n            const lifecycleOnBeforeRequestReturnValues = returnValues;\n            return assign(\n              {},\n              ...lifecycleOnResponseReturnValues,\n              ...consumerOnResponseReturnValues,\n              ...lifecycleOnBeforeRequestReturnValues\n            );\n          });\n      });\n  };\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nexport const NO_CONTENT = 204;\nexport const TOO_MANY_REQUESTS = 429;\nexport const BAD_GATEWAY = 502;\nexport const SERVICE_UNAVAILABLE = 503;\nexport const GATEWAY_TIMEOUT = 504;\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { NO_CONTENT } from \"../../constants/httpStatusCode\";\n\nconst MESSAGE_PREFIX = \"The server responded with a\";\n\nexport default ({ logger }) => {\n  return networkResponse => {\n    const { statusCode, body, parsedBody } = networkResponse;\n\n    if (\n      statusCode < 200 ||\n      statusCode >= 300 ||\n      (!parsedBody && statusCode !== NO_CONTENT) ||\n      (parsedBody && !Array.isArray(parsedBody.handle))\n    ) {\n      const bodyToLog = parsedBody ? JSON.stringify(parsedBody, null, 2) : body;\n      const messageSuffix = bodyToLog\n        ? `response body:\\n${bodyToLog}`\n        : `no response body.`;\n      throw new Error(\n        `${MESSAGE_PREFIX} status code ${statusCode} and ${messageSuffix}`\n      );\n    }\n\n    if (parsedBody) {\n      const { warnings = [], errors = [] } = parsedBody;\n      warnings.forEach(warning => {\n        logger.warn(`${MESSAGE_PREFIX} warning:`, warning);\n      });\n      errors.forEach(error => {\n        logger.error(`${MESSAGE_PREFIX} non-fatal error:`, error);\n      });\n    }\n  };\n};\n","/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { getNamespacedCookieName } from \"../../utils\";\nimport { CLUSTER } from \"../../constants/cookieNameKey\";\n\nexport default ({ orgId, cookieJar }) => {\n  const clusterCookieName = getNamespacedCookieName(orgId, CLUSTER);\n\n  return () => cookieJar.get(clusterCookieName);\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n  TOO_MANY_REQUESTS,\n  SERVICE_UNAVAILABLE,\n  BAD_GATEWAY,\n  GATEWAY_TIMEOUT\n} from \"../../constants/httpStatusCode\";\nimport { includes } from \"../../utils\";\n\nconst MAX_RETRIES = 3;\n\nconst RETRYABLE_STATUS_CODES = [\n  TOO_MANY_REQUESTS,\n  SERVICE_UNAVAILABLE,\n  BAD_GATEWAY,\n  GATEWAY_TIMEOUT\n];\n\n// These rules are in accordance with\n// https://git.corp.adobe.com/pages/experience-edge/konductor/#/apis/errors?id=handling-4xx-and-5xx-responses\nexport default ({ response, retriesAttempted }) => {\n  return (\n    retriesAttempted < MAX_RETRIES &&\n    includes(RETRYABLE_STATUS_CODES, response.statusCode)\n  );\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { RETRY_AFTER } from \"../../constants/httpHeaderNames\";\nimport { isInteger } from \"../../utils\";\n\n// The retry gets incrementally (but not exponentially) longer for each retry.\nconst FIRST_DELAY_MILLIS = 1000;\nconst INCREMENTAL_DELAY_MILLIS = 1000;\n\n// When the target delay is randomized, make it within the range of this percentage above or below the target delay.\nconst MAX_RANDOM_VARIANCE_PERCENTAGE = 0.3;\n\nconst calculateRetryDelay = retriesAttempted => {\n  const targetDelay =\n    FIRST_DELAY_MILLIS + retriesAttempted * INCREMENTAL_DELAY_MILLIS;\n  const maxVariance = targetDelay * MAX_RANDOM_VARIANCE_PERCENTAGE;\n  const minDelay = targetDelay - maxVariance;\n  const maxDelay = targetDelay + maxVariance;\n  const randomizedDelayWithinRange = Math.round(\n    minDelay + Math.random() * (maxDelay - minDelay)\n  );\n  return randomizedDelayWithinRange;\n};\n\nconst getDelayFromHeader = response => {\n  // According to the HTTP spec, if the header is defined, its value will be a string that\n  // represents either:\n  //  * An integer indicating the number of seconds to delay.\n  //  * A date after which a retry may occur. The date would be in HTTP-date\n  //    format (https://tools.ietf.org/html/rfc7231#section-7.1.1.1). When debugging, it can\n  //    be helpful to know that this is the same format that a JavaScript date's\n  //    toGMTString() returns.\n  const headerValue = response.getHeader(RETRY_AFTER);\n  let delayInMillis;\n\n  if (headerValue) {\n    const headerValueInt = parseInt(headerValue, 10);\n    if (isInteger(headerValueInt)) {\n      delayInMillis = headerValueInt * 1000;\n    } else {\n      delayInMillis = Math.max(\n        0,\n        new Date(headerValue).getTime() - new Date().getTime()\n      );\n    }\n  }\n\n  return delayInMillis;\n};\n\n// These rules are in accordance with\n// https://git.corp.adobe.com/pages/experience-edge/konductor/#/apis/errors?id=handling-4xx-and-5xx-responses\n// For retry delays that don't come from a Retry-After response header, we try to stick with the following best\n// practices outlined in https://docs.microsoft.com/en-us/azure/architecture/best-practices/transient-faults:\n//  * Incremental retry\n//  * Random interval\nexport default ({ response, retriesAttempted }) => {\n  // Technically, only 429 or 503 responses should have a Retry-After header, but we'll respect the\n  // header if we find it on any response.\n  let delayInMillis = getDelayFromHeader(response);\n\n  // Note that the value of delay may be 0 at this point, which would be a valid delay we want to use\n  // and not override, which is why we don't do:\n  // if (!delay) { ... }\n  if (delayInMillis === undefined) {\n    delayInMillis = calculateRetryDelay(retriesAttempted);\n  }\n\n  return delayInMillis;\n};\n","/*\nCopyright 2019 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport createInstanceFunction from \"./createInstanceFunction\";\nimport {\n  getApexDomain,\n  injectStorage,\n  cookieJar,\n  isFunction,\n  createLoggingCookieJar,\n  injectFireReferrerHideableImage\n} from \"../utils\";\nimport createLogController from \"./createLogController\";\nimport createLifecycle from \"./createLifecycle\";\nimport createComponentRegistry from \"./createComponentRegistry\";\nimport injectSendNetworkRequest from \"./network/injectSendNetworkRequest\";\nimport injectExtractEdgeInfo from \"./edgeNetwork/injectExtractEdgeInfo\";\nimport createConsent from \"./consent/createConsent\";\nimport createConsentStateMachine from \"./consent/createConsentStateMachine\";\nimport createEvent from \"./createEvent\";\nimport injectCreateResponse from \"./injectCreateResponse\";\nimport injectExecuteCommand from \"./injectExecuteCommand\";\nimport validateCommandOptions from \"./validateCommandOptions\";\nimport componentCreators from \"./componentCreators\";\nimport buildAndValidateConfig from \"./buildAndValidateConfig\";\nimport initializeComponents from \"./initializeComponents\";\nimport createConfig from \"./config/createConfig\";\nimport createCoreConfigs from \"./config/createCoreConfigs\";\nimport injectHandleError from \"./injectHandleError\";\nimport injectSendFetchRequest from \"./network/requestMethods/injectSendFetchRequest\";\nimport injectSendXhrRequest from \"./network/requestMethods/injectSendXhrRequest\";\nimport injectSendBeaconRequest from \"./network/requestMethods/injectSendBeaconRequest\";\nimport createLogger from \"./createLogger\";\nimport createEventManager from \"./createEventManager\";\nimport createCookieTransfer from \"./createCookieTransfer\";\nimport {\n  createDataCollectionRequest,\n  createDataCollectionRequestPayload\n} from \"../utils/request\";\nimport injectSendEdgeNetworkRequest from \"./edgeNetwork/injectSendEdgeNetworkRequest\";\nimport injectProcessWarningsAndErrors from \"./edgeNetwork/injectProcessWarningsAndErrors\";\nimport injectGetLocationHint from \"./edgeNetwork/injectGetLocationHint\";\nimport isRequestRetryable from \"./network/isRequestRetryable\";\nimport getRequestRetryDelay from \"./network/getRequestRetryDelay\";\n\nconst createNamespacedStorage = injectStorage(window);\n\nconst { console, fetch, navigator, XMLHttpRequest } = window;\n\n// set this up as a function so that monitors can be added at anytime\n// eslint-disable-next-line no-underscore-dangle\nconst getMonitors = () => window.__alloyMonitors || [];\n\nconst coreConfigValidators = createCoreConfigs();\nconst apexDomain = getApexDomain(window, cookieJar);\nconst sendFetchRequest = isFunction(fetch)\n  ? injectSendFetchRequest({ fetch })\n  : injectSendXhrRequest({ XMLHttpRequest });\nconst fireReferrerHideableImage = injectFireReferrerHideableImage();\n\nexport const createExecuteCommand = ({\n  instanceName,\n  logController: { setDebugEnabled, logger, createComponentLogger }\n}) => {\n  const componentRegistry = createComponentRegistry();\n  const lifecycle = createLifecycle(componentRegistry);\n\n  const setDebugCommand = options => {\n    setDebugEnabled(options.enabled, { fromConfig: false });\n  };\n\n  const loggingCookieJar = createLoggingCookieJar({ logger, cookieJar });\n\n  const configureCommand = options => {\n    const config = buildAndValidateConfig({\n      options,\n      componentCreators,\n      coreConfigValidators,\n      createConfig,\n      logger,\n      setDebugEnabled\n    });\n    const { orgId } = config;\n    const cookieTransfer = createCookieTransfer({\n      cookieJar: loggingCookieJar,\n      orgId,\n      apexDomain,\n      dateProvider: () => new Date()\n    });\n    const sendBeaconRequest = isFunction(navigator.sendBeacon)\n      ? injectSendBeaconRequest({\n          // Without the bind(), the browser will complain about an\n          // illegal invocation.\n          sendBeacon: navigator.sendBeacon.bind(navigator),\n          sendFetchRequest,\n          logger\n        })\n      : sendFetchRequest;\n    const sendNetworkRequest = injectSendNetworkRequest({\n      logger,\n      sendFetchRequest,\n      sendBeaconRequest,\n      isRequestRetryable,\n      getRequestRetryDelay\n    });\n    const processWarningsAndErrors = injectProcessWarningsAndErrors({\n      logger\n    });\n    const extractEdgeInfo = injectExtractEdgeInfo({ logger });\n    const createResponse = injectCreateResponse({ extractEdgeInfo });\n    const getLocationHint = injectGetLocationHint({ orgId, cookieJar });\n    const sendEdgeNetworkRequest = injectSendEdgeNetworkRequest({\n      config,\n      lifecycle,\n      cookieTransfer,\n      sendNetworkRequest,\n      createResponse,\n      processWarningsAndErrors,\n      getLocationHint\n    });\n\n    const generalConsentState = createConsentStateMachine({ logger });\n    const consent = createConsent({\n      generalConsentState,\n      logger\n    });\n    const eventManager = createEventManager({\n      config,\n      logger,\n      lifecycle,\n      consent,\n      createEvent,\n      createDataCollectionRequestPayload,\n      createDataCollectionRequest,\n      sendEdgeNetworkRequest\n    });\n    return initializeComponents({\n      componentCreators,\n      lifecycle,\n      componentRegistry,\n      getImmediatelyAvailableTools(componentName) {\n        const componentLogger = createComponentLogger(componentName);\n        return {\n          config,\n          componentRegistry,\n          consent,\n          eventManager,\n          fireReferrerHideableImage,\n          logger: componentLogger,\n          lifecycle,\n          sendEdgeNetworkRequest,\n          handleError: injectHandleError({\n            errorPrefix: `[${instanceName}] [${componentName}]`,\n            logger: componentLogger\n          }),\n          createNamespacedStorage,\n          apexDomain\n        };\n      }\n    });\n  };\n\n  const handleError = injectHandleError({\n    errorPrefix: `[${instanceName}]`,\n    logger\n  });\n\n  const executeCommand = injectExecuteCommand({\n    logger,\n    configureCommand,\n    setDebugCommand,\n    handleError,\n    validateCommandOptions\n  });\n  return executeCommand;\n};\n\nexport default () => {\n  // eslint-disable-next-line no-underscore-dangle\n  const instanceNames = window.__alloyNS;\n\n  if (instanceNames) {\n    instanceNames.forEach(instanceName => {\n      const logController = createLogController({\n        console,\n        locationSearch: window.location.search,\n        createLogger,\n        instanceName,\n        createNamespacedStorage,\n        getMonitors\n      });\n\n      const executeCommand = createExecuteCommand({\n        instanceName,\n        logController\n      });\n      const instance = createInstanceFunction(executeCommand);\n\n      const queue = window[instanceName].q;\n      queue.push = instance;\n      logController.logger.logOnInstanceCreated({ instance });\n      queue.forEach(instance);\n    });\n  }\n};\n","/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\n// This file is used by rollup to create the browser version that is uploaded to cdn\n\nimport core from \"./core\";\n\ncore();\n"],"names":["executeCommand","args","resolve","reject","userProvidedArgs","commandName","options","then","CHROME","EDGE","EDGE_CHROMIUM","FIREFOX","IE","SAFARI","UNKNOWN","arr","item","indexOf","browsersSupportingThirdPartyCookie","browser","includes","getOwnPropertySymbols","Object","hasOwnProperty","prototype","propIsEnumerable","propertyIsEnumerable","toObject","val","undefined","TypeError","shouldUseNative","assign","test1","String","getOwnPropertyNames","test2","i","fromCharCode","order2","map","n","join","test3","split","forEach","letter","keys","err","target","source","from","to","symbols","s","arguments","length","key","call","require$$0","factory","registeredInModuleLoader","module","OldCookies","window","Cookies","api","noConflict","extend","result","attributes","decode","replace","decodeURIComponent","init","converter","set","value","document","path","defaults","expires","Date","toUTCString","JSON","stringify","test","e","write","encodeURIComponent","escape","stringifiedAttributes","attributeName","cookie","get","json","jar","cookies","parts","slice","charAt","name","read","parse","getJSON","remove","withConverter","isNil","Array","isArray","deepAssignObject","isObject","sources","content","updates","propertyPath","hostObjectForUpdates","reduce","obj","propertyName","deepAssign","callbacks","add","callback","push","Promise","all","logger","cookieJar","info","queueLength","lastPromiseInQueue","addTask","task","lastPromiseFulfilledHandler","finally","crc32","table","c","j","str","crc","unescape","y","charCodeAt","deferred","promise","suffix","substr","predicate","parent","node","appendChild","populateElementProperties","element","props","styleProps","styleKey","style","tag","attrs","children","doc","createElement","setAttribute","child","appendNode","BODY","IFRAME","IMG","DIV","STYLE","SCRIPT","HEAD","src","currentDocument","onload","onerror","onabort","createNode","SIBLING_PATTERN","context","selector","toArray","querySelectorAll","now","classList","prefix","splitWithShadow","SHADOW_SEPARATOR","transformPrefix","trim","hasChildCombinatorPrefix","startsWith","documentMode","substring","Element","HTMLDocument","documentElement","attachShadow","part","partNode","shadowRoot","isShadowSelector","selectNodesWithShadow","MUTATION_OBSERVER","RAF","MUTATION_OBSERVER_CONFIG","childList","subtree","VISIBILITY_STATE","VISIBLE","DELAY","MAX_POLLING_TIMEOUT","createError","Error","createPromise","executor","canUseMutationObserver","win","isFunction","awaitUsingMutationObserver","timeout","selectFunc","mutationObserver","nodes","isNonEmptyArray","disconnect","setTimeout","observe","canUseRequestAnimationFrame","awaitUsingRequestAnimation","execute","awaitUsingTimer","selectNodes","matches","msMatchesSelector","parentNode","removeChild","IFRAME_ATTRS","IFRAME_PROPS","display","width","height","appendNodeToDocument","awaitSelector","awaitSelectorInDocument","createNodeInDocument","fireImage","fireImageInDocument","fireOnPage","hiddenIframe","createIframe","body","fireInIframe","iframe","contentWindow","request","hideReferrer","url","array","mapFunction","concat","apply","itemCount","cookieName","namespace","topLevelCookieDomain","hostParts","location","hostname","toLowerCase","getLastArrayItems","domain","orgId","COOKIE_NAME_PREFIX","sanitizeOrgIdForCookieName","IDENTITY","CONSENT","CLUSTER","identityCookieName","getNamespacedCookieName","Boolean","getStorageByType","storageType","getItem","setItem","clear","removeItem","additionalNamespace","finalNamespace","baseNamespace","session","persistent","a","b","filter","x","isNaN","parsed","parseInt","isNumber","isString","fn","keyResolver","Map","has","string","targetLength","padString","originalString","repeatedPadString","lengthToAdd","prop","qs","sep","eq","regexp","maxKeys","len","idx","kstr","vstr","k","v","stringifyPrimitive","isFinite","ks","exports","require$$1","querystring","object","error","message","errorToStack","toError","newMessage","updateErrorMessage","defaultValue","Math","round","Number","date","YYYY","getFullYear","MM","padStart","getMonth","DD","getDate","hh","getHours","mm","getMinutes","ss","getSeconds","mmm","getMilliseconds","timezoneOffset","toInteger","getTimezoneOffset","ts","th","floor","abs","tm","getRandomValues","crypto","bind","msCrypto","rnds8","Uint8Array","whatwgRNG","rnds","mathRNG","r","random","byteToHex","toString","bytesToUuid","buf","offset","bth","v4","rng","ii","leftValidator","rightValidator","additionalMethods","combinedValidator","rightValidatorWithNullCheck","chain","isValid","assertValid","isBoolean","elementValidator","errors","validatedArray","subValue","literalValue","valueValidator","validatedObject","subKey","subPath","validatedValue","typeName","minimum","schema","isEmptyObject","subSchema","validators","valid","find","validator","values","DOMAIN_REGEX","isInteger","RegExp","isValidRegExp","base","default","_default","createDefaultValidator","required","requiredValidator","nullSafeChain","domainValidator","minimumInteger","minValue","createMinimumValidator","minimumNumber","integer","integerValidator","nonEmptyString","createNonEmptyValidator","nonEmptyArray","nonEmptyObject","regexpValidator","unique","createUnique","createUniqueValidator","anyOf","createAnyOfValidator","anything","arrayOf","createArrayOfValidator","nonEmpty","boolean","booleanValidator","callbackValidator","literal","createLiteralValidator","number","numberValidator","mapOfValues","valuesValidator","createMapOfValuesValidator","objectOf","noUnknownFields","createNoUnknownFieldsValidator","createObjectOfValidator","stringValidator","boundAnyOf","boundAnything","boundArrayOf","boundBoolean","boundCallback","boundLiteral","boundMapOfValues","boundObjectOf","boundString","boundEnumOf","AMBIGUOUS","AUTHENTICATED","LOGGED_OUT","authenticatedState","enumOf","id","code","primary","xid","console","locationSearch","createLogger","instanceName","createNamespacedStorage","getMonitors","parsedQueryString","queryString","storage","debugSessionValue","debugEnabled","debugEnabledWritableFromConfig","getDebugEnabled","setDebugEnabled","fromConfig","debugQueryParam","stringToBoolean","createComponentLogger","componentName","hookNames","createHook","componentRegistry","hookName","getLifecycleCallbacks","guardHook","memo","wrapForErrorHandling","stackMessage","stackError","catch","componentsByNamespace","commandsByName","lifecycleCallbacksByName","registerComponentCommands","componentCommandsByName","conflictingCommandNames","intersection","command","run","registerLifecycleCallbacks","componentLifecycleCallbacksByName","register","component","commands","lifecycle","getCommand","getCommandNames","sendFetchRequest","sendBeaconRequest","isRequestRetryable","getRequestRetryDelay","requestId","payload","useSendBeacon","stringifiedPayload","parsedPayload","logOnBeforeNetworkRequest","executeRequest","retriesAttempted","requestMethod","response","requestIsRetryable","requestRetryDelay","parsedBody","logOnNetworkResponse","statusCode","getHeader","logOnNetworkError","adobeEdgeHeader","headerParts","regionId","warn","IN","OUT","PENDING","GENERAL","DECLINED_CONSENT_ERROR_CODE","CONSENT_SOURCE_DEFAULT","CONSENT_SOURCE_INITIAL","CONSENT_SOURCE_NEW","createDeclinedConsentError","errorMessage","deferreds","runAll","shift","discardAll","awaitInitial","awaitInDefault","awaitIn","awaitOutDefault","awaitOut","awaitPending","returnImmediately","defer","in","awaitConsent","out","pending","withConsent","generalConsentState","setConsent","consentByPurpose","initializeConsent","defaultConsentByPurpose","storedConsentByPurpose","suspend","userXdm","userData","documentMayUnload","isFinalized","shouldSendEvent","throwIfEventFinalized","methodName","event","setUserXdm","setUserData","mergeXdm","xdm","mergeMeta","meta","mergeQuery","query","finalize","onBeforeEventSend","data","tempContent","getDocumentMayUnload","isEmpty","shouldSend","getViewName","web","webPageDetails","viewName","toJSON","RETRY_AFTER","ADOBE_EDGE","extractEdgeInfo","handle","warnings","getPayloadsByType","type","flatMap","fragment","getErrors","getWarnings","getEdge","CONFIGURE","SET_DEBUG","configureCommand","setDebugCommand","handleError","validateCommandOptions","configurePromise","getExecutor","commandNames","validatedOptions","logOnBeforeCommand","logOnCommandRejected","rawResult","logOnCommandResolved","COMMAND_DOC_URI","documentationUri","optionsValidator","validationError","invalidOptionsMessage","eventOptionsValidator","eventType","identityMap","validateIdentityMap","renderDecisions","decisionScopes","datasetId","createDataCollector","eventManager","sendEvent","validateUserEventOptions","documentUnloading","mergeId","createEvent","eventMergeId","collect","configValidators","createClickHandler","clickEvent","clickedElement","onClick","noop","config","enabled","clickCollectionEnabled","clickHandler","addEventListener","downloadLinkQualifier","urlStartsWithScheme","getAbsoluteUrlFromAnchorElement","loc","href","protocol","host","indx","pathname","lastIndexOf","isSupportedAnchorElement","tagName","onclick","isDownloadLink","linkUrl","clickedObj","re","download","isExitLink","currentHostname","determineLinkType","linkType","findSupportedAnchorElement","targetElement","anchorElement","linkName","webInteraction","URL","linkClicks","createActivityCollector","linkClick","createLinkClick","onComponentsRegistered","tools","attachClickActivityCollector","createResultLogMessage","idSync","success","spec","fireReferrerHideableImage","idSyncs","urlIdSyncs","thirdPartyCookiesEnabled","idMigrationEnabled","getIdentityOptionsValidator","namespaces","addEcidQueryToPayload","addQueryStringIdentityToPayload","ensureSingleIdentity","setLegacyEcid","handleResponseForIdSyncs","getEcidFromResponse","getIdentity","consent","appendIdentityToUrl","ecid","edge","onBeforeRequest","onResponse","onRequestFailure","getPayload","identity","ECID","appendIdentityToUrlOptionsValidator","getEcidFromVisitor","apexDomain","isPageSsl","amcvCookieName","getEcidFromLegacyCookies","secidCookieName","legacyEcidCookieValue","reg","match","getEcid","setEcid","extraOptions","sameSite","secure","adobe","optIn","optInOld","fetchPermissions","isApproved","Categories","Visitor","getInstance","awaitVisitorOptIn","getVisitor","visitor","getMarketingCloudVisitorID","processIdSyncs","doesIdentityCookieExist","setDomainForInitialIdentityPayload","addLegacyEcidToPayload","awaitIdentityCookie","obtainedIdentityPromise","allowRequestToGoWithoutIdentity","setIsIdentityEstablished","previousObtainedIdentityPromise","fetch","ecidNamespace","matchUserAgent","regexs","userAgent","regex","memoize","navigator","areThirdPartyCookiesSupportedByDefault","getBrowser","setUseIdThirdPartyDomain","getLegacyEcid","addEcidToPayload","hasIdentity","ecidToMigrate","LINK_TTL_SECONDS","dateProvider","queryStringValue","queryStringIdentityParam","properties","keyValue","TS","mcmid","MCMID","mcorgid","MCORGID","getTime","addIdentity","noIdentityCookieError","identityResultPayloads","ecidPayload","sendEdgeNetworkRequest","createIdentityRequestPayload","createIdentityRequest","namespaceCode","getAction","getUseSendBeacon","uuid","shouldUseThirdPartyDomain","isIdentityEstablished","getId","getUseIdThirdPartyDomain","dataCollectionRequestPayload","createRequest","mergeState","createMerger","createRequestPayload","createAddIdentity","createHasIdentity","addEvent","events","some","identityRequestPayload","URL_REGEX","getSeparator","adobemc","separator","createIdentity","injectGetEcidFromVisitor","loggingCookieJar","createLoggingCookieJar","legacyIdentity","createLegacyIdentity","injectDoesIdentityCookieExist","createGetIdentity","injectSetDomainForInitialIdentityPayload","injectAddLegacyEcidToPayload","injectAddQueryStringIdentityToPayload","search","injectAwaitIdentityCookie","injectEnsureSingleIdentity","injectProcessIdSyncs","injectHandleResponseForIdSyncs","injectAppendIdentityToUrl","createComponent","urlDestination","extraCookieOptions","processCookies","destinations","cookieDestinations","dest","ttlDays","processUrls","urlDestinations","processDestinations","processPushDestinations","retrievePullDestinations","createAudiences","injectProcessDestinations","processResponse","injectProcessResponse","DEFAULT_CONTENT_ITEM","DOM_ACTION","HTML_CONTENT_ITEM","JSON_CONTENT_ITEM","REDIRECT_ITEM","MEASUREMENT_SCHEMA","viewCache","isRenderDecisions","hasScopes","hasViewName","isNonEmptyString","createQueryDetails","scopes","isCacheInitialized","PAGE_WIDE_SCOPE","schemas","isInitialized","shouldFetchData","shouldUseCachedData","AUTHORING_ENABLED","REDIRECT_EXECUTION_ERROR","EMPTY_PROPOSITIONS","propositions","applyPropositionsOptionsValidator","metadata","fetchDataHandler","viewChangeHandler","onClickHandler","isAuthoringModeEnabled","showContainers","applyPropositions","onBeforeEvent","personalizationDetails","createPersonalizationDetails","decisionsDeferred","storeViews","validateApplyPropositionsOptions","innerHTML","root","global","this","CSS","cssEscape","index","codeUnit","firstCodeUnit","EQ_START","EQ_PATTERN","isNotEqSelector","splitWithEq","CSS_IDENTIFIER_PATTERN","replaceIdentifier","_","$1","$2","escapeIdentifiersInSelector","parseSelector","rawSelector","sel","selectNodesWithEq","nodesCount","getElementById","getAttribute","removeAttribute","priority","css","cssText","nextElementSibling","container","getParent","insertBefore","getNextSibling","childNodes","firstElementChild","nonce","querySelector","PREHIDING_ID","HIDING_STYLE_DEFINITION","styleNodes","hideElements","prehidingSelector","getNonce","textContent","head","showElements","removeNode","hideContainers","prehidingStyle","styleNode","text","SRC","isImage","loadImage","loadImages","images","image","is","isInlineStyleElement","finallyConstructor","constructor","reason","setTimeoutFunc","thisArg","_state","_handled","_value","_deferreds","doResolve","self","_immediateFn","cb","onFulfilled","onRejected","ret","newValue","finale","_unhandledRejectionFn","Handler","done","ex","prom","promiseFinally","remaining","res","race","setImmediate","getPromise","script","async","getElementsByTagName","isInlineScript","isRemoteScript","getInlineScripts","scripts","getRemoteScriptsUrls","executeInlineScripts","executeRemoteScripts","urls","loadScript","html","createFragment","addNonceToInlineStyleElements","elements","getChildNodes","scriptsUrls","appendHtml","firstChild","getFirstChild","insertHtmlBefore","insertAfter","styles","setStyle","getChildren","elementFrom","elementTo","settings","store","renderContent","renderFunc","executions","createAction","setHtml","customCode","prependHtml","setText","setAttributes","setImageSource","swapImage","setStyles","move","resize","rearrange","rearrangeChildren","insertHtmlAfter","replaceHtml","click","defaultContent","APPEND_HTML","HEAD_TAGS_SELECTOR","filterHeadContent","headNodes","outerHTML","action","isBlankString","logActionError","details","stack","logActionCompleted","executeAction","modules","actions","actionPromises","processedAction","preprocess","DISPLAY","INTERACT","mergeDecisionsMeta","decisionsMeta","DEFAULT_ACTION_TYPE","buildActions","decision","scope","scopeDetails","items","processMetas","actionResults","results","finalMetas","Set","executeActions","decisions","actionResultsPromises","responseHandler","matchesSelector","getMetasIfMatches","getClickMetasBySelector","matchesSelectorWithEq","selectors","metas","_experience","decisioning","personalization","collectClicks","getClickSelectors","viewStorage","viewStorageDeferred","decisionsPromise","getView","renderAttempted","resultingObject","addRenderAttemptedToDecisions","executeDecisions","viewDecisions","composePersonalizationResultingObject","VIEW_SCOPE_TYPE","splitItems","matched","nonMatched","createDecision","splitMergedMetricDecisions","matchedDecisions","unmatchedDecisions","splitDecisions","matchedItems","nonMatchedItems","appendScopeDecision","scopeDecisions","isViewScope","characteristics","scopeType","extractDecisionsByScope","pageWideScopeDecisions","nonPageWideScopeDecisions","viewScopeDecisions","groupDecisions","unprocessedDecisions","decisionsGroupedByRedirectItemSchema","mergedMetricDecisions","decisionsGroupedByRenderableSchemas","redirectDecisions","nonAutoRenderableDecisions","DECISIONS_HANDLE","autoRenderingHandler","nonRenderingHandler","handleRedirectDecisions","metasToArray","clickStorage","storeClickMetrics","getRedirectDetails","getPropositions","viewPropositions","renderablePropositions","getViewPropositions","buildFinalResult","SUPPORTED_SCHEMAS","filterItemsPredicate","updatePropositionItems","metadataForScope","actionType","filterPropositionsPredicate","proposition","preparePropositions","propositionsToExecute","createPersonalization","createCollect","createClickStorage","createViewCacheManager","initDomActionsModules","createExecuteDecisions","createRedirectHandler","createAutorenderingHandler","createApplyPropositions","createNonRenderingHandler","createOnResponseHandler","createFetchDataHandler","createOnClickHandler","createViewChangeHandler","webReferrer","referrer","getScreenOrientationViaProperty","orientation","screen","getScreenOrientationViaMediaQuery","matchMedia","device","screenHeight","screenWidth","screenOrientation","clientWidth","clientHeight","environment","browserDetails","viewportWidth","viewportHeight","placeContext","localTime","toISOStringLocal","localTimezoneOffset","timestamp","toISOString","implementationDetails","libraryName","version","libraryVersion","availableContexts","requiredContexts","configuredContexts","contexts","injectWeb","injectDevice","injectEnvironment","injectPlaceContext","injectTimestamp","optionalContexts","createContext","storedConsent","taskQueue","defaultConsent","sendSetConsentRequest","validateSetConsentOptions","consentHashStore","identityCookieExists","consentCookieExists","readCookieIfQueueEmpty","storedConsentObject","consentOptions","consentHashes","lookup","isNew","save","serialize","sort","getKey","standard","consentObjects","currentHashes","getCurrentHash","consentObject","rest","computeConsentHash","previousHash","consentRequestPayload","parseConsentCookie","consentCookieName","cookieValue","createConsentRequestPayload","createConsentRequest","categoryPairs","categoryPair","createPrivacy","createStoredConsent","createTaskQueue","injectSendSetConsentRequest","createConsentHashStore","createEventMergeId","createEventMerge","prepareLibraryInfo","allCommands","resultConfig","configs","createLibraryInfo","libraryInfo","getLibraryInfo","inferences","createMachineLearning","CONFIG_DOC_URI","buildSchema","coreConfigValidators","componentCreators","transformOptions","createConfig","logOnInstanceConfigured","getImmediatelyAvailableTools","ID_THIRD_PARTY","edgeConfigId","edgeDomain","EDGE_DOMAIN","edgeBasePath","EDGE_BASE_PATH","errorPrefix","operation","method","cache","credentials","headers","responseBody","status","XMLHttpRequest","onreadystatechange","readyState","getResponseHeader","responseText","onloadstart","responseType","open","setRequestHeader","withCredentials","send","sendBeacon","blob","Blob","notifyMonitors","monitors","dataWithContext","monitor","log","level","logOnInstanceCreated","messagesSuffix","EVENT_CANCELLATION_MESSAGE","createDataCollectionRequestPayload","createDataCollectionRequest","onResponseCallbackAggregator","createCallbackAggregator","onRequestFailureCallbackAggregator","throwError","runOnResponseCallbacks","runOnRequestFailureCallbacks","STATE_STORE_HANDLE_TYPE","cookiesToPayload","endpointDomain","isEndpointFirstParty","endsWith","state","cookiesEnabled","entries","isNamespacedCookieName","qualifyingCookieName","responseToCookies","stateItem","SameSite","maxAge","cookieTransfer","sendNetworkRequest","createResponse","processWarningsAndErrors","getLocationHint","ID_THIRD_PARTY_DOMAIN","locationHint","edgeBasePathWithLocationHint","apiVersion","networkResponse","returnValues","lifecycleOnResponseReturnValues","consumerOnResponseReturnValues","lifecycleOnBeforeRequestReturnValues","NO_CONTENT","TOO_MANY_REQUESTS","BAD_GATEWAY","SERVICE_UNAVAILABLE","GATEWAY_TIMEOUT","MESSAGE_PREFIX","bodyToLog","messageSuffix","warning","clusterCookieName","MAX_RETRIES","RETRYABLE_STATUS_CODES","FIRST_DELAY_MILLIS","INCREMENTAL_DELAY_MILLIS","MAX_RANDOM_VARIANCE_PERCENTAGE","calculateRetryDelay","targetDelay","maxVariance","minDelay","maxDelay","randomizedDelayWithinRange","getDelayFromHeader","headerValue","delayInMillis","headerValueInt","max","injectStorage","__alloyMonitors","createCoreConfigs","getApexDomain","injectSendFetchRequest","injectSendXhrRequest","injectFireReferrerHideableImage","createExecuteCommand","logController","createComponentRegistry","createLifecycle","buildAndValidateConfig","createCookieTransfer","injectSendBeaconRequest","injectSendNetworkRequest","injectProcessWarningsAndErrors","injectExtractEdgeInfo","injectCreateResponse","injectGetLocationHint","injectSendEdgeNetworkRequest","createConsentStateMachine","createConsent","createEventManager","initializeComponents","componentLogger","injectHandleError","injectExecuteCommand","instanceNames","__alloyNS","createLogController","instance","createInstanceFunction","queue","q","core"],"mappings":"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EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;EAIA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;AACA,eAAe,UAACG,aAAD,EAAgBC,cAAhB,EAA2D;EAAA,MAA3BC,iBAA2B,uEAAP,EAAO;;EACxE;EACA;EACA,MAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACxT,KAAD,EAAQE,IAAR,EAAiB;EACzC,WAAOoT,cAAc,CAACD,aAAa,CAACrT,KAAD,EAAQE,IAAR,CAAd,EAA6BA,IAA7B,CAArB;EACD,GAFD,CAHwE;EAOxE;;;EACA/C,EAAAA,mBAAM,CAACqW,iBAAD,EAAoBH,aAApB,EAAmCE,iBAAnC,CAAN;EACA,SAAOC,iBAAP;EACD,CAVD;;ECxDA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;EAIA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;AACA,uBAAe,UAACH,aAAD,EAAgBC,cAAhB,EAAgCC,iBAAhC,EAAsD;EACnE,MAAME,2BAA2B,GAAG,SAA9BA,2BAA8B,CAACzT,KAAD,EAAQE,IAAR;EAAA,WAClCF,KAAK,IAAI,IAAT,GAAgBA,KAAhB,GAAwBsT,cAAc,CAACtT,KAAD,EAAQE,IAAR,CADJ;EAAA,GAApC;;EAEA,SAAOwT,KAAK,CAACL,aAAD,EAAgBI,2BAAhB,EAA6CF,iBAA7C,CAAZ;EACD,CAJD;;EC5BA;EACA;EACA;EACA;EACA;AACA;EACA;EACA;EACA;EACA;EACA;AAEA,qBAAe,UAACI,OAAD,EAAU3T,KAAV,EAAiBE,IAAjB,EAAuB8P,OAAvB,EAAmC;EAChD,MAAI,CAAC2D,OAAL,EAAc;EACZ,UAAM,IAAIjL,KAAJ,OACAxI,IADA,oBACmB8P,OADnB,k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"}