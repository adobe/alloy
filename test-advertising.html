<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Advertising Component Test</title>

    <!-- Alloy initialization -->
    <script>
      !(function (n, o) {
        o.forEach(function (o) {
          n[o] ||
            ((n.__alloyNS = n.__alloyNS || []).push(o),
            (n[o] = function () {
              var u = arguments;
              return new Promise(function (i, l) {
                n[o].q.push([i, l, u]);
              });
            }),
            (n[o].q = []));
        });
      })(window, ["alloy"]);

      // Configure Alloy with advertising config
      alloy("configure", {
        debugEnabled: true,
        edgeConfigId: "test-edge-config",
        orgId: "test@AdobeOrg",
        // Updated advertising configuration with proper settings
        advertising: {
          // ID5 Configuration
          id5PartnerId: "1650",

          // RampID/LiveRamp Configuration
          liverampScriptPath: "https://ats.rlcdn.com/ats.js",

          // Display campaign configuration
          isDisplay: true,
        },
      });
    </script>

    <!-- Include your custom Alloy build -->
    <script src="./alloy.js" async></script>
  </head>
  <body>
    <h1>Advertising Component Test</h1>

    <div style="margin: 20px 0">
      <button id="checkBtn">Check Component Registration</button>
      <button id="testBtn">Test Ad Conversion</button>
      <button id="getIdsBtn">Get Advertising IDs</button>
    </div>

    <div
      id="output"
      style="
        margin-top: 20px;
        border: 1px solid #ccc;
        padding: 10px;
        min-height: 200px;
      "
    ></div>

    <script>
      // Output helper function
      function log(message) {
        const output = document.getElementById("output");
        const entry = document.createElement("div");
        entry.textContent = message;
        output.appendChild(entry);
        console.log(message);
      }

      // Check component registration
      document
        .getElementById("checkBtn")
        .addEventListener("click", function () {
          log("Checking component registration...");

          alloy("getLibraryInfo")
            .then(function (info) {
              log("Components: " + info.components.join(", "));
              log("Commands: " + info.commands.join(", "));

              if (info.components.includes("Advertising")) {
                log("✅ Advertising component is registered!");
              } else {
                log("❌ Advertising component is NOT registered");
              }

              if (info.commands.includes("sendAdConversion")) {
                log("✅ sendAdConversion command is available!");
              } else {
                log("❌ sendAdConversion command is NOT available");
              }
            })
            .catch(function (error) {
              log("❌ Error: " + error.message);
            });
        });

      // Test sendAdConversion command
      document.getElementById("testBtn").addEventListener("click", function () {
        log("Testing sendAdConversion command...");

        alloy("sendAdConversion", {
          viewThruEnabled: true,
          clickThruEnabled: false,
        })
          .then(function (result) {
            log("✅ Ad conversion successful!");
            log("Result: " + JSON.stringify(result));
          })
          .catch(function (error) {
            log("❌ Error sending ad conversion: " + error.message);
          });
      });

      // Test getAdvertisingIdentity command
      document
        .getElementById("getIdsBtn")
        .addEventListener("click", function () {
          log("Retrieving advertising identities...");

          alloy("getAdvertisingIdentity")
            .then(function (result) {
              log("✅ Advertising identities retrieved!");
              log("IDs: " + JSON.stringify(result));

              if (result.id5_id) {
                log("ID5 ID: " + result.id5_id);
              }

              if (result.ramp_id) {
                log("RampID: " + result.ramp_id);
              }

              if (result.surfer_id) {
                log("Surfer ID: " + result.surfer_id);
              }
            })
            .catch(function (error) {
              log(
                "❌ Error retrieving advertising identities: " + error.message,
              );
            });
        });
    </script>
  </body>
</html>
